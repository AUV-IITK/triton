<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Triton: RobotLocalization::RosFilter&lt; T &gt; Class Template Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../custom.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Triton
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>RobotLocalization</b></li><li class="navelem"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RosFilter</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="../../d3/ddb/classRobotLocalization_1_1RosFilter-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">RobotLocalization::RosFilter&lt; T &gt; Class Template Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a39ff4db9503a7f645093b086716b4a98"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a39ff4db9503a7f645093b086716b4a98">RosFilter</a> (ros::NodeHandle nh, ros::NodeHandle nh_priv, std::string node_name, std::vector&lt; double &gt; args=std::vector&lt; double &gt;())</td></tr>
<tr class="memdesc:a39ff4db9503a7f645093b086716b4a98"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a39ff4db9503a7f645093b086716b4a98">More...</a><br /></td></tr>
<tr class="separator:a39ff4db9503a7f645093b086716b4a98"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a392382adffded2b4390f2a780b81e0f4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a392382adffded2b4390f2a780b81e0f4">RosFilter</a> (ros::NodeHandle nh, ros::NodeHandle nh_priv, std::vector&lt; double &gt; args=std::vector&lt; double &gt;())</td></tr>
<tr class="memdesc:a392382adffded2b4390f2a780b81e0f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a392382adffded2b4390f2a780b81e0f4">More...</a><br /></td></tr>
<tr class="separator:a392382adffded2b4390f2a780b81e0f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d9207b728f5094c941745766b551bf1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a9d9207b728f5094c941745766b551bf1">~RosFilter</a> ()</td></tr>
<tr class="memdesc:a9d9207b728f5094c941745766b551bf1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a9d9207b728f5094c941745766b551bf1">More...</a><br /></td></tr>
<tr class="separator:a9d9207b728f5094c941745766b551bf1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71b6967fb2331e5bc701e37337b8df66"><td class="memItemLeft" align="right" valign="top"><a id="a71b6967fb2331e5bc701e37337b8df66"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a71b6967fb2331e5bc701e37337b8df66">initialize</a> ()</td></tr>
<tr class="memdesc:a71b6967fb2331e5bc701e37337b8df66"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize filter. <br /></td></tr>
<tr class="separator:a71b6967fb2331e5bc701e37337b8df66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a011b39dad94b84b7856f993518e4ae00"><td class="memItemLeft" align="right" valign="top"><a id="a011b39dad94b84b7856f993518e4ae00"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a011b39dad94b84b7856f993518e4ae00">reset</a> ()</td></tr>
<tr class="memdesc:a011b39dad94b84b7856f993518e4ae00"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resets the filter to its initial state. <br /></td></tr>
<tr class="separator:a011b39dad94b84b7856f993518e4ae00"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb177072d3c8ff1f4b9442ad41c2d754"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#afb177072d3c8ff1f4b9442ad41c2d754">toggleFilterProcessingCallback</a> (robot_localization::ToggleFilterProcessing::Request &amp;, robot_localization::ToggleFilterProcessing::Response &amp;)</td></tr>
<tr class="memdesc:afb177072d3c8ff1f4b9442ad41c2d754"><td class="mdescLeft">&#160;</td><td class="mdescRight">Service callback to toggle processing measurements for a standby mode but continuing to publish.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#afb177072d3c8ff1f4b9442ad41c2d754">More...</a><br /></td></tr>
<tr class="separator:afb177072d3c8ff1f4b9442ad41c2d754"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae5643fce575cd46f5cd77becf29d04ad"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ae5643fce575cd46f5cd77becf29d04ad">accelerationCallback</a> (const sensor_msgs::Imu::ConstPtr &amp;msg, const <a class="el" href="../../d0/d89/structRobotLocalization_1_1CallbackData.html">CallbackData</a> &amp;callbackData, const std::string &amp;targetFrame)</td></tr>
<tr class="memdesc:ae5643fce575cd46f5cd77becf29d04ad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback method for receiving all acceleration (IMU) messages.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ae5643fce575cd46f5cd77becf29d04ad">More...</a><br /></td></tr>
<tr class="separator:ae5643fce575cd46f5cd77becf29d04ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a89276e71a0258bbcf5686d552804fa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a4a89276e71a0258bbcf5686d552804fa">controlCallback</a> (const geometry_msgs::Twist::ConstPtr &amp;msg)</td></tr>
<tr class="memdesc:a4a89276e71a0258bbcf5686d552804fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback method for receiving non-stamped control input.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a4a89276e71a0258bbcf5686d552804fa">More...</a><br /></td></tr>
<tr class="separator:a4a89276e71a0258bbcf5686d552804fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5c164b66407c5b0bfd96565a858604b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ac5c164b66407c5b0bfd96565a858604b">controlCallback</a> (const geometry_msgs::TwistStamped::ConstPtr &amp;msg)</td></tr>
<tr class="memdesc:ac5c164b66407c5b0bfd96565a858604b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback method for receiving stamped control input.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ac5c164b66407c5b0bfd96565a858604b">More...</a><br /></td></tr>
<tr class="separator:ac5c164b66407c5b0bfd96565a858604b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f69cfe0fd2fea54446e4895b14c4c88"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6f69cfe0fd2fea54446e4895b14c4c88">enqueueMeasurement</a> (const std::string &amp;topicName, const Eigen::VectorXd &amp;measurement, const Eigen::MatrixXd &amp;measurementCovariance, const std::vector&lt; int &gt; &amp;updateVector, const double mahalanobisThresh, const ros::Time &amp;time)</td></tr>
<tr class="memdesc:a6f69cfe0fd2fea54446e4895b14c4c88"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a measurement to the queue of measurements to be processed.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6f69cfe0fd2fea54446e4895b14c4c88">More...</a><br /></td></tr>
<tr class="separator:a6f69cfe0fd2fea54446e4895b14c4c88"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4585957fbc3239e559eb509921f28a8f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a4585957fbc3239e559eb509921f28a8f">forceTwoD</a> (Eigen::VectorXd &amp;measurement, Eigen::MatrixXd &amp;measurementCovariance, std::vector&lt; int &gt; &amp;updateVector)</td></tr>
<tr class="memdesc:a4585957fbc3239e559eb509921f28a8f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Method for zeroing out 3D variables within measurements.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a4585957fbc3239e559eb509921f28a8f">More...</a><br /></td></tr>
<tr class="separator:a4585957fbc3239e559eb509921f28a8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2bfbf2f272e49f7727adbf180ba00356"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a2bfbf2f272e49f7727adbf180ba00356">getFilteredOdometryMessage</a> (nav_msgs::Odometry &amp;message)</td></tr>
<tr class="memdesc:a2bfbf2f272e49f7727adbf180ba00356"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the EKF's output for broadcasting.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a2bfbf2f272e49f7727adbf180ba00356">More...</a><br /></td></tr>
<tr class="separator:a2bfbf2f272e49f7727adbf180ba00356"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62f8eabae93ec1ca823b1b4ce65faa68"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a62f8eabae93ec1ca823b1b4ce65faa68">getFilteredAccelMessage</a> (geometry_msgs::AccelWithCovarianceStamped &amp;message)</td></tr>
<tr class="memdesc:a62f8eabae93ec1ca823b1b4ce65faa68"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the EKF's acceleration output for broadcasting.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a62f8eabae93ec1ca823b1b4ce65faa68">More...</a><br /></td></tr>
<tr class="separator:a62f8eabae93ec1ca823b1b4ce65faa68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3a763add884bc19e741a69d0720b27e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aa3a763add884bc19e741a69d0720b27e">imuCallback</a> (const sensor_msgs::Imu::ConstPtr &amp;msg, const std::string &amp;topicName, const <a class="el" href="../../d0/d89/structRobotLocalization_1_1CallbackData.html">CallbackData</a> &amp;poseCallbackData, const <a class="el" href="../../d0/d89/structRobotLocalization_1_1CallbackData.html">CallbackData</a> &amp;twistCallbackData, const <a class="el" href="../../d0/d89/structRobotLocalization_1_1CallbackData.html">CallbackData</a> &amp;accelCallbackData)</td></tr>
<tr class="memdesc:aa3a763add884bc19e741a69d0720b27e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback method for receiving all IMU messages.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aa3a763add884bc19e741a69d0720b27e">More...</a><br /></td></tr>
<tr class="separator:aa3a763add884bc19e741a69d0720b27e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0408a310dcd78472013e174c4f26061b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a0408a310dcd78472013e174c4f26061b">integrateMeasurements</a> (const ros::Time &amp;currentTime)</td></tr>
<tr class="memdesc:a0408a310dcd78472013e174c4f26061b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes all measurements in the measurement queue, in temporal order.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a0408a310dcd78472013e174c4f26061b">More...</a><br /></td></tr>
<tr class="separator:a0408a310dcd78472013e174c4f26061b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad817d2848eab32e6ee37c04939fda59d"><td class="memItemLeft" align="right" valign="top"><a id="ad817d2848eab32e6ee37c04939fda59d"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ad817d2848eab32e6ee37c04939fda59d">loadParams</a> ()</td></tr>
<tr class="memdesc:ad817d2848eab32e6ee37c04939fda59d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Loads all parameters from file. <br /></td></tr>
<tr class="separator:ad817d2848eab32e6ee37c04939fda59d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa64036d927adebecab93437b5a086748"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aa64036d927adebecab93437b5a086748">odometryCallback</a> (const nav_msgs::Odometry::ConstPtr &amp;msg, const std::string &amp;topicName, const <a class="el" href="../../d0/d89/structRobotLocalization_1_1CallbackData.html">CallbackData</a> &amp;poseCallbackData, const <a class="el" href="../../d0/d89/structRobotLocalization_1_1CallbackData.html">CallbackData</a> &amp;twistCallbackData)</td></tr>
<tr class="memdesc:aa64036d927adebecab93437b5a086748"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback method for receiving all odometry messages.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aa64036d927adebecab93437b5a086748">More...</a><br /></td></tr>
<tr class="separator:aa64036d927adebecab93437b5a086748"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54e73dcf610e672435582a72dfae57eb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a54e73dcf610e672435582a72dfae57eb">poseCallback</a> (const geometry_msgs::PoseWithCovarianceStamped::ConstPtr &amp;msg, const <a class="el" href="../../d0/d89/structRobotLocalization_1_1CallbackData.html">CallbackData</a> &amp;callbackData, const std::string &amp;targetFrame, const bool imuData)</td></tr>
<tr class="memdesc:a54e73dcf610e672435582a72dfae57eb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback method for receiving all pose messages.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a54e73dcf610e672435582a72dfae57eb">More...</a><br /></td></tr>
<tr class="separator:a54e73dcf610e672435582a72dfae57eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4a8a9f6bc2aa5358c04de11ed72a821"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ae4a8a9f6bc2aa5358c04de11ed72a821">setPoseCallback</a> (const geometry_msgs::PoseWithCovarianceStamped::ConstPtr &amp;msg)</td></tr>
<tr class="memdesc:ae4a8a9f6bc2aa5358c04de11ed72a821"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback method for manually setting/resetting the internal pose estimate.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ae4a8a9f6bc2aa5358c04de11ed72a821">More...</a><br /></td></tr>
<tr class="separator:ae4a8a9f6bc2aa5358c04de11ed72a821"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7e52d78645c3c68279d81d0b0feda25"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ae7e52d78645c3c68279d81d0b0feda25">setPoseSrvCallback</a> (robot_localization::SetPose::Request &amp;request, robot_localization::SetPose::Response &amp;)</td></tr>
<tr class="memdesc:ae7e52d78645c3c68279d81d0b0feda25"><td class="mdescLeft">&#160;</td><td class="mdescRight">Service callback for manually setting/resetting the internal pose estimate.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ae7e52d78645c3c68279d81d0b0feda25">More...</a><br /></td></tr>
<tr class="separator:ae7e52d78645c3c68279d81d0b0feda25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83c63cecbddfda272d9905c337b4ef4d"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a83c63cecbddfda272d9905c337b4ef4d">enableFilterSrvCallback</a> (std_srvs::Empty::Request &amp;, std_srvs::Empty::Response &amp;)</td></tr>
<tr class="memdesc:a83c63cecbddfda272d9905c337b4ef4d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Service callback for manually enable the filter.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a83c63cecbddfda272d9905c337b4ef4d">More...</a><br /></td></tr>
<tr class="separator:a83c63cecbddfda272d9905c337b4ef4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeec53ee745d41ed8e342c9688a4a3165"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aeec53ee745d41ed8e342c9688a4a3165">twistCallback</a> (const geometry_msgs::TwistWithCovarianceStamped::ConstPtr &amp;msg, const <a class="el" href="../../d0/d89/structRobotLocalization_1_1CallbackData.html">CallbackData</a> &amp;callbackData, const std::string &amp;targetFrame)</td></tr>
<tr class="memdesc:aeec53ee745d41ed8e342c9688a4a3165"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback method for receiving all twist messages.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aeec53ee745d41ed8e342c9688a4a3165">More...</a><br /></td></tr>
<tr class="separator:aeec53ee745d41ed8e342c9688a4a3165"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3de307ae35c1f4d6df8d3e19ec06d3e8"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a3de307ae35c1f4d6df8d3e19ec06d3e8">validateFilterOutput</a> (const nav_msgs::Odometry &amp;message)</td></tr>
<tr class="memdesc:a3de307ae35c1f4d6df8d3e19ec06d3e8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Validates filter outputs for NaNs and Infinite values.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a3de307ae35c1f4d6df8d3e19ec06d3e8">More...</a><br /></td></tr>
<tr class="separator:a3de307ae35c1f4d6df8d3e19ec06d3e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a8ea96b4c2cca39358e3c6e90cfe315bd"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8ea96b4c2cca39358e3c6e90cfe315bd">revertTo</a> (const double time)</td></tr>
<tr class="memdesc:a8ea96b4c2cca39358e3c6e90cfe315bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finds the latest filter state before the given timestamp and makes it the current state again.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8ea96b4c2cca39358e3c6e90cfe315bd">More...</a><br /></td></tr>
<tr class="separator:a8ea96b4c2cca39358e3c6e90cfe315bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0247b864a7b44e5310e7d05e69e41695"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a0247b864a7b44e5310e7d05e69e41695">saveFilterState</a> (<a class="el" href="../../d5/d5b/classRobotLocalization_1_1FilterBase.html">FilterBase</a> &amp;filter)</td></tr>
<tr class="memdesc:a0247b864a7b44e5310e7d05e69e41695"><td class="mdescLeft">&#160;</td><td class="mdescRight">Saves the current filter state in the queue of previous filter states.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a0247b864a7b44e5310e7d05e69e41695">More...</a><br /></td></tr>
<tr class="separator:a0247b864a7b44e5310e7d05e69e41695"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0e25abbb388e990c2062b6029329131"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ae0e25abbb388e990c2062b6029329131">clearExpiredHistory</a> (const double cutoffTime)</td></tr>
<tr class="memdesc:ae0e25abbb388e990c2062b6029329131"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes measurements and filter states older than the given cutoff time.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ae0e25abbb388e990c2062b6029329131">More...</a><br /></td></tr>
<tr class="separator:ae0e25abbb388e990c2062b6029329131"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ff13740c9af1413442122197e565caf"><td class="memItemLeft" align="right" valign="top"><a id="a1ff13740c9af1413442122197e565caf"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a1ff13740c9af1413442122197e565caf">clearMeasurementQueue</a> ()</td></tr>
<tr class="memdesc:a1ff13740c9af1413442122197e565caf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clears measurement queue. <br /></td></tr>
<tr class="separator:a1ff13740c9af1413442122197e565caf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8266b1436e1907c160d8c73a920e806c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8266b1436e1907c160d8c73a920e806c">addDiagnostic</a> (const int errLevel, const std::string &amp;topicAndClass, const std::string &amp;message, const bool staticDiag)</td></tr>
<tr class="memdesc:a8266b1436e1907c160d8c73a920e806c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a diagnostic message to the accumulating map and updates the error level.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8266b1436e1907c160d8c73a920e806c">More...</a><br /></td></tr>
<tr class="separator:a8266b1436e1907c160d8c73a920e806c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6217442419d2808d43eb8c613403b04b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6217442419d2808d43eb8c613403b04b">aggregateDiagnostics</a> (diagnostic_updater::DiagnosticStatusWrapper &amp;wrapper)</td></tr>
<tr class="memdesc:a6217442419d2808d43eb8c613403b04b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Aggregates all diagnostics so they can be published.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6217442419d2808d43eb8c613403b04b">More...</a><br /></td></tr>
<tr class="separator:a6217442419d2808d43eb8c613403b04b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b299c262fd69e029c8fc05ff19f150e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8b299c262fd69e029c8fc05ff19f150e">copyCovariance</a> (const double *arr, Eigen::MatrixXd &amp;covariance, const std::string &amp;topicName, const std::vector&lt; int &gt; &amp;updateVector, const size_t offset, const size_t dimension)</td></tr>
<tr class="memdesc:a8b299c262fd69e029c8fc05ff19f150e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Utility method for copying covariances from ROS covariance arrays to Eigen matrices.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8b299c262fd69e029c8fc05ff19f150e">More...</a><br /></td></tr>
<tr class="separator:a8b299c262fd69e029c8fc05ff19f150e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54eb6cf70f939ed188fa051c0dc50c97"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a54eb6cf70f939ed188fa051c0dc50c97">copyCovariance</a> (const Eigen::MatrixXd &amp;covariance, double *arr, const size_t dimension)</td></tr>
<tr class="memdesc:a54eb6cf70f939ed188fa051c0dc50c97"><td class="mdescLeft">&#160;</td><td class="mdescRight">Utility method for copying covariances from Eigen matrices to ROS covariance arrays.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a54eb6cf70f939ed188fa051c0dc50c97">More...</a><br /></td></tr>
<tr class="separator:a54eb6cf70f939ed188fa051c0dc50c97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b54251a0ae492ddf7bbb4112a915968"><td class="memItemLeft" align="right" valign="top">std::vector&lt; int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a2b54251a0ae492ddf7bbb4112a915968">loadUpdateConfig</a> (const std::string &amp;topicName)</td></tr>
<tr class="memdesc:a2b54251a0ae492ddf7bbb4112a915968"><td class="mdescLeft">&#160;</td><td class="mdescRight">Loads fusion settings from the config file.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a2b54251a0ae492ddf7bbb4112a915968">More...</a><br /></td></tr>
<tr class="separator:a2b54251a0ae492ddf7bbb4112a915968"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34b0ea97d422eaf92c36ed8085dea5c3"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a34b0ea97d422eaf92c36ed8085dea5c3">prepareAcceleration</a> (const sensor_msgs::Imu::ConstPtr &amp;msg, const std::string &amp;topicName, const std::string &amp;targetFrame, std::vector&lt; int &gt; &amp;updateVector, Eigen::VectorXd &amp;measurement, Eigen::MatrixXd &amp;measurementCovariance)</td></tr>
<tr class="memdesc:a34b0ea97d422eaf92c36ed8085dea5c3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepares an IMU message's linear acceleration for integration into the filter.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a34b0ea97d422eaf92c36ed8085dea5c3">More...</a><br /></td></tr>
<tr class="separator:a34b0ea97d422eaf92c36ed8085dea5c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2538569c164be4b396576252e69732bb"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a2538569c164be4b396576252e69732bb">preparePose</a> (const geometry_msgs::PoseWithCovarianceStamped::ConstPtr &amp;msg, const std::string &amp;topicName, const std::string &amp;targetFrame, const bool differential, const bool relative, const bool imuData, std::vector&lt; int &gt; &amp;updateVector, Eigen::VectorXd &amp;measurement, Eigen::MatrixXd &amp;measurementCovariance)</td></tr>
<tr class="memdesc:a2538569c164be4b396576252e69732bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepares a pose message for integration into the filter.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a2538569c164be4b396576252e69732bb">More...</a><br /></td></tr>
<tr class="separator:a2538569c164be4b396576252e69732bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01c500083730b2030e947e21d630e43b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a01c500083730b2030e947e21d630e43b">prepareTwist</a> (const geometry_msgs::TwistWithCovarianceStamped::ConstPtr &amp;msg, const std::string &amp;topicName, const std::string &amp;targetFrame, std::vector&lt; int &gt; &amp;updateVector, Eigen::VectorXd &amp;measurement, Eigen::MatrixXd &amp;measurementCovariance)</td></tr>
<tr class="memdesc:a01c500083730b2030e947e21d630e43b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepares a twist message for integration into the filter.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a01c500083730b2030e947e21d630e43b">More...</a><br /></td></tr>
<tr class="separator:a01c500083730b2030e947e21d630e43b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a258d93003041a34e8dc72f8004caed1c"><td class="memItemLeft" align="right" valign="top"><a id="a258d93003041a34e8dc72f8004caed1c"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a258d93003041a34e8dc72f8004caed1c">periodicUpdate</a> (const ros::TimerEvent &amp;event)</td></tr>
<tr class="memdesc:a258d93003041a34e8dc72f8004caed1c"><td class="mdescLeft">&#160;</td><td class="mdescRight">callback function which is called for periodic updates <br /></td></tr>
<tr class="separator:a258d93003041a34e8dc72f8004caed1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:adb32c6e37c800af6a02158c071f85d92"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#adb32c6e37c800af6a02158c071f85d92">disabledAtStartup_</a></td></tr>
<tr class="memdesc:adb32c6e37c800af6a02158c071f85d92"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start the Filter disabled at startup.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#adb32c6e37c800af6a02158c071f85d92">More...</a><br /></td></tr>
<tr class="separator:adb32c6e37c800af6a02158c071f85d92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5da2ab5cea26ee0545447a7643523d1b"><td class="memItemLeft" align="right" valign="top"><a id="a5da2ab5cea26ee0545447a7643523d1b"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5da2ab5cea26ee0545447a7643523d1b">enabled_</a></td></tr>
<tr class="memdesc:a5da2ab5cea26ee0545447a7643523d1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Whether the filter is enabled or not. See disabledAtStartup_. <br /></td></tr>
<tr class="separator:a5da2ab5cea26ee0545447a7643523d1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add0c677e8eb87145755b5cd18718a45a"><td class="memItemLeft" align="right" valign="top"><a id="add0c677e8eb87145755b5cd18718a45a"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#add0c677e8eb87145755b5cd18718a45a">predictToCurrentTime_</a></td></tr>
<tr class="memdesc:add0c677e8eb87145755b5cd18718a45a"><td class="mdescLeft">&#160;</td><td class="mdescRight">By default, the filter predicts and corrects up to the time of the latest measurement. If this is set to true, the filter does the same, but then also predicts up to the current time step. <br /></td></tr>
<tr class="separator:add0c677e8eb87145755b5cd18718a45a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91643ae3e6d532325acdc556b4b8f739"><td class="memItemLeft" align="right" valign="top"><a id="a91643ae3e6d532325acdc556b4b8f739"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a91643ae3e6d532325acdc556b4b8f739">printDiagnostics_</a></td></tr>
<tr class="memdesc:a91643ae3e6d532325acdc556b4b8f739"><td class="mdescLeft">&#160;</td><td class="mdescRight">Whether or not we print diagnostic messages to the /diagnostics topic. <br /></td></tr>
<tr class="separator:a91643ae3e6d532325acdc556b4b8f739"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28aacc455afa26b8d02fed733473577b"><td class="memItemLeft" align="right" valign="top"><a id="a28aacc455afa26b8d02fed733473577b"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a28aacc455afa26b8d02fed733473577b">publishAcceleration_</a></td></tr>
<tr class="memdesc:a28aacc455afa26b8d02fed733473577b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Whether we publish the acceleration. <br /></td></tr>
<tr class="separator:a28aacc455afa26b8d02fed733473577b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0372ebd630b868624f2dd931e6b28b7f"><td class="memItemLeft" align="right" valign="top"><a id="a0372ebd630b868624f2dd931e6b28b7f"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a0372ebd630b868624f2dd931e6b28b7f">publishTransform_</a></td></tr>
<tr class="memdesc:a0372ebd630b868624f2dd931e6b28b7f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Whether we publish the transform from the world_frame to the base_link_frame. <br /></td></tr>
<tr class="separator:a0372ebd630b868624f2dd931e6b28b7f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a16ad0452b5b52e64a93736d25cfeba95"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a16ad0452b5b52e64a93736d25cfeba95">resetOnTimeJump_</a></td></tr>
<tr class="memdesc:a16ad0452b5b52e64a93736d25cfeba95"><td class="mdescLeft">&#160;</td><td class="mdescRight">Whether to reset the filters when backwards jump in time is detected.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a16ad0452b5b52e64a93736d25cfeba95">More...</a><br /></td></tr>
<tr class="separator:a16ad0452b5b52e64a93736d25cfeba95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8779e25f3390bd1ddeba10401164a2c"><td class="memItemLeft" align="right" valign="top"><a id="ab8779e25f3390bd1ddeba10401164a2c"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ab8779e25f3390bd1ddeba10401164a2c">smoothLaggedData_</a></td></tr>
<tr class="memdesc:ab8779e25f3390bd1ddeba10401164a2c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Whether or not we use smoothing. <br /></td></tr>
<tr class="separator:ab8779e25f3390bd1ddeba10401164a2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac22190accdeee0fc2dcfb692e5d97038"><td class="memItemLeft" align="right" valign="top"><a id="ac22190accdeee0fc2dcfb692e5d97038"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ac22190accdeee0fc2dcfb692e5d97038">toggledOn_</a></td></tr>
<tr class="memdesc:ac22190accdeee0fc2dcfb692e5d97038"><td class="mdescLeft">&#160;</td><td class="mdescRight">Whether the filter should process new measurements or not. <br /></td></tr>
<tr class="separator:ac22190accdeee0fc2dcfb692e5d97038"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad06dbf8f35a49fc76daf1c16fdecd34d"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ad06dbf8f35a49fc76daf1c16fdecd34d">twoDMode_</a></td></tr>
<tr class="memdesc:ad06dbf8f35a49fc76daf1c16fdecd34d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Whether or not we're in 2D mode.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ad06dbf8f35a49fc76daf1c16fdecd34d">More...</a><br /></td></tr>
<tr class="separator:ad06dbf8f35a49fc76daf1c16fdecd34d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a714e2c0386cfa1ec147c52f897852532"><td class="memItemLeft" align="right" valign="top"><a id="a714e2c0386cfa1ec147c52f897852532"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a714e2c0386cfa1ec147c52f897852532">useControl_</a></td></tr>
<tr class="memdesc:a714e2c0386cfa1ec147c52f897852532"><td class="mdescLeft">&#160;</td><td class="mdescRight">Whether or not we use a control term. <br /></td></tr>
<tr class="separator:a714e2c0386cfa1ec147c52f897852532"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f51fcc879266f6091c5745c93bdc960"><td class="memItemLeft" align="right" valign="top"><a id="a5f51fcc879266f6091c5745c93bdc960"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5f51fcc879266f6091c5745c93bdc960">dynamicDiagErrorLevel_</a></td></tr>
<tr class="memdesc:a5f51fcc879266f6091c5745c93bdc960"><td class="mdescLeft">&#160;</td><td class="mdescRight">The max (worst) dynamic diagnostic level. <br /></td></tr>
<tr class="separator:a5f51fcc879266f6091c5745c93bdc960"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe66e5331dcd54686c7cf039ce856f71"><td class="memItemLeft" align="right" valign="top"><a id="afe66e5331dcd54686c7cf039ce856f71"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#afe66e5331dcd54686c7cf039ce856f71">staticDiagErrorLevel_</a></td></tr>
<tr class="memdesc:afe66e5331dcd54686c7cf039ce856f71"><td class="mdescLeft">&#160;</td><td class="mdescRight">The max (worst) static diagnostic level. <br /></td></tr>
<tr class="separator:afe66e5331dcd54686c7cf039ce856f71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad15b5063af8ae3b48cd44dfae17eaf9e"><td class="memItemLeft" align="right" valign="top"><a id="ad15b5063af8ae3b48cd44dfae17eaf9e"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ad15b5063af8ae3b48cd44dfae17eaf9e">frequency_</a></td></tr>
<tr class="memdesc:ad15b5063af8ae3b48cd44dfae17eaf9e"><td class="mdescLeft">&#160;</td><td class="mdescRight">The frequency of the run loop. <br /></td></tr>
<tr class="separator:ad15b5063af8ae3b48cd44dfae17eaf9e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26a3d07bd073104fd3a2ee004ba88581"><td class="memItemLeft" align="right" valign="top"><a id="a26a3d07bd073104fd3a2ee004ba88581"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a26a3d07bd073104fd3a2ee004ba88581">gravitationalAcc_</a></td></tr>
<tr class="memdesc:a26a3d07bd073104fd3a2ee004ba88581"><td class="mdescLeft">&#160;</td><td class="mdescRight">What is the acceleration in Z due to gravity (m/s^2)? Default is +9.80665. <br /></td></tr>
<tr class="separator:a26a3d07bd073104fd3a2ee004ba88581"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84b03bc70e9979c28deb044c545ba287"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a84b03bc70e9979c28deb044c545ba287">historyLength_</a></td></tr>
<tr class="memdesc:a84b03bc70e9979c28deb044c545ba287"><td class="mdescLeft">&#160;</td><td class="mdescRight">The depth of the history we track for smoothing/delayed measurement processing.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a84b03bc70e9979c28deb044c545ba287">More...</a><br /></td></tr>
<tr class="separator:a84b03bc70e9979c28deb044c545ba287"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a861a0f9c63867697b18377805572a00a"><td class="memItemLeft" align="right" valign="top"><a id="a861a0f9c63867697b18377805572a00a"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a861a0f9c63867697b18377805572a00a">minFrequency_</a></td></tr>
<tr class="memdesc:a861a0f9c63867697b18377805572a00a"><td class="mdescLeft">&#160;</td><td class="mdescRight">minimal frequency <br /></td></tr>
<tr class="separator:a861a0f9c63867697b18377805572a00a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98514257c62d3bcb14ec1e8446e0c0a3"><td class="memItemLeft" align="right" valign="top"><a id="a98514257c62d3bcb14ec1e8446e0c0a3"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a98514257c62d3bcb14ec1e8446e0c0a3">maxFrequency_</a></td></tr>
<tr class="memdesc:a98514257c62d3bcb14ec1e8446e0c0a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">maximal frequency <br /></td></tr>
<tr class="separator:a98514257c62d3bcb14ec1e8446e0c0a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c0cfc2c5d47061bf2ae272b7532b51b"><td class="memItemLeft" align="right" valign="top"><a id="a6c0cfc2c5d47061bf2ae272b7532b51b"></a>
std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6c0cfc2c5d47061bf2ae272b7532b51b">baseLinkFrameId_</a></td></tr>
<tr class="memdesc:a6c0cfc2c5d47061bf2ae272b7532b51b"><td class="mdescLeft">&#160;</td><td class="mdescRight">tf frame name for the robot's body frame <br /></td></tr>
<tr class="separator:a6c0cfc2c5d47061bf2ae272b7532b51b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b00cc26b36b9039f120eecf7a7d4ab1"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a4b00cc26b36b9039f120eecf7a7d4ab1">baseLinkOutputFrameId_</a></td></tr>
<tr class="memdesc:a4b00cc26b36b9039f120eecf7a7d4ab1"><td class="mdescLeft">&#160;</td><td class="mdescRight">tf frame name for the robot's body frame  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a4b00cc26b36b9039f120eecf7a7d4ab1">More...</a><br /></td></tr>
<tr class="separator:a4b00cc26b36b9039f120eecf7a7d4ab1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b184469b63dfe6261dea4a92b5b23a6"><td class="memItemLeft" align="right" valign="top"><a id="a2b184469b63dfe6261dea4a92b5b23a6"></a>
std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a2b184469b63dfe6261dea4a92b5b23a6">mapFrameId_</a></td></tr>
<tr class="memdesc:a2b184469b63dfe6261dea4a92b5b23a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">tf frame name for the robot's map (world-fixed) frame <br /></td></tr>
<tr class="separator:a2b184469b63dfe6261dea4a92b5b23a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6ef41c43d134fb109fe8996a723bcf4"><td class="memItemLeft" align="right" valign="top"><a id="ae6ef41c43d134fb109fe8996a723bcf4"></a>
std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ae6ef41c43d134fb109fe8996a723bcf4">odomFrameId_</a></td></tr>
<tr class="memdesc:ae6ef41c43d134fb109fe8996a723bcf4"><td class="mdescLeft">&#160;</td><td class="mdescRight">tf frame name for the robot's odometry (world-fixed) frame <br /></td></tr>
<tr class="separator:ae6ef41c43d134fb109fe8996a723bcf4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37c23d6c10a630fe33e74376898fc5c8"><td class="memItemLeft" align="right" valign="top"><a id="a37c23d6c10a630fe33e74376898fc5c8"></a>
std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a37c23d6c10a630fe33e74376898fc5c8">worldFrameId_</a></td></tr>
<tr class="memdesc:a37c23d6c10a630fe33e74376898fc5c8"><td class="mdescLeft">&#160;</td><td class="mdescRight">tf frame name that is the parent frame of the transform that this node will calculate and broadcast. <br /></td></tr>
<tr class="separator:a37c23d6c10a630fe33e74376898fc5c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa618bc022956c37dbfd62c8eeb5eb454"><td class="memItemLeft" align="right" valign="top"><a id="aa618bc022956c37dbfd62c8eeb5eb454"></a>
std::ofstream&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aa618bc022956c37dbfd62c8eeb5eb454">debugStream_</a></td></tr>
<tr class="memdesc:aa618bc022956c37dbfd62c8eeb5eb454"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used for outputting debug messages. <br /></td></tr>
<tr class="separator:aa618bc022956c37dbfd62c8eeb5eb454"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a394f86657e02d8c445ce2eaba71153a3"><td class="memItemLeft" align="right" valign="top"><a id="a394f86657e02d8c445ce2eaba71153a3"></a>
std::vector&lt; std::string &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a394f86657e02d8c445ce2eaba71153a3">stateVariableNames_</a></td></tr>
<tr class="memdesc:a394f86657e02d8c445ce2eaba71153a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Contains the state vector variable names in string format. <br /></td></tr>
<tr class="separator:a394f86657e02d8c445ce2eaba71153a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c36b4e9478bf44a96f74687cc882c6b"><td class="memItemLeft" align="right" valign="top"><a id="a1c36b4e9478bf44a96f74687cc882c6b"></a>
std::vector&lt; ros::Subscriber &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a1c36b4e9478bf44a96f74687cc882c6b">topicSubs_</a></td></tr>
<tr class="memdesc:a1c36b4e9478bf44a96f74687cc882c6b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Vector to hold our subscribers until they go out of scope. <br /></td></tr>
<tr class="separator:a1c36b4e9478bf44a96f74687cc882c6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b48b5bb099cf8c0bd283b6fd5661424"><td class="memItemLeft" align="right" valign="top">std::map&lt; std::string, std::string &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a7b48b5bb099cf8c0bd283b6fd5661424">dynamicDiagnostics_</a></td></tr>
<tr class="memdesc:a7b48b5bb099cf8c0bd283b6fd5661424"><td class="mdescLeft">&#160;</td><td class="mdescRight">This object accumulates dynamic diagnostics, e.g., diagnostics relating to sensor data.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a7b48b5bb099cf8c0bd283b6fd5661424">More...</a><br /></td></tr>
<tr class="separator:a7b48b5bb099cf8c0bd283b6fd5661424"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a706c4ea2aad03711195e856dbd2e6796"><td class="memItemLeft" align="right" valign="top">std::map&lt; std::string, tf2::Transform &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a706c4ea2aad03711195e856dbd2e6796">initialMeasurements_</a></td></tr>
<tr class="memdesc:a706c4ea2aad03711195e856dbd2e6796"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stores the first measurement from each topic for relative measurements.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a706c4ea2aad03711195e856dbd2e6796">More...</a><br /></td></tr>
<tr class="separator:a706c4ea2aad03711195e856dbd2e6796"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a473c0f797fcd9677b1005637ee159ae4"><td class="memItemLeft" align="right" valign="top">std::map&lt; std::string, ros::Time &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a473c0f797fcd9677b1005637ee159ae4">lastMessageTimes_</a></td></tr>
<tr class="memdesc:a473c0f797fcd9677b1005637ee159ae4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Store the last time a message from each topic was received.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a473c0f797fcd9677b1005637ee159ae4">More...</a><br /></td></tr>
<tr class="separator:a473c0f797fcd9677b1005637ee159ae4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38800f148299b693366730b3488812b0"><td class="memItemLeft" align="right" valign="top"><a id="a38800f148299b693366730b3488812b0"></a>
std::map&lt; std::string, Eigen::MatrixXd &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a38800f148299b693366730b3488812b0">previousMeasurementCovariances_</a></td></tr>
<tr class="memdesc:a38800f148299b693366730b3488812b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">We also need the previous covariance matrix for differential data. <br /></td></tr>
<tr class="separator:a38800f148299b693366730b3488812b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a368ffffbd5a044c29342add42d1971a9"><td class="memItemLeft" align="right" valign="top">std::map&lt; std::string, tf2::Transform &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a368ffffbd5a044c29342add42d1971a9">previousMeasurements_</a></td></tr>
<tr class="memdesc:a368ffffbd5a044c29342add42d1971a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stores the last measurement from a given topic for differential integration.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a368ffffbd5a044c29342add42d1971a9">More...</a><br /></td></tr>
<tr class="separator:a368ffffbd5a044c29342add42d1971a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27854c71e92da52d6a7c7a004efa1736"><td class="memItemLeft" align="right" valign="top"><a id="a27854c71e92da52d6a7c7a004efa1736"></a>
std::map&lt; std::string, bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a27854c71e92da52d6a7c7a004efa1736">removeGravitationalAcc_</a></td></tr>
<tr class="memdesc:a27854c71e92da52d6a7c7a004efa1736"><td class="mdescLeft">&#160;</td><td class="mdescRight">If including acceleration for each IMU input, whether or not we remove acceleration due to gravity. <br /></td></tr>
<tr class="separator:a27854c71e92da52d6a7c7a004efa1736"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5df01bed8ccaf9deaadd869518c60310"><td class="memItemLeft" align="right" valign="top">std::map&lt; std::string, std::string &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5df01bed8ccaf9deaadd869518c60310">staticDiagnostics_</a></td></tr>
<tr class="memdesc:a5df01bed8ccaf9deaadd869518c60310"><td class="mdescLeft">&#160;</td><td class="mdescRight">This object accumulates static diagnostics, e.g., diagnostics relating to the configuration parameters.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5df01bed8ccaf9deaadd869518c60310">More...</a><br /></td></tr>
<tr class="separator:a5df01bed8ccaf9deaadd869518c60310"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1dc8ec7162549a3f935159fc4df143d6"><td class="memItemLeft" align="right" valign="top"><a id="a1dc8ec7162549a3f935159fc4df143d6"></a>
Eigen::VectorXd&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a1dc8ec7162549a3f935159fc4df143d6">latestControl_</a></td></tr>
<tr class="memdesc:a1dc8ec7162549a3f935159fc4df143d6"><td class="mdescLeft">&#160;</td><td class="mdescRight">The most recent control input. <br /></td></tr>
<tr class="separator:a1dc8ec7162549a3f935159fc4df143d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aefbc737fbacf16090e2f17d87de9b186"><td class="memItemLeft" align="right" valign="top">geometry_msgs::TransformStamped&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aefbc737fbacf16090e2f17d87de9b186">worldBaseLinkTransMsg_</a></td></tr>
<tr class="memdesc:aefbc737fbacf16090e2f17d87de9b186"><td class="mdescLeft">&#160;</td><td class="mdescRight">Message that contains our latest transform (i.e., state)  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aefbc737fbacf16090e2f17d87de9b186">More...</a><br /></td></tr>
<tr class="separator:aefbc737fbacf16090e2f17d87de9b186"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa42f6af65d32b9bec34c88974822fea9"><td class="memItemLeft" align="right" valign="top"><a id="aa42f6af65d32b9bec34c88974822fea9"></a>
ros::Time&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aa42f6af65d32b9bec34c88974822fea9">lastDiagTime_</a></td></tr>
<tr class="memdesc:aa42f6af65d32b9bec34c88974822fea9"><td class="mdescLeft">&#160;</td><td class="mdescRight">last call of periodicUpdate <br /></td></tr>
<tr class="separator:aa42f6af65d32b9bec34c88974822fea9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9df5f56cfb6d02a4bc22c8b68ad115f"><td class="memItemLeft" align="right" valign="top">ros::Time&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aa9df5f56cfb6d02a4bc22c8b68ad115f">lastSetPoseTime_</a></td></tr>
<tr class="memdesc:aa9df5f56cfb6d02a4bc22c8b68ad115f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Store the last time set pose message was received.  <a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aa9df5f56cfb6d02a4bc22c8b68ad115f">More...</a><br /></td></tr>
<tr class="separator:aa9df5f56cfb6d02a4bc22c8b68ad115f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a94ccac9ce6b71ee1a36b19a8ba33b0ac"><td class="memItemLeft" align="right" valign="top"><a id="a94ccac9ce6b71ee1a36b19a8ba33b0ac"></a>
ros::Time&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a94ccac9ce6b71ee1a36b19a8ba33b0ac">latestControlTime_</a></td></tr>
<tr class="memdesc:a94ccac9ce6b71ee1a36b19a8ba33b0ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">The time of the most recent control input. <br /></td></tr>
<tr class="separator:a94ccac9ce6b71ee1a36b19a8ba33b0ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6a90f7afc20e69a148d84e4e41330f3"><td class="memItemLeft" align="right" valign="top"><a id="ab6a90f7afc20e69a148d84e4e41330f3"></a>
ros::Duration&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ab6a90f7afc20e69a148d84e4e41330f3">tfTimeOffset_</a></td></tr>
<tr class="memdesc:ab6a90f7afc20e69a148d84e4e41330f3"><td class="mdescLeft">&#160;</td><td class="mdescRight">For future (or past) dating the world_frame-&gt;base_link_frame transform. <br /></td></tr>
<tr class="separator:ab6a90f7afc20e69a148d84e4e41330f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c57fe5f94f02e033ac78939966ad366"><td class="memItemLeft" align="right" valign="top"><a id="a5c57fe5f94f02e033ac78939966ad366"></a>
ros::Duration&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5c57fe5f94f02e033ac78939966ad366">tfTimeout_</a></td></tr>
<tr class="memdesc:a5c57fe5f94f02e033ac78939966ad366"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parameter that specifies the how long we wait for a transform to become available. <br /></td></tr>
<tr class="separator:a5c57fe5f94f02e033ac78939966ad366"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad87227f3976d25577258b1c2cbf8c17a"><td class="memItemLeft" align="right" valign="top"><a id="ad87227f3976d25577258b1c2cbf8c17a"></a>
ros::ServiceServer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ad87227f3976d25577258b1c2cbf8c17a">toggleFilterProcessingSrv_</a></td></tr>
<tr class="memdesc:ad87227f3976d25577258b1c2cbf8c17a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Service that allows another node to toggle on/off filter processing while still publishing. Uses a robot_localization ToggleFilterProcessing service. <br /></td></tr>
<tr class="separator:ad87227f3976d25577258b1c2cbf8c17a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d41cde61a5436978a65531dbd08accd"><td class="memItemLeft" align="right" valign="top"><a id="a6d41cde61a5436978a65531dbd08accd"></a>
ros::Timer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6d41cde61a5436978a65531dbd08accd">periodicUpdateTimer_</a></td></tr>
<tr class="memdesc:a6d41cde61a5436978a65531dbd08accd"><td class="mdescLeft">&#160;</td><td class="mdescRight">timer calling periodicUpdate <br /></td></tr>
<tr class="separator:a6d41cde61a5436978a65531dbd08accd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37a9eb3abb974e2079e34843dbd69af3"><td class="memItemLeft" align="right" valign="top"><a id="a37a9eb3abb974e2079e34843dbd69af3"></a>
FilterStateHistoryDeque&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a37a9eb3abb974e2079e34843dbd69af3">filterStateHistory_</a></td></tr>
<tr class="memdesc:a37a9eb3abb974e2079e34843dbd69af3"><td class="mdescLeft">&#160;</td><td class="mdescRight">An implicitly time ordered queue of past filter states used for smoothing. <br /></td></tr>
<tr class="separator:a37a9eb3abb974e2079e34843dbd69af3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb7a3b61549bad2cc4e84d803c038c5f"><td class="memItemLeft" align="right" valign="top"><a id="aeb7a3b61549bad2cc4e84d803c038c5f"></a>
MeasurementHistoryDeque&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aeb7a3b61549bad2cc4e84d803c038c5f">measurementHistory_</a></td></tr>
<tr class="memdesc:aeb7a3b61549bad2cc4e84d803c038c5f"><td class="mdescLeft">&#160;</td><td class="mdescRight">A deque of previous measurements which is implicitly ordered from earliest to latest measurement. <br /></td></tr>
<tr class="separator:aeb7a3b61549bad2cc4e84d803c038c5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a233bcdab40b3b0d7db316ffd0c09f2ce"><td class="memItemLeft" align="right" valign="top"><a id="a233bcdab40b3b0d7db316ffd0c09f2ce"></a>
MeasurementQueue&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a233bcdab40b3b0d7db316ffd0c09f2ce">measurementQueue_</a></td></tr>
<tr class="memdesc:a233bcdab40b3b0d7db316ffd0c09f2ce"><td class="mdescLeft">&#160;</td><td class="mdescRight">We process measurements by queueing them up in callbacks and processing them all at once within each iteration. <br /></td></tr>
<tr class="separator:a233bcdab40b3b0d7db316ffd0c09f2ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6061a5284caef5912ec015e6caaf00a0"><td class="memItemLeft" align="right" valign="top"><a id="a6061a5284caef5912ec015e6caaf00a0"></a>
T&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a></td></tr>
<tr class="memdesc:a6061a5284caef5912ec015e6caaf00a0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Our filter (EKF, UKF, etc.) <br /></td></tr>
<tr class="separator:a6061a5284caef5912ec015e6caaf00a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03a0adf9f3be7b576044755a76b12b3b"><td class="memItemLeft" align="right" valign="top"><a id="a03a0adf9f3be7b576044755a76b12b3b"></a>
ros::NodeHandle&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a03a0adf9f3be7b576044755a76b12b3b">nh_</a></td></tr>
<tr class="memdesc:a03a0adf9f3be7b576044755a76b12b3b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Node handle. <br /></td></tr>
<tr class="separator:a03a0adf9f3be7b576044755a76b12b3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe50aea17d383427f39c3b3c57617f12"><td class="memItemLeft" align="right" valign="top"><a id="abe50aea17d383427f39c3b3c57617f12"></a>
ros::NodeHandle&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#abe50aea17d383427f39c3b3c57617f12">nhLocal_</a></td></tr>
<tr class="memdesc:abe50aea17d383427f39c3b3c57617f12"><td class="mdescLeft">&#160;</td><td class="mdescRight">Local node handle (for params) <br /></td></tr>
<tr class="separator:abe50aea17d383427f39c3b3c57617f12"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a023f7d6bface4ae490ac876178c00477"><td class="memItemLeft" align="right" valign="top"><a id="a023f7d6bface4ae490ac876178c00477"></a>
ros::Publisher&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a023f7d6bface4ae490ac876178c00477">accelPub_</a></td></tr>
<tr class="memdesc:a023f7d6bface4ae490ac876178c00477"><td class="mdescLeft">&#160;</td><td class="mdescRight">optional acceleration publisher <br /></td></tr>
<tr class="separator:a023f7d6bface4ae490ac876178c00477"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed5b71140cfc7395ce2a20fa0dc86c4d"><td class="memItemLeft" align="right" valign="top"><a id="aed5b71140cfc7395ce2a20fa0dc86c4d"></a>
ros::Publisher&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aed5b71140cfc7395ce2a20fa0dc86c4d">positionPub_</a></td></tr>
<tr class="memdesc:aed5b71140cfc7395ce2a20fa0dc86c4d"><td class="mdescLeft">&#160;</td><td class="mdescRight">position publisher <br /></td></tr>
<tr class="separator:aed5b71140cfc7395ce2a20fa0dc86c4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5d413ed595a2cbbaa486ef380c5ab9c"><td class="memItemLeft" align="right" valign="top"><a id="ad5d413ed595a2cbbaa486ef380c5ab9c"></a>
ros::Subscriber&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ad5d413ed595a2cbbaa486ef380c5ab9c">controlSub_</a></td></tr>
<tr class="memdesc:ad5d413ed595a2cbbaa486ef380c5ab9c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Subscribes to the control input topic. <br /></td></tr>
<tr class="separator:ad5d413ed595a2cbbaa486ef380c5ab9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7beb7c4588a1b41f44d44e08c81caab1"><td class="memItemLeft" align="right" valign="top"><a id="a7beb7c4588a1b41f44d44e08c81caab1"></a>
ros::Subscriber&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a7beb7c4588a1b41f44d44e08c81caab1">setPoseSub_</a></td></tr>
<tr class="memdesc:a7beb7c4588a1b41f44d44e08c81caab1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Subscribes to the set_pose topic (usually published from rviz). Message type is geometry_msgs/PoseWithCovarianceStamped. <br /></td></tr>
<tr class="separator:a7beb7c4588a1b41f44d44e08c81caab1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab027ce32b0c4400893b03c5ed629c65b"><td class="memItemLeft" align="right" valign="top"><a id="ab027ce32b0c4400893b03c5ed629c65b"></a>
ros::ServiceServer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ab027ce32b0c4400893b03c5ed629c65b">enableFilterSrv_</a></td></tr>
<tr class="memdesc:ab027ce32b0c4400893b03c5ed629c65b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Service that allows another node to enable the filter. Uses a standard Empty service. <br /></td></tr>
<tr class="separator:ab027ce32b0c4400893b03c5ed629c65b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa58d71c5e43eaf68b452aaec7f09992f"><td class="memItemLeft" align="right" valign="top"><a id="aa58d71c5e43eaf68b452aaec7f09992f"></a>
ros::ServiceServer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aa58d71c5e43eaf68b452aaec7f09992f">setPoseSrv_</a></td></tr>
<tr class="memdesc:aa58d71c5e43eaf68b452aaec7f09992f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Service that allows another node to change the current state and recieve a confirmation. Uses a custom SetPose service. <br /></td></tr>
<tr class="separator:aa58d71c5e43eaf68b452aaec7f09992f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae88f4c45d5209d03d53fc6a4d1bb93ab"><td class="memItemLeft" align="right" valign="top"><a id="ae88f4c45d5209d03d53fc6a4d1bb93ab"></a>
diagnostic_updater::Updater&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ae88f4c45d5209d03d53fc6a4d1bb93ab">diagnosticUpdater_</a></td></tr>
<tr class="memdesc:ae88f4c45d5209d03d53fc6a4d1bb93ab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used for updating the diagnostics. <br /></td></tr>
<tr class="separator:ae88f4c45d5209d03d53fc6a4d1bb93ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aacaed6dea7d7bd1dc1d03eeddf002c29"><td class="memItemLeft" align="right" valign="top"><a id="aacaed6dea7d7bd1dc1d03eeddf002c29"></a>
tf2_ros::Buffer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aacaed6dea7d7bd1dc1d03eeddf002c29">tfBuffer_</a></td></tr>
<tr class="memdesc:aacaed6dea7d7bd1dc1d03eeddf002c29"><td class="mdescLeft">&#160;</td><td class="mdescRight">Transform buffer for managing coordinate transforms. <br /></td></tr>
<tr class="separator:aacaed6dea7d7bd1dc1d03eeddf002c29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1941fdd54f6ac9f212dafba9330b5002"><td class="memItemLeft" align="right" valign="top"><a id="a1941fdd54f6ac9f212dafba9330b5002"></a>
tf2_ros::TransformListener&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a1941fdd54f6ac9f212dafba9330b5002">tfListener_</a></td></tr>
<tr class="memdesc:a1941fdd54f6ac9f212dafba9330b5002"><td class="mdescLeft">&#160;</td><td class="mdescRight">Transform listener for receiving transforms. <br /></td></tr>
<tr class="separator:a1941fdd54f6ac9f212dafba9330b5002"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b573989259338afb3aba497140f8568"><td class="memItemLeft" align="right" valign="top"><a id="a0b573989259338afb3aba497140f8568"></a>
tf2_ros::TransformBroadcaster&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a0b573989259338afb3aba497140f8568">worldTransformBroadcaster_</a></td></tr>
<tr class="memdesc:a0b573989259338afb3aba497140f8568"><td class="mdescLeft">&#160;</td><td class="mdescRight">broadcaster of worldTransform tfs <br /></td></tr>
<tr class="separator:a0b573989259338afb3aba497140f8568"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03543a3b187133e09ebe769157de2c01"><td class="memItemLeft" align="right" valign="top"><a id="a03543a3b187133e09ebe769157de2c01"></a>
std::unique_ptr&lt; diagnostic_updater::HeaderlessTopicDiagnostic &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a03543a3b187133e09ebe769157de2c01">freqDiag_</a></td></tr>
<tr class="memdesc:a03543a3b187133e09ebe769157de2c01"><td class="mdescLeft">&#160;</td><td class="mdescRight">optional signaling diagnostic frequency <br /></td></tr>
<tr class="separator:a03543a3b187133e09ebe769157de2c01"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h3>template&lt;class T&gt;<br />
class RobotLocalization::RosFilter&lt; T &gt;</h3>


<p class="definition">Definition at line <a class="el" href="../../db/d3c/ros__filter_8h_source.html#l00106">106</a> of file <a class="el" href="../../db/d3c/ros__filter_8h_source.html">ros_filter.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a39ff4db9503a7f645093b086716b4a98"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39ff4db9503a7f645093b086716b4a98">&#9670;&nbsp;</a></span>RosFilter() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::<a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RosFilter</a> </td>
          <td>(</td>
          <td class="paramtype">ros::NodeHandle&#160;</td>
          <td class="paramname"><em>nh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ros::NodeHandle&#160;</td>
          <td class="paramname"><em>nh_priv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>node_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; double &gt;&#160;</td>
          <td class="paramname"><em>args</em> = <code>std::vector&lt;double&gt;()</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Constructor. </p>
<p>The <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RosFilter</a> constructor makes sure that anyone using this template is doing so with the correct object type </p>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l00049">49</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                                                  :</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#adb32c6e37c800af6a02158c071f85d92">disabledAtStartup_</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5da2ab5cea26ee0545447a7643523d1b">enabled_</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#add0c677e8eb87145755b5cd18718a45a">predictToCurrentTime_</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a91643ae3e6d532325acdc556b4b8f739">printDiagnostics_</a>(<span class="keyword">true</span>),</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a28aacc455afa26b8d02fed733473577b">publishAcceleration_</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a0372ebd630b868624f2dd931e6b28b7f">publishTransform_</a>(<span class="keyword">true</span>),</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a16ad0452b5b52e64a93736d25cfeba95">resetOnTimeJump_</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ab8779e25f3390bd1ddeba10401164a2c">smoothLaggedData_</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ac22190accdeee0fc2dcfb692e5d97038">toggledOn_</a>(<span class="keyword">true</span>),</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ad06dbf8f35a49fc76daf1c16fdecd34d">twoDMode_</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a714e2c0386cfa1ec147c52f897852532">useControl_</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5f51fcc879266f6091c5745c93bdc960">dynamicDiagErrorLevel_</a>(diagnostic_msgs::DiagnosticStatus::OK),</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#afe66e5331dcd54686c7cf039ce856f71">staticDiagErrorLevel_</a>(diagnostic_msgs::DiagnosticStatus::OK),</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ad15b5063af8ae3b48cd44dfae17eaf9e">frequency_</a>(30.0),</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a26a3d07bd073104fd3a2ee004ba88581">gravitationalAcc_</a>(9.80665),</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a84b03bc70e9979c28deb044c545ba287">historyLength_</a>(0),</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a861a0f9c63867697b18377805572a00a">minFrequency_</a>(<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ad15b5063af8ae3b48cd44dfae17eaf9e">frequency_</a> - 2.0),</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a98514257c62d3bcb14ec1e8446e0c0a3">maxFrequency_</a>(<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ad15b5063af8ae3b48cd44dfae17eaf9e">frequency_</a> + 2.0),</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6c0cfc2c5d47061bf2ae272b7532b51b">baseLinkFrameId_</a>(<span class="stringliteral">&quot;base_link&quot;</span>),</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a2b184469b63dfe6261dea4a92b5b23a6">mapFrameId_</a>(<span class="stringliteral">&quot;map&quot;</span>),</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ae6ef41c43d134fb109fe8996a723bcf4">odomFrameId_</a>(<span class="stringliteral">&quot;odom&quot;</span>),</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a37c23d6c10a630fe33e74376898fc5c8">worldFrameId_</a>(<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ae6ef41c43d134fb109fe8996a723bcf4">odomFrameId_</a>),</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aa42f6af65d32b9bec34c88974822fea9">lastDiagTime_</a>(0),</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aa9df5f56cfb6d02a4bc22c8b68ad115f">lastSetPoseTime_</a>(0),</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a94ccac9ce6b71ee1a36b19a8ba33b0ac">latestControlTime_</a>(0),</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ab6a90f7afc20e69a148d84e4e41330f3">tfTimeOffset_</a>(ros::Duration(0)),</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5c57fe5f94f02e033ac78939966ad366">tfTimeout_</a>(ros::Duration(0)),</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>(args),</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a03a0adf9f3be7b576044755a76b12b3b">nh_</a>(nh),</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#abe50aea17d383427f39c3b3c57617f12">nhLocal_</a>(nh_priv),</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ae88f4c45d5209d03d53fc6a4d1bb93ab">diagnosticUpdater_</a>(nh, nh_priv, node_name),</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a1941fdd54f6ac9f212dafba9330b5002">tfListener_</a>(<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aacaed6dea7d7bd1dc1d03eeddf002c29">tfBuffer_</a>)</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  {</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a394f86657e02d8c445ce2eaba71153a3">stateVariableNames_</a>.push_back(<span class="stringliteral">&quot;X&quot;</span>);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a394f86657e02d8c445ce2eaba71153a3">stateVariableNames_</a>.push_back(<span class="stringliteral">&quot;Y&quot;</span>);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a394f86657e02d8c445ce2eaba71153a3">stateVariableNames_</a>.push_back(<span class="stringliteral">&quot;Z&quot;</span>);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a394f86657e02d8c445ce2eaba71153a3">stateVariableNames_</a>.push_back(<span class="stringliteral">&quot;ROLL&quot;</span>);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a394f86657e02d8c445ce2eaba71153a3">stateVariableNames_</a>.push_back(<span class="stringliteral">&quot;PITCH&quot;</span>);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a394f86657e02d8c445ce2eaba71153a3">stateVariableNames_</a>.push_back(<span class="stringliteral">&quot;YAW&quot;</span>);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a394f86657e02d8c445ce2eaba71153a3">stateVariableNames_</a>.push_back(<span class="stringliteral">&quot;X_VELOCITY&quot;</span>);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a394f86657e02d8c445ce2eaba71153a3">stateVariableNames_</a>.push_back(<span class="stringliteral">&quot;Y_VELOCITY&quot;</span>);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a394f86657e02d8c445ce2eaba71153a3">stateVariableNames_</a>.push_back(<span class="stringliteral">&quot;Z_VELOCITY&quot;</span>);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a394f86657e02d8c445ce2eaba71153a3">stateVariableNames_</a>.push_back(<span class="stringliteral">&quot;ROLL_VELOCITY&quot;</span>);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a394f86657e02d8c445ce2eaba71153a3">stateVariableNames_</a>.push_back(<span class="stringliteral">&quot;PITCH_VELOCITY&quot;</span>);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a394f86657e02d8c445ce2eaba71153a3">stateVariableNames_</a>.push_back(<span class="stringliteral">&quot;YAW_VELOCITY&quot;</span>);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a394f86657e02d8c445ce2eaba71153a3">stateVariableNames_</a>.push_back(<span class="stringliteral">&quot;X_ACCELERATION&quot;</span>);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a394f86657e02d8c445ce2eaba71153a3">stateVariableNames_</a>.push_back(<span class="stringliteral">&quot;Y_ACCELERATION&quot;</span>);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a394f86657e02d8c445ce2eaba71153a3">stateVariableNames_</a>.push_back(<span class="stringliteral">&quot;Z_ACCELERATION&quot;</span>);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ae88f4c45d5209d03d53fc6a4d1bb93ab">diagnosticUpdater_</a>.setHardwareID(<span class="stringliteral">&quot;none&quot;</span>);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a392382adffded2b4390f2a780b81e0f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a392382adffded2b4390f2a780b81e0f4">&#9670;&nbsp;</a></span>RosFilter() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::<a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RosFilter</a> </td>
          <td>(</td>
          <td class="paramtype">ros::NodeHandle&#160;</td>
          <td class="paramname"><em>nh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ros::NodeHandle&#160;</td>
          <td class="paramname"><em>nh_priv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; double &gt;&#160;</td>
          <td class="paramname"><em>args</em> = <code>std::vector&lt;double&gt;()</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Constructor. </p>
<p>The <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RosFilter</a> constructor makes sure that anyone using this template is doing so with the correct object type </p>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l00106">106</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                                                                                         :</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a39ff4db9503a7f645093b086716b4a98">RosFilter&lt;T&gt;::RosFilter</a>(nh, nh_priv, ros::this_node::getName(), args)</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  {}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a9d9207b728f5094c941745766b551bf1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d9207b728f5094c941745766b551bf1">&#9670;&nbsp;</a></span>~RosFilter()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::~<a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RosFilter</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Destructor. </p>
<p>Clears out the message filters and topic subscribers. </p>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l00111">111</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  {</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a1c36b4e9478bf44a96f74687cc882c6b">topicSubs_</a>.clear();</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ae5643fce575cd46f5cd77becf29d04ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae5643fce575cd46f5cd77becf29d04ad">&#9670;&nbsp;</a></span>accelerationCallback()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::accelerationCallback </td>
          <td>(</td>
          <td class="paramtype">const sensor_msgs::Imu::ConstPtr &amp;&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d89/structRobotLocalization_1_1CallbackData.html">CallbackData</a> &amp;&#160;</td>
          <td class="paramname"><em>callbackData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>targetFrame</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback method for receiving all acceleration (IMU) messages. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">msg</td><td>- The ROS IMU message to take in. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">callbackData</td><td>- Relevant static callback data </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">targetFrame</td><td>- The target frame_id into which to transform the data </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l00202">202</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="comment">// If we&#39;ve just reset the filter, then we want to ignore any messages</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment">// that arrive with an older timestamp</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">if</span> (msg-&gt;header.stamp &lt;= <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aa9df5f56cfb6d02a4bc22c8b68ad115f">lastSetPoseTime_</a>)</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keyword">const</span> std::string &amp;topicName = callbackData.topicName_;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;------ RosFilter::accelerationCallback (&quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot;) ------\n&quot;</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;             <span class="stringliteral">&quot;Twist message:\n&quot;</span> &lt;&lt; *msg);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a473c0f797fcd9677b1005637ee159ae4">lastMessageTimes_</a>.count(topicName) == 0)</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a473c0f797fcd9677b1005637ee159ae4">lastMessageTimes_</a>.insert(std::pair&lt;std::string, ros::Time&gt;(topicName, msg-&gt;header.stamp));</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    }</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="comment">// Make sure this message is newer than the last one</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keywordflow">if</span> (msg-&gt;header.stamp &gt;= <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a473c0f797fcd9677b1005637ee159ae4">lastMessageTimes_</a>[topicName])</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    {</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      RF_DEBUG(<span class="stringliteral">&quot;Update vector for &quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot; is:\n&quot;</span> &lt;&lt; topicName);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160; </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      Eigen::VectorXd measurement(STATE_SIZE);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      Eigen::MatrixXd measurementCovariance(STATE_SIZE, STATE_SIZE);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      measurement.setZero();</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      measurementCovariance.setZero();</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160; </div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      <span class="comment">// Make sure we&#39;re actually updating at least one of these variables</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      std::vector&lt;int&gt; updateVectorCorrected = callbackData.updateVector_;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160; </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      <span class="comment">// Prepare the twist data for inclusion in the filter</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a34b0ea97d422eaf92c36ed8085dea5c3">prepareAcceleration</a>(msg, topicName, targetFrame, updateVectorCorrected, measurement,</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            measurementCovariance))</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="comment">// Store the measurement. Add an &quot;acceleration&quot; suffix so we know what kind of measurement</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <span class="comment">// we&#39;re dealing with when we debug the core filter logic.</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6f69cfe0fd2fea54446e4895b14c4c88">enqueueMeasurement</a>(topicName,</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                           measurement,</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                           measurementCovariance,</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                           updateVectorCorrected,</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                           callbackData.rejectionThreshold_,</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                           msg-&gt;header.stamp);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        RF_DEBUG(<span class="stringliteral">&quot;Enqueued new measurement for &quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot;_acceleration\n&quot;</span>);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      }</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      {</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        RF_DEBUG(<span class="stringliteral">&quot;Did *not* enqueue measurement for &quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot;_acceleration\n&quot;</span>);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a473c0f797fcd9677b1005637ee159ae4">lastMessageTimes_</a>[topicName] = msg-&gt;header.stamp;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      RF_DEBUG(<span class="stringliteral">&quot;Last message time for &quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot; is now &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a473c0f797fcd9677b1005637ee159ae4">lastMessageTimes_</a>[topicName] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a16ad0452b5b52e64a93736d25cfeba95">resetOnTimeJump_</a> &amp;&amp; ros::Time::isSimTime())</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a011b39dad94b84b7856f993518e4ae00">reset</a>();</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    }</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    {</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      std::stringstream stream;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      stream &lt;&lt; <span class="stringliteral">&quot;The &quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot; message has a timestamp before that of the previous message received,&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                <span class="stringliteral">&quot; this message will be ignored. This may indicate a bad timestamp. (message time: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                msg-&gt;header.stamp.toSec() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8266b1436e1907c160d8c73a920e806c">addDiagnostic</a>(diagnostic_msgs::DiagnosticStatus::WARN,</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                    topicName + <span class="stringliteral">&quot;_timestamp&quot;</span>,</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                    stream.str(),</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                    <span class="keyword">false</span>);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      RF_DEBUG(<span class="stringliteral">&quot;Message is too old. Last message time for &quot;</span> &lt;&lt; topicName &lt;&lt;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;               <span class="stringliteral">&quot; is &quot;</span> &lt;&lt; <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a473c0f797fcd9677b1005637ee159ae4">lastMessageTimes_</a>[topicName] &lt;&lt; <span class="stringliteral">&quot;, current message time is &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;               msg-&gt;header.stamp &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    }</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160; </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;\n----- /RosFilter::accelerationCallback (&quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot;) ------\n&quot;</span>);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8266b1436e1907c160d8c73a920e806c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8266b1436e1907c160d8c73a920e806c">&#9670;&nbsp;</a></span>addDiagnostic()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::addDiagnostic </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>errLevel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>topicAndClass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>staticDiag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Adds a diagnostic message to the accumulating map and updates the error level. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">errLevel</td><td>- The error level of the diagnostic </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">topicAndClass</td><td>- The sensor topic (if relevant) and class of diagnostic </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">message</td><td>- Details of the diagnostic </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">staticDiag</td><td>- Whether or not this diagnostic information is static </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l02172">2172</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;  {</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;    <span class="keywordflow">if</span> (staticDiag)</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;    {</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5df01bed8ccaf9deaadd869518c60310">staticDiagnostics_</a>[topicAndClass] = message;</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#afe66e5331dcd54686c7cf039ce856f71">staticDiagErrorLevel_</a> = std::max(<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#afe66e5331dcd54686c7cf039ce856f71">staticDiagErrorLevel_</a>, errLevel);</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;    }</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;    {</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a7b48b5bb099cf8c0bd283b6fd5661424">dynamicDiagnostics_</a>[topicAndClass] = message;</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5f51fcc879266f6091c5745c93bdc960">dynamicDiagErrorLevel_</a> = std::max(<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5f51fcc879266f6091c5745c93bdc960">dynamicDiagErrorLevel_</a>, errLevel);</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;    }</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a6217442419d2808d43eb8c613403b04b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6217442419d2808d43eb8c613403b04b">&#9670;&nbsp;</a></span>aggregateDiagnostics()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::aggregateDiagnostics </td>
          <td>(</td>
          <td class="paramtype">diagnostic_updater::DiagnosticStatusWrapper &amp;&#160;</td>
          <td class="paramname"><em>wrapper</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Aggregates all diagnostics so they can be published. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">wrapper</td><td>- The diagnostic status wrapper to update </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l02190">2190</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;  {</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;    wrapper.clear();</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;    wrapper.clearSummary();</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160; </div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;    <span class="keywordtype">int</span> maxErrLevel = std::max(<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#afe66e5331dcd54686c7cf039ce856f71">staticDiagErrorLevel_</a>, <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5f51fcc879266f6091c5745c93bdc960">dynamicDiagErrorLevel_</a>);</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160; </div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;    <span class="comment">// Report the overall status</span></div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;    <span class="keywordflow">switch</span> (maxErrLevel)</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;    {</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;      <span class="keywordflow">case</span> diagnostic_msgs::DiagnosticStatus::ERROR:</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;        wrapper.summary(maxErrLevel,</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;                        <span class="stringliteral">&quot;Erroneous data or settings detected for a robot_localization state estimation node.&quot;</span>);</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;      <span class="keywordflow">case</span> diagnostic_msgs::DiagnosticStatus::WARN:</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;        wrapper.summary(maxErrLevel,</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;                        <span class="stringliteral">&quot;Potentially erroneous data or settings detected for &quot;</span></div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;                        <span class="stringliteral">&quot;a robot_localization state estimation node.&quot;</span>);</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;      <span class="keywordflow">case</span> diagnostic_msgs::DiagnosticStatus::STALE:</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;        wrapper.summary(maxErrLevel,</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;                        <span class="stringliteral">&quot;The state of the robot_localization state estimation node is stale.&quot;</span>);</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;      <span class="keywordflow">case</span> diagnostic_msgs::DiagnosticStatus::OK:</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;        wrapper.summary(maxErrLevel,</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;                        <span class="stringliteral">&quot;The robot_localization state estimation node appears to be functioning properly.&quot;</span>);</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;      <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;    }</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160; </div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;    <span class="comment">// Aggregate all the static messages</span></div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;    <span class="keywordflow">for</span> (std::map&lt;std::string, std::string&gt;::iterator diagIt = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5df01bed8ccaf9deaadd869518c60310">staticDiagnostics_</a>.begin();</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;        diagIt != <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5df01bed8ccaf9deaadd869518c60310">staticDiagnostics_</a>.end();</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;        ++diagIt)</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;    {</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;      wrapper.add(diagIt-&gt;first, diagIt-&gt;second);</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;    }</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160; </div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;    <span class="comment">// Aggregate all the dynamic messages, then clear them</span></div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;    <span class="keywordflow">for</span> (std::map&lt;std::string, std::string&gt;::iterator diagIt = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a7b48b5bb099cf8c0bd283b6fd5661424">dynamicDiagnostics_</a>.begin();</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;        diagIt != <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a7b48b5bb099cf8c0bd283b6fd5661424">dynamicDiagnostics_</a>.end();</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;        ++diagIt)</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;    {</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;      wrapper.add(diagIt-&gt;first, diagIt-&gt;second);</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;    }</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a7b48b5bb099cf8c0bd283b6fd5661424">dynamicDiagnostics_</a>.clear();</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160; </div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;    <span class="comment">// Reset the warning level for the dynamic diagnostic messages</span></div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5f51fcc879266f6091c5745c93bdc960">dynamicDiagErrorLevel_</a> = diagnostic_msgs::DiagnosticStatus::OK;</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae0e25abbb388e990c2062b6029329131"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae0e25abbb388e990c2062b6029329131">&#9670;&nbsp;</a></span>clearExpiredHistory()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::clearExpiredHistory </td>
          <td>(</td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>cutoffTime</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Removes measurements and filter states older than the given cutoff time. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cutoffTime</td><td>- Measurements and states older than this time will be dropped. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l03176">3176</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;  {</div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;\n----- RosFilter::clearExpiredHistory -----&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;             <span class="stringliteral">&quot;\nCutoff time is &quot;</span> &lt;&lt; cutOffTime &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160; </div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;    <span class="keywordtype">int</span> poppedMeasurements = 0;</div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;    <span class="keywordtype">int</span> poppedStates = 0;</div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160; </div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;    <span class="keywordflow">while</span> (!<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aeb7a3b61549bad2cc4e84d803c038c5f">measurementHistory_</a>.empty() &amp;&amp; <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aeb7a3b61549bad2cc4e84d803c038c5f">measurementHistory_</a>.front()-&gt;time_ &lt; cutOffTime)</div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;    {</div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aeb7a3b61549bad2cc4e84d803c038c5f">measurementHistory_</a>.pop_front();</div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;      poppedMeasurements++;</div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;    }</div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160; </div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;    <span class="keywordflow">while</span> (!<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a37a9eb3abb974e2079e34843dbd69af3">filterStateHistory_</a>.empty() &amp;&amp; <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a37a9eb3abb974e2079e34843dbd69af3">filterStateHistory_</a>.front()-&gt;lastMeasurementTime_ &lt; cutOffTime)</div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;    {</div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a37a9eb3abb974e2079e34843dbd69af3">filterStateHistory_</a>.pop_front();</div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;      poppedStates++;</div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;    }</div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160; </div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;\nPopped &quot;</span> &lt;&lt; poppedMeasurements &lt;&lt; <span class="stringliteral">&quot; measurements and &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;             poppedStates &lt;&lt; <span class="stringliteral">&quot; states from their respective queues.&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;             <span class="stringliteral">&quot;\n---- /RosFilter::clearExpiredHistory ----\n&quot;</span>);</div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a4a89276e71a0258bbcf5686d552804fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a89276e71a0258bbcf5686d552804fa">&#9670;&nbsp;</a></span>controlCallback() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::controlCallback </td>
          <td>(</td>
          <td class="paramtype">const geometry_msgs::Twist::ConstPtr &amp;&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback method for receiving non-stamped control input. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">msg</td><td>- The ROS twist message to take in </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l00285">285</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  {</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    geometry_msgs::TwistStampedPtr twistStampedPtr = geometry_msgs::TwistStampedPtr(<span class="keyword">new</span> geometry_msgs::TwistStamped());</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    twistStampedPtr-&gt;twist = *msg;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    twistStampedPtr-&gt;header.frame_id = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6c0cfc2c5d47061bf2ae272b7532b51b">baseLinkFrameId_</a>;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    twistStampedPtr-&gt;header.stamp = ros::Time::now();</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a4a89276e71a0258bbcf5686d552804fa">controlCallback</a>(twistStampedPtr);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="ac5c164b66407c5b0bfd96565a858604b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac5c164b66407c5b0bfd96565a858604b">&#9670;&nbsp;</a></span>controlCallback() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::controlCallback </td>
          <td>(</td>
          <td class="paramtype">const geometry_msgs::TwistStamped::ConstPtr &amp;&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback method for receiving stamped control input. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">msg</td><td>- The ROS stamped twist message to take in </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l00295">295</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordflow">if</span> (msg-&gt;header.frame_id == <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6c0cfc2c5d47061bf2ae272b7532b51b">baseLinkFrameId_</a> || msg-&gt;header.frame_id == <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    {</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a1dc8ec7162549a3f935159fc4df143d6">latestControl_</a>(ControlMemberVx) = msg-&gt;twist.linear.x;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a1dc8ec7162549a3f935159fc4df143d6">latestControl_</a>(ControlMemberVy) = msg-&gt;twist.linear.y;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a1dc8ec7162549a3f935159fc4df143d6">latestControl_</a>(ControlMemberVz) = msg-&gt;twist.linear.z;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a1dc8ec7162549a3f935159fc4df143d6">latestControl_</a>(ControlMemberVroll) = msg-&gt;twist.angular.x;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a1dc8ec7162549a3f935159fc4df143d6">latestControl_</a>(ControlMemberVpitch) = msg-&gt;twist.angular.y;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a1dc8ec7162549a3f935159fc4df143d6">latestControl_</a>(ControlMemberVyaw) = msg-&gt;twist.angular.z;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a94ccac9ce6b71ee1a36b19a8ba33b0ac">latestControlTime_</a> = msg-&gt;header.stamp;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160; </div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      <span class="comment">// Update the filter with this control term</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.setControl(<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a1dc8ec7162549a3f935159fc4df143d6">latestControl_</a>, msg-&gt;header.stamp.toSec());</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    }</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    {</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      ROS_WARN_STREAM_THROTTLE(5.0, <span class="stringliteral">&quot;Commanded velocities must be given in the robot&#39;s body frame (&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6c0cfc2c5d47061bf2ae272b7532b51b">baseLinkFrameId_</a> &lt;&lt; <span class="stringliteral">&quot;). Message frame was &quot;</span> &lt;&lt; msg-&gt;header.frame_id);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    }</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8b299c262fd69e029c8fc05ff19f150e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b299c262fd69e029c8fc05ff19f150e">&#9670;&nbsp;</a></span>copyCovariance() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::copyCovariance </td>
          <td>(</td>
          <td class="paramtype">const double *&#160;</td>
          <td class="paramname"><em>arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Eigen::MatrixXd &amp;&#160;</td>
          <td class="paramname"><em>covariance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>topicName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int &gt; &amp;&#160;</td>
          <td class="paramname"><em>updateVector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>dimension</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Utility method for copying covariances from ROS covariance arrays to Eigen matrices. </p>
<p>This method copies the covariances and also does some data validation, which is why it requires more parameters than just the covariance containers. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">arr</td><td>- The source array for the covariance data </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">covariance</td><td>- The destination matrix for the covariance data </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">topicName</td><td>- The name of the source data topic (for debug purposes) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">updateVector</td><td>- The update vector for the source topic </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">offset</td><td>- The "starting" location within the array/update vector </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dimension</td><td>- The number of values to copy, starting at the offset </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l02243">2243</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;  {</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; dimension; i++)</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;    {</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; dimension; j++)</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;      {</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;        covariance(i, j) = arr[dimension * i + j];</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160; </div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a91643ae3e6d532325acdc556b4b8f739">printDiagnostics_</a>)</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;        {</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;          std::string iVar = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a394f86657e02d8c445ce2eaba71153a3">stateVariableNames_</a>[offset + i];</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160; </div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;          <span class="keywordflow">if</span> (covariance(i, j) &gt; 1e3 &amp;&amp; (updateVector[offset  + i] || updateVector[offset  + j]))</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;          {</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;            std::string jVar = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a394f86657e02d8c445ce2eaba71153a3">stateVariableNames_</a>[offset + j];</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160; </div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;            std::stringstream stream;</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;            stream &lt;&lt; <span class="stringliteral">&quot;The covariance at position (&quot;</span> &lt;&lt; dimension * i + j &lt;&lt; <span class="stringliteral">&quot;), which corresponds to &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;                (i == j ? iVar + <span class="stringliteral">&quot; variance&quot;</span> : iVar + <span class="stringliteral">&quot; and &quot;</span> + jVar + <span class="stringliteral">&quot; covariance&quot;</span>) &lt;&lt;</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;                <span class="stringliteral">&quot;, the value is extremely large (&quot;</span> &lt;&lt; covariance(i, j) &lt;&lt; <span class="stringliteral">&quot;), but the update vector for &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;                (i == j ? iVar : iVar + <span class="stringliteral">&quot; and/or &quot;</span> + jVar) &lt;&lt; <span class="stringliteral">&quot; is set to true. This may produce undesirable results.&quot;</span>;</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160; </div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;            <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8266b1436e1907c160d8c73a920e806c">addDiagnostic</a>(diagnostic_msgs::DiagnosticStatus::WARN,</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;                          topicName + <span class="stringliteral">&quot;_covariance&quot;</span>,</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;                          stream.str(),</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;                          <span class="keyword">false</span>);</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;          }</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (updateVector[i] &amp;&amp; i == j &amp;&amp; covariance(i, j) == 0)</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;          {</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;            std::stringstream stream;</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;            stream &lt;&lt; <span class="stringliteral">&quot;The covariance at position (&quot;</span> &lt;&lt; dimension * i + j &lt;&lt; <span class="stringliteral">&quot;), which corresponds to &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;                       iVar &lt;&lt; <span class="stringliteral">&quot; variance, was zero. This will be replaced with a small value to maintain filter &quot;</span></div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;                       <span class="stringliteral">&quot;stability, but should be corrected at the message origin node.&quot;</span>;</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160; </div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;            <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8266b1436e1907c160d8c73a920e806c">addDiagnostic</a>(diagnostic_msgs::DiagnosticStatus::WARN,</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;                          topicName + <span class="stringliteral">&quot;_covariance&quot;</span>,</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;                          stream.str(),</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;                          <span class="keyword">false</span>);</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;          }</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (updateVector[i] &amp;&amp; i == j &amp;&amp; covariance(i, j) &lt; 0)</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;          {</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;            std::stringstream stream;</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;            stream &lt;&lt; <span class="stringliteral">&quot;The covariance at position (&quot;</span> &lt;&lt; dimension * i + j &lt;&lt;</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;                      <span class="stringliteral">&quot;), which corresponds to &quot;</span> &lt;&lt; iVar &lt;&lt; <span class="stringliteral">&quot; variance, was negative. This will be replaced with a &quot;</span></div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;                      <span class="stringliteral">&quot;small positive value to maintain filter stability, but should be corrected at the message &quot;</span></div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;                      <span class="stringliteral">&quot;origin node.&quot;</span>;</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160; </div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;            <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8266b1436e1907c160d8c73a920e806c">addDiagnostic</a>(diagnostic_msgs::DiagnosticStatus::WARN,</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;                          topicName + <span class="stringliteral">&quot;_covariance&quot;</span>,</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;                          stream.str(),</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;                          <span class="keyword">false</span>);</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;          }</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;        }</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;      }</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;    }</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a54eb6cf70f939ed188fa051c0dc50c97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54eb6cf70f939ed188fa051c0dc50c97">&#9670;&nbsp;</a></span>copyCovariance() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::copyCovariance </td>
          <td>(</td>
          <td class="paramtype">const Eigen::MatrixXd &amp;&#160;</td>
          <td class="paramname"><em>covariance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>dimension</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Utility method for copying covariances from Eigen matrices to ROS covariance arrays. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">covariance</td><td>- The source matrix for the covariance data </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">arr</td><td>- The destination array </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dimension</td><td>- The number of values to copy </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l02306">2306</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;  {</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; dimension; i++)</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;    {</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; dimension; j++)</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;      {</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;        arr[dimension * i + j] = covariance(i, j);</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;      }</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;    }</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a83c63cecbddfda272d9905c337b4ef4d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83c63cecbddfda272d9905c337b4ef4d">&#9670;&nbsp;</a></span>enableFilterSrvCallback()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::enableFilterSrvCallback </td>
          <td>(</td>
          <td class="paramtype">std_srvs::Empty::Request &amp;&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std_srvs::Empty::Response &amp;&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Service callback for manually enable the filter. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">request</td><td>- N/A </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">response</td><td>- N/A </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>boolean true if successful, false if not </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l02064">2064</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;  {</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;\n[&quot;</span> &lt;&lt; ros::this_node::getName() &lt;&lt; <span class="stringliteral">&quot;:]&quot;</span> &lt;&lt; <span class="stringliteral">&quot; ------ /RosFilter::enableFilterSrvCallback ------\n&quot;</span>);</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5da2ab5cea26ee0545447a7643523d1b">enabled_</a>)</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;    {</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;      ROS_WARN_STREAM(<span class="stringliteral">&quot;[&quot;</span> &lt;&lt; ros::this_node::getName() &lt;&lt; <span class="stringliteral">&quot;:] Asking for enabling filter service, but the filter was &quot;</span></div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;        <span class="stringliteral">&quot;already enabled! Use param disabled_at_startup.&quot;</span>);</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;    }</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;    {</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;      ROS_INFO_STREAM(<span class="stringliteral">&quot;[&quot;</span> &lt;&lt; ros::this_node::getName() &lt;&lt; <span class="stringliteral">&quot;:] Enabling filter...&quot;</span>);</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5da2ab5cea26ee0545447a7643523d1b">enabled_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;    }</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a6f69cfe0fd2fea54446e4895b14c4c88"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f69cfe0fd2fea54446e4895b14c4c88">&#9670;&nbsp;</a></span>enqueueMeasurement()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::enqueueMeasurement </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>topicName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Eigen::VectorXd &amp;&#160;</td>
          <td class="paramname"><em>measurement</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Eigen::MatrixXd &amp;&#160;</td>
          <td class="paramname"><em>measurementCovariance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int &gt; &amp;&#160;</td>
          <td class="paramname"><em>updateVector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>mahalanobisThresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ros::Time &amp;&#160;</td>
          <td class="paramname"><em>time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adds a measurement to the queue of measurements to be processed. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">topicName</td><td>- The name of the measurement source (only used for debugging) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">measurement</td><td>- The measurement to enqueue </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">measurementCovariance</td><td>- The covariance of the measurement </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">updateVector</td><td>- The boolean vector that specifies which variables to update from this measurement </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mahalanobisThresh</td><td>- Threshold, expressed as a Mahalanobis distance, for outlier rejection </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">time</td><td>- The time of arrival (in seconds) </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l00318">318</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  {</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    MeasurementPtr meas = MeasurementPtr(<span class="keyword">new</span> Measurement());</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160; </div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    meas-&gt;topicName_ = topicName;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    meas-&gt;measurement_ = measurement;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    meas-&gt;covariance_ = measurementCovariance;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    meas-&gt;updateVector_ = updateVector;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    meas-&gt;time_ = time.toSec();</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    meas-&gt;mahalanobisThresh_ = mahalanobisThresh;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    meas-&gt;latestControl_ = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a1dc8ec7162549a3f935159fc4df143d6">latestControl_</a>;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    meas-&gt;latestControlTime_ = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a94ccac9ce6b71ee1a36b19a8ba33b0ac">latestControlTime_</a>.toSec();</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a233bcdab40b3b0d7db316ffd0c09f2ce">measurementQueue_</a>.push(meas);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a4585957fbc3239e559eb509921f28a8f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4585957fbc3239e559eb509921f28a8f">&#9670;&nbsp;</a></span>forceTwoD()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::forceTwoD </td>
          <td>(</td>
          <td class="paramtype">Eigen::VectorXd &amp;&#160;</td>
          <td class="paramname"><em>measurement</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Eigen::MatrixXd &amp;&#160;</td>
          <td class="paramname"><em>measurementCovariance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int &gt; &amp;&#160;</td>
          <td class="paramname"><em>updateVector</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Method for zeroing out 3D variables within measurements. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">measurement</td><td>- The measurement whose 3D variables will be zeroed out </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">measurementCovariance</td><td>- The covariance of the measurement </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">updateVector</td><td>- The boolean update vector of the measurement</td></tr>
  </table>
  </dd>
</dl>
<p>If we're in 2D mode, then for every measurement from every sensor, we call this. It sets the 3D variables to 0, gives those variables tiny variances, and sets their updateVector values to 1. </p>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l00339">339</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    measurement(StateMemberZ) = 0.0;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    measurement(StateMemberRoll) = 0.0;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    measurement(StateMemberPitch) = 0.0;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    measurement(StateMemberVz) = 0.0;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    measurement(StateMemberVroll) = 0.0;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    measurement(StateMemberVpitch) = 0.0;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    measurement(StateMemberAz) = 0.0;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160; </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    measurementCovariance(StateMemberZ, StateMemberZ) = 1e-6;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    measurementCovariance(StateMemberRoll, StateMemberRoll) = 1e-6;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    measurementCovariance(StateMemberPitch, StateMemberPitch) = 1e-6;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    measurementCovariance(StateMemberVz, StateMemberVz) = 1e-6;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    measurementCovariance(StateMemberVroll, StateMemberVroll) = 1e-6;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    measurementCovariance(StateMemberVpitch, StateMemberVpitch) = 1e-6;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    measurementCovariance(StateMemberAz, StateMemberAz) = 1e-6;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160; </div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    updateVector[StateMemberZ] = 1;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    updateVector[StateMemberRoll] = 1;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    updateVector[StateMemberPitch] = 1;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    updateVector[StateMemberVz] = 1;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    updateVector[StateMemberVroll] = 1;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    updateVector[StateMemberVpitch] = 1;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    updateVector[StateMemberAz] = 1;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a62f8eabae93ec1ca823b1b4ce65faa68"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a62f8eabae93ec1ca823b1b4ce65faa68">&#9670;&nbsp;</a></span>getFilteredAccelMessage()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::getFilteredAccelMessage </td>
          <td>(</td>
          <td class="paramtype">geometry_msgs::AccelWithCovarianceStamped &amp;&#160;</td>
          <td class="paramname"><em>message</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieves the EKF's acceleration output for broadcasting. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">message</td><td>- The standard ROS acceleration message to be filled </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the filter is initialized, false otherwise </dd></dl>
<p>Fill out the accel_msg</p>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l00428">428</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  {</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="comment">// If the filter has received a measurement at some point...</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.getInitializedStatus())</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    {</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      <span class="comment">// Grab our current state and covariance estimates</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      <span class="keyword">const</span> Eigen::VectorXd &amp;state = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.getState();</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      <span class="keyword">const</span> Eigen::MatrixXd &amp;estimateErrorCovariance = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.getEstimateErrorCovariance();</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      message.accel.accel.linear.x = state(StateMemberAx);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      message.accel.accel.linear.y = state(StateMemberAy);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      message.accel.accel.linear.z = state(StateMemberAz);</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160; </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      <span class="comment">// Fill the covariance (only the left-upper matrix since we are not estimating</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      <span class="comment">// the rotational accelerations arround the axes</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; ACCELERATION_SIZE; i++)</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; ACCELERATION_SIZE; j++)</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        {</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;          <span class="comment">// We use the POSE_SIZE since the accel cov matrix of ROS is 6x6</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;          message.accel.covariance[POSE_SIZE * i + j] =</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;              estimateErrorCovariance(i + POSITION_A_OFFSET, j + POSITION_A_OFFSET);</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        }</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      }</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      <span class="comment">// Fill header information</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      message.header.stamp = ros::Time(<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.getLastMeasurementTime());</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      message.header.frame_id = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a4b00cc26b36b9039f120eecf7a7d4ab1">baseLinkOutputFrameId_</a>;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    }</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160; </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.getInitializedStatus();</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a2bfbf2f272e49f7727adbf180ba00356"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2bfbf2f272e49f7727adbf180ba00356">&#9670;&nbsp;</a></span>getFilteredOdometryMessage()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::getFilteredOdometryMessage </td>
          <td>(</td>
          <td class="paramtype">nav_msgs::Odometry &amp;&#160;</td>
          <td class="paramname"><em>message</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieves the EKF's output for broadcasting. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">message</td><td>- The standard ROS odometry message to be filled </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the filter is initialized, false otherwise </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l00369">369</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="comment">// If the filter has received a measurement at some point...</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.getInitializedStatus())</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <span class="comment">// Grab our current state and covariance estimates</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      <span class="keyword">const</span> Eigen::VectorXd &amp;state = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.getState();</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <span class="keyword">const</span> Eigen::MatrixXd &amp;estimateErrorCovariance = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.getEstimateErrorCovariance();</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160; </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      <span class="comment">// Convert from roll, pitch, and yaw back to quaternion for</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      <span class="comment">// orientation values</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      tf2::Quaternion quat;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      quat.setRPY(state(StateMemberRoll), state(StateMemberPitch), state(StateMemberYaw));</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160; </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      <span class="comment">// Fill out the message</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      message.pose.pose.position.x = state(StateMemberX);</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      message.pose.pose.position.y = state(StateMemberY);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      message.pose.pose.position.z = state(StateMemberZ);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      message.pose.pose.orientation.x = quat.x();</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      message.pose.pose.orientation.y = quat.y();</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      message.pose.pose.orientation.z = quat.z();</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      message.pose.pose.orientation.w = quat.w();</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      message.twist.twist.linear.x = state(StateMemberVx);</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      message.twist.twist.linear.y = state(StateMemberVy);</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      message.twist.twist.linear.z = state(StateMemberVz);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      message.twist.twist.angular.x = state(StateMemberVroll);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      message.twist.twist.angular.y = state(StateMemberVpitch);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      message.twist.twist.angular.z = state(StateMemberVyaw);</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160; </div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      <span class="comment">// Our covariance matrix layout doesn&#39;t quite match</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; POSE_SIZE; i++)</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      {</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; POSE_SIZE; j++)</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        {</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;          message.pose.covariance[POSE_SIZE * i + j] = estimateErrorCovariance(i, j);</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        }</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160; </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      <span class="comment">// POSE_SIZE and TWIST_SIZE are currently the same size, but we can spare a few</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      <span class="comment">// cycles to be meticulous and not index a twist covariance array on the size of</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      <span class="comment">// a pose covariance array</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; TWIST_SIZE; i++)</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      {</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; TWIST_SIZE; j++)</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        {</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;          message.twist.covariance[TWIST_SIZE * i + j] =</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;              estimateErrorCovariance(i + POSITION_V_OFFSET, j + POSITION_V_OFFSET);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        }</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      }</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160; </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;      message.header.stamp = ros::Time(<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.getLastMeasurementTime());</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      message.header.frame_id = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a37c23d6c10a630fe33e74376898fc5c8">worldFrameId_</a>;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      message.child_frame_id = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a4b00cc26b36b9039f120eecf7a7d4ab1">baseLinkOutputFrameId_</a>;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    }</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160; </div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.getInitializedStatus();</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa3a763add884bc19e741a69d0720b27e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3a763add884bc19e741a69d0720b27e">&#9670;&nbsp;</a></span>imuCallback()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::imuCallback </td>
          <td>(</td>
          <td class="paramtype">const sensor_msgs::Imu::ConstPtr &amp;&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>topicName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d89/structRobotLocalization_1_1CallbackData.html">CallbackData</a> &amp;&#160;</td>
          <td class="paramname"><em>poseCallbackData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d89/structRobotLocalization_1_1CallbackData.html">CallbackData</a> &amp;&#160;</td>
          <td class="paramname"><em>twistCallbackData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d89/structRobotLocalization_1_1CallbackData.html">CallbackData</a> &amp;&#160;</td>
          <td class="paramname"><em>accelCallbackData</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback method for receiving all IMU messages. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">msg</td><td>- The ROS IMU message to take in. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">topicName</td><td>- The topic name for the IMU message (only used for debug output) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">poseCallbackData</td><td>- Relevant static callback data for orientation variables </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">twistCallbackData</td><td>- Relevant static callback data for angular velocity variables </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">accelCallbackData</td><td>- Relevant static callback data for linear acceleration variables</td></tr>
  </table>
  </dd>
</dl>
<p>This method separates out the orientation, angular velocity, and linear acceleration data and passed each on to its respective callback. </p>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l00463">463</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  {</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;------ RosFilter::imuCallback (&quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot;) ------\n&quot;</span> &lt;&lt; <span class="stringliteral">&quot;IMU message:\n&quot;</span> &lt;&lt; *msg);</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="comment">// If we&#39;ve just reset the filter, then we want to ignore any messages</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="comment">// that arrive with an older timestamp</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="keywordflow">if</span> (msg-&gt;header.stamp &lt;= <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aa9df5f56cfb6d02a4bc22c8b68ad115f">lastSetPoseTime_</a>)</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    {</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      std::stringstream stream;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      stream &lt;&lt; <span class="stringliteral">&quot;The &quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot; message has a timestamp equal to or before the last filter reset, &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                <span class="stringliteral">&quot;this message will be ignored. This may indicate an empty or bad timestamp. (message time: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                msg-&gt;header.stamp.toSec() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8266b1436e1907c160d8c73a920e806c">addDiagnostic</a>(diagnostic_msgs::DiagnosticStatus::WARN,</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                    topicName + <span class="stringliteral">&quot;_timestamp&quot;</span>,</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                    stream.str(),</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                    <span class="keyword">false</span>);</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      RF_DEBUG(<span class="stringliteral">&quot;Received message that preceded the most recent pose reset. Ignoring...&quot;</span>);</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160; </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    }</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160; </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="comment">// As with the odometry message, we can separate out the pose- and twist-related variables</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="comment">// in the IMU message and pass them to the pose and twist callbacks (filters)</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordflow">if</span> (poseCallbackData.updateSum_ &gt; 0)</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    {</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      <span class="comment">// Per the IMU message specification, if the IMU does not provide orientation,</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      <span class="comment">// then its first covariance value should be set to -1, and we should ignore</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      <span class="comment">// that portion of the message. robot_localization allows users to explicitly</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      <span class="comment">// ignore data using its parameters, but we should also be compliant with</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      <span class="comment">// message specs.</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      <span class="keywordflow">if</span> (::fabs(msg-&gt;orientation_covariance[0] + 1) &lt; 1e-9)</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      {</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        RF_DEBUG(<span class="stringliteral">&quot;Received IMU message with -1 as its first covariance value for orientation. &quot;</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                 <span class="stringliteral">&quot;Ignoring orientation...&quot;</span>);</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      }</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <span class="comment">// Extract the pose (orientation) data, pass it to its filter</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        geometry_msgs::PoseWithCovarianceStamped *posPtr = <span class="keyword">new</span> geometry_msgs::PoseWithCovarianceStamped();</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        posPtr-&gt;header = msg-&gt;header;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        posPtr-&gt;pose.pose.orientation = msg-&gt;orientation;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160; </div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="comment">// Copy the covariance for roll, pitch, and yaw</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; ORIENTATION_SIZE; i++)</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        {</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; ORIENTATION_SIZE; j++)</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;          {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            posPtr-&gt;pose.covariance[POSE_SIZE * (i + ORIENTATION_SIZE) + (j + ORIENTATION_SIZE)] =</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                msg-&gt;orientation_covariance[ORIENTATION_SIZE * i + j];</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;          }</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        }</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160; </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="comment">// IMU data gets handled a bit differently, since the message is ambiguous and has only a single frame_id,</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <span class="comment">// even though the data in it is reported in two different frames. As we assume users will specify a base_link</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <span class="comment">// to imu transform, we make the target frame baseLinkFrameId_ and tell the poseCallback that it is working</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <span class="comment">// with IMU data. This will cause it to apply different logic to the data.</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        geometry_msgs::PoseWithCovarianceStampedConstPtr pptr(posPtr);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a54e73dcf610e672435582a72dfae57eb">poseCallback</a>(pptr, poseCallbackData, <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6c0cfc2c5d47061bf2ae272b7532b51b">baseLinkFrameId_</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      }</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    }</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160; </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">if</span> (twistCallbackData.updateSum_ &gt; 0)</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    {</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      <span class="comment">// Ignore rotational velocity if the first covariance value is -1</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      <span class="keywordflow">if</span> (::fabs(msg-&gt;angular_velocity_covariance[0] + 1) &lt; 1e-9)</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      {</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        RF_DEBUG(<span class="stringliteral">&quot;Received IMU message with -1 as its first covariance value for angular &quot;</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                 <span class="stringliteral">&quot;velocity. Ignoring angular velocity...&quot;</span>);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      }</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      {</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <span class="comment">// Repeat for velocity</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        geometry_msgs::TwistWithCovarianceStamped *twistPtr = <span class="keyword">new</span> geometry_msgs::TwistWithCovarianceStamped();</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        twistPtr-&gt;header = msg-&gt;header;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        twistPtr-&gt;twist.twist.angular = msg-&gt;angular_velocity;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160; </div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <span class="comment">// Copy the covariance</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; ORIENTATION_SIZE; i++)</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        {</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; ORIENTATION_SIZE; j++)</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;          {</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            twistPtr-&gt;twist.covariance[TWIST_SIZE * (i + ORIENTATION_SIZE) + (j + ORIENTATION_SIZE)] =</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;              msg-&gt;angular_velocity_covariance[ORIENTATION_SIZE * i + j];</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;          }</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        }</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160; </div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        geometry_msgs::TwistWithCovarianceStampedConstPtr tptr(twistPtr);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aeec53ee745d41ed8e342c9688a4a3165">twistCallback</a>(tptr, twistCallbackData, <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6c0cfc2c5d47061bf2ae272b7532b51b">baseLinkFrameId_</a>);</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      }</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    }</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160; </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="keywordflow">if</span> (accelCallbackData.updateSum_ &gt; 0)</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    {</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <span class="comment">// Ignore linear acceleration if the first covariance value is -1</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <span class="keywordflow">if</span> (::fabs(msg-&gt;linear_acceleration_covariance[0] + 1) &lt; 1e-9)</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      {</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        RF_DEBUG(<span class="stringliteral">&quot;Received IMU message with -1 as its first covariance value for linear &quot;</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                 <span class="stringliteral">&quot;acceleration. Ignoring linear acceleration...&quot;</span>);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;      }</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      {</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <span class="comment">// Pass the message on</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ae5643fce575cd46f5cd77becf29d04ad">accelerationCallback</a>(msg, accelCallbackData, <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6c0cfc2c5d47061bf2ae272b7532b51b">baseLinkFrameId_</a>);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      }</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    }</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160; </div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;\n----- /RosFilter::imuCallback (&quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot;) ------\n&quot;</span>);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a0408a310dcd78472013e174c4f26061b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0408a310dcd78472013e174c4f26061b">&#9670;&nbsp;</a></span>integrateMeasurements()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::integrateMeasurements </td>
          <td>(</td>
          <td class="paramtype">const ros::Time &amp;&#160;</td>
          <td class="paramname"><em>currentTime</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Processes all measurements in the measurement queue, in temporal order. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">currentTime</td><td>- The time at which to carry out integration (the current time) </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l00577">577</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  {</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> currentTimeSec = currentTime.toSec();</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160; </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;------ RosFilter::integrateMeasurements ------\n\n&quot;</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;             <span class="stringliteral">&quot;Integration time is &quot;</span> &lt;&lt; std::setprecision(20) &lt;&lt; currentTimeSec &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;             &lt;&lt; <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a233bcdab40b3b0d7db316ffd0c09f2ce">measurementQueue_</a>.size() &lt;&lt; <span class="stringliteral">&quot; measurements in queue.\n&quot;</span>);</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160; </div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keywordtype">bool</span> predictToCurrentTime = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#add0c677e8eb87145755b5cd18718a45a">predictToCurrentTime_</a>;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160; </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="comment">// If we have any measurements in the queue, process them</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a233bcdab40b3b0d7db316ffd0c09f2ce">measurementQueue_</a>.empty())</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    {</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      <span class="comment">// Check if the first measurement we&#39;re going to process is older than the filter&#39;s last measurement.</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      <span class="comment">// This means we have received an out-of-sequence message (one with an old timestamp), and we need to</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      <span class="comment">// revert both the filter state and measurement queue to the first state that preceded the time stamp</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <span class="comment">// of our first measurement.</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      <span class="keyword">const</span> MeasurementPtr&amp; firstMeasurement = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a233bcdab40b3b0d7db316ffd0c09f2ce">measurementQueue_</a>.top();</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      <span class="keywordtype">int</span> restoredMeasurementCount = 0;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ab8779e25f3390bd1ddeba10401164a2c">smoothLaggedData_</a> &amp;&amp; firstMeasurement-&gt;time_ &lt; <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.getLastMeasurementTime())</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      {</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        RF_DEBUG(<span class="stringliteral">&quot;Received a measurement that was &quot;</span> &lt;&lt; <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.getLastMeasurementTime() - firstMeasurement-&gt;time_ &lt;&lt;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                 <span class="stringliteral">&quot; seconds in the past. Reverting filter state and measurement queue...&quot;</span>);</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160; </div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <span class="keywordtype">int</span> originalCount = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a233bcdab40b3b0d7db316ffd0c09f2ce">measurementQueue_</a>.size());</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> firstMeasurementTime =  firstMeasurement-&gt;time_;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <span class="keyword">const</span> std::string firstMeasurementTopic =  firstMeasurement-&gt;topicName_;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8ea96b4c2cca39358e3c6e90cfe315bd">revertTo</a>(firstMeasurementTime - 1e-9))  <span class="comment">// revertTo may invalidate firstMeasurement</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        {</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;          RF_DEBUG(<span class="stringliteral">&quot;ERROR: history interval is too small to revert to time &quot;</span> &lt;&lt; firstMeasurementTime &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;          ROS_WARN_STREAM_DELAYED_THROTTLE(<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a84b03bc70e9979c28deb044c545ba287">historyLength_</a>, <span class="stringliteral">&quot;Received old measurement for topic &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            firstMeasurementTopic &lt;&lt; <span class="stringliteral">&quot;, but history interval is insufficiently sized. Measurement time is &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            std::setprecision(20) &lt;&lt; firstMeasurementTime &lt;&lt; <span class="stringliteral">&quot;, current time is &quot;</span> &lt;&lt; currentTime.toSec() &lt;&lt;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;            <span class="stringliteral">&quot;, history length is &quot;</span> &lt;&lt; <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a84b03bc70e9979c28deb044c545ba287">historyLength_</a> &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;          restoredMeasurementCount = 0;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        }</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160; </div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        restoredMeasurementCount = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a233bcdab40b3b0d7db316ffd0c09f2ce">measurementQueue_</a>.size()) - originalCount;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      }</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160; </div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      <span class="keywordflow">while</span> (!<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a233bcdab40b3b0d7db316ffd0c09f2ce">measurementQueue_</a>.empty() &amp;&amp; ros::ok())</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      {</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        MeasurementPtr measurement = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a233bcdab40b3b0d7db316ffd0c09f2ce">measurementQueue_</a>.top();</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160; </div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="comment">// If we&#39;ve reached a measurement that has a time later than now, it should wait until a future iteration.</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        <span class="comment">// Since measurements are stored in a priority queue, all remaining measurements will be in the future.</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        <span class="keywordflow">if</span> (measurement-&gt;time_ &gt; currentTime.toSec())</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        {</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        }</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160; </div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a233bcdab40b3b0d7db316ffd0c09f2ce">measurementQueue_</a>.pop();</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160; </div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="comment">// When we receive control messages, we call this directly in the control callback. However, we also associate</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        <span class="comment">// a control with each sensor message so that we can support lagged smoothing. As we cannot guarantee that the</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <span class="comment">// new control callback will fire before a new measurement, we should only perform this operation if we are</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        <span class="comment">// processing messages from the history. Otherwise, we may get a new measurement, store the &quot;old&quot; latest</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="comment">// control, then receive a control, call setControl, and then overwrite that value with this one (i.e., with</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <span class="comment">// the &quot;old&quot; control we associated with the measurement).</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a714e2c0386cfa1ec147c52f897852532">useControl_</a> &amp;&amp; restoredMeasurementCount &gt; 0)</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        {</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;          <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.setControl(measurement-&gt;latestControl_, measurement-&gt;latestControlTime_);</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;          restoredMeasurementCount--;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        }</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160; </div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        <span class="comment">// This will call predict and, if necessary, correct</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.processMeasurement(*(measurement.get()));</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160; </div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <span class="comment">// Store old states and measurements if we&#39;re smoothing</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ab8779e25f3390bd1ddeba10401164a2c">smoothLaggedData_</a>)</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        {</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;          <span class="comment">// Invariant still holds: measurementHistoryDeque_.back().time_ &lt; measurementQueue_.top().time_</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;          <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aeb7a3b61549bad2cc4e84d803c038c5f">measurementHistory_</a>.push_back(measurement);</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160; </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;          <span class="comment">// We should only save the filter state once per unique timstamp</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a233bcdab40b3b0d7db316ffd0c09f2ce">measurementQueue_</a>.empty() ||</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;              ::fabs(<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a233bcdab40b3b0d7db316ffd0c09f2ce">measurementQueue_</a>.top()-&gt;time_ - <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.getLastMeasurementTime()) &gt; 1e-9)</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;          {</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a0247b864a7b44e5310e7d05e69e41695">saveFilterState</a>(<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>);</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;          }</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        }</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      }</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    }</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.getInitializedStatus())</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    {</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      <span class="comment">// In the event that we don&#39;t get any measurements for a long time,</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      <span class="comment">// we still need to continue to estimate our state. Therefore, we</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <span class="comment">// should project the state forward here.</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      <span class="keywordtype">double</span> lastUpdateDelta = currentTimeSec - <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.getLastMeasurementTime();</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160; </div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <span class="comment">// If we get a large delta, then continuously predict until</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      <span class="keywordflow">if</span> (lastUpdateDelta &gt;= <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.getSensorTimeout())</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      {</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        predictToCurrentTime = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160; </div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        RF_DEBUG(<span class="stringliteral">&quot;Sensor timeout! Last measurement time was &quot;</span> &lt;&lt; <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.getLastMeasurementTime() &lt;&lt;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                 <span class="stringliteral">&quot;, current time is &quot;</span> &lt;&lt; currentTimeSec &lt;&lt;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                 <span class="stringliteral">&quot;, delta is &quot;</span> &lt;&lt; lastUpdateDelta &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      }</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    }</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    {</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      RF_DEBUG(<span class="stringliteral">&quot;Filter not yet initialized.\n&quot;</span>);</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    }</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160; </div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.getInitializedStatus() &amp;&amp; predictToCurrentTime)</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    {</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      <span class="keywordtype">double</span> lastUpdateDelta = currentTimeSec - <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.getLastMeasurementTime();</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160; </div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.validateDelta(lastUpdateDelta);</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.predict(currentTimeSec, lastUpdateDelta);</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160; </div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      <span class="comment">// Update the last measurement time and last update time</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.setLastMeasurementTime(<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.getLastMeasurementTime() + lastUpdateDelta);</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    }</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160; </div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;\n----- /RosFilter::integrateMeasurements ------\n&quot;</span>);</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a2b54251a0ae492ddf7bbb4112a915968"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b54251a0ae492ddf7bbb4112a915968">&#9670;&nbsp;</a></span>loadUpdateConfig()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; int &gt; <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::loadUpdateConfig </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>topicName</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Loads fusion settings from the config file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">topicName</td><td>- The name of the topic for which to load settings </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The boolean vector of update settings for each variable for this topic </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l02320">2320</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;  {</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;    XmlRpc::XmlRpcValue topicConfig;</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;    std::vector&lt;int&gt; updateVector(STATE_SIZE, 0);</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;    std::string topicConfigName = topicName + <span class="stringliteral">&quot;_config&quot;</span>;</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160; </div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;    <span class="keywordflow">try</span></div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;    {</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#abe50aea17d383427f39c3b3c57617f12">nhLocal_</a>.getParam(topicConfigName, topicConfig);</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160; </div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;      ROS_ASSERT(topicConfig.getType() == XmlRpc::XmlRpcValue::TypeArray);</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160; </div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;      <span class="keywordflow">if</span> (topicConfig.size() != STATE_SIZE)</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;      {</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;        ROS_WARN_STREAM(<span class="stringliteral">&quot;Configuration vector for &quot;</span> &lt;&lt; topicConfigName &lt;&lt; <span class="stringliteral">&quot; should have 15 entries.&quot;</span>);</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;      }</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160; </div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; topicConfig.size(); i++)</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;      {</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;        <span class="comment">// The double cast looks strange, but we&#39;ll get exceptions if we</span></div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;        <span class="comment">// remove the cast to bool. vector&lt;bool&gt; is discouraged, so updateVector</span></div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;        <span class="comment">// uses integers.</span></div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;        updateVector[i] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(topicConfig[i]));</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;      }</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;    }</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;    <span class="keywordflow">catch</span> (XmlRpc::XmlRpcException &amp;e)</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;    {</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;      ROS_FATAL_STREAM(<span class="stringliteral">&quot;Could not read sensor update configuration for topic &quot;</span> &lt;&lt; topicName &lt;&lt;</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;                       <span class="stringliteral">&quot; (type: &quot;</span> &lt;&lt; topicConfig.getType() &lt;&lt; <span class="stringliteral">&quot;, expected: &quot;</span> &lt;&lt; XmlRpc::XmlRpcValue::TypeArray</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;                       &lt;&lt; <span class="stringliteral">&quot;). Error was &quot;</span> &lt;&lt; e.getMessage() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;    }</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160; </div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;    <span class="keywordflow">return</span> updateVector;</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa64036d927adebecab93437b5a086748"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa64036d927adebecab93437b5a086748">&#9670;&nbsp;</a></span>odometryCallback()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::odometryCallback </td>
          <td>(</td>
          <td class="paramtype">const nav_msgs::Odometry::ConstPtr &amp;&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>topicName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d89/structRobotLocalization_1_1CallbackData.html">CallbackData</a> &amp;&#160;</td>
          <td class="paramname"><em>poseCallbackData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d89/structRobotLocalization_1_1CallbackData.html">CallbackData</a> &amp;&#160;</td>
          <td class="paramname"><em>twistCallbackData</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback method for receiving all odometry messages. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">msg</td><td>- The ROS odometry message to take in. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">topicName</td><td>- The topic name for the odometry message (only used for debug output) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">poseCallbackData</td><td>- Relevant static callback data for pose variables </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">twistCallbackData</td><td>- Relevant static callback data for twist variables</td></tr>
  </table>
  </dd>
</dl>
<p>This method simply separates out the pose and twist data into two new messages, and passes them into their respective callbacks </p>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l01700">1700</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;  {</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    <span class="comment">// If we&#39;ve just reset the filter, then we want to ignore any messages</span></div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;    <span class="comment">// that arrive with an older timestamp</span></div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    <span class="keywordflow">if</span> (msg-&gt;header.stamp &lt;= <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aa9df5f56cfb6d02a4bc22c8b68ad115f">lastSetPoseTime_</a>)</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    {</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;      std::stringstream stream;</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;      stream &lt;&lt; <span class="stringliteral">&quot;The &quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot; message has a timestamp equal to or before the last filter reset, &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;                <span class="stringliteral">&quot;this message will be ignored. This may indicate an empty or bad timestamp. (message time: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;                msg-&gt;header.stamp.toSec() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8266b1436e1907c160d8c73a920e806c">addDiagnostic</a>(diagnostic_msgs::DiagnosticStatus::WARN,</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;                    topicName + <span class="stringliteral">&quot;_timestamp&quot;</span>,</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;                    stream.str(),</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;                    <span class="keyword">false</span>);</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;      RF_DEBUG(<span class="stringliteral">&quot;Received message that preceded the most recent pose reset. Ignoring...&quot;</span>);</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160; </div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    }</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160; </div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;------ RosFilter::odometryCallback (&quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot;) ------\n&quot;</span> &lt;&lt; <span class="stringliteral">&quot;Odometry message:\n&quot;</span> &lt;&lt; *msg);</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160; </div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    <span class="keywordflow">if</span> (poseCallbackData.updateSum_ &gt; 0)</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    {</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;      <span class="comment">// Grab the pose portion of the message and pass it to the poseCallback</span></div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;      geometry_msgs::PoseWithCovarianceStamped *posPtr = <span class="keyword">new</span> geometry_msgs::PoseWithCovarianceStamped();</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;      posPtr-&gt;header = msg-&gt;header;</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;      posPtr-&gt;pose = msg-&gt;pose;  <span class="comment">// Entire pose object, also copies covariance</span></div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160; </div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;      geometry_msgs::PoseWithCovarianceStampedConstPtr pptr(posPtr);</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a54e73dcf610e672435582a72dfae57eb">poseCallback</a>(pptr, poseCallbackData, <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a37c23d6c10a630fe33e74376898fc5c8">worldFrameId_</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;    }</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160; </div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;    <span class="keywordflow">if</span> (twistCallbackData.updateSum_ &gt; 0)</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;    {</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;      <span class="comment">// Grab the twist portion of the message and pass it to the twistCallback</span></div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;      geometry_msgs::TwistWithCovarianceStamped *twistPtr = <span class="keyword">new</span> geometry_msgs::TwistWithCovarianceStamped();</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;      twistPtr-&gt;header = msg-&gt;header;</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;      twistPtr-&gt;header.frame_id = msg-&gt;child_frame_id;</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;      twistPtr-&gt;twist = msg-&gt;twist;  <span class="comment">// Entire twist object, also copies covariance</span></div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160; </div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;      geometry_msgs::TwistWithCovarianceStampedConstPtr tptr(twistPtr);</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aeec53ee745d41ed8e342c9688a4a3165">twistCallback</a>(tptr, twistCallbackData, <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6c0cfc2c5d47061bf2ae272b7532b51b">baseLinkFrameId_</a>);</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;    }</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160; </div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;\n----- /RosFilter::odometryCallback (&quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot;) ------\n&quot;</span>);</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a54e73dcf610e672435582a72dfae57eb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54e73dcf610e672435582a72dfae57eb">&#9670;&nbsp;</a></span>poseCallback()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::poseCallback </td>
          <td>(</td>
          <td class="paramtype">const geometry_msgs::PoseWithCovarianceStamped::ConstPtr &amp;&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d89/structRobotLocalization_1_1CallbackData.html">CallbackData</a> &amp;&#160;</td>
          <td class="paramname"><em>callbackData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>targetFrame</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>imuData</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback method for receiving all pose messages. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">msg</td><td>- The ROS stamped pose with covariance message to take in </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">callbackData</td><td>- Relevant static callback data </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">targetFrame</td><td>- The target frame_id into which to transform the data </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">imuData</td><td>- Whether this data comes from an IMU </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l01749">1749</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;  {</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    <span class="keyword">const</span> std::string &amp;topicName = callbackData.topicName_;</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160; </div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;    <span class="comment">// If we&#39;ve just reset the filter, then we want to ignore any messages</span></div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    <span class="comment">// that arrive with an older timestamp</span></div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    <span class="keywordflow">if</span> (msg-&gt;header.stamp &lt;= <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aa9df5f56cfb6d02a4bc22c8b68ad115f">lastSetPoseTime_</a>)</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    {</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;      std::stringstream stream;</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;      stream &lt;&lt; <span class="stringliteral">&quot;The &quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot; message has a timestamp equal to or before the last filter reset, &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;                <span class="stringliteral">&quot;this message will be ignored. This may indicate an empty or bad timestamp. (message time: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;                msg-&gt;header.stamp.toSec() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8266b1436e1907c160d8c73a920e806c">addDiagnostic</a>(diagnostic_msgs::DiagnosticStatus::WARN,</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;                    topicName + <span class="stringliteral">&quot;_timestamp&quot;</span>,</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;                    stream.str(),</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;                    <span class="keyword">false</span>);</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    }</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160; </div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;------ RosFilter::poseCallback (&quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot;) ------\n&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;             <span class="stringliteral">&quot;Pose message:\n&quot;</span> &lt;&lt; *msg);</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160; </div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;    <span class="comment">// Put the initial value in the lastMessagTimes_ for this variable if it&#39;s empty</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a473c0f797fcd9677b1005637ee159ae4">lastMessageTimes_</a>.count(topicName) == 0)</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;    {</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a473c0f797fcd9677b1005637ee159ae4">lastMessageTimes_</a>.insert(std::pair&lt;std::string, ros::Time&gt;(topicName, msg-&gt;header.stamp));</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;    }</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160; </div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;    <span class="comment">// Make sure this message is newer than the last one</span></div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    <span class="keywordflow">if</span> (msg-&gt;header.stamp &gt;= <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a473c0f797fcd9677b1005637ee159ae4">lastMessageTimes_</a>[topicName])</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;    {</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;      RF_DEBUG(<span class="stringliteral">&quot;Update vector for &quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot; is:\n&quot;</span> &lt;&lt; callbackData.updateVector_);</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160; </div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;      Eigen::VectorXd measurement(STATE_SIZE);</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;      Eigen::MatrixXd measurementCovariance(STATE_SIZE, STATE_SIZE);</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160; </div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;      measurement.setZero();</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;      measurementCovariance.setZero();</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160; </div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;      <span class="comment">// Make sure we&#39;re actually updating at least one of these variables</span></div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;      std::vector&lt;int&gt; updateVectorCorrected = callbackData.updateVector_;</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160; </div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;      <span class="comment">// Prepare the pose data for inclusion in the filter</span></div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a2538569c164be4b396576252e69732bb">preparePose</a>(msg,</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;                      topicName,</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;                      targetFrame,</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;                      callbackData.differential_,</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;                      callbackData.relative_,</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;                      imuData,</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;                      updateVectorCorrected,</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;                      measurement,</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;                      measurementCovariance))</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;      {</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;        <span class="comment">// Store the measurement. Add a &quot;pose&quot; suffix so we know what kind of measurement</span></div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;        <span class="comment">// we&#39;re dealing with when we debug the core filter logic.</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;        <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6f69cfe0fd2fea54446e4895b14c4c88">enqueueMeasurement</a>(topicName,</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;                           measurement,</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;                           measurementCovariance,</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;                           updateVectorCorrected,</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;                           callbackData.rejectionThreshold_,</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;                           msg-&gt;header.stamp);</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160; </div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;        RF_DEBUG(<span class="stringliteral">&quot;Enqueued new measurement for &quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;      }</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;      {</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;        RF_DEBUG(<span class="stringliteral">&quot;Did *not* enqueue measurement for &quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;      }</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160; </div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a473c0f797fcd9677b1005637ee159ae4">lastMessageTimes_</a>[topicName] = msg-&gt;header.stamp;</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160; </div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;      RF_DEBUG(<span class="stringliteral">&quot;Last message time for &quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot; is now &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;        <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a473c0f797fcd9677b1005637ee159ae4">lastMessageTimes_</a>[topicName] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;    }</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a16ad0452b5b52e64a93736d25cfeba95">resetOnTimeJump_</a> &amp;&amp; ros::Time::isSimTime())</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;    {</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a011b39dad94b84b7856f993518e4ae00">reset</a>();</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;    }</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;    {</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;      std::stringstream stream;</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;      stream &lt;&lt; <span class="stringliteral">&quot;The &quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot; message has a timestamp before that of the previous message received,&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;                <span class="stringliteral">&quot; this message will be ignored. This may indicate a bad timestamp. (message time: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;                msg-&gt;header.stamp.toSec() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8266b1436e1907c160d8c73a920e806c">addDiagnostic</a>(diagnostic_msgs::DiagnosticStatus::WARN,</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;                    topicName + <span class="stringliteral">&quot;_timestamp&quot;</span>,</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;                    stream.str(),</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;                    <span class="keyword">false</span>);</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160; </div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;      RF_DEBUG(<span class="stringliteral">&quot;Message is too old. Last message time for &quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot; is &quot;</span></div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;               &lt;&lt; <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a473c0f797fcd9677b1005637ee159ae4">lastMessageTimes_</a>[topicName] &lt;&lt; <span class="stringliteral">&quot;, current message time is &quot;</span></div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;               &lt;&lt; msg-&gt;header.stamp &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;    }</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160; </div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;\n----- /RosFilter::poseCallback (&quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot;) ------\n&quot;</span>);</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a34b0ea97d422eaf92c36ed8085dea5c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34b0ea97d422eaf92c36ed8085dea5c3">&#9670;&nbsp;</a></span>prepareAcceleration()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::prepareAcceleration </td>
          <td>(</td>
          <td class="paramtype">const sensor_msgs::Imu::ConstPtr &amp;&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>topicName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>targetFrame</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int &gt; &amp;&#160;</td>
          <td class="paramname"><em>updateVector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Eigen::VectorXd &amp;&#160;</td>
          <td class="paramname"><em>measurement</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Eigen::MatrixXd &amp;&#160;</td>
          <td class="paramname"><em>measurementCovariance</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Prepares an IMU message's linear acceleration for integration into the filter. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">msg</td><td>- The IMU message to prepare </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">topicName</td><td>- The name of the topic over which this message was received </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">targetFrame</td><td>- The target tf frame </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">updateVector</td><td>- The update vector for the data source </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">measurement</td><td>- The twist data converted to a measurement </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">measurementCovariance</td><td>- The covariance of the converted measurement </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l02356">2356</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;  {</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;------ RosFilter::prepareAcceleration (&quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot;) ------\n&quot;</span>);</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160; </div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;    <span class="comment">// 1. Get the measurement into a vector</span></div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;    tf2::Vector3 accTmp(msg-&gt;linear_acceleration.x,</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;                        msg-&gt;linear_acceleration.y,</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;                        msg-&gt;linear_acceleration.z);</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160; </div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;    <span class="comment">// Set relevant header info</span></div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;    std::string msgFrame = (msg-&gt;header.frame_id == <span class="stringliteral">&quot;&quot;</span> ? <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6c0cfc2c5d47061bf2ae272b7532b51b">baseLinkFrameId_</a> : msg-&gt;header.frame_id);</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160; </div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;    <span class="comment">// 2. robot_localization lets users configure which variables from the sensor should be</span></div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;    <span class="comment">//    fused with the filter. This is specified at the sensor level. However, the data</span></div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;    <span class="comment">//    may go through transforms before being fused with the state estimate. In that case,</span></div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;    <span class="comment">//    we need to know which of the transformed variables came from the pre-transformed</span></div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;    <span class="comment">//    &quot;approved&quot; variables (i.e., the ones that had &quot;true&quot; in their xxx_config parameter).</span></div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;    <span class="comment">//    To do this, we create a pose from the original upate vector, which contains only</span></div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;    <span class="comment">//    zeros and ones. This pose goes through the same transforms as the measurement. The</span></div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;    <span class="comment">//    non-zero values that result will be used to modify the updateVector.</span></div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;    tf2::Matrix3x3 maskAcc(updateVector[StateMemberAx], 0, 0,</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;                           0, updateVector[StateMemberAy], 0,</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;                           0, 0, updateVector[StateMemberAz]);</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160; </div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;    <span class="comment">// 3. We&#39;ll need to rotate the covariance as well</span></div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;    Eigen::MatrixXd covarianceRotated(ACCELERATION_SIZE, ACCELERATION_SIZE);</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;    covarianceRotated.setZero();</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160; </div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;    this-&gt;<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8b299c262fd69e029c8fc05ff19f150e">copyCovariance</a>(&amp;(msg-&gt;linear_acceleration_covariance[0]),</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;                         covarianceRotated,</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;                         topicName,</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;                         updateVector,</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;                         POSITION_A_OFFSET,</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;                         ACCELERATION_SIZE);</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160; </div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;Original measurement as tf object: &quot;</span> &lt;&lt; accTmp &lt;&lt;</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;             <span class="stringliteral">&quot;\nOriginal update vector:\n&quot;</span> &lt;&lt; updateVector &lt;&lt;</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;             <span class="stringliteral">&quot;\nOriginal covariance matrix:\n&quot;</span> &lt;&lt; covarianceRotated &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160; </div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;    <span class="comment">// 4. We need to transform this into the target frame (probably base_link)</span></div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;    <span class="comment">// It&#39;s unlikely that we&#39;ll get a velocity measurement in another frame, but</span></div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;    <span class="comment">// we have to handle the situation.</span></div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;    tf2::Transform targetFrameTrans;</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;    <span class="keywordtype">bool</span> canTransform = RosFilterUtilities::lookupTransformSafe(<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aacaed6dea7d7bd1dc1d03eeddf002c29">tfBuffer_</a>,</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;                                                                targetFrame,</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;                                                                msgFrame,</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;                                                                msg-&gt;header.stamp,</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;                                                                <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5c57fe5f94f02e033ac78939966ad366">tfTimeout_</a>,</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;                                                                targetFrameTrans);</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160; </div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;    <span class="keywordflow">if</span> (canTransform)</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;    {</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;      <span class="comment">// We don&#39;t know if the user has already handled the removal</span></div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;      <span class="comment">// of normal forces, so we use a parameter</span></div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a27854c71e92da52d6a7c7a004efa1736">removeGravitationalAcc_</a>[topicName])</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;      {</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;        tf2::Vector3 normAcc(0, 0, <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a26a3d07bd073104fd3a2ee004ba88581">gravitationalAcc_</a>);</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;        tf2::Quaternion curAttitude;</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;        tf2::Transform trans;</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160; </div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;        <span class="keywordflow">if</span> (::fabs(msg-&gt;orientation_covariance[0] + 1) &lt; 1e-9)</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;        {</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;          <span class="comment">// Imu message contains no orientation, so we should use orientation</span></div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;          <span class="comment">// from filter state to transform and remove acceleration</span></div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;          <span class="keyword">const</span> Eigen::VectorXd &amp;state = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.getState();</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;          tf2::Vector3 stateTmp(state(StateMemberRoll),</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;                                state(StateMemberPitch),</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;                                state(StateMemberYaw));</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;          <span class="comment">// transform state orientation to IMU frame</span></div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;          tf2::Transform imuFrameTrans;</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;          RosFilterUtilities::lookupTransformSafe(<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aacaed6dea7d7bd1dc1d03eeddf002c29">tfBuffer_</a>,</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;                                                  msgFrame,</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;                                                  targetFrame,</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;                                                  msg-&gt;header.stamp,</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;                                                  <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5c57fe5f94f02e033ac78939966ad366">tfTimeout_</a>,</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;                                                  imuFrameTrans);</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;          stateTmp = imuFrameTrans.getBasis() * stateTmp;</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;          curAttitude.setRPY(stateTmp.getX(), stateTmp.getY(), stateTmp.getZ());</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;        }</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;        {</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;          tf2::fromMsg(msg-&gt;orientation, curAttitude);</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;          <span class="keywordflow">if</span> (fabs(curAttitude.length() - 1.0) &gt; 0.01)</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;          {</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;            ROS_WARN_ONCE(<span class="stringliteral">&quot;An input was not normalized, this should NOT happen, but will normalize.&quot;</span>);</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;            curAttitude.normalize();</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;          }</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;        }</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;        trans.setRotation(curAttitude);</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;        tf2::Vector3 rotNorm = trans.getBasis().inverse() * normAcc;</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;        accTmp.setX(accTmp.getX() - rotNorm.getX());</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;        accTmp.setY(accTmp.getY() - rotNorm.getY());</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;        accTmp.setZ(accTmp.getZ() - rotNorm.getZ());</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160; </div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;        RF_DEBUG(<span class="stringliteral">&quot;Orientation is &quot;</span> &lt;&lt; curAttitude &lt;&lt;</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;                 <span class="stringliteral">&quot;Acceleration due to gravity is &quot;</span> &lt;&lt; rotNorm &lt;&lt;</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;                 <span class="stringliteral">&quot;After removing acceleration due to gravity, acceleration is &quot;</span> &lt;&lt; accTmp &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;      }</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160; </div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;      <span class="comment">// Transform to correct frame</span></div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;      <span class="comment">// @todo: This needs to take into account offsets from the origin. Right now,</span></div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;      <span class="comment">// it assumes that if the sensor is placed at some non-zero offset from the</span></div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;      <span class="comment">// vehicle&#39;s center, that the vehicle turns with constant velocity. This needs</span></div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;      <span class="comment">// to be something like</span></div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;      <span class="comment">// accTmp = targetFrameTrans.getBasis() * accTmp - targetFrameTrans.getOrigin().cross(rotation_acceleration);</span></div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;      <span class="comment">// We can get rotational acceleration by differentiating the rotational velocity</span></div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;      <span class="comment">// (if it&#39;s available)</span></div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;      accTmp = targetFrameTrans.getBasis() * accTmp;</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;      maskAcc = targetFrameTrans.getBasis() * maskAcc;</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160; </div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;      <span class="comment">// Now use the mask values to determine which update vector values should be true</span></div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;      updateVector[StateMemberAx] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;        maskAcc.getRow(StateMemberAx - POSITION_A_OFFSET).length() &gt;= 1e-6);</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;      updateVector[StateMemberAy] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;        maskAcc.getRow(StateMemberAy - POSITION_A_OFFSET).length() &gt;= 1e-6);</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;      updateVector[StateMemberAz] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;        maskAcc.getRow(StateMemberAz - POSITION_A_OFFSET).length() &gt;= 1e-6);</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160; </div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;      RF_DEBUG(msg-&gt;header.frame_id &lt;&lt; <span class="stringliteral">&quot;-&gt;&quot;</span> &lt;&lt; targetFrame &lt;&lt; <span class="stringliteral">&quot; transform:\n&quot;</span> &lt;&lt; targetFrameTrans &lt;&lt;</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;               <span class="stringliteral">&quot;\nAfter applying transform to &quot;</span> &lt;&lt; targetFrame &lt;&lt; <span class="stringliteral">&quot;, update vector is:\n&quot;</span> &lt;&lt; updateVector &lt;&lt;</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;               <span class="stringliteral">&quot;\nAfter applying transform to &quot;</span> &lt;&lt; targetFrame &lt;&lt; <span class="stringliteral">&quot;, measurement is:\n&quot;</span> &lt;&lt; accTmp &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160; </div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;      <span class="comment">// 5. Now rotate the covariance: create an augmented</span></div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;      <span class="comment">// matrix that contains a 3D rotation matrix in the</span></div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;      <span class="comment">// upper-left and lower-right quadrants, and zeros</span></div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;      <span class="comment">// elsewhere</span></div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;      tf2::Matrix3x3 rot(targetFrameTrans.getRotation());</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;      Eigen::MatrixXd rot3d(ACCELERATION_SIZE, ACCELERATION_SIZE);</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;      rot3d.setIdentity();</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160; </div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> rInd = 0; rInd &lt; ACCELERATION_SIZE; ++rInd)</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;      {</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;        rot3d(rInd, 0) = rot.getRow(rInd).getX();</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;        rot3d(rInd, 1) = rot.getRow(rInd).getY();</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;        rot3d(rInd, 2) = rot.getRow(rInd).getZ();</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;      }</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160; </div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;      <span class="comment">// Carry out the rotation</span></div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;      covarianceRotated = rot3d * covarianceRotated.eval() * rot3d.transpose();</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160; </div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;      RF_DEBUG(<span class="stringliteral">&quot;Transformed covariance is \n&quot;</span> &lt;&lt; covarianceRotated &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160; </div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;      <span class="comment">// 6. Store our corrected measurement and covariance</span></div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;      measurement(StateMemberAx) = accTmp.getX();</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;      measurement(StateMemberAy) = accTmp.getY();</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;      measurement(StateMemberAz) = accTmp.getZ();</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160; </div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;      <span class="comment">// Copy the covariances</span></div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;      measurementCovariance.block(POSITION_A_OFFSET, POSITION_A_OFFSET, ACCELERATION_SIZE, ACCELERATION_SIZE) =</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;        covarianceRotated.block(0, 0, ACCELERATION_SIZE, ACCELERATION_SIZE);</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160; </div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;      <span class="comment">// 7. Handle 2D mode</span></div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ad06dbf8f35a49fc76daf1c16fdecd34d">twoDMode_</a>)</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;      {</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;        <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a4585957fbc3239e559eb509921f28a8f">forceTwoD</a>(measurement, measurementCovariance, updateVector);</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;      }</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;    }</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;    {</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;      RF_DEBUG(<span class="stringliteral">&quot;Could not transform measurement into &quot;</span> &lt;&lt; targetFrame &lt;&lt; <span class="stringliteral">&quot;. Ignoring...\n&quot;</span>);</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;    }</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160; </div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;\n----- /RosFilter::prepareAcceleration(&quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot;) ------\n&quot;</span>);</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160; </div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;    <span class="keywordflow">return</span> canTransform;</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a2538569c164be4b396576252e69732bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2538569c164be4b396576252e69732bb">&#9670;&nbsp;</a></span>preparePose()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::preparePose </td>
          <td>(</td>
          <td class="paramtype">const geometry_msgs::PoseWithCovarianceStamped::ConstPtr &amp;&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>topicName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>targetFrame</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>differential</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>relative</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>imuData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int &gt; &amp;&#160;</td>
          <td class="paramname"><em>updateVector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Eigen::VectorXd &amp;&#160;</td>
          <td class="paramname"><em>measurement</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Eigen::MatrixXd &amp;&#160;</td>
          <td class="paramname"><em>measurementCovariance</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Prepares a pose message for integration into the filter. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">msg</td><td>- The pose message to prepare </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">topicName</td><td>- The name of the topic over which this message was received </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">targetFrame</td><td>- The target tf frame </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">differential</td><td>- Whether we're carrying out differential integration </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">relative</td><td>- Whether this measurement is processed relative to the first </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">imuData</td><td>- Whether this measurement is from an IMU </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">updateVector</td><td>- The update vector for the data source </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">measurement</td><td>- The pose data converted to a measurement </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">measurementCovariance</td><td>- The covariance of the converted measurement </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true indicates that the measurement was successfully prepared, false otherwise </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l02529">2529</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;  {</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;    <span class="keywordtype">bool</span> retVal = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160; </div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;------ RosFilter::preparePose (&quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot;) ------\n&quot;</span>);</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160; </div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;    <span class="comment">// 1. Get the measurement into a tf-friendly transform (pose) object</span></div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;    tf2::Stamped&lt;tf2::Transform&gt; poseTmp;</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160; </div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;    <span class="comment">// We&#39;ll need this later for storing this measurement for differential integration</span></div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;    tf2::Transform curMeasurement;</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160; </div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;    <span class="comment">// Handle issues where frame_id data is not filled out properly</span></div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;    <span class="comment">// @todo: verify that this is necessary still. New IMU handling may</span></div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;    <span class="comment">// have rendered this obsolete.</span></div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;    std::string finalTargetFrame;</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;    <span class="keywordflow">if</span> (targetFrame == <span class="stringliteral">&quot;&quot;</span> &amp;&amp; msg-&gt;header.frame_id == <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;    {</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;      <span class="comment">// Blank target and message frames mean we can just</span></div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;      <span class="comment">// use our world_frame</span></div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;      finalTargetFrame = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a37c23d6c10a630fe33e74376898fc5c8">worldFrameId_</a>;</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;      poseTmp.frame_id_ = finalTargetFrame;</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;    }</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (targetFrame == <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;    {</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;      <span class="comment">// A blank target frame means we shouldn&#39;t bother</span></div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;      <span class="comment">// transforming the data</span></div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;      finalTargetFrame = msg-&gt;header.frame_id;</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;      poseTmp.frame_id_ = finalTargetFrame;</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;    }</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;    {</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;      <span class="comment">// Otherwise, we should use our target frame</span></div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;      finalTargetFrame = targetFrame;</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;      poseTmp.frame_id_ = (differential ? finalTargetFrame : msg-&gt;header.frame_id);</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;    }</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160; </div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;Final target frame for &quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot; is &quot;</span> &lt;&lt; finalTargetFrame &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160; </div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;    poseTmp.stamp_ = msg-&gt;header.stamp;</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160; </div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;    <span class="comment">// Fill out the position data</span></div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;    poseTmp.setOrigin(tf2::Vector3(msg-&gt;pose.pose.position.x,</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;                                   msg-&gt;pose.pose.position.y,</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;                                   msg-&gt;pose.pose.position.z));</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160; </div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;    tf2::Quaternion orientation;</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160; </div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;    <span class="comment">// Handle bad (empty) quaternions</span></div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;    <span class="keywordflow">if</span> (msg-&gt;pose.pose.orientation.x == 0 &amp;&amp; msg-&gt;pose.pose.orientation.y == 0 &amp;&amp;</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;       msg-&gt;pose.pose.orientation.z == 0 &amp;&amp; msg-&gt;pose.pose.orientation.w == 0)</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;    {</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;      orientation.setValue(0.0, 0.0, 0.0, 1.0);</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160; </div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;      <span class="keywordflow">if</span> (updateVector[StateMemberRoll] || updateVector[StateMemberPitch] || updateVector[StateMemberYaw])</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;      {</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;        std::stringstream stream;</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;        stream &lt;&lt; <span class="stringliteral">&quot;The &quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot; message contains an invalid orientation quaternion, &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;                  <span class="stringliteral">&quot;but its configuration is such that orientation data is being used. Correcting...&quot;</span>;</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160; </div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;        <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8266b1436e1907c160d8c73a920e806c">addDiagnostic</a>(diagnostic_msgs::DiagnosticStatus::WARN,</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;                      topicName + <span class="stringliteral">&quot;_orientation&quot;</span>,</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;                      stream.str(),</div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;                      <span class="keyword">false</span>);</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;      }</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;    }</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;    {</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;      tf2::fromMsg(msg-&gt;pose.pose.orientation, orientation);</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;      <span class="keywordflow">if</span> (fabs(orientation.length() - 1.0) &gt; 0.01)</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;      {</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;        ROS_WARN_ONCE(<span class="stringliteral">&quot;An input was not normalized, this should NOT happen, but will normalize.&quot;</span>);</div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;        orientation.normalize();</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;      }</div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;    }</div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160; </div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;    <span class="comment">// Fill out the orientation data</span></div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;    poseTmp.setRotation(orientation);</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160; </div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;    <span class="comment">// 2. Get the target frame transformation</span></div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;    tf2::Transform targetFrameTrans;</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;    <span class="keywordtype">bool</span> canTransform = RosFilterUtilities::lookupTransformSafe(<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aacaed6dea7d7bd1dc1d03eeddf002c29">tfBuffer_</a>,</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;                                                                finalTargetFrame,</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;                                                                poseTmp.frame_id_,</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;                                                                poseTmp.stamp_,</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;                                                                <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5c57fe5f94f02e033ac78939966ad366">tfTimeout_</a>,</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;                                                                targetFrameTrans);</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160; </div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;    <span class="comment">// 3. Make sure we can work with this data before carrying on</span></div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;    <span class="keywordflow">if</span> (canTransform)</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;    {</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;      <span class="comment">/* 4. robot_localization lets users configure which variables from the sensor should be</span></div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;<span class="comment">       *    fused with the filter. This is specified at the sensor level. However, the data</span></div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;<span class="comment">       *    may go through transforms before being fused with the state estimate. In that case,</span></div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;<span class="comment">       *    we need to know which of the transformed variables came from the pre-transformed</span></div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;<span class="comment">       *    &quot;approved&quot; variables (i.e., the ones that had &quot;true&quot; in their xxx_config parameter).</span></div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;<span class="comment">       *    To do this, we construct matrices using the update vector values on the diagonals,</span></div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;<span class="comment">       *    pass this matrix through the rotation, and use the length of each row to determine</span></div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;<span class="comment">       *    the transformed update vector. The process is slightly different for IMUs, as the</span></div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;<span class="comment">       *    coordinate frame transform is really the base_link-&gt;imu_frame transform, and not</span></div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;<span class="comment">       *    a transform from some other world-fixed frame (even though the IMU data itself *is*</span></div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;<span class="comment">       *    reported in a world fixed frame). */</span></div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;      tf2::Matrix3x3 maskPosition(updateVector[StateMemberX], 0, 0,</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;                                  0, updateVector[StateMemberY], 0,</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;                                  0, 0, updateVector[StateMemberZ]);</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160; </div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;      tf2::Matrix3x3 maskOrientation(updateVector[StateMemberRoll], 0, 0,</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;                                     0, updateVector[StateMemberPitch], 0,</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;                                     0, 0, updateVector[StateMemberYaw]);</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160; </div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;      <span class="keywordflow">if</span> (imuData)</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;      {</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;        <span class="comment">/* We have to treat IMU orientation data differently. Even though we are dealing with pose</span></div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;<span class="comment">         * data when we work with orientations, for IMUs, the frame_id is the frame in which the</span></div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;<span class="comment">         * sensor is mounted, and not the coordinate frame of the IMU. Imagine an IMU that is mounted</span></div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;<span class="comment">         * facing sideways. The pitch in the IMU frame becomes roll for the vehicle. This means that</span></div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;<span class="comment">         * we need to rotate roll and pitch angles by the IMU&#39;s mounting yaw offset, and we must apply</span></div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;<span class="comment">         * similar treatment to its update mask and covariance. */</span></div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160; </div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;        <span class="keywordtype">double</span> dummy, yaw;</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;        targetFrameTrans.getBasis().getRPY(dummy, dummy, yaw);</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;        tf2::Matrix3x3 transTmp;</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;        transTmp.setRPY(0.0, 0.0, yaw);</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160; </div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;        maskPosition = transTmp * maskPosition;</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;        maskOrientation = transTmp * maskOrientation;</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;      }</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;      {</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;        maskPosition = targetFrameTrans.getBasis() * maskPosition;</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;        maskOrientation = targetFrameTrans.getBasis() * maskOrientation;</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;      }</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160; </div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;      <span class="comment">// Now copy the mask values back into the update vector: any row with a significant vector length</span></div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;      <span class="comment">// indicates that we want to set that variable to true in the update vector.</span></div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;      updateVector[StateMemberX] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;        maskPosition.getRow(StateMemberX - POSITION_OFFSET).length() &gt;= 1e-6);</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;      updateVector[StateMemberY] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;        maskPosition.getRow(StateMemberY - POSITION_OFFSET).length() &gt;= 1e-6);</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;      updateVector[StateMemberZ] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;        maskPosition.getRow(StateMemberZ - POSITION_OFFSET).length() &gt;= 1e-6);</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;      updateVector[StateMemberRoll] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;        maskOrientation.getRow(StateMemberRoll - ORIENTATION_OFFSET).length() &gt;= 1e-6);</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;      updateVector[StateMemberPitch] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;        maskOrientation.getRow(StateMemberPitch - ORIENTATION_OFFSET).length() &gt;= 1e-6);</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;      updateVector[StateMemberYaw] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;        maskOrientation.getRow(StateMemberYaw - ORIENTATION_OFFSET).length() &gt;= 1e-6);</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160; </div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;      <span class="comment">// 5a. We&#39;ll need to rotate the covariance as well. Create a container and copy over the</span></div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;      <span class="comment">// covariance data</span></div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;      Eigen::MatrixXd covariance(POSE_SIZE, POSE_SIZE);</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;      covariance.setZero();</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8b299c262fd69e029c8fc05ff19f150e">copyCovariance</a>(&amp;(msg-&gt;pose.covariance[0]), covariance, topicName, updateVector, POSITION_OFFSET, POSE_SIZE);</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160; </div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;      <span class="comment">// 5b. Now rotate the covariance: create an augmented matrix that</span></div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;      <span class="comment">// contains a 3D rotation matrix in the upper-left and lower-right</span></div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;      <span class="comment">// quadrants, with zeros elsewhere.</span></div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;      tf2::Matrix3x3 rot;</div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;      Eigen::MatrixXd rot6d(POSE_SIZE, POSE_SIZE);</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;      rot6d.setIdentity();</div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;      Eigen::MatrixXd covarianceRotated;</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160; </div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;      <span class="keywordflow">if</span> (imuData)</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;      {</div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;        <span class="comment">// Apply the same special logic to the IMU covariance rotation</span></div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;        <span class="keywordtype">double</span> dummy, yaw;</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;        targetFrameTrans.getBasis().getRPY(dummy, dummy, yaw);</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;        rot.setRPY(0.0, 0.0, yaw);</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;      }</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;      {</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;        rot.setRotation(targetFrameTrans.getRotation());</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;      }</div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160; </div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> rInd = 0; rInd &lt; POSITION_SIZE; ++rInd)</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;      {</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;        rot6d(rInd, 0) = rot.getRow(rInd).getX();</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;        rot6d(rInd, 1) = rot.getRow(rInd).getY();</div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;        rot6d(rInd, 2) = rot.getRow(rInd).getZ();</div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;        rot6d(rInd+POSITION_SIZE, 3) = rot.getRow(rInd).getX();</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;        rot6d(rInd+POSITION_SIZE, 4) = rot.getRow(rInd).getY();</div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;        rot6d(rInd+POSITION_SIZE, 5) = rot.getRow(rInd).getZ();</div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;      }</div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160; </div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;      <span class="comment">// Now carry out the rotation</span></div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;      covarianceRotated = rot6d * covariance * rot6d.transpose();</div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160; </div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;      RF_DEBUG(<span class="stringliteral">&quot;After rotating into the &quot;</span> &lt;&lt; finalTargetFrame &lt;&lt;</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;               <span class="stringliteral">&quot; frame, covariance is \n&quot;</span> &lt;&lt; covarianceRotated &lt;&lt;  <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160; </div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;      <span class="comment">/* 6a. For IMU data, the transform that we get is the transform from the body</span></div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;<span class="comment">       * frame of the robot (e.g., base_link) to the mounting frame of the robot. It</span></div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;<span class="comment">       * is *not* the coordinate frame in which the IMU orientation data is reported.</span></div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;<span class="comment">       * If the IMU is mounted in a non-neutral orientation, we need to remove those</span></div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;<span class="comment">       * offsets, and then we need to potentially &quot;swap&quot; roll and pitch.</span></div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;<span class="comment">       * Note that this transform does NOT handle NED-&gt;ENU conversions. Data is assumed</span></div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;<span class="comment">       * to be in the ENU frame when it is received.</span></div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;<span class="comment">       * */</span></div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;      <span class="keywordflow">if</span> (imuData)</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;      {</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;        <span class="comment">// First, convert the transform and measurement rotation to RPY</span></div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;        <span class="comment">// @todo: There must be a way to handle this with quaternions. Need to look into it.</span></div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;        <span class="keywordtype">double</span> rollOffset = 0;</div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;        <span class="keywordtype">double</span> pitchOffset = 0;</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;        <span class="keywordtype">double</span> yawOffset = 0;</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;        <span class="keywordtype">double</span> roll = 0;</div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;        <span class="keywordtype">double</span> pitch = 0;</div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;        <span class="keywordtype">double</span> yaw = 0;</div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;        RosFilterUtilities::quatToRPY(targetFrameTrans.getRotation(), rollOffset, pitchOffset, yawOffset);</div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;        RosFilterUtilities::quatToRPY(poseTmp.getRotation(), roll, pitch, yaw);</div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160; </div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;        <span class="comment">// 6b. Apply the offset (making sure to bound them), and throw them in a vector</span></div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;        tf2::Vector3 rpyAngles(FilterUtilities::clampRotation(roll - rollOffset),</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;                               FilterUtilities::clampRotation(pitch - pitchOffset),</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;                               FilterUtilities::clampRotation(yaw - yawOffset));</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160; </div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;        <span class="comment">// 6c. Now we need to rotate the roll and pitch by the yaw offset value.</span></div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;        <span class="comment">// Imagine a case where an IMU is mounted facing sideways. In that case</span></div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;        <span class="comment">// pitch for the IMU&#39;s world frame is roll for the robot.</span></div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;        tf2::Matrix3x3 mat;</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;        mat.setRPY(0.0, 0.0, yawOffset);</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;        rpyAngles = mat * rpyAngles;</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;        poseTmp.getBasis().setRPY(rpyAngles.getX(), rpyAngles.getY(), rpyAngles.getZ());</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160; </div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;        <span class="comment">// We will use this target transformation later on, but</span></div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;        <span class="comment">// we&#39;ve already transformed this data as if the IMU</span></div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;        <span class="comment">// were mounted neutrall on the robot, so we can just</span></div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;        <span class="comment">// make the transform the identity.</span></div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;        targetFrameTrans.setIdentity();</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;      }</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160; </div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;      <span class="comment">// 7. Two cases: if we&#39;re in differential mode, we need to generate a twist</span></div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;      <span class="comment">// message. Otherwise, we just transform it to the target frame.</span></div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;      <span class="keywordflow">if</span> (differential)</div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;      {</div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;        <span class="keywordtype">bool</span> success = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160; </div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;        <span class="comment">// We&#39;re going to be playing with poseTmp, so store it,</span></div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;        <span class="comment">// as we&#39;ll need to save its current value for the next</span></div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;        <span class="comment">// measurement.</span></div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;        curMeasurement = poseTmp;</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160; </div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;        <span class="comment">// Make sure we have previous measurements to work with</span></div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a368ffffbd5a044c29342add42d1971a9">previousMeasurements_</a>.count(topicName) &gt; 0 &amp;&amp; <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a38800f148299b693366730b3488812b0">previousMeasurementCovariances_</a>.count(topicName) &gt; 0)</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;        {</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;          <span class="comment">// 7a. If we are carrying out differential integration and</span></div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;          <span class="comment">// we have a previous measurement for this sensor,then we</span></div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;          <span class="comment">// need to apply the inverse of that measurement to this new</span></div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;          <span class="comment">// measurement to produce a &quot;delta&quot; measurement between the two.</span></div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;          <span class="comment">// Even if we&#39;re not using all of the variables from this sensor,</span></div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;          <span class="comment">// we need to use the whole measurement to determine the delta</span></div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;          <span class="comment">// to the new measurement</span></div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;          tf2::Transform prevMeasurement = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a368ffffbd5a044c29342add42d1971a9">previousMeasurements_</a>[topicName];</div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;          poseTmp.setData(prevMeasurement.inverseTimes(poseTmp));</div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160; </div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;          RF_DEBUG(<span class="stringliteral">&quot;Previous measurement:\n&quot;</span> &lt;&lt; <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a368ffffbd5a044c29342add42d1971a9">previousMeasurements_</a>[topicName] &lt;&lt;</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;                   <span class="stringliteral">&quot;\nAfter removing previous measurement, measurement delta is:\n&quot;</span> &lt;&lt; poseTmp &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160; </div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;          <span class="comment">// 7b. Now we we have a measurement delta in the frame_id of the</span></div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;          <span class="comment">// message, but we want that delta to be in the target frame, so</span></div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;          <span class="comment">// we need to apply the rotation of the target frame transform.</span></div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;          targetFrameTrans.setOrigin(tf2::Vector3(0.0, 0.0, 0.0));</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;          poseTmp.mult(targetFrameTrans, poseTmp);</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160; </div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;          RF_DEBUG(<span class="stringliteral">&quot;After rotating to the target frame, measurement delta is:\n&quot;</span> &lt;&lt; poseTmp &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160; </div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;          <span class="comment">// 7c. Now use the time difference from the last message to compute</span></div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;          <span class="comment">// translational and rotational velocities</span></div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;          <span class="keywordtype">double</span> dt = msg-&gt;header.stamp.toSec() - <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a473c0f797fcd9677b1005637ee159ae4">lastMessageTimes_</a>[topicName].toSec();</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;          <span class="keywordtype">double</span> xVel = poseTmp.getOrigin().getX() / dt;</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;          <span class="keywordtype">double</span> yVel = poseTmp.getOrigin().getY() / dt;</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;          <span class="keywordtype">double</span> zVel = poseTmp.getOrigin().getZ() / dt;</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160; </div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;          <span class="keywordtype">double</span> rollVel = 0;</div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;          <span class="keywordtype">double</span> pitchVel = 0;</div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;          <span class="keywordtype">double</span> yawVel = 0;</div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160; </div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;          RosFilterUtilities::quatToRPY(poseTmp.getRotation(), rollVel, pitchVel, yawVel);</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;          rollVel /= dt;</div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;          pitchVel /= dt;</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;          yawVel /= dt;</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160; </div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;          RF_DEBUG(<span class="stringliteral">&quot;Previous message time was &quot;</span> &lt;&lt; <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a473c0f797fcd9677b1005637ee159ae4">lastMessageTimes_</a>[topicName].toSec() &lt;&lt;</div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;                   <span class="stringliteral">&quot;, current message time is &quot;</span> &lt;&lt; msg-&gt;header.stamp.toSec() &lt;&lt; <span class="stringliteral">&quot;, delta is &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;                   dt &lt;&lt; <span class="stringliteral">&quot;, velocity is (vX, vY, vZ): (&quot;</span> &lt;&lt; xVel &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; yVel &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; zVel &lt;&lt;</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;                   <span class="stringliteral">&quot;)\n&quot;</span> &lt;&lt; <span class="stringliteral">&quot;(vRoll, vPitch, vYaw): (&quot;</span> &lt;&lt; rollVel &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; pitchVel &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;                   yawVel &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>);</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160; </div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;          <span class="comment">// 7d. Fill out the velocity data in the message</span></div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;          geometry_msgs::TwistWithCovarianceStamped *twistPtr = <span class="keyword">new</span> geometry_msgs::TwistWithCovarianceStamped();</div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;          twistPtr-&gt;header = msg-&gt;header;</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;          twistPtr-&gt;header.frame_id = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6c0cfc2c5d47061bf2ae272b7532b51b">baseLinkFrameId_</a>;</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;          twistPtr-&gt;twist.twist.linear.x = xVel;</div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;          twistPtr-&gt;twist.twist.linear.y = yVel;</div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;          twistPtr-&gt;twist.twist.linear.z = zVel;</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;          twistPtr-&gt;twist.twist.angular.x = rollVel;</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;          twistPtr-&gt;twist.twist.angular.y = pitchVel;</div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;          twistPtr-&gt;twist.twist.angular.z = yawVel;</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;          std::vector&lt;int&gt; twistUpdateVec(STATE_SIZE, <span class="keyword">false</span>);</div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;          std::copy(updateVector.begin() + POSITION_OFFSET,</div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;                    updateVector.begin() + POSE_SIZE,</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;                    twistUpdateVec.begin() + POSITION_V_OFFSET);</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;          std::copy(twistUpdateVec.begin(), twistUpdateVec.end(), updateVector.begin());</div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;          geometry_msgs::TwistWithCovarianceStampedConstPtr ptr(twistPtr);</div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160; </div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;          <span class="comment">// 7e. Now rotate the previous covariance for this measurement to get it</span></div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;          <span class="comment">// into the target frame, and add the current measurement&#39;s rotated covariance</span></div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;          <span class="comment">// to the previous measurement&#39;s rotated covariance, and multiply by the time delta.</span></div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;          Eigen::MatrixXd prevCovarRotated = rot6d * <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a38800f148299b693366730b3488812b0">previousMeasurementCovariances_</a>[topicName] * rot6d.transpose();</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;          covarianceRotated = (covarianceRotated.eval() + prevCovarRotated) * dt;</div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;          <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8b299c262fd69e029c8fc05ff19f150e">copyCovariance</a>(covarianceRotated, &amp;(twistPtr-&gt;twist.covariance[0]), POSE_SIZE);</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160; </div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;          RF_DEBUG(<span class="stringliteral">&quot;Previous measurement covariance:\n&quot;</span> &lt;&lt; <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a38800f148299b693366730b3488812b0">previousMeasurementCovariances_</a>[topicName] &lt;&lt;</div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;                   <span class="stringliteral">&quot;\nPrevious measurement covariance rotated:\n&quot;</span> &lt;&lt; prevCovarRotated &lt;&lt;</div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;                   <span class="stringliteral">&quot;\nFinal twist covariance:\n&quot;</span> &lt;&lt; covarianceRotated &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160; </div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;          <span class="comment">// Now pass this on to prepareTwist, which will convert it to the required frame</span></div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;          success = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a01c500083730b2030e947e21d630e43b">prepareTwist</a>(ptr,</div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;                                 topicName + <span class="stringliteral">&quot;_twist&quot;</span>,</div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;                                 twistPtr-&gt;header.frame_id,</div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;                                 updateVector,</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;                                 measurement,</div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;                                 measurementCovariance);</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;        }</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160; </div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;        <span class="comment">// 7f. Update the previous measurement and measurement covariance</span></div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;        <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a368ffffbd5a044c29342add42d1971a9">previousMeasurements_</a>[topicName] = curMeasurement;</div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;        <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a38800f148299b693366730b3488812b0">previousMeasurementCovariances_</a>[topicName] = covariance;</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160; </div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;        retVal = success;</div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;      }</div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;      {</div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;        <span class="comment">// 7g. If we&#39;re in relative mode, remove the initial measurement</span></div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;        <span class="keywordflow">if</span> (relative)</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;        {</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a706c4ea2aad03711195e856dbd2e6796">initialMeasurements_</a>.count(topicName) == 0)</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;          {</div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;            <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a706c4ea2aad03711195e856dbd2e6796">initialMeasurements_</a>.insert(std::pair&lt;std::string, tf2::Transform&gt;(topicName, poseTmp));</div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;          }</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160; </div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;          tf2::Transform initialMeasurement = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a706c4ea2aad03711195e856dbd2e6796">initialMeasurements_</a>[topicName];</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;          poseTmp.setData(initialMeasurement.inverseTimes(poseTmp));</div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;        }</div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160; </div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;        <span class="comment">// 7h. Apply the target frame transformation to the pose object.</span></div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;        poseTmp.mult(targetFrameTrans, poseTmp);</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;        poseTmp.frame_id_ = finalTargetFrame;</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160; </div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;        <span class="comment">// 7i. Finally, copy everything into our measurement and covariance objects</span></div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;        measurement(StateMemberX) = poseTmp.getOrigin().x();</div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;        measurement(StateMemberY) = poseTmp.getOrigin().y();</div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;        measurement(StateMemberZ) = poseTmp.getOrigin().z();</div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160; </div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;        <span class="comment">// The filter needs roll, pitch, and yaw values instead of quaternions</span></div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;        <span class="keywordtype">double</span> roll, pitch, yaw;</div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;        RosFilterUtilities::quatToRPY(poseTmp.getRotation(), roll, pitch, yaw);</div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;        measurement(StateMemberRoll) = roll;</div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;        measurement(StateMemberPitch) = pitch;</div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;        measurement(StateMemberYaw) = yaw;</div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160; </div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;        measurementCovariance.block(0, 0, POSE_SIZE, POSE_SIZE) = covarianceRotated.block(0, 0, POSE_SIZE, POSE_SIZE);</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160; </div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;        <span class="comment">// 8. Handle 2D mode</span></div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ad06dbf8f35a49fc76daf1c16fdecd34d">twoDMode_</a>)</div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;        {</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;          <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a4585957fbc3239e559eb509921f28a8f">forceTwoD</a>(measurement, measurementCovariance, updateVector);</div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;        }</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160; </div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;        retVal = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;      }</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;    }</div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;    {</div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;      retVal = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160; </div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;      RF_DEBUG(<span class="stringliteral">&quot;Could not transform measurement into &quot;</span> &lt;&lt; finalTargetFrame &lt;&lt; <span class="stringliteral">&quot;. Ignoring...&quot;</span>);</div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;    }</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160; </div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;\n----- /RosFilter::preparePose (&quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot;) ------\n&quot;</span>);</div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160; </div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;    <span class="keywordflow">return</span> retVal;</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a01c500083730b2030e947e21d630e43b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01c500083730b2030e947e21d630e43b">&#9670;&nbsp;</a></span>prepareTwist()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::prepareTwist </td>
          <td>(</td>
          <td class="paramtype">const geometry_msgs::TwistWithCovarianceStamped::ConstPtr &amp;&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>topicName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>targetFrame</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int &gt; &amp;&#160;</td>
          <td class="paramname"><em>updateVector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Eigen::VectorXd &amp;&#160;</td>
          <td class="paramname"><em>measurement</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Eigen::MatrixXd &amp;&#160;</td>
          <td class="paramname"><em>measurementCovariance</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Prepares a twist message for integration into the filter. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">msg</td><td>- The twist message to prepare </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">topicName</td><td>- The name of the topic over which this message was received </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">targetFrame</td><td>- The target tf frame </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">updateVector</td><td>- The update vector for the data source </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">measurement</td><td>- The twist data converted to a measurement </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">measurementCovariance</td><td>- The covariance of the converted measurement </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true indicates that the measurement was successfully prepared, false otherwise </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l02922">2922</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;  {</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;------ RosFilter::prepareTwist (&quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot;) ------\n&quot;</span>);</div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160; </div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;    <span class="comment">// 1. Get the measurement into two separate vector objects.</span></div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;    tf2::Vector3 twistLin(msg-&gt;twist.twist.linear.x,</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;                          msg-&gt;twist.twist.linear.y,</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;                          msg-&gt;twist.twist.linear.z);</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;    tf2::Vector3 measTwistRot(msg-&gt;twist.twist.angular.x,</div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;                              msg-&gt;twist.twist.angular.y,</div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;                              msg-&gt;twist.twist.angular.z);</div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160; </div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;    <span class="comment">// 1a. This sensor may or may not measure rotational velocity. Regardless,</span></div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;    <span class="comment">// if it measures linear velocity, then later on, we&#39;ll need to remove &quot;false&quot;</span></div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;    <span class="comment">// linear velocity resulting from angular velocity and the translational offset</span></div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;    <span class="comment">// of the sensor from the vehicle origin.</span></div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;    <span class="keyword">const</span> Eigen::VectorXd &amp;state = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.getState();</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;    tf2::Vector3 stateTwistRot(state(StateMemberVroll),</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;                               state(StateMemberVpitch),</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;                               state(StateMemberVyaw));</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160; </div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;    <span class="comment">// Determine the frame_id of the data</span></div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;    std::string msgFrame = (msg-&gt;header.frame_id == <span class="stringliteral">&quot;&quot;</span> ? targetFrame : msg-&gt;header.frame_id);</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160; </div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;    <span class="comment">// 2. robot_localization lets users configure which variables from the sensor should be</span></div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;    <span class="comment">//    fused with the filter. This is specified at the sensor level. However, the data</span></div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;    <span class="comment">//    may go through transforms before being fused with the state estimate. In that case,</span></div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;    <span class="comment">//    we need to know which of the transformed variables came from the pre-transformed</span></div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;    <span class="comment">//    &quot;approved&quot; variables (i.e., the ones that had &quot;true&quot; in their xxx_config parameter).</span></div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;    <span class="comment">//    To do this, we construct matrices using the update vector values on the diagonals,</span></div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;    <span class="comment">//    pass this matrix through the rotation, and use the length of each row to determine</span></div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;    <span class="comment">//    the transformed update vector.</span></div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;    tf2::Matrix3x3 maskLin(updateVector[StateMemberVx], 0, 0,</div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;                           0, updateVector[StateMemberVy], 0,</div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;                           0, 0, updateVector[StateMemberVz]);</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160; </div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;    tf2::Matrix3x3 maskRot(updateVector[StateMemberVroll], 0, 0,</div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;                           0, updateVector[StateMemberVpitch], 0,</div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;                           0, 0, updateVector[StateMemberVyaw]);</div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160; </div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;    <span class="comment">// 3. We&#39;ll need to rotate the covariance as well</span></div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;    Eigen::MatrixXd covarianceRotated(TWIST_SIZE, TWIST_SIZE);</div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;    covarianceRotated.setZero();</div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160; </div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8b299c262fd69e029c8fc05ff19f150e">copyCovariance</a>(&amp;(msg-&gt;twist.covariance[0]),</div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;                   covarianceRotated,</div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;                   topicName,</div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;                   updateVector,</div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;                   POSITION_V_OFFSET,</div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;                   TWIST_SIZE);</div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160; </div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;Original measurement as tf object:\nLinear: &quot;</span> &lt;&lt; twistLin &lt;&lt;</div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;             <span class="stringliteral">&quot;Rotational: &quot;</span> &lt;&lt; measTwistRot &lt;&lt;</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;             <span class="stringliteral">&quot;\nOriginal update vector:\n&quot;</span> &lt;&lt; updateVector &lt;&lt;</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;             <span class="stringliteral">&quot;\nOriginal covariance matrix:\n&quot;</span> &lt;&lt; covarianceRotated &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160; </div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;    <span class="comment">// 4. We need to transform this into the target frame (probably base_link)</span></div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;    tf2::Transform targetFrameTrans;</div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;    <span class="keywordtype">bool</span> canTransform = RosFilterUtilities::lookupTransformSafe(<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aacaed6dea7d7bd1dc1d03eeddf002c29">tfBuffer_</a>,</div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;                                                                targetFrame,</div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;                                                                msgFrame,</div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;                                                                msg-&gt;header.stamp,</div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;                                                                <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5c57fe5f94f02e033ac78939966ad366">tfTimeout_</a>,</div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;                                                                targetFrameTrans);</div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160; </div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;    <span class="keywordflow">if</span> (canTransform)</div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;    {</div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;      <span class="comment">// Transform to correct frame. Note that we can get linear velocity</span></div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;      <span class="comment">// as a result of the sensor offset and rotational velocity</span></div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;      measTwistRot = targetFrameTrans.getBasis() * measTwistRot;</div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;      twistLin = targetFrameTrans.getBasis() * twistLin + targetFrameTrans.getOrigin().cross(stateTwistRot);</div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;      maskLin = targetFrameTrans.getBasis() * maskLin;</div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;      maskRot = targetFrameTrans.getBasis() * maskRot;</div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160; </div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;      <span class="comment">// Now copy the mask values back into the update vector</span></div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;      updateVector[StateMemberVx] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;        maskLin.getRow(StateMemberVx - POSITION_V_OFFSET).length() &gt;= 1e-6);</div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;      updateVector[StateMemberVy] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;        maskLin.getRow(StateMemberVy - POSITION_V_OFFSET).length() &gt;= 1e-6);</div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;      updateVector[StateMemberVz] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;        maskLin.getRow(StateMemberVz - POSITION_V_OFFSET).length() &gt;= 1e-6);</div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;      updateVector[StateMemberVroll] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;        maskRot.getRow(StateMemberVroll - ORIENTATION_V_OFFSET).length() &gt;= 1e-6);</div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;      updateVector[StateMemberVpitch] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;        maskRot.getRow(StateMemberVpitch - ORIENTATION_V_OFFSET).length() &gt;= 1e-6);</div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;      updateVector[StateMemberVyaw] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;        maskRot.getRow(StateMemberVyaw - ORIENTATION_V_OFFSET).length() &gt;= 1e-6);</div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160; </div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;      RF_DEBUG(msg-&gt;header.frame_id &lt;&lt; <span class="stringliteral">&quot;-&gt;&quot;</span> &lt;&lt; targetFrame &lt;&lt; <span class="stringliteral">&quot; transform:\n&quot;</span> &lt;&lt; targetFrameTrans &lt;&lt;</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;               <span class="stringliteral">&quot;\nAfter applying transform to &quot;</span> &lt;&lt; targetFrame &lt;&lt; <span class="stringliteral">&quot;, update vector is:\n&quot;</span> &lt;&lt; updateVector &lt;&lt;</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;               <span class="stringliteral">&quot;\nAfter applying transform to &quot;</span> &lt;&lt; targetFrame &lt;&lt; <span class="stringliteral">&quot;, measurement is:\n&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;               <span class="stringliteral">&quot;Linear: &quot;</span> &lt;&lt; twistLin &lt;&lt; <span class="stringliteral">&quot;Rotational: &quot;</span> &lt;&lt; measTwistRot &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160; </div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;      <span class="comment">// 5. Now rotate the covariance: create an augmented</span></div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;      <span class="comment">// matrix that contains a 3D rotation matrix in the</span></div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;      <span class="comment">// upper-left and lower-right quadrants, and zeros</span></div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;      <span class="comment">// elsewhere</span></div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;      tf2::Matrix3x3 rot(targetFrameTrans.getRotation());</div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;      Eigen::MatrixXd rot6d(TWIST_SIZE, TWIST_SIZE);</div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;      rot6d.setIdentity();</div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160; </div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> rInd = 0; rInd &lt; POSITION_SIZE; ++rInd)</div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;      {</div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;        rot6d(rInd, 0) = rot.getRow(rInd).getX();</div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;        rot6d(rInd, 1) = rot.getRow(rInd).getY();</div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;        rot6d(rInd, 2) = rot.getRow(rInd).getZ();</div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;        rot6d(rInd+POSITION_SIZE, 3) = rot.getRow(rInd).getX();</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;        rot6d(rInd+POSITION_SIZE, 4) = rot.getRow(rInd).getY();</div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;        rot6d(rInd+POSITION_SIZE, 5) = rot.getRow(rInd).getZ();</div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;      }</div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160; </div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;      <span class="comment">// Carry out the rotation</span></div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;      covarianceRotated = rot6d * covarianceRotated.eval() * rot6d.transpose();</div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160; </div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;      RF_DEBUG(<span class="stringliteral">&quot;Transformed covariance is \n&quot;</span> &lt;&lt; covarianceRotated &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160; </div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;      <span class="comment">// 6. Store our corrected measurement and covariance</span></div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;      measurement(StateMemberVx) = twistLin.getX();</div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;      measurement(StateMemberVy) = twistLin.getY();</div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;      measurement(StateMemberVz) = twistLin.getZ();</div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;      measurement(StateMemberVroll) = measTwistRot.getX();</div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;      measurement(StateMemberVpitch) = measTwistRot.getY();</div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;      measurement(StateMemberVyaw) = measTwistRot.getZ();</div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160; </div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;      <span class="comment">// Copy the covariances</span></div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;      measurementCovariance.block(POSITION_V_OFFSET, POSITION_V_OFFSET, TWIST_SIZE, TWIST_SIZE) =</div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;        covarianceRotated.block(0, 0, TWIST_SIZE, TWIST_SIZE);</div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160; </div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;      <span class="comment">// 7. Handle 2D mode</span></div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ad06dbf8f35a49fc76daf1c16fdecd34d">twoDMode_</a>)</div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;      {</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;        <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a4585957fbc3239e559eb509921f28a8f">forceTwoD</a>(measurement, measurementCovariance, updateVector);</div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;      }</div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;    }</div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;    {</div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;      RF_DEBUG(<span class="stringliteral">&quot;Could not transform measurement into &quot;</span> &lt;&lt; targetFrame &lt;&lt; <span class="stringliteral">&quot;. Ignoring...&quot;</span>);</div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;    }</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160; </div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;\n----- /RosFilter::prepareTwist (&quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot;) ------\n&quot;</span>);</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160; </div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;    <span class="keywordflow">return</span> canTransform;</div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8ea96b4c2cca39358e3c6e90cfe315bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ea96b4c2cca39358e3c6e90cfe315bd">&#9670;&nbsp;</a></span>revertTo()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::revertTo </td>
          <td>(</td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>time</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Finds the latest filter state before the given timestamp and makes it the current state again. </p>
<p>This method also inserts all measurements between the older filter timestamp and now into the measurements queue.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">time</td><td>- The time to which the filter state should revert </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if restoring the filter succeeded. False if not. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l03086">3086</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;  {</div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;\n----- RosFilter::revertTo -----\n&quot;</span>);</div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;\nRequested time was &quot;</span> &lt;&lt; std::setprecision(20) &lt;&lt; time &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>)</div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160; </div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;    size_t history_size = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a37a9eb3abb974e2079e34843dbd69af3">filterStateHistory_</a>.size();</div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160; </div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;    <span class="comment">// Walk back through the queue until we reach a filter state whose time stamp is less than or equal to the</span></div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;    <span class="comment">// requested time. Since every saved state after that time will be overwritten/corrected, we can pop from</span></div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;    <span class="comment">// the queue. If the history is insufficiently short, we just take the oldest state we have.</span></div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;    FilterStatePtr lastHistoryState;</div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;    while (!<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a37a9eb3abb974e2079e34843dbd69af3">filterStateHistory_</a>.empty() &amp;&amp; <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a37a9eb3abb974e2079e34843dbd69af3">filterStateHistory_</a>.back()-&gt;lastMeasurementTime_ &gt; time)</div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;    {</div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;      lastHistoryState = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a37a9eb3abb974e2079e34843dbd69af3">filterStateHistory_</a>.back();</div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a37a9eb3abb974e2079e34843dbd69af3">filterStateHistory_</a>.pop_back();</div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;    }</div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160; </div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;    <span class="comment">// If the state history is not empty at this point, it means that our history was large enough, and we</span></div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;    <span class="comment">// should revert to the state at the back of the history deque.</span></div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;    <span class="keywordtype">bool</span> retVal = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a37a9eb3abb974e2079e34843dbd69af3">filterStateHistory_</a>.empty())</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;    {</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;      retVal = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;      lastHistoryState = <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a37a9eb3abb974e2079e34843dbd69af3">filterStateHistory_</a>.back();</div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;    }</div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;    {</div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;      RF_DEBUG(<span class="stringliteral">&quot;Insufficient history to revert to time &quot;</span> &lt;&lt; time &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160; </div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;      <span class="keywordflow">if</span> (lastHistoryState)</div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;      {</div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;        RF_DEBUG(<span class="stringliteral">&quot;Will revert to oldest state at &quot;</span> &lt;&lt; lastHistoryState-&gt;latestControlTime_ &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;        ROS_WARN_STREAM_DELAYED_THROTTLE(<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a84b03bc70e9979c28deb044c545ba287">historyLength_</a>, <span class="stringliteral">&quot;Could not revert to state with time &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;          std::setprecision(20) &lt;&lt; time &lt;&lt; <span class="stringliteral">&quot;. Instead reverted to state with time &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;          lastHistoryState-&gt;lastMeasurementTime_ &lt;&lt; <span class="stringliteral">&quot;. History size was &quot;</span> &lt;&lt; history_size);</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;      }</div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;    }</div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160; </div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;    <span class="comment">// If we have a valid reversion state, revert</span></div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;    <span class="keywordflow">if</span> (lastHistoryState)</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;    {</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;      <span class="comment">// Reset filter to the latest state from the queue.</span></div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;      <span class="keyword">const</span> FilterStatePtr &amp;state = lastHistoryState;</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.setState(state-&gt;state_);</div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.setEstimateErrorCovariance(state-&gt;estimateErrorCovariance_);</div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.setLastMeasurementTime(state-&gt;lastMeasurementTime_);</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160; </div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;      RF_DEBUG(<span class="stringliteral">&quot;Reverted to state with time &quot;</span> &lt;&lt; std::setprecision(20) &lt;&lt; state-&gt;lastMeasurementTime_ &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160; </div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;      <span class="comment">// Repeat for measurements, but push every measurement onto the measurement queue as we go</span></div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;      <span class="keywordtype">int</span> restored_measurements = 0;</div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;      <span class="keywordflow">while</span> (!<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aeb7a3b61549bad2cc4e84d803c038c5f">measurementHistory_</a>.empty() &amp;&amp; <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aeb7a3b61549bad2cc4e84d803c038c5f">measurementHistory_</a>.back()-&gt;time_ &gt; time)</div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;      {</div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;        <span class="comment">// Don&#39;t need to restore measurements that predate our earliest state time</span></div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;        <span class="keywordflow">if</span> (state-&gt;lastMeasurementTime_ &lt;= <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aeb7a3b61549bad2cc4e84d803c038c5f">measurementHistory_</a>.back()-&gt;time_)</div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;        {</div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;          <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a233bcdab40b3b0d7db316ffd0c09f2ce">measurementQueue_</a>.push(<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aeb7a3b61549bad2cc4e84d803c038c5f">measurementHistory_</a>.back());</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;          restored_measurements++;</div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;        }</div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160; </div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;        <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aeb7a3b61549bad2cc4e84d803c038c5f">measurementHistory_</a>.pop_back();</div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;      }</div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160; </div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;      RF_DEBUG(<span class="stringliteral">&quot;Restored &quot;</span> &lt;&lt; restored_measurements &lt;&lt; <span class="stringliteral">&quot; to measurement queue.\n&quot;</span>);</div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;    }</div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160; </div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;\n----- /RosFilter::revertTo\n&quot;</span>);</div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160; </div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;    <span class="keywordflow">return</span> retVal;</div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a0247b864a7b44e5310e7d05e69e41695"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0247b864a7b44e5310e7d05e69e41695">&#9670;&nbsp;</a></span>saveFilterState()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::saveFilterState </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d5/d5b/classRobotLocalization_1_1FilterBase.html">FilterBase</a> &amp;&#160;</td>
          <td class="paramname"><em>filter</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Saves the current filter state in the queue of previous filter states. </p>
<p>These measurements will be used in backwards smoothing in the event that older measurements come in. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">filter</td><td>- The filter base object whose state we want to save </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l03072">3072</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;  {</div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;    FilterStatePtr state = FilterStatePtr(<span class="keyword">new</span> FilterState());</div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;    state-&gt;state_ = Eigen::VectorXd(filter.getState());</div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;    state-&gt;estimateErrorCovariance_ = Eigen::MatrixXd(filter.getEstimateErrorCovariance());</div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;    state-&gt;lastMeasurementTime_ = filter.getLastMeasurementTime();</div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;    state-&gt;latestControl_ = Eigen::VectorXd(filter.getControl());</div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;    state-&gt;latestControlTime_ = filter.getControlTime();</div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a37a9eb3abb974e2079e34843dbd69af3">filterStateHistory_</a>.push_back(state);</div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;Saved state with timestamp &quot;</span> &lt;&lt; std::setprecision(20) &lt;&lt; state-&gt;lastMeasurementTime_ &lt;&lt;</div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;             <span class="stringliteral">&quot; to history. &quot;</span> &lt;&lt; <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a37a9eb3abb974e2079e34843dbd69af3">filterStateHistory_</a>.size() &lt;&lt; <span class="stringliteral">&quot; measurements are in the queue.\n&quot;</span>);</div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae4a8a9f6bc2aa5358c04de11ed72a821"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae4a8a9f6bc2aa5358c04de11ed72a821">&#9670;&nbsp;</a></span>setPoseCallback()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::setPoseCallback </td>
          <td>(</td>
          <td class="paramtype">const geometry_msgs::PoseWithCovarianceStamped::ConstPtr &amp;&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback method for manually setting/resetting the internal pose estimate. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">msg</td><td>- The ROS stamped pose with covariance message to take in </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l02005">2005</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;  {</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;------ RosFilter::setPoseCallback ------\nPose message:\n&quot;</span> &lt;&lt; *msg);</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160; </div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;    ROS_INFO_STREAM(<span class="stringliteral">&quot;Received set_pose request with value\n&quot;</span> &lt;&lt; *msg);</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160; </div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    std::string topicName(<span class="stringliteral">&quot;setPose&quot;</span>);</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160; </div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;    <span class="comment">// Get rid of any initial poses (pretend we&#39;ve never had a measurement)</span></div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a706c4ea2aad03711195e856dbd2e6796">initialMeasurements_</a>.clear();</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a368ffffbd5a044c29342add42d1971a9">previousMeasurements_</a>.clear();</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a38800f148299b693366730b3488812b0">previousMeasurementCovariances_</a>.clear();</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160; </div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a1ff13740c9af1413442122197e565caf">clearMeasurementQueue</a>();</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160; </div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a37a9eb3abb974e2079e34843dbd69af3">filterStateHistory_</a>.clear();</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aeb7a3b61549bad2cc4e84d803c038c5f">measurementHistory_</a>.clear();</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160; </div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;    <span class="comment">// Also set the last set pose time, so we ignore all messages</span></div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;    <span class="comment">// that occur before it</span></div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aa9df5f56cfb6d02a4bc22c8b68ad115f">lastSetPoseTime_</a> = msg-&gt;header.stamp;</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160; </div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;    <span class="comment">// Set the state vector to the reported pose</span></div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;    Eigen::VectorXd measurement(STATE_SIZE);</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;    Eigen::MatrixXd measurementCovariance(STATE_SIZE, STATE_SIZE);</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;    std::vector&lt;int&gt; updateVector(STATE_SIZE, <span class="keyword">true</span>);</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160; </div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;    <span class="comment">// We only measure pose variables, so initialize the vector to 0</span></div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;    measurement.setZero();</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160; </div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;    <span class="comment">// Set this to the identity and let the message reset it</span></div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;    measurementCovariance.setIdentity();</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;    measurementCovariance *= 1e-6;</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160; </div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;    <span class="comment">// Prepare the pose data (really just using this to transform it into the target frame).</span></div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    <span class="comment">// Twist data is going to get zeroed out.</span></div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a2538569c164be4b396576252e69732bb">preparePose</a>(msg, topicName, <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a37c23d6c10a630fe33e74376898fc5c8">worldFrameId_</a>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, updateVector, measurement, measurementCovariance);</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160; </div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;    <span class="comment">// For the state</span></div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.setState(measurement);</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.setEstimateErrorCovariance(measurementCovariance);</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160; </div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">filter_</a>.setLastMeasurementTime(ros::Time::now().toSec());</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160; </div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;\n------ /RosFilter::setPoseCallback ------\n&quot;</span>);</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae7e52d78645c3c68279d81d0b0feda25"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae7e52d78645c3c68279d81d0b0feda25">&#9670;&nbsp;</a></span>setPoseSrvCallback()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::setPoseSrvCallback </td>
          <td>(</td>
          <td class="paramtype">robot_localization::SetPose::Request &amp;&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">robot_localization::SetPose::Response &amp;&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Service callback for manually setting/resetting the internal pose estimate. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">request</td><td>- Custom service request with pose information </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if successful, false if not </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l02053">2053</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;  {</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;    geometry_msgs::PoseWithCovarianceStamped::Ptr msg;</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;    msg = boost::make_shared&lt;geometry_msgs::PoseWithCovarianceStamped&gt;(request.pose);</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;    <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ae4a8a9f6bc2aa5358c04de11ed72a821">setPoseCallback</a>(msg);</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160; </div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="afb177072d3c8ff1f4b9442ad41c2d754"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb177072d3c8ff1f4b9442ad41c2d754">&#9670;&nbsp;</a></span>toggleFilterProcessingCallback()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::toggleFilterProcessingCallback </td>
          <td>(</td>
          <td class="paramtype">robot_localization::ToggleFilterProcessing::Request &amp;&#160;</td>
          <td class="paramname"><em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">robot_localization::ToggleFilterProcessing::Response &amp;&#160;</td>
          <td class="paramname"><em>resp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Service callback to toggle processing measurements for a standby mode but continuing to publish. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">request</td><td>- The state requested, on (True) or off (False) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">response</td><td>- status if upon success </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>boolean true if successful, false if not </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l00183">183</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  {</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordflow">if</span> (req.on == <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ac22190accdeee0fc2dcfb692e5d97038">toggledOn_</a>)</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      ROS_WARN_STREAM(<span class="stringliteral">&quot;Service was called to toggle filter processing but state was already as requested.&quot;</span>);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      resp.status = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    }</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      ROS_INFO(<span class="stringliteral">&quot;Toggling filter measurement filtering to %s.&quot;</span>, req.on ? <span class="stringliteral">&quot;On&quot;</span> : <span class="stringliteral">&quot;Off&quot;</span>);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ac22190accdeee0fc2dcfb692e5d97038">toggledOn_</a> = req.on;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      resp.status = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="aeec53ee745d41ed8e342c9688a4a3165"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeec53ee745d41ed8e342c9688a4a3165">&#9670;&nbsp;</a></span>twistCallback()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::twistCallback </td>
          <td>(</td>
          <td class="paramtype">const geometry_msgs::TwistWithCovarianceStamped::ConstPtr &amp;&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d89/structRobotLocalization_1_1CallbackData.html">CallbackData</a> &amp;&#160;</td>
          <td class="paramname"><em>callbackData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>targetFrame</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback method for receiving all twist messages. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">msg</td><td>- The ROS stamped twist with covariance message to take in. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">callbackData</td><td>- Relevant static callback data </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">targetFrame</td><td>- The target frame_id into which to transform the data </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l02082">2082</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;  {</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;    <span class="keyword">const</span> std::string &amp;topicName = callbackData.topicName_;</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160; </div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;    <span class="comment">// If we&#39;ve just reset the filter, then we want to ignore any messages</span></div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;    <span class="comment">// that arrive with an older timestamp</span></div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;    <span class="keywordflow">if</span> (msg-&gt;header.stamp &lt;= <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aa9df5f56cfb6d02a4bc22c8b68ad115f">lastSetPoseTime_</a>)</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;    {</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;      std::stringstream stream;</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;      stream &lt;&lt; <span class="stringliteral">&quot;The &quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot; message has a timestamp equal to or before the last filter reset, &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;                <span class="stringliteral">&quot;this message will be ignored. This may indicate an empty or bad timestamp. (message time: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;                msg-&gt;header.stamp.toSec() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8266b1436e1907c160d8c73a920e806c">addDiagnostic</a>(diagnostic_msgs::DiagnosticStatus::WARN,</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;                    topicName + <span class="stringliteral">&quot;_timestamp&quot;</span>,</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;                    stream.str(),</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;                    <span class="keyword">false</span>);</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;    }</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160; </div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;------ RosFilter::twistCallback (&quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot;) ------\n&quot;</span></div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;             <span class="stringliteral">&quot;Twist message:\n&quot;</span> &lt;&lt; *msg);</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160; </div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a473c0f797fcd9677b1005637ee159ae4">lastMessageTimes_</a>.count(topicName) == 0)</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;    {</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a473c0f797fcd9677b1005637ee159ae4">lastMessageTimes_</a>.insert(std::pair&lt;std::string, ros::Time&gt;(topicName, msg-&gt;header.stamp));</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;    }</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160; </div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;    <span class="comment">// Make sure this message is newer than the last one</span></div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;    <span class="keywordflow">if</span> (msg-&gt;header.stamp &gt;= <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a473c0f797fcd9677b1005637ee159ae4">lastMessageTimes_</a>[topicName])</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;    {</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;      RF_DEBUG(<span class="stringliteral">&quot;Update vector for &quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot; is:\n&quot;</span> &lt;&lt; callbackData.updateVector_);</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160; </div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;      Eigen::VectorXd measurement(STATE_SIZE);</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;      Eigen::MatrixXd measurementCovariance(STATE_SIZE, STATE_SIZE);</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160; </div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;      measurement.setZero();</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;      measurementCovariance.setZero();</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160; </div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;      <span class="comment">// Make sure we&#39;re actually updating at least one of these variables</span></div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;      std::vector&lt;int&gt; updateVectorCorrected = callbackData.updateVector_;</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160; </div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;      <span class="comment">// Prepare the twist data for inclusion in the filter</span></div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a01c500083730b2030e947e21d630e43b">prepareTwist</a>(msg, topicName, targetFrame, updateVectorCorrected, measurement, measurementCovariance))</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;      {</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;        <span class="comment">// Store the measurement. Add a &quot;twist&quot; suffix so we know what kind of measurement</span></div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;        <span class="comment">// we&#39;re dealing with when we debug the core filter logic.</span></div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;        <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6f69cfe0fd2fea54446e4895b14c4c88">enqueueMeasurement</a>(topicName,</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;                           measurement,</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;                           measurementCovariance,</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;                           updateVectorCorrected,</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;                           callbackData.rejectionThreshold_,</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;                           msg-&gt;header.stamp);</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160; </div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;        RF_DEBUG(<span class="stringliteral">&quot;Enqueued new measurement for &quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot;_twist\n&quot;</span>);</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;      }</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;      {</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;        RF_DEBUG(<span class="stringliteral">&quot;Did *not* enqueue measurement for &quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot;_twist\n&quot;</span>);</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;      }</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160; </div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a473c0f797fcd9677b1005637ee159ae4">lastMessageTimes_</a>[topicName] = msg-&gt;header.stamp;</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160; </div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;      RF_DEBUG(<span class="stringliteral">&quot;Last message time for &quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot; is now &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;        <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a473c0f797fcd9677b1005637ee159ae4">lastMessageTimes_</a>[topicName] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;    }</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a16ad0452b5b52e64a93736d25cfeba95">resetOnTimeJump_</a> &amp;&amp; ros::Time::isSimTime())</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;    {</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a011b39dad94b84b7856f993518e4ae00">reset</a>();</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;    }</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;    {</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;      std::stringstream stream;</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;      stream &lt;&lt; <span class="stringliteral">&quot;The &quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot; message has a timestamp before that of the previous message received,&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;                <span class="stringliteral">&quot; this message will be ignored. This may indicate a bad timestamp. (message time: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;                msg-&gt;header.stamp.toSec() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;      <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8266b1436e1907c160d8c73a920e806c">addDiagnostic</a>(diagnostic_msgs::DiagnosticStatus::WARN,</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;                    topicName + <span class="stringliteral">&quot;_timestamp&quot;</span>,</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;                    stream.str(),</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;                    <span class="keyword">false</span>);</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160; </div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;      RF_DEBUG(<span class="stringliteral">&quot;Message is too old. Last message time for &quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot; is &quot;</span> &lt;&lt; <a class="code" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a473c0f797fcd9677b1005637ee159ae4">lastMessageTimes_</a>[topicName] &lt;&lt;</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;        <span class="stringliteral">&quot;, current message time is &quot;</span> &lt;&lt; msg-&gt;header.stamp &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;    }</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160; </div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;    RF_DEBUG(<span class="stringliteral">&quot;\n----- /RosFilter::twistCallback (&quot;</span> &lt;&lt; topicName &lt;&lt; <span class="stringliteral">&quot;) ------\n&quot;</span>);</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a3de307ae35c1f4d6df8d3e19ec06d3e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3de307ae35c1f4d6df8d3e19ec06d3e8">&#9670;&nbsp;</a></span>validateFilterOutput()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::validateFilterOutput </td>
          <td>(</td>
          <td class="paramtype">const nav_msgs::Odometry &amp;&#160;</td>
          <td class="paramname"><em>message</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Validates filter outputs for NaNs and Infinite values. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">message</td><td>- The standard ROS odometry message to be validated </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the filter output is valid, false otherwise </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html#l03158">3158</a> of file <a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;  {</div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;    <span class="keywordflow">return</span> !std::isnan(message.pose.pose.position.x) &amp;&amp; !std::isinf(message.pose.pose.position.x) &amp;&amp;</div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;           !std::isnan(message.pose.pose.position.y) &amp;&amp; !std::isinf(message.pose.pose.position.y) &amp;&amp;</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;           !std::isnan(message.pose.pose.position.z) &amp;&amp; !std::isinf(message.pose.pose.position.z) &amp;&amp;</div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;           !std::isnan(message.pose.pose.orientation.x) &amp;&amp; !std::isinf(message.pose.pose.orientation.x) &amp;&amp;</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;           !std::isnan(message.pose.pose.orientation.y) &amp;&amp; !std::isinf(message.pose.pose.orientation.y) &amp;&amp;</div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;           !std::isnan(message.pose.pose.orientation.z) &amp;&amp; !std::isinf(message.pose.pose.orientation.z) &amp;&amp;</div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;           !std::isnan(message.pose.pose.orientation.w) &amp;&amp; !std::isinf(message.pose.pose.orientation.w) &amp;&amp;</div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;           !std::isnan(message.twist.twist.linear.x) &amp;&amp; !std::isinf(message.twist.twist.linear.x) &amp;&amp;</div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;           !std::isnan(message.twist.twist.linear.y) &amp;&amp; !std::isinf(message.twist.twist.linear.y) &amp;&amp;</div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;           !std::isnan(message.twist.twist.linear.z) &amp;&amp; !std::isinf(message.twist.twist.linear.z) &amp;&amp;</div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;           !std::isnan(message.twist.twist.angular.x) &amp;&amp; !std::isinf(message.twist.twist.angular.x) &amp;&amp;</div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;           !std::isnan(message.twist.twist.angular.y) &amp;&amp; !std::isinf(message.twist.twist.angular.y) &amp;&amp;</div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;           !std::isnan(message.twist.twist.angular.z) &amp;&amp; !std::isinf(message.twist.twist.angular.z);</div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a4b00cc26b36b9039f120eecf7a7d4ab1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b00cc26b36b9039f120eecf7a7d4ab1">&#9670;&nbsp;</a></span>baseLinkOutputFrameId_</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::baseLinkOutputFrameId_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>tf frame name for the robot's body frame </p>
<p>When the final state is computed, we "override" the output transform and message to have this frame for its child_frame_id. This helps to enable disconnected TF trees when multiple EKF instances are being run. </p>

<p class="definition">Definition at line <a class="el" href="../../db/d3c/ros__filter_8h_source.html#l00516">516</a> of file <a class="el" href="../../db/d3c/ros__filter_8h_source.html">ros_filter.h</a>.</p>

</div>
</div>
<a id="adb32c6e37c800af6a02158c071f85d92"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb32c6e37c800af6a02158c071f85d92">&#9670;&nbsp;</a></span>disabledAtStartup_</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::disabledAtStartup_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Start the Filter disabled at startup. </p>
<p>If this is true, the filter reads parameters and prepares publishers and subscribes but does not integrate new messages into the state vector. The filter can be enabled later using a service. </p>

<p class="definition">Definition at line <a class="el" href="../../db/d3c/ros__filter_8h_source.html#l00430">430</a> of file <a class="el" href="../../db/d3c/ros__filter_8h_source.html">ros_filter.h</a>.</p>

</div>
</div>
<a id="a7b48b5bb099cf8c0bd283b6fd5661424"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b48b5bb099cf8c0bd283b6fd5661424">&#9670;&nbsp;</a></span>dynamicDiagnostics_</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;std::string, std::string&gt; <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::dynamicDiagnostics_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This object accumulates dynamic diagnostics, e.g., diagnostics relating to sensor data. </p>
<p>The values are considered transient and are cleared at every iteration. </p>

<p class="definition">Definition at line <a class="el" href="../../db/d3c/ros__filter_8h_source.html#l00547">547</a> of file <a class="el" href="../../db/d3c/ros__filter_8h_source.html">ros_filter.h</a>.</p>

</div>
</div>
<a id="a84b03bc70e9979c28deb044c545ba287"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a84b03bc70e9979c28deb044c545ba287">&#9670;&nbsp;</a></span>historyLength_</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::historyLength_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The depth of the history we track for smoothing/delayed measurement processing. </p>
<p>This is the guaranteed minimum buffer size for which previous states and measurements are kept. </p>

<p class="definition">Definition at line <a class="el" href="../../db/d3c/ros__filter_8h_source.html#l00498">498</a> of file <a class="el" href="../../db/d3c/ros__filter_8h_source.html">ros_filter.h</a>.</p>

</div>
</div>
<a id="a706c4ea2aad03711195e856dbd2e6796"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a706c4ea2aad03711195e856dbd2e6796">&#9670;&nbsp;</a></span>initialMeasurements_</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;std::string, tf2::Transform&gt; <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::initialMeasurements_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Stores the first measurement from each topic for relative measurements. </p>
<p>When a given sensor is being integrated in relative mode, its first measurement is effectively treated as an offset, and future measurements have this first measurement removed before they are fused. This variable stores the initial measurements. Note that this is different from using differential mode, as in differential mode, pose data is converted to twist data, resulting in boundless error growth for the variables being fused. With relative measurements, the vehicle will start with a 0 heading and position, but the measurements are still fused absolutely. </p>

<p class="definition">Definition at line <a class="el" href="../../db/d3c/ros__filter_8h_source.html#l00559">559</a> of file <a class="el" href="../../db/d3c/ros__filter_8h_source.html">ros_filter.h</a>.</p>

</div>
</div>
<a id="a473c0f797fcd9677b1005637ee159ae4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a473c0f797fcd9677b1005637ee159ae4">&#9670;&nbsp;</a></span>lastMessageTimes_</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;std::string, ros::Time&gt; <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::lastMessageTimes_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Store the last time a message from each topic was received. </p>
<p>If we're getting messages rapidly, we may accidentally get an older message arriving after a newer one. This variable keeps track of the most recent message time for each subscribed message topic. We also use it when listening to odometry messages to determine if we should be using messages from that topic. </p>

<p class="definition">Definition at line <a class="el" href="../../db/d3c/ros__filter_8h_source.html#l00569">569</a> of file <a class="el" href="../../db/d3c/ros__filter_8h_source.html">ros_filter.h</a>.</p>

</div>
</div>
<a id="aa9df5f56cfb6d02a4bc22c8b68ad115f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa9df5f56cfb6d02a4bc22c8b68ad115f">&#9670;&nbsp;</a></span>lastSetPoseTime_</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">ros::Time <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::lastSetPoseTime_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Store the last time set pose message was received. </p>
<p>If we receive a setPose message to reset the filter, we can get in strange situations wherein we process the pose reset, but then even after another spin cycle or two, we can get a new message with a time stamp that is <em>older</em> than the setPose message's time stamp. This means we have to check the message's time stamp against the lastSetPoseTime_. </p>

<p class="definition">Definition at line <a class="el" href="../../db/d3c/ros__filter_8h_source.html#l00619">619</a> of file <a class="el" href="../../db/d3c/ros__filter_8h_source.html">ros_filter.h</a>.</p>

</div>
</div>
<a id="a368ffffbd5a044c29342add42d1971a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a368ffffbd5a044c29342add42d1971a9">&#9670;&nbsp;</a></span>previousMeasurements_</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;std::string, tf2::Transform&gt; <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::previousMeasurements_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Stores the last measurement from a given topic for differential integration. </p>
<p>To carry out differential integration, we have to (1) transform that into the target frame (probably the frame specified by <code>odomFrameId_</code>), (2) "subtract" the previous measurement from the current measurement, and then (3) transform it again by the previous state estimate. This holds the measurements used for step (2). </p>

<p class="definition">Definition at line <a class="el" href="../../db/d3c/ros__filter_8h_source.html#l00583">583</a> of file <a class="el" href="../../db/d3c/ros__filter_8h_source.html">ros_filter.h</a>.</p>

</div>
</div>
<a id="a16ad0452b5b52e64a93736d25cfeba95"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a16ad0452b5b52e64a93736d25cfeba95">&#9670;&nbsp;</a></span>resetOnTimeJump_</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::resetOnTimeJump_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Whether to reset the filters when backwards jump in time is detected. </p>
<p>This is usually the case when logs are being used and a jump in the logi is done or if a log files restarts from the beginning. </p>

<p class="definition">Definition at line <a class="el" href="../../db/d3c/ros__filter_8h_source.html#l00457">457</a> of file <a class="el" href="../../db/d3c/ros__filter_8h_source.html">ros_filter.h</a>.</p>

</div>
</div>
<a id="a5df01bed8ccaf9deaadd869518c60310"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5df01bed8ccaf9deaadd869518c60310">&#9670;&nbsp;</a></span>staticDiagnostics_</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;std::string, std::string&gt; <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::staticDiagnostics_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This object accumulates static diagnostics, e.g., diagnostics relating to the configuration parameters. </p>
<p>The values are treated as static and always reported (i.e., this object is never cleared) </p>

<p class="definition">Definition at line <a class="el" href="../../db/d3c/ros__filter_8h_source.html#l00594">594</a> of file <a class="el" href="../../db/d3c/ros__filter_8h_source.html">ros_filter.h</a>.</p>

</div>
</div>
<a id="ad06dbf8f35a49fc76daf1c16fdecd34d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad06dbf8f35a49fc76daf1c16fdecd34d">&#9670;&nbsp;</a></span>twoDMode_</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::twoDMode_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Whether or not we're in 2D mode. </p>
<p>If this is true, the filter binds all 3D variables (Z, roll, pitch, and their respective velocities) to 0 for every measurement. </p>

<p class="definition">Definition at line <a class="el" href="../../db/d3c/ros__filter_8h_source.html#l00472">472</a> of file <a class="el" href="../../db/d3c/ros__filter_8h_source.html">ros_filter.h</a>.</p>

</div>
</div>
<a id="aefbc737fbacf16090e2f17d87de9b186"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aefbc737fbacf16090e2f17d87de9b186">&#9670;&nbsp;</a></span>worldBaseLinkTransMsg_</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">geometry_msgs::TransformStamped <a class="el" href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html">RobotLocalization::RosFilter</a>&lt; T &gt;::worldBaseLinkTransMsg_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Message that contains our latest transform (i.e., state) </p>
<p>We use the vehicle's latest state in a number of places, and often use it as a transform, so this is the most convenient variable to use as our global "current state" object </p>

<p class="definition">Definition at line <a class="el" href="../../db/d3c/ros__filter_8h_source.html#l00606">606</a> of file <a class="el" href="../../db/d3c/ros__filter_8h_source.html">ros_filter.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>mapping/robot_localization/include/robot_localization/<a class="el" href="../../db/d3c/ros__filter_8h_source.html">ros_filter.h</a></li>
<li>mapping/robot_localization/src/<a class="el" href="../../d3/d7c/ros__filter_8cpp_source.html">ros_filter.cpp</a></li>
</ul>
</div><!-- contents -->
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a0372ebd630b868624f2dd931e6b28b7f"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a0372ebd630b868624f2dd931e6b28b7f">RobotLocalization::RosFilter::publishTransform_</a></div><div class="ttdeci">bool publishTransform_</div><div class="ttdoc">Whether we publish the transform from the world_frame to the base_link_frame.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00450">ros_filter.h:450</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_adb32c6e37c800af6a02158c071f85d92"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#adb32c6e37c800af6a02158c071f85d92">RobotLocalization::RosFilter::disabledAtStartup_</a></div><div class="ttdeci">bool disabledAtStartup_</div><div class="ttdoc">Start the Filter disabled at startup.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00430">ros_filter.h:430</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a01c500083730b2030e947e21d630e43b"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a01c500083730b2030e947e21d630e43b">RobotLocalization::RosFilter::prepareTwist</a></div><div class="ttdeci">bool prepareTwist(const geometry_msgs::TwistWithCovarianceStamped::ConstPtr &amp;msg, const std::string &amp;topicName, const std::string &amp;targetFrame, std::vector&lt; int &gt; &amp;updateVector, Eigen::VectorXd &amp;measurement, Eigen::MatrixXd &amp;measurementCovariance)</div><div class="ttdoc">Prepares a twist message for integration into the filter.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d7c/ros__filter_8cpp_source.html#l02922">ros_filter.cpp:2922</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a98514257c62d3bcb14ec1e8446e0c0a3"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a98514257c62d3bcb14ec1e8446e0c0a3">RobotLocalization::RosFilter::maxFrequency_</a></div><div class="ttdeci">double maxFrequency_</div><div class="ttdoc">maximal frequency</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00505">ros_filter.h:505</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a38800f148299b693366730b3488812b0"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a38800f148299b693366730b3488812b0">RobotLocalization::RosFilter::previousMeasurementCovariances_</a></div><div class="ttdeci">std::map&lt; std::string, Eigen::MatrixXd &gt; previousMeasurementCovariances_</div><div class="ttdoc">We also need the previous covariance matrix for differential data.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00573">ros_filter.h:573</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_aeb7a3b61549bad2cc4e84d803c038c5f"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aeb7a3b61549bad2cc4e84d803c038c5f">RobotLocalization::RosFilter::measurementHistory_</a></div><div class="ttdeci">MeasurementHistoryDeque measurementHistory_</div><div class="ttdoc">A deque of previous measurements which is implicitly ordered from earliest to latest measurement.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00652">ros_filter.h:652</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a26a3d07bd073104fd3a2ee004ba88581"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a26a3d07bd073104fd3a2ee004ba88581">RobotLocalization::RosFilter::gravitationalAcc_</a></div><div class="ttdeci">double gravitationalAcc_</div><div class="ttdoc">What is the acceleration in Z due to gravity (m/s^2)? Default is +9.80665.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00492">ros_filter.h:492</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_ae88f4c45d5209d03d53fc6a4d1bb93ab"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ae88f4c45d5209d03d53fc6a4d1bb93ab">RobotLocalization::RosFilter::diagnosticUpdater_</a></div><div class="ttdeci">diagnostic_updater::Updater diagnosticUpdater_</div><div class="ttdoc">Used for updating the diagnostics.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00700">ros_filter.h:700</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a84b03bc70e9979c28deb044c545ba287"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a84b03bc70e9979c28deb044c545ba287">RobotLocalization::RosFilter::historyLength_</a></div><div class="ttdeci">double historyLength_</div><div class="ttdoc">The depth of the history we track for smoothing/delayed measurement processing.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00498">ros_filter.h:498</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a16ad0452b5b52e64a93736d25cfeba95"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a16ad0452b5b52e64a93736d25cfeba95">RobotLocalization::RosFilter::resetOnTimeJump_</a></div><div class="ttdeci">bool resetOnTimeJump_</div><div class="ttdoc">Whether to reset the filters when backwards jump in time is detected.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00457">ros_filter.h:457</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_add0c677e8eb87145755b5cd18718a45a"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#add0c677e8eb87145755b5cd18718a45a">RobotLocalization::RosFilter::predictToCurrentTime_</a></div><div class="ttdeci">bool predictToCurrentTime_</div><div class="ttdoc">By default, the filter predicts and corrects up to the time of the latest measurement....</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00438">ros_filter.h:438</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a6c0cfc2c5d47061bf2ae272b7532b51b"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6c0cfc2c5d47061bf2ae272b7532b51b">RobotLocalization::RosFilter::baseLinkFrameId_</a></div><div class="ttdeci">std::string baseLinkFrameId_</div><div class="ttdoc">tf frame name for the robot's body frame</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00509">ros_filter.h:509</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_aacaed6dea7d7bd1dc1d03eeddf002c29"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aacaed6dea7d7bd1dc1d03eeddf002c29">RobotLocalization::RosFilter::tfBuffer_</a></div><div class="ttdeci">tf2_ros::Buffer tfBuffer_</div><div class="ttdoc">Transform buffer for managing coordinate transforms.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00704">ros_filter.h:704</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a011b39dad94b84b7856f993518e4ae00"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a011b39dad94b84b7856f993518e4ae00">RobotLocalization::RosFilter::reset</a></div><div class="ttdeci">void reset()</div><div class="ttdoc">Resets the filter to its initial state.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d7c/ros__filter_8cpp_source.html#l00153">ros_filter.cpp:153</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a2538569c164be4b396576252e69732bb"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a2538569c164be4b396576252e69732bb">RobotLocalization::RosFilter::preparePose</a></div><div class="ttdeci">bool preparePose(const geometry_msgs::PoseWithCovarianceStamped::ConstPtr &amp;msg, const std::string &amp;topicName, const std::string &amp;targetFrame, const bool differential, const bool relative, const bool imuData, std::vector&lt; int &gt; &amp;updateVector, Eigen::VectorXd &amp;measurement, Eigen::MatrixXd &amp;measurementCovariance)</div><div class="ttdoc">Prepares a pose message for integration into the filter.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d7c/ros__filter_8cpp_source.html#l02529">ros_filter.cpp:2529</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a394f86657e02d8c445ce2eaba71153a3"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a394f86657e02d8c445ce2eaba71153a3">RobotLocalization::RosFilter::stateVariableNames_</a></div><div class="ttdeci">std::vector&lt; std::string &gt; stateVariableNames_</div><div class="ttdoc">Contains the state vector variable names in string format.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00536">ros_filter.h:536</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a714e2c0386cfa1ec147c52f897852532"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a714e2c0386cfa1ec147c52f897852532">RobotLocalization::RosFilter::useControl_</a></div><div class="ttdeci">bool useControl_</div><div class="ttdoc">Whether or not we use a control term.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00476">ros_filter.h:476</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_ab6a90f7afc20e69a148d84e4e41330f3"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ab6a90f7afc20e69a148d84e4e41330f3">RobotLocalization::RosFilter::tfTimeOffset_</a></div><div class="ttdeci">ros::Duration tfTimeOffset_</div><div class="ttdoc">For future (or past) dating the world_frame-&gt;base_link_frame transform.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00627">ros_filter.h:627</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a233bcdab40b3b0d7db316ffd0c09f2ce"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a233bcdab40b3b0d7db316ffd0c09f2ce">RobotLocalization::RosFilter::measurementQueue_</a></div><div class="ttdeci">MeasurementQueue measurementQueue_</div><div class="ttdoc">We process measurements by queueing them up in callbacks and processing them all at once within each ...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00658">ros_filter.h:658</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a5c57fe5f94f02e033ac78939966ad366"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5c57fe5f94f02e033ac78939966ad366">RobotLocalization::RosFilter::tfTimeout_</a></div><div class="ttdeci">ros::Duration tfTimeout_</div><div class="ttdoc">Parameter that specifies the how long we wait for a transform to become available.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00631">ros_filter.h:631</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_ad15b5063af8ae3b48cd44dfae17eaf9e"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ad15b5063af8ae3b48cd44dfae17eaf9e">RobotLocalization::RosFilter::frequency_</a></div><div class="ttdeci">double frequency_</div><div class="ttdoc">The frequency of the run loop.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00488">ros_filter.h:488</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a54e73dcf610e672435582a72dfae57eb"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a54e73dcf610e672435582a72dfae57eb">RobotLocalization::RosFilter::poseCallback</a></div><div class="ttdeci">void poseCallback(const geometry_msgs::PoseWithCovarianceStamped::ConstPtr &amp;msg, const CallbackData &amp;callbackData, const std::string &amp;targetFrame, const bool imuData)</div><div class="ttdoc">Callback method for receiving all pose messages.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d7c/ros__filter_8cpp_source.html#l01749">ros_filter.cpp:1749</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a8ea96b4c2cca39358e3c6e90cfe315bd"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8ea96b4c2cca39358e3c6e90cfe315bd">RobotLocalization::RosFilter::revertTo</a></div><div class="ttdeci">bool revertTo(const double time)</div><div class="ttdoc">Finds the latest filter state before the given timestamp and makes it the current state again.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d7c/ros__filter_8cpp_source.html#l03086">ros_filter.cpp:3086</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_ae5643fce575cd46f5cd77becf29d04ad"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ae5643fce575cd46f5cd77becf29d04ad">RobotLocalization::RosFilter::accelerationCallback</a></div><div class="ttdeci">void accelerationCallback(const sensor_msgs::Imu::ConstPtr &amp;msg, const CallbackData &amp;callbackData, const std::string &amp;targetFrame)</div><div class="ttdoc">Callback method for receiving all acceleration (IMU) messages.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d7c/ros__filter_8cpp_source.html#l00202">ros_filter.cpp:202</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a28aacc455afa26b8d02fed733473577b"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a28aacc455afa26b8d02fed733473577b">RobotLocalization::RosFilter::publishAcceleration_</a></div><div class="ttdeci">bool publishAcceleration_</div><div class="ttdoc">Whether we publish the acceleration.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00446">ros_filter.h:446</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_afe66e5331dcd54686c7cf039ce856f71"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#afe66e5331dcd54686c7cf039ce856f71">RobotLocalization::RosFilter::staticDiagErrorLevel_</a></div><div class="ttdeci">int staticDiagErrorLevel_</div><div class="ttdoc">The max (worst) static diagnostic level.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00484">ros_filter.h:484</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a5df01bed8ccaf9deaadd869518c60310"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5df01bed8ccaf9deaadd869518c60310">RobotLocalization::RosFilter::staticDiagnostics_</a></div><div class="ttdeci">std::map&lt; std::string, std::string &gt; staticDiagnostics_</div><div class="ttdoc">This object accumulates static diagnostics, e.g., diagnostics relating to the configuration parameter...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00594">ros_filter.h:594</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a5da2ab5cea26ee0545447a7643523d1b"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5da2ab5cea26ee0545447a7643523d1b">RobotLocalization::RosFilter::enabled_</a></div><div class="ttdeci">bool enabled_</div><div class="ttdoc">Whether the filter is enabled or not. See disabledAtStartup_.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00433">ros_filter.h:433</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a37a9eb3abb974e2079e34843dbd69af3"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a37a9eb3abb974e2079e34843dbd69af3">RobotLocalization::RosFilter::filterStateHistory_</a></div><div class="ttdeci">FilterStateHistoryDeque filterStateHistory_</div><div class="ttdoc">An implicitly time ordered queue of past filter states used for smoothing.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00646">ros_filter.h:646</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a1c36b4e9478bf44a96f74687cc882c6b"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a1c36b4e9478bf44a96f74687cc882c6b">RobotLocalization::RosFilter::topicSubs_</a></div><div class="ttdeci">std::vector&lt; ros::Subscriber &gt; topicSubs_</div><div class="ttdoc">Vector to hold our subscribers until they go out of scope.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00540">ros_filter.h:540</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a34b0ea97d422eaf92c36ed8085dea5c3"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a34b0ea97d422eaf92c36ed8085dea5c3">RobotLocalization::RosFilter::prepareAcceleration</a></div><div class="ttdeci">bool prepareAcceleration(const sensor_msgs::Imu::ConstPtr &amp;msg, const std::string &amp;topicName, const std::string &amp;targetFrame, std::vector&lt; int &gt; &amp;updateVector, Eigen::VectorXd &amp;measurement, Eigen::MatrixXd &amp;measurementCovariance)</div><div class="ttdoc">Prepares an IMU message's linear acceleration for integration into the filter.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d7c/ros__filter_8cpp_source.html#l02356">ros_filter.cpp:2356</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a0247b864a7b44e5310e7d05e69e41695"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a0247b864a7b44e5310e7d05e69e41695">RobotLocalization::RosFilter::saveFilterState</a></div><div class="ttdeci">void saveFilterState(FilterBase &amp;filter)</div><div class="ttdoc">Saves the current filter state in the queue of previous filter states.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d7c/ros__filter_8cpp_source.html#l03072">ros_filter.cpp:3072</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a8266b1436e1907c160d8c73a920e806c"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8266b1436e1907c160d8c73a920e806c">RobotLocalization::RosFilter::addDiagnostic</a></div><div class="ttdeci">void addDiagnostic(const int errLevel, const std::string &amp;topicAndClass, const std::string &amp;message, const bool staticDiag)</div><div class="ttdoc">Adds a diagnostic message to the accumulating map and updates the error level.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d7c/ros__filter_8cpp_source.html#l02172">ros_filter.cpp:2172</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_ae6ef41c43d134fb109fe8996a723bcf4"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ae6ef41c43d134fb109fe8996a723bcf4">RobotLocalization::RosFilter::odomFrameId_</a></div><div class="ttdeci">std::string odomFrameId_</div><div class="ttdoc">tf frame name for the robot's odometry (world-fixed) frame</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00524">ros_filter.h:524</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a4b00cc26b36b9039f120eecf7a7d4ab1"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a4b00cc26b36b9039f120eecf7a7d4ab1">RobotLocalization::RosFilter::baseLinkOutputFrameId_</a></div><div class="ttdeci">std::string baseLinkOutputFrameId_</div><div class="ttdoc">tf frame name for the robot's body frame</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00516">ros_filter.h:516</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_ab8779e25f3390bd1ddeba10401164a2c"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ab8779e25f3390bd1ddeba10401164a2c">RobotLocalization::RosFilter::smoothLaggedData_</a></div><div class="ttdeci">bool smoothLaggedData_</div><div class="ttdoc">Whether or not we use smoothing.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00461">ros_filter.h:461</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a8b299c262fd69e029c8fc05ff19f150e"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a8b299c262fd69e029c8fc05ff19f150e">RobotLocalization::RosFilter::copyCovariance</a></div><div class="ttdeci">void copyCovariance(const double *arr, Eigen::MatrixXd &amp;covariance, const std::string &amp;topicName, const std::vector&lt; int &gt; &amp;updateVector, const size_t offset, const size_t dimension)</div><div class="ttdoc">Utility method for copying covariances from ROS covariance arrays to Eigen matrices.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d7c/ros__filter_8cpp_source.html#l02243">ros_filter.cpp:2243</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a473c0f797fcd9677b1005637ee159ae4"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a473c0f797fcd9677b1005637ee159ae4">RobotLocalization::RosFilter::lastMessageTimes_</a></div><div class="ttdeci">std::map&lt; std::string, ros::Time &gt; lastMessageTimes_</div><div class="ttdoc">Store the last time a message from each topic was received.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00569">ros_filter.h:569</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a368ffffbd5a044c29342add42d1971a9"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a368ffffbd5a044c29342add42d1971a9">RobotLocalization::RosFilter::previousMeasurements_</a></div><div class="ttdeci">std::map&lt; std::string, tf2::Transform &gt; previousMeasurements_</div><div class="ttdoc">Stores the last measurement from a given topic for differential integration.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00583">ros_filter.h:583</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_aa9df5f56cfb6d02a4bc22c8b68ad115f"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aa9df5f56cfb6d02a4bc22c8b68ad115f">RobotLocalization::RosFilter::lastSetPoseTime_</a></div><div class="ttdeci">ros::Time lastSetPoseTime_</div><div class="ttdoc">Store the last time set pose message was received.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00619">ros_filter.h:619</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a4a89276e71a0258bbcf5686d552804fa"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a4a89276e71a0258bbcf5686d552804fa">RobotLocalization::RosFilter::controlCallback</a></div><div class="ttdeci">void controlCallback(const geometry_msgs::Twist::ConstPtr &amp;msg)</div><div class="ttdoc">Callback method for receiving non-stamped control input.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d7c/ros__filter_8cpp_source.html#l00285">ros_filter.cpp:285</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a1ff13740c9af1413442122197e565caf"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a1ff13740c9af1413442122197e565caf">RobotLocalization::RosFilter::clearMeasurementQueue</a></div><div class="ttdeci">void clearMeasurementQueue()</div><div class="ttdoc">Clears measurement queue.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d7c/ros__filter_8cpp_source.html#l03202">ros_filter.cpp:3202</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_aa42f6af65d32b9bec34c88974822fea9"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aa42f6af65d32b9bec34c88974822fea9">RobotLocalization::RosFilter::lastDiagTime_</a></div><div class="ttdeci">ros::Time lastDiagTime_</div><div class="ttdoc">last call of periodicUpdate</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00610">ros_filter.h:610</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_ad06dbf8f35a49fc76daf1c16fdecd34d"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ad06dbf8f35a49fc76daf1c16fdecd34d">RobotLocalization::RosFilter::twoDMode_</a></div><div class="ttdeci">bool twoDMode_</div><div class="ttdoc">Whether or not we're in 2D mode.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00472">ros_filter.h:472</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a5f51fcc879266f6091c5745c93bdc960"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a5f51fcc879266f6091c5745c93bdc960">RobotLocalization::RosFilter::dynamicDiagErrorLevel_</a></div><div class="ttdeci">int dynamicDiagErrorLevel_</div><div class="ttdoc">The max (worst) dynamic diagnostic level.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00480">ros_filter.h:480</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a4585957fbc3239e559eb509921f28a8f"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a4585957fbc3239e559eb509921f28a8f">RobotLocalization::RosFilter::forceTwoD</a></div><div class="ttdeci">void forceTwoD(Eigen::VectorXd &amp;measurement, Eigen::MatrixXd &amp;measurementCovariance, std::vector&lt; int &gt; &amp;updateVector)</div><div class="ttdoc">Method for zeroing out 3D variables within measurements.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d7c/ros__filter_8cpp_source.html#l00339">ros_filter.cpp:339</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_ae4a8a9f6bc2aa5358c04de11ed72a821"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ae4a8a9f6bc2aa5358c04de11ed72a821">RobotLocalization::RosFilter::setPoseCallback</a></div><div class="ttdeci">void setPoseCallback(const geometry_msgs::PoseWithCovarianceStamped::ConstPtr &amp;msg)</div><div class="ttdoc">Callback method for manually setting/resetting the internal pose estimate.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d7c/ros__filter_8cpp_source.html#l02005">ros_filter.cpp:2005</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_ac22190accdeee0fc2dcfb692e5d97038"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#ac22190accdeee0fc2dcfb692e5d97038">RobotLocalization::RosFilter::toggledOn_</a></div><div class="ttdeci">bool toggledOn_</div><div class="ttdoc">Whether the filter should process new measurements or not.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00464">ros_filter.h:464</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a27854c71e92da52d6a7c7a004efa1736"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a27854c71e92da52d6a7c7a004efa1736">RobotLocalization::RosFilter::removeGravitationalAcc_</a></div><div class="ttdeci">std::map&lt; std::string, bool &gt; removeGravitationalAcc_</div><div class="ttdoc">If including acceleration for each IMU input, whether or not we remove acceleration due to gravity.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00587">ros_filter.h:587</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a6f69cfe0fd2fea54446e4895b14c4c88"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6f69cfe0fd2fea54446e4895b14c4c88">RobotLocalization::RosFilter::enqueueMeasurement</a></div><div class="ttdeci">void enqueueMeasurement(const std::string &amp;topicName, const Eigen::VectorXd &amp;measurement, const Eigen::MatrixXd &amp;measurementCovariance, const std::vector&lt; int &gt; &amp;updateVector, const double mahalanobisThresh, const ros::Time &amp;time)</div><div class="ttdoc">Adds a measurement to the queue of measurements to be processed.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d7c/ros__filter_8cpp_source.html#l00318">ros_filter.cpp:318</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_abe50aea17d383427f39c3b3c57617f12"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#abe50aea17d383427f39c3b3c57617f12">RobotLocalization::RosFilter::nhLocal_</a></div><div class="ttdeci">ros::NodeHandle nhLocal_</div><div class="ttdoc">Local node handle (for params)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00670">ros_filter.h:670</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a7b48b5bb099cf8c0bd283b6fd5661424"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a7b48b5bb099cf8c0bd283b6fd5661424">RobotLocalization::RosFilter::dynamicDiagnostics_</a></div><div class="ttdeci">std::map&lt; std::string, std::string &gt; dynamicDiagnostics_</div><div class="ttdoc">This object accumulates dynamic diagnostics, e.g., diagnostics relating to sensor data.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00547">ros_filter.h:547</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a1941fdd54f6ac9f212dafba9330b5002"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a1941fdd54f6ac9f212dafba9330b5002">RobotLocalization::RosFilter::tfListener_</a></div><div class="ttdeci">tf2_ros::TransformListener tfListener_</div><div class="ttdoc">Transform listener for receiving transforms.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00708">ros_filter.h:708</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a39ff4db9503a7f645093b086716b4a98"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a39ff4db9503a7f645093b086716b4a98">RobotLocalization::RosFilter::RosFilter</a></div><div class="ttdeci">RosFilter(ros::NodeHandle nh, ros::NodeHandle nh_priv, std::string node_name, std::vector&lt; double &gt; args=std::vector&lt; double &gt;())</div><div class="ttdoc">Constructor.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d7c/ros__filter_8cpp_source.html#l00049">ros_filter.cpp:49</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a1dc8ec7162549a3f935159fc4df143d6"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a1dc8ec7162549a3f935159fc4df143d6">RobotLocalization::RosFilter::latestControl_</a></div><div class="ttdeci">Eigen::VectorXd latestControl_</div><div class="ttdoc">The most recent control input.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00598">ros_filter.h:598</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a2b184469b63dfe6261dea4a92b5b23a6"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a2b184469b63dfe6261dea4a92b5b23a6">RobotLocalization::RosFilter::mapFrameId_</a></div><div class="ttdeci">std::string mapFrameId_</div><div class="ttdoc">tf frame name for the robot's map (world-fixed) frame</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00520">ros_filter.h:520</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a6061a5284caef5912ec015e6caaf00a0"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a6061a5284caef5912ec015e6caaf00a0">RobotLocalization::RosFilter::filter_</a></div><div class="ttdeci">T filter_</div><div class="ttdoc">Our filter (EKF, UKF, etc.)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00662">ros_filter.h:662</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_aeec53ee745d41ed8e342c9688a4a3165"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#aeec53ee745d41ed8e342c9688a4a3165">RobotLocalization::RosFilter::twistCallback</a></div><div class="ttdeci">void twistCallback(const geometry_msgs::TwistWithCovarianceStamped::ConstPtr &amp;msg, const CallbackData &amp;callbackData, const std::string &amp;targetFrame)</div><div class="ttdoc">Callback method for receiving all twist messages.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d7c/ros__filter_8cpp_source.html#l02082">ros_filter.cpp:2082</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a91643ae3e6d532325acdc556b4b8f739"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a91643ae3e6d532325acdc556b4b8f739">RobotLocalization::RosFilter::printDiagnostics_</a></div><div class="ttdeci">bool printDiagnostics_</div><div class="ttdoc">Whether or not we print diagnostic messages to the /diagnostics topic.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00442">ros_filter.h:442</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a37c23d6c10a630fe33e74376898fc5c8"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a37c23d6c10a630fe33e74376898fc5c8">RobotLocalization::RosFilter::worldFrameId_</a></div><div class="ttdeci">std::string worldFrameId_</div><div class="ttdoc">tf frame name that is the parent frame of the transform that this node will calculate and broadcast.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00528">ros_filter.h:528</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a94ccac9ce6b71ee1a36b19a8ba33b0ac"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a94ccac9ce6b71ee1a36b19a8ba33b0ac">RobotLocalization::RosFilter::latestControlTime_</a></div><div class="ttdeci">ros::Time latestControlTime_</div><div class="ttdoc">The time of the most recent control input.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00623">ros_filter.h:623</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a861a0f9c63867697b18377805572a00a"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a861a0f9c63867697b18377805572a00a">RobotLocalization::RosFilter::minFrequency_</a></div><div class="ttdeci">double minFrequency_</div><div class="ttdoc">minimal frequency</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00502">ros_filter.h:502</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a03a0adf9f3be7b576044755a76b12b3b"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a03a0adf9f3be7b576044755a76b12b3b">RobotLocalization::RosFilter::nh_</a></div><div class="ttdeci">ros::NodeHandle nh_</div><div class="ttdoc">Node handle.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00666">ros_filter.h:666</a></div></div>
<div class="ttc" id="aclassRobotLocalization_1_1RosFilter_html_a706c4ea2aad03711195e856dbd2e6796"><div class="ttname"><a href="../../dd/d4a/classRobotLocalization_1_1RosFilter.html#a706c4ea2aad03711195e856dbd2e6796">RobotLocalization::RosFilter::initialMeasurements_</a></div><div class="ttdeci">std::map&lt; std::string, tf2::Transform &gt; initialMeasurements_</div><div class="ttdoc">Stores the first measurement from each topic for relative measurements.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/ros__filter_8h_source.html#l00559">ros_filter.h:559</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.18
</small></address>
</body>
</html>
