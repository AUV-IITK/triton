\hypertarget{classRobotLocalization_1_1RosFilter}{}\doxysection{Robot\+Localization\+::Ros\+Filter$<$ T $>$ Class Template Reference}
\label{classRobotLocalization_1_1RosFilter}\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a39ff4db9503a7f645093b086716b4a98}{Ros\+Filter}} (ros\+::\+Node\+Handle nh, ros\+::\+Node\+Handle nh\+\_\+priv, std\+::string node\+\_\+name, std\+::vector$<$ double $>$ args=std\+::vector$<$ double $>$())
\begin{DoxyCompactList}\small\item\em Constructor. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a392382adffded2b4390f2a780b81e0f4}{Ros\+Filter}} (ros\+::\+Node\+Handle nh, ros\+::\+Node\+Handle nh\+\_\+priv, std\+::vector$<$ double $>$ args=std\+::vector$<$ double $>$())
\begin{DoxyCompactList}\small\item\em Constructor. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a9d9207b728f5094c941745766b551bf1}{$\sim$\+Ros\+Filter}} ()
\begin{DoxyCompactList}\small\item\em Destructor. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a71b6967fb2331e5bc701e37337b8df66}\label{classRobotLocalization_1_1RosFilter_a71b6967fb2331e5bc701e37337b8df66}} 
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a71b6967fb2331e5bc701e37337b8df66}{initialize}} ()
\begin{DoxyCompactList}\small\item\em Initialize filter. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a011b39dad94b84b7856f993518e4ae00}\label{classRobotLocalization_1_1RosFilter_a011b39dad94b84b7856f993518e4ae00}} 
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a011b39dad94b84b7856f993518e4ae00}{reset}} ()
\begin{DoxyCompactList}\small\item\em Resets the filter to its initial state. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_afb177072d3c8ff1f4b9442ad41c2d754}{toggle\+Filter\+Processing\+Callback}} (robot\+\_\+localization\+::\+Toggle\+Filter\+Processing\+::\+Request \&, robot\+\_\+localization\+::\+Toggle\+Filter\+Processing\+::\+Response \&)
\begin{DoxyCompactList}\small\item\em Service callback to toggle processing measurements for a standby mode but continuing to publish. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ae5643fce575cd46f5cd77becf29d04ad}{acceleration\+Callback}} (const sensor\+\_\+msgs\+::\+Imu\+::\+Const\+Ptr \&msg, const \mbox{\hyperlink{structRobotLocalization_1_1CallbackData}{Callback\+Data}} \&callback\+Data, const std\+::string \&target\+Frame)
\begin{DoxyCompactList}\small\item\em Callback method for receiving all acceleration (I\+MU) messages. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a4a89276e71a0258bbcf5686d552804fa}{control\+Callback}} (const geometry\+\_\+msgs\+::\+Twist\+::\+Const\+Ptr \&msg)
\begin{DoxyCompactList}\small\item\em Callback method for receiving non-\/stamped control input. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ac5c164b66407c5b0bfd96565a858604b}{control\+Callback}} (const geometry\+\_\+msgs\+::\+Twist\+Stamped\+::\+Const\+Ptr \&msg)
\begin{DoxyCompactList}\small\item\em Callback method for receiving stamped control input. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6f69cfe0fd2fea54446e4895b14c4c88}{enqueue\+Measurement}} (const std\+::string \&topic\+Name, const Eigen\+::\+Vector\+Xd \&measurement, const Eigen\+::\+Matrix\+Xd \&measurement\+Covariance, const std\+::vector$<$ int $>$ \&update\+Vector, const double mahalanobis\+Thresh, const ros\+::\+Time \&time)
\begin{DoxyCompactList}\small\item\em Adds a measurement to the queue of measurements to be processed. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a4585957fbc3239e559eb509921f28a8f}{force\+TwoD}} (Eigen\+::\+Vector\+Xd \&measurement, Eigen\+::\+Matrix\+Xd \&measurement\+Covariance, std\+::vector$<$ int $>$ \&update\+Vector)
\begin{DoxyCompactList}\small\item\em Method for zeroing out 3D variables within measurements. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a2bfbf2f272e49f7727adbf180ba00356}{get\+Filtered\+Odometry\+Message}} (nav\+\_\+msgs\+::\+Odometry \&message)
\begin{DoxyCompactList}\small\item\em Retrieves the E\+KF\textquotesingle{}s output for broadcasting. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a62f8eabae93ec1ca823b1b4ce65faa68}{get\+Filtered\+Accel\+Message}} (geometry\+\_\+msgs\+::\+Accel\+With\+Covariance\+Stamped \&message)
\begin{DoxyCompactList}\small\item\em Retrieves the E\+KF\textquotesingle{}s acceleration output for broadcasting. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aa3a763add884bc19e741a69d0720b27e}{imu\+Callback}} (const sensor\+\_\+msgs\+::\+Imu\+::\+Const\+Ptr \&msg, const std\+::string \&topic\+Name, const \mbox{\hyperlink{structRobotLocalization_1_1CallbackData}{Callback\+Data}} \&pose\+Callback\+Data, const \mbox{\hyperlink{structRobotLocalization_1_1CallbackData}{Callback\+Data}} \&twist\+Callback\+Data, const \mbox{\hyperlink{structRobotLocalization_1_1CallbackData}{Callback\+Data}} \&accel\+Callback\+Data)
\begin{DoxyCompactList}\small\item\em Callback method for receiving all I\+MU messages. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a0408a310dcd78472013e174c4f26061b}{integrate\+Measurements}} (const ros\+::\+Time \&current\+Time)
\begin{DoxyCompactList}\small\item\em Processes all measurements in the measurement queue, in temporal order. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_ad817d2848eab32e6ee37c04939fda59d}\label{classRobotLocalization_1_1RosFilter_ad817d2848eab32e6ee37c04939fda59d}} 
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ad817d2848eab32e6ee37c04939fda59d}{load\+Params}} ()
\begin{DoxyCompactList}\small\item\em Loads all parameters from file. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aa64036d927adebecab93437b5a086748}{odometry\+Callback}} (const nav\+\_\+msgs\+::\+Odometry\+::\+Const\+Ptr \&msg, const std\+::string \&topic\+Name, const \mbox{\hyperlink{structRobotLocalization_1_1CallbackData}{Callback\+Data}} \&pose\+Callback\+Data, const \mbox{\hyperlink{structRobotLocalization_1_1CallbackData}{Callback\+Data}} \&twist\+Callback\+Data)
\begin{DoxyCompactList}\small\item\em Callback method for receiving all odometry messages. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a54e73dcf610e672435582a72dfae57eb}{pose\+Callback}} (const geometry\+\_\+msgs\+::\+Pose\+With\+Covariance\+Stamped\+::\+Const\+Ptr \&msg, const \mbox{\hyperlink{structRobotLocalization_1_1CallbackData}{Callback\+Data}} \&callback\+Data, const std\+::string \&target\+Frame, const bool imu\+Data)
\begin{DoxyCompactList}\small\item\em Callback method for receiving all pose messages. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ae4a8a9f6bc2aa5358c04de11ed72a821}{set\+Pose\+Callback}} (const geometry\+\_\+msgs\+::\+Pose\+With\+Covariance\+Stamped\+::\+Const\+Ptr \&msg)
\begin{DoxyCompactList}\small\item\em Callback method for manually setting/resetting the internal pose estimate. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ae7e52d78645c3c68279d81d0b0feda25}{set\+Pose\+Srv\+Callback}} (robot\+\_\+localization\+::\+Set\+Pose\+::\+Request \&request, robot\+\_\+localization\+::\+Set\+Pose\+::\+Response \&)
\begin{DoxyCompactList}\small\item\em Service callback for manually setting/resetting the internal pose estimate. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a83c63cecbddfda272d9905c337b4ef4d}{enable\+Filter\+Srv\+Callback}} (std\+\_\+srvs\+::\+Empty\+::\+Request \&, std\+\_\+srvs\+::\+Empty\+::\+Response \&)
\begin{DoxyCompactList}\small\item\em Service callback for manually enable the filter. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aeec53ee745d41ed8e342c9688a4a3165}{twist\+Callback}} (const geometry\+\_\+msgs\+::\+Twist\+With\+Covariance\+Stamped\+::\+Const\+Ptr \&msg, const \mbox{\hyperlink{structRobotLocalization_1_1CallbackData}{Callback\+Data}} \&callback\+Data, const std\+::string \&target\+Frame)
\begin{DoxyCompactList}\small\item\em Callback method for receiving all twist messages. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a3de307ae35c1f4d6df8d3e19ec06d3e8}{validate\+Filter\+Output}} (const nav\+\_\+msgs\+::\+Odometry \&message)
\begin{DoxyCompactList}\small\item\em Validates filter outputs for Na\+Ns and Infinite values. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a8ea96b4c2cca39358e3c6e90cfe315bd}{revert\+To}} (const double time)
\begin{DoxyCompactList}\small\item\em Finds the latest filter state before the given timestamp and makes it the current state again. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a0247b864a7b44e5310e7d05e69e41695}{save\+Filter\+State}} (\mbox{\hyperlink{classRobotLocalization_1_1FilterBase}{Filter\+Base}} \&filter)
\begin{DoxyCompactList}\small\item\em Saves the current filter state in the queue of previous filter states. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ae0e25abbb388e990c2062b6029329131}{clear\+Expired\+History}} (const double cutoff\+Time)
\begin{DoxyCompactList}\small\item\em Removes measurements and filter states older than the given cutoff time. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a1ff13740c9af1413442122197e565caf}\label{classRobotLocalization_1_1RosFilter_a1ff13740c9af1413442122197e565caf}} 
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a1ff13740c9af1413442122197e565caf}{clear\+Measurement\+Queue}} ()
\begin{DoxyCompactList}\small\item\em Clears measurement queue. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a8266b1436e1907c160d8c73a920e806c}{add\+Diagnostic}} (const int err\+Level, const std\+::string \&topic\+And\+Class, const std\+::string \&message, const bool static\+Diag)
\begin{DoxyCompactList}\small\item\em Adds a diagnostic message to the accumulating map and updates the error level. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6217442419d2808d43eb8c613403b04b}{aggregate\+Diagnostics}} (diagnostic\+\_\+updater\+::\+Diagnostic\+Status\+Wrapper \&wrapper)
\begin{DoxyCompactList}\small\item\em Aggregates all diagnostics so they can be published. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a8b299c262fd69e029c8fc05ff19f150e}{copy\+Covariance}} (const double $\ast$arr, Eigen\+::\+Matrix\+Xd \&covariance, const std\+::string \&topic\+Name, const std\+::vector$<$ int $>$ \&update\+Vector, const size\+\_\+t offset, const size\+\_\+t dimension)
\begin{DoxyCompactList}\small\item\em Utility method for copying covariances from R\+OS covariance arrays to Eigen matrices. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a54eb6cf70f939ed188fa051c0dc50c97}{copy\+Covariance}} (const Eigen\+::\+Matrix\+Xd \&covariance, double $\ast$arr, const size\+\_\+t dimension)
\begin{DoxyCompactList}\small\item\em Utility method for copying covariances from Eigen matrices to R\+OS covariance arrays. \end{DoxyCompactList}\item 
std\+::vector$<$ int $>$ \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a2b54251a0ae492ddf7bbb4112a915968}{load\+Update\+Config}} (const std\+::string \&topic\+Name)
\begin{DoxyCompactList}\small\item\em Loads fusion settings from the config file. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a34b0ea97d422eaf92c36ed8085dea5c3}{prepare\+Acceleration}} (const sensor\+\_\+msgs\+::\+Imu\+::\+Const\+Ptr \&msg, const std\+::string \&topic\+Name, const std\+::string \&target\+Frame, std\+::vector$<$ int $>$ \&update\+Vector, Eigen\+::\+Vector\+Xd \&measurement, Eigen\+::\+Matrix\+Xd \&measurement\+Covariance)
\begin{DoxyCompactList}\small\item\em Prepares an I\+MU message\textquotesingle{}s linear acceleration for integration into the filter. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a2538569c164be4b396576252e69732bb}{prepare\+Pose}} (const geometry\+\_\+msgs\+::\+Pose\+With\+Covariance\+Stamped\+::\+Const\+Ptr \&msg, const std\+::string \&topic\+Name, const std\+::string \&target\+Frame, const bool differential, const bool relative, const bool imu\+Data, std\+::vector$<$ int $>$ \&update\+Vector, Eigen\+::\+Vector\+Xd \&measurement, Eigen\+::\+Matrix\+Xd \&measurement\+Covariance)
\begin{DoxyCompactList}\small\item\em Prepares a pose message for integration into the filter. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a01c500083730b2030e947e21d630e43b}{prepare\+Twist}} (const geometry\+\_\+msgs\+::\+Twist\+With\+Covariance\+Stamped\+::\+Const\+Ptr \&msg, const std\+::string \&topic\+Name, const std\+::string \&target\+Frame, std\+::vector$<$ int $>$ \&update\+Vector, Eigen\+::\+Vector\+Xd \&measurement, Eigen\+::\+Matrix\+Xd \&measurement\+Covariance)
\begin{DoxyCompactList}\small\item\em Prepares a twist message for integration into the filter. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a258d93003041a34e8dc72f8004caed1c}\label{classRobotLocalization_1_1RosFilter_a258d93003041a34e8dc72f8004caed1c}} 
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a258d93003041a34e8dc72f8004caed1c}{periodic\+Update}} (const ros\+::\+Timer\+Event \&event)
\begin{DoxyCompactList}\small\item\em callback function which is called for periodic updates \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_adb32c6e37c800af6a02158c071f85d92}{disabled\+At\+Startup\+\_\+}}
\begin{DoxyCompactList}\small\item\em Start the Filter disabled at startup. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a5da2ab5cea26ee0545447a7643523d1b}\label{classRobotLocalization_1_1RosFilter_a5da2ab5cea26ee0545447a7643523d1b}} 
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a5da2ab5cea26ee0545447a7643523d1b}{enabled\+\_\+}}
\begin{DoxyCompactList}\small\item\em Whether the filter is enabled or not. See disabled\+At\+Startup\+\_\+. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_add0c677e8eb87145755b5cd18718a45a}\label{classRobotLocalization_1_1RosFilter_add0c677e8eb87145755b5cd18718a45a}} 
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_add0c677e8eb87145755b5cd18718a45a}{predict\+To\+Current\+Time\+\_\+}}
\begin{DoxyCompactList}\small\item\em By default, the filter predicts and corrects up to the time of the latest measurement. If this is set to true, the filter does the same, but then also predicts up to the current time step. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a91643ae3e6d532325acdc556b4b8f739}\label{classRobotLocalization_1_1RosFilter_a91643ae3e6d532325acdc556b4b8f739}} 
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a91643ae3e6d532325acdc556b4b8f739}{print\+Diagnostics\+\_\+}}
\begin{DoxyCompactList}\small\item\em Whether or not we print diagnostic messages to the /diagnostics topic. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a28aacc455afa26b8d02fed733473577b}\label{classRobotLocalization_1_1RosFilter_a28aacc455afa26b8d02fed733473577b}} 
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a28aacc455afa26b8d02fed733473577b}{publish\+Acceleration\+\_\+}}
\begin{DoxyCompactList}\small\item\em Whether we publish the acceleration. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a0372ebd630b868624f2dd931e6b28b7f}\label{classRobotLocalization_1_1RosFilter_a0372ebd630b868624f2dd931e6b28b7f}} 
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a0372ebd630b868624f2dd931e6b28b7f}{publish\+Transform\+\_\+}}
\begin{DoxyCompactList}\small\item\em Whether we publish the transform from the world\+\_\+frame to the base\+\_\+link\+\_\+frame. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a16ad0452b5b52e64a93736d25cfeba95}{reset\+On\+Time\+Jump\+\_\+}}
\begin{DoxyCompactList}\small\item\em Whether to reset the filters when backwards jump in time is detected. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_ab8779e25f3390bd1ddeba10401164a2c}\label{classRobotLocalization_1_1RosFilter_ab8779e25f3390bd1ddeba10401164a2c}} 
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ab8779e25f3390bd1ddeba10401164a2c}{smooth\+Lagged\+Data\+\_\+}}
\begin{DoxyCompactList}\small\item\em Whether or not we use smoothing. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_ac22190accdeee0fc2dcfb692e5d97038}\label{classRobotLocalization_1_1RosFilter_ac22190accdeee0fc2dcfb692e5d97038}} 
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ac22190accdeee0fc2dcfb692e5d97038}{toggled\+On\+\_\+}}
\begin{DoxyCompactList}\small\item\em Whether the filter should process new measurements or not. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ad06dbf8f35a49fc76daf1c16fdecd34d}{two\+D\+Mode\+\_\+}}
\begin{DoxyCompactList}\small\item\em Whether or not we\textquotesingle{}re in 2D mode. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a714e2c0386cfa1ec147c52f897852532}\label{classRobotLocalization_1_1RosFilter_a714e2c0386cfa1ec147c52f897852532}} 
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a714e2c0386cfa1ec147c52f897852532}{use\+Control\+\_\+}}
\begin{DoxyCompactList}\small\item\em Whether or not we use a control term. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a5f51fcc879266f6091c5745c93bdc960}\label{classRobotLocalization_1_1RosFilter_a5f51fcc879266f6091c5745c93bdc960}} 
int \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a5f51fcc879266f6091c5745c93bdc960}{dynamic\+Diag\+Error\+Level\+\_\+}}
\begin{DoxyCompactList}\small\item\em The max (worst) dynamic diagnostic level. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_afe66e5331dcd54686c7cf039ce856f71}\label{classRobotLocalization_1_1RosFilter_afe66e5331dcd54686c7cf039ce856f71}} 
int \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_afe66e5331dcd54686c7cf039ce856f71}{static\+Diag\+Error\+Level\+\_\+}}
\begin{DoxyCompactList}\small\item\em The max (worst) static diagnostic level. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_ad15b5063af8ae3b48cd44dfae17eaf9e}\label{classRobotLocalization_1_1RosFilter_ad15b5063af8ae3b48cd44dfae17eaf9e}} 
double \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ad15b5063af8ae3b48cd44dfae17eaf9e}{frequency\+\_\+}}
\begin{DoxyCompactList}\small\item\em The frequency of the run loop. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a26a3d07bd073104fd3a2ee004ba88581}\label{classRobotLocalization_1_1RosFilter_a26a3d07bd073104fd3a2ee004ba88581}} 
double \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a26a3d07bd073104fd3a2ee004ba88581}{gravitational\+Acc\+\_\+}}
\begin{DoxyCompactList}\small\item\em What is the acceleration in Z due to gravity (m/s$^\wedge$2)? Default is +9.\+80665. \end{DoxyCompactList}\item 
double \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a84b03bc70e9979c28deb044c545ba287}{history\+Length\+\_\+}}
\begin{DoxyCompactList}\small\item\em The depth of the history we track for smoothing/delayed measurement processing. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a861a0f9c63867697b18377805572a00a}\label{classRobotLocalization_1_1RosFilter_a861a0f9c63867697b18377805572a00a}} 
double \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a861a0f9c63867697b18377805572a00a}{min\+Frequency\+\_\+}}
\begin{DoxyCompactList}\small\item\em minimal frequency \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a98514257c62d3bcb14ec1e8446e0c0a3}\label{classRobotLocalization_1_1RosFilter_a98514257c62d3bcb14ec1e8446e0c0a3}} 
double \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a98514257c62d3bcb14ec1e8446e0c0a3}{max\+Frequency\+\_\+}}
\begin{DoxyCompactList}\small\item\em maximal frequency \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a6c0cfc2c5d47061bf2ae272b7532b51b}\label{classRobotLocalization_1_1RosFilter_a6c0cfc2c5d47061bf2ae272b7532b51b}} 
std\+::string \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6c0cfc2c5d47061bf2ae272b7532b51b}{base\+Link\+Frame\+Id\+\_\+}}
\begin{DoxyCompactList}\small\item\em tf frame name for the robot\textquotesingle{}s body frame \end{DoxyCompactList}\item 
std\+::string \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a4b00cc26b36b9039f120eecf7a7d4ab1}{base\+Link\+Output\+Frame\+Id\+\_\+}}
\begin{DoxyCompactList}\small\item\em tf frame name for the robot\textquotesingle{}s body frame \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a2b184469b63dfe6261dea4a92b5b23a6}\label{classRobotLocalization_1_1RosFilter_a2b184469b63dfe6261dea4a92b5b23a6}} 
std\+::string \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a2b184469b63dfe6261dea4a92b5b23a6}{map\+Frame\+Id\+\_\+}}
\begin{DoxyCompactList}\small\item\em tf frame name for the robot\textquotesingle{}s map (world-\/fixed) frame \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_ae6ef41c43d134fb109fe8996a723bcf4}\label{classRobotLocalization_1_1RosFilter_ae6ef41c43d134fb109fe8996a723bcf4}} 
std\+::string \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ae6ef41c43d134fb109fe8996a723bcf4}{odom\+Frame\+Id\+\_\+}}
\begin{DoxyCompactList}\small\item\em tf frame name for the robot\textquotesingle{}s odometry (world-\/fixed) frame \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a37c23d6c10a630fe33e74376898fc5c8}\label{classRobotLocalization_1_1RosFilter_a37c23d6c10a630fe33e74376898fc5c8}} 
std\+::string \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a37c23d6c10a630fe33e74376898fc5c8}{world\+Frame\+Id\+\_\+}}
\begin{DoxyCompactList}\small\item\em tf frame name that is the parent frame of the transform that this node will calculate and broadcast. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_aa618bc022956c37dbfd62c8eeb5eb454}\label{classRobotLocalization_1_1RosFilter_aa618bc022956c37dbfd62c8eeb5eb454}} 
std\+::ofstream \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aa618bc022956c37dbfd62c8eeb5eb454}{debug\+Stream\+\_\+}}
\begin{DoxyCompactList}\small\item\em Used for outputting debug messages. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a394f86657e02d8c445ce2eaba71153a3}\label{classRobotLocalization_1_1RosFilter_a394f86657e02d8c445ce2eaba71153a3}} 
std\+::vector$<$ std\+::string $>$ \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a394f86657e02d8c445ce2eaba71153a3}{state\+Variable\+Names\+\_\+}}
\begin{DoxyCompactList}\small\item\em Contains the state vector variable names in string format. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a1c36b4e9478bf44a96f74687cc882c6b}\label{classRobotLocalization_1_1RosFilter_a1c36b4e9478bf44a96f74687cc882c6b}} 
std\+::vector$<$ ros\+::\+Subscriber $>$ \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a1c36b4e9478bf44a96f74687cc882c6b}{topic\+Subs\+\_\+}}
\begin{DoxyCompactList}\small\item\em Vector to hold our subscribers until they go out of scope. \end{DoxyCompactList}\item 
std\+::map$<$ std\+::string, std\+::string $>$ \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a7b48b5bb099cf8c0bd283b6fd5661424}{dynamic\+Diagnostics\+\_\+}}
\begin{DoxyCompactList}\small\item\em This object accumulates dynamic diagnostics, e.\+g., diagnostics relating to sensor data. \end{DoxyCompactList}\item 
std\+::map$<$ std\+::string, tf2\+::\+Transform $>$ \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a706c4ea2aad03711195e856dbd2e6796}{initial\+Measurements\+\_\+}}
\begin{DoxyCompactList}\small\item\em Stores the first measurement from each topic for relative measurements. \end{DoxyCompactList}\item 
std\+::map$<$ std\+::string, ros\+::\+Time $>$ \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a473c0f797fcd9677b1005637ee159ae4}{last\+Message\+Times\+\_\+}}
\begin{DoxyCompactList}\small\item\em Store the last time a message from each topic was received. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a38800f148299b693366730b3488812b0}\label{classRobotLocalization_1_1RosFilter_a38800f148299b693366730b3488812b0}} 
std\+::map$<$ std\+::string, Eigen\+::\+Matrix\+Xd $>$ \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a38800f148299b693366730b3488812b0}{previous\+Measurement\+Covariances\+\_\+}}
\begin{DoxyCompactList}\small\item\em We also need the previous covariance matrix for differential data. \end{DoxyCompactList}\item 
std\+::map$<$ std\+::string, tf2\+::\+Transform $>$ \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a368ffffbd5a044c29342add42d1971a9}{previous\+Measurements\+\_\+}}
\begin{DoxyCompactList}\small\item\em Stores the last measurement from a given topic for differential integration. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a27854c71e92da52d6a7c7a004efa1736}\label{classRobotLocalization_1_1RosFilter_a27854c71e92da52d6a7c7a004efa1736}} 
std\+::map$<$ std\+::string, bool $>$ \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a27854c71e92da52d6a7c7a004efa1736}{remove\+Gravitational\+Acc\+\_\+}}
\begin{DoxyCompactList}\small\item\em If including acceleration for each I\+MU input, whether or not we remove acceleration due to gravity. \end{DoxyCompactList}\item 
std\+::map$<$ std\+::string, std\+::string $>$ \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a5df01bed8ccaf9deaadd869518c60310}{static\+Diagnostics\+\_\+}}
\begin{DoxyCompactList}\small\item\em This object accumulates static diagnostics, e.\+g., diagnostics relating to the configuration parameters. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a1dc8ec7162549a3f935159fc4df143d6}\label{classRobotLocalization_1_1RosFilter_a1dc8ec7162549a3f935159fc4df143d6}} 
Eigen\+::\+Vector\+Xd \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a1dc8ec7162549a3f935159fc4df143d6}{latest\+Control\+\_\+}}
\begin{DoxyCompactList}\small\item\em The most recent control input. \end{DoxyCompactList}\item 
geometry\+\_\+msgs\+::\+Transform\+Stamped \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aefbc737fbacf16090e2f17d87de9b186}{world\+Base\+Link\+Trans\+Msg\+\_\+}}
\begin{DoxyCompactList}\small\item\em Message that contains our latest transform (i.\+e., state) \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_aa42f6af65d32b9bec34c88974822fea9}\label{classRobotLocalization_1_1RosFilter_aa42f6af65d32b9bec34c88974822fea9}} 
ros\+::\+Time \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aa42f6af65d32b9bec34c88974822fea9}{last\+Diag\+Time\+\_\+}}
\begin{DoxyCompactList}\small\item\em last call of periodic\+Update \end{DoxyCompactList}\item 
ros\+::\+Time \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aa9df5f56cfb6d02a4bc22c8b68ad115f}{last\+Set\+Pose\+Time\+\_\+}}
\begin{DoxyCompactList}\small\item\em Store the last time set pose message was received. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a94ccac9ce6b71ee1a36b19a8ba33b0ac}\label{classRobotLocalization_1_1RosFilter_a94ccac9ce6b71ee1a36b19a8ba33b0ac}} 
ros\+::\+Time \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a94ccac9ce6b71ee1a36b19a8ba33b0ac}{latest\+Control\+Time\+\_\+}}
\begin{DoxyCompactList}\small\item\em The time of the most recent control input. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_ab6a90f7afc20e69a148d84e4e41330f3}\label{classRobotLocalization_1_1RosFilter_ab6a90f7afc20e69a148d84e4e41330f3}} 
ros\+::\+Duration \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ab6a90f7afc20e69a148d84e4e41330f3}{tf\+Time\+Offset\+\_\+}}
\begin{DoxyCompactList}\small\item\em For future (or past) dating the world\+\_\+frame-\/$>$base\+\_\+link\+\_\+frame transform. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a5c57fe5f94f02e033ac78939966ad366}\label{classRobotLocalization_1_1RosFilter_a5c57fe5f94f02e033ac78939966ad366}} 
ros\+::\+Duration \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a5c57fe5f94f02e033ac78939966ad366}{tf\+Timeout\+\_\+}}
\begin{DoxyCompactList}\small\item\em Parameter that specifies the how long we wait for a transform to become available. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_ad87227f3976d25577258b1c2cbf8c17a}\label{classRobotLocalization_1_1RosFilter_ad87227f3976d25577258b1c2cbf8c17a}} 
ros\+::\+Service\+Server \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ad87227f3976d25577258b1c2cbf8c17a}{toggle\+Filter\+Processing\+Srv\+\_\+}}
\begin{DoxyCompactList}\small\item\em Service that allows another node to toggle on/off filter processing while still publishing. Uses a robot\+\_\+localization Toggle\+Filter\+Processing service. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a6d41cde61a5436978a65531dbd08accd}\label{classRobotLocalization_1_1RosFilter_a6d41cde61a5436978a65531dbd08accd}} 
ros\+::\+Timer \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6d41cde61a5436978a65531dbd08accd}{periodic\+Update\+Timer\+\_\+}}
\begin{DoxyCompactList}\small\item\em timer calling periodic\+Update \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a37a9eb3abb974e2079e34843dbd69af3}\label{classRobotLocalization_1_1RosFilter_a37a9eb3abb974e2079e34843dbd69af3}} 
Filter\+State\+History\+Deque \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a37a9eb3abb974e2079e34843dbd69af3}{filter\+State\+History\+\_\+}}
\begin{DoxyCompactList}\small\item\em An implicitly time ordered queue of past filter states used for smoothing. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_aeb7a3b61549bad2cc4e84d803c038c5f}\label{classRobotLocalization_1_1RosFilter_aeb7a3b61549bad2cc4e84d803c038c5f}} 
Measurement\+History\+Deque \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aeb7a3b61549bad2cc4e84d803c038c5f}{measurement\+History\+\_\+}}
\begin{DoxyCompactList}\small\item\em A deque of previous measurements which is implicitly ordered from earliest to latest measurement. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a233bcdab40b3b0d7db316ffd0c09f2ce}\label{classRobotLocalization_1_1RosFilter_a233bcdab40b3b0d7db316ffd0c09f2ce}} 
Measurement\+Queue \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a233bcdab40b3b0d7db316ffd0c09f2ce}{measurement\+Queue\+\_\+}}
\begin{DoxyCompactList}\small\item\em We process measurements by queueing them up in callbacks and processing them all at once within each iteration. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}\label{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}} 
T \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\+\_\+}}
\begin{DoxyCompactList}\small\item\em Our filter (E\+KF, U\+KF, etc.) \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a03a0adf9f3be7b576044755a76b12b3b}\label{classRobotLocalization_1_1RosFilter_a03a0adf9f3be7b576044755a76b12b3b}} 
ros\+::\+Node\+Handle \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a03a0adf9f3be7b576044755a76b12b3b}{nh\+\_\+}}
\begin{DoxyCompactList}\small\item\em Node handle. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_abe50aea17d383427f39c3b3c57617f12}\label{classRobotLocalization_1_1RosFilter_abe50aea17d383427f39c3b3c57617f12}} 
ros\+::\+Node\+Handle \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_abe50aea17d383427f39c3b3c57617f12}{nh\+Local\+\_\+}}
\begin{DoxyCompactList}\small\item\em Local node handle (for params) \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a023f7d6bface4ae490ac876178c00477}\label{classRobotLocalization_1_1RosFilter_a023f7d6bface4ae490ac876178c00477}} 
ros\+::\+Publisher \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a023f7d6bface4ae490ac876178c00477}{accel\+Pub\+\_\+}}
\begin{DoxyCompactList}\small\item\em optional acceleration publisher \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_aed5b71140cfc7395ce2a20fa0dc86c4d}\label{classRobotLocalization_1_1RosFilter_aed5b71140cfc7395ce2a20fa0dc86c4d}} 
ros\+::\+Publisher \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aed5b71140cfc7395ce2a20fa0dc86c4d}{position\+Pub\+\_\+}}
\begin{DoxyCompactList}\small\item\em position publisher \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_ad5d413ed595a2cbbaa486ef380c5ab9c}\label{classRobotLocalization_1_1RosFilter_ad5d413ed595a2cbbaa486ef380c5ab9c}} 
ros\+::\+Subscriber \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ad5d413ed595a2cbbaa486ef380c5ab9c}{control\+Sub\+\_\+}}
\begin{DoxyCompactList}\small\item\em Subscribes to the control input topic. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a7beb7c4588a1b41f44d44e08c81caab1}\label{classRobotLocalization_1_1RosFilter_a7beb7c4588a1b41f44d44e08c81caab1}} 
ros\+::\+Subscriber \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a7beb7c4588a1b41f44d44e08c81caab1}{set\+Pose\+Sub\+\_\+}}
\begin{DoxyCompactList}\small\item\em Subscribes to the set\+\_\+pose topic (usually published from rviz). Message type is geometry\+\_\+msgs/\+Pose\+With\+Covariance\+Stamped. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_ab027ce32b0c4400893b03c5ed629c65b}\label{classRobotLocalization_1_1RosFilter_ab027ce32b0c4400893b03c5ed629c65b}} 
ros\+::\+Service\+Server \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ab027ce32b0c4400893b03c5ed629c65b}{enable\+Filter\+Srv\+\_\+}}
\begin{DoxyCompactList}\small\item\em Service that allows another node to enable the filter. Uses a standard Empty service. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_aa58d71c5e43eaf68b452aaec7f09992f}\label{classRobotLocalization_1_1RosFilter_aa58d71c5e43eaf68b452aaec7f09992f}} 
ros\+::\+Service\+Server \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aa58d71c5e43eaf68b452aaec7f09992f}{set\+Pose\+Srv\+\_\+}}
\begin{DoxyCompactList}\small\item\em Service that allows another node to change the current state and recieve a confirmation. Uses a custom Set\+Pose service. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_ae88f4c45d5209d03d53fc6a4d1bb93ab}\label{classRobotLocalization_1_1RosFilter_ae88f4c45d5209d03d53fc6a4d1bb93ab}} 
diagnostic\+\_\+updater\+::\+Updater \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ae88f4c45d5209d03d53fc6a4d1bb93ab}{diagnostic\+Updater\+\_\+}}
\begin{DoxyCompactList}\small\item\em Used for updating the diagnostics. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_aacaed6dea7d7bd1dc1d03eeddf002c29}\label{classRobotLocalization_1_1RosFilter_aacaed6dea7d7bd1dc1d03eeddf002c29}} 
tf2\+\_\+ros\+::\+Buffer \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aacaed6dea7d7bd1dc1d03eeddf002c29}{tf\+Buffer\+\_\+}}
\begin{DoxyCompactList}\small\item\em Transform buffer for managing coordinate transforms. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a1941fdd54f6ac9f212dafba9330b5002}\label{classRobotLocalization_1_1RosFilter_a1941fdd54f6ac9f212dafba9330b5002}} 
tf2\+\_\+ros\+::\+Transform\+Listener \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a1941fdd54f6ac9f212dafba9330b5002}{tf\+Listener\+\_\+}}
\begin{DoxyCompactList}\small\item\em Transform listener for receiving transforms. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a0b573989259338afb3aba497140f8568}\label{classRobotLocalization_1_1RosFilter_a0b573989259338afb3aba497140f8568}} 
tf2\+\_\+ros\+::\+Transform\+Broadcaster \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a0b573989259338afb3aba497140f8568}{world\+Transform\+Broadcaster\+\_\+}}
\begin{DoxyCompactList}\small\item\em broadcaster of world\+Transform tfs \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a03543a3b187133e09ebe769157de2c01}\label{classRobotLocalization_1_1RosFilter_a03543a3b187133e09ebe769157de2c01}} 
std\+::unique\+\_\+ptr$<$ diagnostic\+\_\+updater\+::\+Headerless\+Topic\+Diagnostic $>$ \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a03543a3b187133e09ebe769157de2c01}{freq\+Diag\+\_\+}}
\begin{DoxyCompactList}\small\item\em optional signaling diagnostic frequency \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\subsubsection*{template$<$class T$>$\newline
class Robot\+Localization\+::\+Ros\+Filter$<$ T $>$}



Definition at line 106 of file ros\+\_\+filter.\+h.



\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a39ff4db9503a7f645093b086716b4a98}\label{classRobotLocalization_1_1RosFilter_a39ff4db9503a7f645093b086716b4a98}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!RosFilter@{RosFilter}}
\index{RosFilter@{RosFilter}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{RosFilter()}{RosFilter()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
\mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::\mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Ros\+Filter}} (\begin{DoxyParamCaption}\item[{ros\+::\+Node\+Handle}]{nh,  }\item[{ros\+::\+Node\+Handle}]{nh\+\_\+priv,  }\item[{std\+::string}]{node\+\_\+name,  }\item[{std\+::vector$<$ double $>$}]{args = {\ttfamily std\+:\+:vector$<$double$>$()} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [explicit]}}



Constructor. 

The \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Ros\+Filter}} constructor makes sure that anyone using this template is doing so with the correct object type 

Definition at line 49 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{52                                                   :}
\DoxyCodeLine{53       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_adb32c6e37c800af6a02158c071f85d92}{disabledAtStartup\_}}(\textcolor{keyword}{false}),}
\DoxyCodeLine{54       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a5da2ab5cea26ee0545447a7643523d1b}{enabled\_}}(\textcolor{keyword}{false}),}
\DoxyCodeLine{55       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_add0c677e8eb87145755b5cd18718a45a}{predictToCurrentTime\_}}(\textcolor{keyword}{false}),}
\DoxyCodeLine{56       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a91643ae3e6d532325acdc556b4b8f739}{printDiagnostics\_}}(\textcolor{keyword}{true}),}
\DoxyCodeLine{57       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a28aacc455afa26b8d02fed733473577b}{publishAcceleration\_}}(\textcolor{keyword}{false}),}
\DoxyCodeLine{58       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a0372ebd630b868624f2dd931e6b28b7f}{publishTransform\_}}(\textcolor{keyword}{true}),}
\DoxyCodeLine{59       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a16ad0452b5b52e64a93736d25cfeba95}{resetOnTimeJump\_}}(\textcolor{keyword}{false}),}
\DoxyCodeLine{60       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ab8779e25f3390bd1ddeba10401164a2c}{smoothLaggedData\_}}(\textcolor{keyword}{false}),}
\DoxyCodeLine{61       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ac22190accdeee0fc2dcfb692e5d97038}{toggledOn\_}}(\textcolor{keyword}{true}),}
\DoxyCodeLine{62       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ad06dbf8f35a49fc76daf1c16fdecd34d}{twoDMode\_}}(\textcolor{keyword}{false}),}
\DoxyCodeLine{63       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a714e2c0386cfa1ec147c52f897852532}{useControl\_}}(\textcolor{keyword}{false}),}
\DoxyCodeLine{64       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a5f51fcc879266f6091c5745c93bdc960}{dynamicDiagErrorLevel\_}}(diagnostic\_msgs::DiagnosticStatus::OK),}
\DoxyCodeLine{65       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_afe66e5331dcd54686c7cf039ce856f71}{staticDiagErrorLevel\_}}(diagnostic\_msgs::DiagnosticStatus::OK),}
\DoxyCodeLine{66       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ad15b5063af8ae3b48cd44dfae17eaf9e}{frequency\_}}(30.0),}
\DoxyCodeLine{67       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a26a3d07bd073104fd3a2ee004ba88581}{gravitationalAcc\_}}(9.80665),}
\DoxyCodeLine{68       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a84b03bc70e9979c28deb044c545ba287}{historyLength\_}}(0),}
\DoxyCodeLine{69       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a861a0f9c63867697b18377805572a00a}{minFrequency\_}}(\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ad15b5063af8ae3b48cd44dfae17eaf9e}{frequency\_}} -\/ 2.0),}
\DoxyCodeLine{70       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a98514257c62d3bcb14ec1e8446e0c0a3}{maxFrequency\_}}(\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ad15b5063af8ae3b48cd44dfae17eaf9e}{frequency\_}} + 2.0),}
\DoxyCodeLine{71       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6c0cfc2c5d47061bf2ae272b7532b51b}{baseLinkFrameId\_}}(\textcolor{stringliteral}{"base\_link"}),}
\DoxyCodeLine{72       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a2b184469b63dfe6261dea4a92b5b23a6}{mapFrameId\_}}(\textcolor{stringliteral}{"map"}),}
\DoxyCodeLine{73       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ae6ef41c43d134fb109fe8996a723bcf4}{odomFrameId\_}}(\textcolor{stringliteral}{"odom"}),}
\DoxyCodeLine{74       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a37c23d6c10a630fe33e74376898fc5c8}{worldFrameId\_}}(\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ae6ef41c43d134fb109fe8996a723bcf4}{odomFrameId\_}}),}
\DoxyCodeLine{75       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aa42f6af65d32b9bec34c88974822fea9}{lastDiagTime\_}}(0),}
\DoxyCodeLine{76       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aa9df5f56cfb6d02a4bc22c8b68ad115f}{lastSetPoseTime\_}}(0),}
\DoxyCodeLine{77       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a94ccac9ce6b71ee1a36b19a8ba33b0ac}{latestControlTime\_}}(0),}
\DoxyCodeLine{78       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ab6a90f7afc20e69a148d84e4e41330f3}{tfTimeOffset\_}}(ros::Duration(0)),}
\DoxyCodeLine{79       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a5c57fe5f94f02e033ac78939966ad366}{tfTimeout\_}}(ros::Duration(0)),}
\DoxyCodeLine{80       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}(args),}
\DoxyCodeLine{81       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a03a0adf9f3be7b576044755a76b12b3b}{nh\_}}(nh),}
\DoxyCodeLine{82       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_abe50aea17d383427f39c3b3c57617f12}{nhLocal\_}}(nh\_priv),}
\DoxyCodeLine{83       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ae88f4c45d5209d03d53fc6a4d1bb93ab}{diagnosticUpdater\_}}(nh, nh\_priv, node\_name),}
\DoxyCodeLine{84       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a1941fdd54f6ac9f212dafba9330b5002}{tfListener\_}}(\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aacaed6dea7d7bd1dc1d03eeddf002c29}{tfBuffer\_}})}
\DoxyCodeLine{85   \{}
\DoxyCodeLine{86     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a394f86657e02d8c445ce2eaba71153a3}{stateVariableNames\_}}.push\_back(\textcolor{stringliteral}{"X"});}
\DoxyCodeLine{87     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a394f86657e02d8c445ce2eaba71153a3}{stateVariableNames\_}}.push\_back(\textcolor{stringliteral}{"Y"});}
\DoxyCodeLine{88     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a394f86657e02d8c445ce2eaba71153a3}{stateVariableNames\_}}.push\_back(\textcolor{stringliteral}{"Z"});}
\DoxyCodeLine{89     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a394f86657e02d8c445ce2eaba71153a3}{stateVariableNames\_}}.push\_back(\textcolor{stringliteral}{"ROLL"});}
\DoxyCodeLine{90     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a394f86657e02d8c445ce2eaba71153a3}{stateVariableNames\_}}.push\_back(\textcolor{stringliteral}{"PITCH"});}
\DoxyCodeLine{91     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a394f86657e02d8c445ce2eaba71153a3}{stateVariableNames\_}}.push\_back(\textcolor{stringliteral}{"YAW"});}
\DoxyCodeLine{92     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a394f86657e02d8c445ce2eaba71153a3}{stateVariableNames\_}}.push\_back(\textcolor{stringliteral}{"X\_VELOCITY"});}
\DoxyCodeLine{93     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a394f86657e02d8c445ce2eaba71153a3}{stateVariableNames\_}}.push\_back(\textcolor{stringliteral}{"Y\_VELOCITY"});}
\DoxyCodeLine{94     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a394f86657e02d8c445ce2eaba71153a3}{stateVariableNames\_}}.push\_back(\textcolor{stringliteral}{"Z\_VELOCITY"});}
\DoxyCodeLine{95     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a394f86657e02d8c445ce2eaba71153a3}{stateVariableNames\_}}.push\_back(\textcolor{stringliteral}{"ROLL\_VELOCITY"});}
\DoxyCodeLine{96     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a394f86657e02d8c445ce2eaba71153a3}{stateVariableNames\_}}.push\_back(\textcolor{stringliteral}{"PITCH\_VELOCITY"});}
\DoxyCodeLine{97     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a394f86657e02d8c445ce2eaba71153a3}{stateVariableNames\_}}.push\_back(\textcolor{stringliteral}{"YAW\_VELOCITY"});}
\DoxyCodeLine{98     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a394f86657e02d8c445ce2eaba71153a3}{stateVariableNames\_}}.push\_back(\textcolor{stringliteral}{"X\_ACCELERATION"});}
\DoxyCodeLine{99     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a394f86657e02d8c445ce2eaba71153a3}{stateVariableNames\_}}.push\_back(\textcolor{stringliteral}{"Y\_ACCELERATION"});}
\DoxyCodeLine{100     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a394f86657e02d8c445ce2eaba71153a3}{stateVariableNames\_}}.push\_back(\textcolor{stringliteral}{"Z\_ACCELERATION"});}
\DoxyCodeLine{101 }
\DoxyCodeLine{102     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ae88f4c45d5209d03d53fc6a4d1bb93ab}{diagnosticUpdater\_}}.setHardwareID(\textcolor{stringliteral}{"none"});}
\DoxyCodeLine{103   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a392382adffded2b4390f2a780b81e0f4}\label{classRobotLocalization_1_1RosFilter_a392382adffded2b4390f2a780b81e0f4}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!RosFilter@{RosFilter}}
\index{RosFilter@{RosFilter}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{RosFilter()}{RosFilter()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
\mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::\mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Ros\+Filter}} (\begin{DoxyParamCaption}\item[{ros\+::\+Node\+Handle}]{nh,  }\item[{ros\+::\+Node\+Handle}]{nh\+\_\+priv,  }\item[{std\+::vector$<$ double $>$}]{args = {\ttfamily std\+:\+:vector$<$double$>$()} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [explicit]}}



Constructor. 

The \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Ros\+Filter}} constructor makes sure that anyone using this template is doing so with the correct object type 

Definition at line 106 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{106                                                                                          :}
\DoxyCodeLine{107       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a39ff4db9503a7f645093b086716b4a98}{RosFilter<T>::RosFilter}}(nh, nh\_priv, ros::this\_node::getName(), args)}
\DoxyCodeLine{108   \{\}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a9d9207b728f5094c941745766b551bf1}\label{classRobotLocalization_1_1RosFilter_a9d9207b728f5094c941745766b551bf1}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!````~RosFilter@{$\sim$RosFilter}}
\index{````~RosFilter@{$\sim$RosFilter}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{$\sim$RosFilter()}{~RosFilter()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
\mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::$\sim$\mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Ros\+Filter}}}



Destructor. 

Clears out the message filters and topic subscribers. 

Definition at line 111 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{112   \{}
\DoxyCodeLine{113     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a1c36b4e9478bf44a96f74687cc882c6b}{topicSubs\_}}.clear();}
\DoxyCodeLine{114   \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_ae5643fce575cd46f5cd77becf29d04ad}\label{classRobotLocalization_1_1RosFilter_ae5643fce575cd46f5cd77becf29d04ad}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!accelerationCallback@{accelerationCallback}}
\index{accelerationCallback@{accelerationCallback}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{accelerationCallback()}{accelerationCallback()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::acceleration\+Callback (\begin{DoxyParamCaption}\item[{const sensor\+\_\+msgs\+::\+Imu\+::\+Const\+Ptr \&}]{msg,  }\item[{const \mbox{\hyperlink{structRobotLocalization_1_1CallbackData}{Callback\+Data}} \&}]{callback\+Data,  }\item[{const std\+::string \&}]{target\+Frame }\end{DoxyParamCaption})}



Callback method for receiving all acceleration (I\+MU) messages. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em msg} & -\/ The R\+OS I\+MU message to take in. \\
\hline
\mbox{\texttt{ in}}  & {\em callback\+Data} & -\/ Relevant static callback data \\
\hline
\mbox{\texttt{ in}}  & {\em target\+Frame} & -\/ The target frame\+\_\+id into which to transform the data \\
\hline
\end{DoxyParams}


Definition at line 202 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{204   \{}
\DoxyCodeLine{205     \textcolor{comment}{// If we've just reset the filter, then we want to ignore any messages}}
\DoxyCodeLine{206     \textcolor{comment}{// that arrive with an older timestamp}}
\DoxyCodeLine{207     \textcolor{keywordflow}{if} (msg-\/>header.stamp <= \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aa9df5f56cfb6d02a4bc22c8b68ad115f}{lastSetPoseTime\_}})}
\DoxyCodeLine{208     \{}
\DoxyCodeLine{209       \textcolor{keywordflow}{return};}
\DoxyCodeLine{210     \}}
\DoxyCodeLine{211 }
\DoxyCodeLine{212     \textcolor{keyword}{const} std::string \&topicName = callbackData.topicName\_;}
\DoxyCodeLine{213 }
\DoxyCodeLine{214     RF\_DEBUG(\textcolor{stringliteral}{"-\/-\/-\/-\/-\/-\/ RosFilter::accelerationCallback ("} << topicName << \textcolor{stringliteral}{") -\/-\/-\/-\/-\/-\/\(\backslash\)n"}}
\DoxyCodeLine{215              \textcolor{stringliteral}{"Twist message:\(\backslash\)n"} << *msg);}
\DoxyCodeLine{216 }
\DoxyCodeLine{217     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a473c0f797fcd9677b1005637ee159ae4}{lastMessageTimes\_}}.count(topicName) == 0)}
\DoxyCodeLine{218     \{}
\DoxyCodeLine{219       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a473c0f797fcd9677b1005637ee159ae4}{lastMessageTimes\_}}.insert(std::pair<std::string, ros::Time>(topicName, msg-\/>header.stamp));}
\DoxyCodeLine{220     \}}
\DoxyCodeLine{221 }
\DoxyCodeLine{222     \textcolor{comment}{// Make sure this message is newer than the last one}}
\DoxyCodeLine{223     \textcolor{keywordflow}{if} (msg-\/>header.stamp >= \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a473c0f797fcd9677b1005637ee159ae4}{lastMessageTimes\_}}[topicName])}
\DoxyCodeLine{224     \{}
\DoxyCodeLine{225       RF\_DEBUG(\textcolor{stringliteral}{"Update vector for "} << topicName << \textcolor{stringliteral}{" is:\(\backslash\)n"} << topicName);}
\DoxyCodeLine{226 }
\DoxyCodeLine{227       Eigen::VectorXd measurement(STATE\_SIZE);}
\DoxyCodeLine{228       Eigen::MatrixXd measurementCovariance(STATE\_SIZE, STATE\_SIZE);}
\DoxyCodeLine{229 }
\DoxyCodeLine{230       measurement.setZero();}
\DoxyCodeLine{231       measurementCovariance.setZero();}
\DoxyCodeLine{232 }
\DoxyCodeLine{233       \textcolor{comment}{// Make sure we're actually updating at least one of these variables}}
\DoxyCodeLine{234       std::vector<int> updateVectorCorrected = callbackData.updateVector\_;}
\DoxyCodeLine{235 }
\DoxyCodeLine{236       \textcolor{comment}{// Prepare the twist data for inclusion in the filter}}
\DoxyCodeLine{237       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a34b0ea97d422eaf92c36ed8085dea5c3}{prepareAcceleration}}(msg, topicName, targetFrame, updateVectorCorrected, measurement,}
\DoxyCodeLine{238             measurementCovariance))}
\DoxyCodeLine{239       \{}
\DoxyCodeLine{240         \textcolor{comment}{// Store the measurement. Add an "acceleration" suffix so we know what kind of measurement}}
\DoxyCodeLine{241         \textcolor{comment}{// we're dealing with when we debug the core filter logic.}}
\DoxyCodeLine{242         \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6f69cfe0fd2fea54446e4895b14c4c88}{enqueueMeasurement}}(topicName,}
\DoxyCodeLine{243                            measurement,}
\DoxyCodeLine{244                            measurementCovariance,}
\DoxyCodeLine{245                            updateVectorCorrected,}
\DoxyCodeLine{246                            callbackData.rejectionThreshold\_,}
\DoxyCodeLine{247                            msg-\/>header.stamp);}
\DoxyCodeLine{248 }
\DoxyCodeLine{249         RF\_DEBUG(\textcolor{stringliteral}{"Enqueued new measurement for "} << topicName << \textcolor{stringliteral}{"\_acceleration\(\backslash\)n"});}
\DoxyCodeLine{250       \}}
\DoxyCodeLine{251       \textcolor{keywordflow}{else}}
\DoxyCodeLine{252       \{}
\DoxyCodeLine{253         RF\_DEBUG(\textcolor{stringliteral}{"Did *not* enqueue measurement for "} << topicName << \textcolor{stringliteral}{"\_acceleration\(\backslash\)n"});}
\DoxyCodeLine{254       \}}
\DoxyCodeLine{255 }
\DoxyCodeLine{256       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a473c0f797fcd9677b1005637ee159ae4}{lastMessageTimes\_}}[topicName] = msg-\/>header.stamp;}
\DoxyCodeLine{257 }
\DoxyCodeLine{258       RF\_DEBUG(\textcolor{stringliteral}{"Last message time for "} << topicName << \textcolor{stringliteral}{" is now "} <<}
\DoxyCodeLine{259         \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a473c0f797fcd9677b1005637ee159ae4}{lastMessageTimes\_}}[topicName] << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{260     \}}
\DoxyCodeLine{261     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a16ad0452b5b52e64a93736d25cfeba95}{resetOnTimeJump\_}} \&\& ros::Time::isSimTime())}
\DoxyCodeLine{262     \{}
\DoxyCodeLine{263       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a011b39dad94b84b7856f993518e4ae00}{reset}}();}
\DoxyCodeLine{264     \}}
\DoxyCodeLine{265     \textcolor{keywordflow}{else}}
\DoxyCodeLine{266     \{}
\DoxyCodeLine{267       std::stringstream stream;}
\DoxyCodeLine{268       stream << \textcolor{stringliteral}{"The "} << topicName << \textcolor{stringliteral}{" message has a timestamp before that of the previous message received,"} <<}
\DoxyCodeLine{269                 \textcolor{stringliteral}{" this message will be ignored. This may indicate a bad timestamp. (message time: "} <<}
\DoxyCodeLine{270                 msg-\/>header.stamp.toSec() << \textcolor{stringliteral}{")"};}
\DoxyCodeLine{271       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a8266b1436e1907c160d8c73a920e806c}{addDiagnostic}}(diagnostic\_msgs::DiagnosticStatus::WARN,}
\DoxyCodeLine{272                     topicName + \textcolor{stringliteral}{"\_timestamp"},}
\DoxyCodeLine{273                     stream.str(),}
\DoxyCodeLine{274                     \textcolor{keyword}{false});}
\DoxyCodeLine{275 }
\DoxyCodeLine{276       RF\_DEBUG(\textcolor{stringliteral}{"Message is too old. Last message time for "} << topicName <<}
\DoxyCodeLine{277                \textcolor{stringliteral}{" is "} << \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a473c0f797fcd9677b1005637ee159ae4}{lastMessageTimes\_}}[topicName] << \textcolor{stringliteral}{", current message time is "} <<}
\DoxyCodeLine{278                msg-\/>header.stamp << \textcolor{stringliteral}{".\(\backslash\)n"});}
\DoxyCodeLine{279     \}}
\DoxyCodeLine{280 }
\DoxyCodeLine{281     RF\_DEBUG(\textcolor{stringliteral}{"\(\backslash\)n-\/-\/-\/-\/-\/ /RosFilter::accelerationCallback ("} << topicName << \textcolor{stringliteral}{") -\/-\/-\/-\/-\/-\/\(\backslash\)n"});}
\DoxyCodeLine{282   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a8266b1436e1907c160d8c73a920e806c}\label{classRobotLocalization_1_1RosFilter_a8266b1436e1907c160d8c73a920e806c}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!addDiagnostic@{addDiagnostic}}
\index{addDiagnostic@{addDiagnostic}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{addDiagnostic()}{addDiagnostic()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::add\+Diagnostic (\begin{DoxyParamCaption}\item[{const int}]{err\+Level,  }\item[{const std\+::string \&}]{topic\+And\+Class,  }\item[{const std\+::string \&}]{message,  }\item[{const bool}]{static\+Diag }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}



Adds a diagnostic message to the accumulating map and updates the error level. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em err\+Level} & -\/ The error level of the diagnostic \\
\hline
\mbox{\texttt{ in}}  & {\em topic\+And\+Class} & -\/ The sensor topic (if relevant) and class of diagnostic \\
\hline
\mbox{\texttt{ in}}  & {\em message} & -\/ Details of the diagnostic \\
\hline
\mbox{\texttt{ in}}  & {\em static\+Diag} & -\/ Whether or not this diagnostic information is static \\
\hline
\end{DoxyParams}


Definition at line 2172 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{2176   \{}
\DoxyCodeLine{2177     \textcolor{keywordflow}{if} (staticDiag)}
\DoxyCodeLine{2178     \{}
\DoxyCodeLine{2179       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a5df01bed8ccaf9deaadd869518c60310}{staticDiagnostics\_}}[topicAndClass] = message;}
\DoxyCodeLine{2180       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_afe66e5331dcd54686c7cf039ce856f71}{staticDiagErrorLevel\_}} = std::max(\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_afe66e5331dcd54686c7cf039ce856f71}{staticDiagErrorLevel\_}}, errLevel);}
\DoxyCodeLine{2181     \}}
\DoxyCodeLine{2182     \textcolor{keywordflow}{else}}
\DoxyCodeLine{2183     \{}
\DoxyCodeLine{2184       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a7b48b5bb099cf8c0bd283b6fd5661424}{dynamicDiagnostics\_}}[topicAndClass] = message;}
\DoxyCodeLine{2185       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a5f51fcc879266f6091c5745c93bdc960}{dynamicDiagErrorLevel\_}} = std::max(\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a5f51fcc879266f6091c5745c93bdc960}{dynamicDiagErrorLevel\_}}, errLevel);}
\DoxyCodeLine{2186     \}}
\DoxyCodeLine{2187   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a6217442419d2808d43eb8c613403b04b}\label{classRobotLocalization_1_1RosFilter_a6217442419d2808d43eb8c613403b04b}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!aggregateDiagnostics@{aggregateDiagnostics}}
\index{aggregateDiagnostics@{aggregateDiagnostics}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{aggregateDiagnostics()}{aggregateDiagnostics()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::aggregate\+Diagnostics (\begin{DoxyParamCaption}\item[{diagnostic\+\_\+updater\+::\+Diagnostic\+Status\+Wrapper \&}]{wrapper }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}



Aggregates all diagnostics so they can be published. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em wrapper} & -\/ The diagnostic status wrapper to update \\
\hline
\end{DoxyParams}


Definition at line 2190 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{2191   \{}
\DoxyCodeLine{2192     wrapper.clear();}
\DoxyCodeLine{2193     wrapper.clearSummary();}
\DoxyCodeLine{2194 }
\DoxyCodeLine{2195     \textcolor{keywordtype}{int} maxErrLevel = std::max(\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_afe66e5331dcd54686c7cf039ce856f71}{staticDiagErrorLevel\_}}, \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a5f51fcc879266f6091c5745c93bdc960}{dynamicDiagErrorLevel\_}});}
\DoxyCodeLine{2196 }
\DoxyCodeLine{2197     \textcolor{comment}{// Report the overall status}}
\DoxyCodeLine{2198     \textcolor{keywordflow}{switch} (maxErrLevel)}
\DoxyCodeLine{2199     \{}
\DoxyCodeLine{2200       \textcolor{keywordflow}{case} diagnostic\_msgs::DiagnosticStatus::ERROR:}
\DoxyCodeLine{2201         wrapper.summary(maxErrLevel,}
\DoxyCodeLine{2202                         \textcolor{stringliteral}{"Erroneous data or settings detected for a robot\_localization state estimation node."});}
\DoxyCodeLine{2203         \textcolor{keywordflow}{break};}
\DoxyCodeLine{2204       \textcolor{keywordflow}{case} diagnostic\_msgs::DiagnosticStatus::WARN:}
\DoxyCodeLine{2205         wrapper.summary(maxErrLevel,}
\DoxyCodeLine{2206                         \textcolor{stringliteral}{"Potentially erroneous data or settings detected for "}}
\DoxyCodeLine{2207                         \textcolor{stringliteral}{"a robot\_localization state estimation node."});}
\DoxyCodeLine{2208         \textcolor{keywordflow}{break};}
\DoxyCodeLine{2209       \textcolor{keywordflow}{case} diagnostic\_msgs::DiagnosticStatus::STALE:}
\DoxyCodeLine{2210         wrapper.summary(maxErrLevel,}
\DoxyCodeLine{2211                         \textcolor{stringliteral}{"The state of the robot\_localization state estimation node is stale."});}
\DoxyCodeLine{2212         \textcolor{keywordflow}{break};}
\DoxyCodeLine{2213       \textcolor{keywordflow}{case} diagnostic\_msgs::DiagnosticStatus::OK:}
\DoxyCodeLine{2214         wrapper.summary(maxErrLevel,}
\DoxyCodeLine{2215                         \textcolor{stringliteral}{"The robot\_localization state estimation node appears to be functioning properly."});}
\DoxyCodeLine{2216         \textcolor{keywordflow}{break};}
\DoxyCodeLine{2217       \textcolor{keywordflow}{default}:}
\DoxyCodeLine{2218         \textcolor{keywordflow}{break};}
\DoxyCodeLine{2219     \}}
\DoxyCodeLine{2220 }
\DoxyCodeLine{2221     \textcolor{comment}{// Aggregate all the static messages}}
\DoxyCodeLine{2222     \textcolor{keywordflow}{for} (std::map<std::string, std::string>::iterator diagIt = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a5df01bed8ccaf9deaadd869518c60310}{staticDiagnostics\_}}.begin();}
\DoxyCodeLine{2223         diagIt != \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a5df01bed8ccaf9deaadd869518c60310}{staticDiagnostics\_}}.end();}
\DoxyCodeLine{2224         ++diagIt)}
\DoxyCodeLine{2225     \{}
\DoxyCodeLine{2226       wrapper.add(diagIt-\/>first, diagIt-\/>second);}
\DoxyCodeLine{2227     \}}
\DoxyCodeLine{2228 }
\DoxyCodeLine{2229     \textcolor{comment}{// Aggregate all the dynamic messages, then clear them}}
\DoxyCodeLine{2230     \textcolor{keywordflow}{for} (std::map<std::string, std::string>::iterator diagIt = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a7b48b5bb099cf8c0bd283b6fd5661424}{dynamicDiagnostics\_}}.begin();}
\DoxyCodeLine{2231         diagIt != \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a7b48b5bb099cf8c0bd283b6fd5661424}{dynamicDiagnostics\_}}.end();}
\DoxyCodeLine{2232         ++diagIt)}
\DoxyCodeLine{2233     \{}
\DoxyCodeLine{2234       wrapper.add(diagIt-\/>first, diagIt-\/>second);}
\DoxyCodeLine{2235     \}}
\DoxyCodeLine{2236     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a7b48b5bb099cf8c0bd283b6fd5661424}{dynamicDiagnostics\_}}.clear();}
\DoxyCodeLine{2237 }
\DoxyCodeLine{2238     \textcolor{comment}{// Reset the warning level for the dynamic diagnostic messages}}
\DoxyCodeLine{2239     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a5f51fcc879266f6091c5745c93bdc960}{dynamicDiagErrorLevel\_}} = diagnostic\_msgs::DiagnosticStatus::OK;}
\DoxyCodeLine{2240   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_ae0e25abbb388e990c2062b6029329131}\label{classRobotLocalization_1_1RosFilter_ae0e25abbb388e990c2062b6029329131}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!clearExpiredHistory@{clearExpiredHistory}}
\index{clearExpiredHistory@{clearExpiredHistory}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{clearExpiredHistory()}{clearExpiredHistory()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::clear\+Expired\+History (\begin{DoxyParamCaption}\item[{const double}]{cutoff\+Time }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}



Removes measurements and filter states older than the given cutoff time. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em cutoff\+Time} & -\/ Measurements and states older than this time will be dropped. \\
\hline
\end{DoxyParams}


Definition at line 3176 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{3177   \{}
\DoxyCodeLine{3178     RF\_DEBUG(\textcolor{stringliteral}{"\(\backslash\)n-\/-\/-\/-\/-\/ RosFilter::clearExpiredHistory -\/-\/-\/-\/-\/"} <<}
\DoxyCodeLine{3179              \textcolor{stringliteral}{"\(\backslash\)nCutoff time is "} << cutOffTime << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{3180 }
\DoxyCodeLine{3181     \textcolor{keywordtype}{int} poppedMeasurements = 0;}
\DoxyCodeLine{3182     \textcolor{keywordtype}{int} poppedStates = 0;}
\DoxyCodeLine{3183 }
\DoxyCodeLine{3184     \textcolor{keywordflow}{while} (!\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aeb7a3b61549bad2cc4e84d803c038c5f}{measurementHistory\_}}.empty() \&\& \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aeb7a3b61549bad2cc4e84d803c038c5f}{measurementHistory\_}}.front()-\/>time\_ < cutOffTime)}
\DoxyCodeLine{3185     \{}
\DoxyCodeLine{3186       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aeb7a3b61549bad2cc4e84d803c038c5f}{measurementHistory\_}}.pop\_front();}
\DoxyCodeLine{3187       poppedMeasurements++;}
\DoxyCodeLine{3188     \}}
\DoxyCodeLine{3189 }
\DoxyCodeLine{3190     \textcolor{keywordflow}{while} (!\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a37a9eb3abb974e2079e34843dbd69af3}{filterStateHistory\_}}.empty() \&\& \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a37a9eb3abb974e2079e34843dbd69af3}{filterStateHistory\_}}.front()-\/>lastMeasurementTime\_ < cutOffTime)}
\DoxyCodeLine{3191     \{}
\DoxyCodeLine{3192       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a37a9eb3abb974e2079e34843dbd69af3}{filterStateHistory\_}}.pop\_front();}
\DoxyCodeLine{3193       poppedStates++;}
\DoxyCodeLine{3194     \}}
\DoxyCodeLine{3195 }
\DoxyCodeLine{3196     RF\_DEBUG(\textcolor{stringliteral}{"\(\backslash\)nPopped "} << poppedMeasurements << \textcolor{stringliteral}{" measurements and "} <<}
\DoxyCodeLine{3197              poppedStates << \textcolor{stringliteral}{" states from their respective queues."} <<}
\DoxyCodeLine{3198              \textcolor{stringliteral}{"\(\backslash\)n-\/-\/-\/-\/ /RosFilter::clearExpiredHistory -\/-\/-\/-\/\(\backslash\)n"});}
\DoxyCodeLine{3199   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a4a89276e71a0258bbcf5686d552804fa}\label{classRobotLocalization_1_1RosFilter_a4a89276e71a0258bbcf5686d552804fa}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!controlCallback@{controlCallback}}
\index{controlCallback@{controlCallback}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{controlCallback()}{controlCallback()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::control\+Callback (\begin{DoxyParamCaption}\item[{const geometry\+\_\+msgs\+::\+Twist\+::\+Const\+Ptr \&}]{msg }\end{DoxyParamCaption})}



Callback method for receiving non-\/stamped control input. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em msg} & -\/ The R\+OS twist message to take in \\
\hline
\end{DoxyParams}


Definition at line 285 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{286   \{}
\DoxyCodeLine{287     geometry\_msgs::TwistStampedPtr twistStampedPtr = geometry\_msgs::TwistStampedPtr(\textcolor{keyword}{new} geometry\_msgs::TwistStamped());}
\DoxyCodeLine{288     twistStampedPtr-\/>twist = *msg;}
\DoxyCodeLine{289     twistStampedPtr-\/>header.frame\_id = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6c0cfc2c5d47061bf2ae272b7532b51b}{baseLinkFrameId\_}};}
\DoxyCodeLine{290     twistStampedPtr-\/>header.stamp = ros::Time::now();}
\DoxyCodeLine{291     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a4a89276e71a0258bbcf5686d552804fa}{controlCallback}}(twistStampedPtr);}
\DoxyCodeLine{292   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_ac5c164b66407c5b0bfd96565a858604b}\label{classRobotLocalization_1_1RosFilter_ac5c164b66407c5b0bfd96565a858604b}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!controlCallback@{controlCallback}}
\index{controlCallback@{controlCallback}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{controlCallback()}{controlCallback()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::control\+Callback (\begin{DoxyParamCaption}\item[{const geometry\+\_\+msgs\+::\+Twist\+Stamped\+::\+Const\+Ptr \&}]{msg }\end{DoxyParamCaption})}



Callback method for receiving stamped control input. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em msg} & -\/ The R\+OS stamped twist message to take in \\
\hline
\end{DoxyParams}


Definition at line 295 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{296   \{}
\DoxyCodeLine{297     \textcolor{keywordflow}{if} (msg-\/>header.frame\_id == \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6c0cfc2c5d47061bf2ae272b7532b51b}{baseLinkFrameId\_}} || msg-\/>header.frame\_id == \textcolor{stringliteral}{""})}
\DoxyCodeLine{298     \{}
\DoxyCodeLine{299       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a1dc8ec7162549a3f935159fc4df143d6}{latestControl\_}}(ControlMemberVx) = msg-\/>twist.linear.x;}
\DoxyCodeLine{300       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a1dc8ec7162549a3f935159fc4df143d6}{latestControl\_}}(ControlMemberVy) = msg-\/>twist.linear.y;}
\DoxyCodeLine{301       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a1dc8ec7162549a3f935159fc4df143d6}{latestControl\_}}(ControlMemberVz) = msg-\/>twist.linear.z;}
\DoxyCodeLine{302       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a1dc8ec7162549a3f935159fc4df143d6}{latestControl\_}}(ControlMemberVroll) = msg-\/>twist.angular.x;}
\DoxyCodeLine{303       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a1dc8ec7162549a3f935159fc4df143d6}{latestControl\_}}(ControlMemberVpitch) = msg-\/>twist.angular.y;}
\DoxyCodeLine{304       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a1dc8ec7162549a3f935159fc4df143d6}{latestControl\_}}(ControlMemberVyaw) = msg-\/>twist.angular.z;}
\DoxyCodeLine{305       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a94ccac9ce6b71ee1a36b19a8ba33b0ac}{latestControlTime\_}} = msg-\/>header.stamp;}
\DoxyCodeLine{306 }
\DoxyCodeLine{307       \textcolor{comment}{// Update the filter with this control term}}
\DoxyCodeLine{308       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.setControl(\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a1dc8ec7162549a3f935159fc4df143d6}{latestControl\_}}, msg-\/>header.stamp.toSec());}
\DoxyCodeLine{309     \}}
\DoxyCodeLine{310     \textcolor{keywordflow}{else}}
\DoxyCodeLine{311     \{}
\DoxyCodeLine{312       ROS\_WARN\_STREAM\_THROTTLE(5.0, \textcolor{stringliteral}{"Commanded velocities must be given in the robot's body frame ("} <<}
\DoxyCodeLine{313         \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6c0cfc2c5d47061bf2ae272b7532b51b}{baseLinkFrameId\_}} << \textcolor{stringliteral}{"). Message frame was "} << msg-\/>header.frame\_id);}
\DoxyCodeLine{314     \}}
\DoxyCodeLine{315   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a8b299c262fd69e029c8fc05ff19f150e}\label{classRobotLocalization_1_1RosFilter_a8b299c262fd69e029c8fc05ff19f150e}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!copyCovariance@{copyCovariance}}
\index{copyCovariance@{copyCovariance}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{copyCovariance()}{copyCovariance()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::copy\+Covariance (\begin{DoxyParamCaption}\item[{const double $\ast$}]{arr,  }\item[{Eigen\+::\+Matrix\+Xd \&}]{covariance,  }\item[{const std\+::string \&}]{topic\+Name,  }\item[{const std\+::vector$<$ int $>$ \&}]{update\+Vector,  }\item[{const size\+\_\+t}]{offset,  }\item[{const size\+\_\+t}]{dimension }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}



Utility method for copying covariances from R\+OS covariance arrays to Eigen matrices. 

This method copies the covariances and also does some data validation, which is why it requires more parameters than just the covariance containers. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em arr} & -\/ The source array for the covariance data \\
\hline
\mbox{\texttt{ in}}  & {\em covariance} & -\/ The destination matrix for the covariance data \\
\hline
\mbox{\texttt{ in}}  & {\em topic\+Name} & -\/ The name of the source data topic (for debug purposes) \\
\hline
\mbox{\texttt{ in}}  & {\em update\+Vector} & -\/ The update vector for the source topic \\
\hline
\mbox{\texttt{ in}}  & {\em offset} & -\/ The \char`\"{}starting\char`\"{} location within the array/update vector \\
\hline
\mbox{\texttt{ in}}  & {\em dimension} & -\/ The number of values to copy, starting at the offset \\
\hline
\end{DoxyParams}


Definition at line 2243 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{2249   \{}
\DoxyCodeLine{2250     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < dimension; i++)}
\DoxyCodeLine{2251     \{}
\DoxyCodeLine{2252       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = 0; j < dimension; j++)}
\DoxyCodeLine{2253       \{}
\DoxyCodeLine{2254         covariance(i, j) = arr[dimension * i + j];}
\DoxyCodeLine{2255 }
\DoxyCodeLine{2256         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a91643ae3e6d532325acdc556b4b8f739}{printDiagnostics\_}})}
\DoxyCodeLine{2257         \{}
\DoxyCodeLine{2258           std::string iVar = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a394f86657e02d8c445ce2eaba71153a3}{stateVariableNames\_}}[offset + i];}
\DoxyCodeLine{2259 }
\DoxyCodeLine{2260           \textcolor{keywordflow}{if} (covariance(i, j) > 1e3 \&\& (updateVector[offset  + i] || updateVector[offset  + j]))}
\DoxyCodeLine{2261           \{}
\DoxyCodeLine{2262             std::string jVar = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a394f86657e02d8c445ce2eaba71153a3}{stateVariableNames\_}}[offset + j];}
\DoxyCodeLine{2263 }
\DoxyCodeLine{2264             std::stringstream stream;}
\DoxyCodeLine{2265             stream << \textcolor{stringliteral}{"The covariance at position ("} << dimension * i + j << \textcolor{stringliteral}{"), which corresponds to "} <<}
\DoxyCodeLine{2266                 (i == j ? iVar + \textcolor{stringliteral}{" variance"} : iVar + \textcolor{stringliteral}{" and "} + jVar + \textcolor{stringliteral}{" covariance"}) <<}
\DoxyCodeLine{2267                 \textcolor{stringliteral}{", the value is extremely large ("} << covariance(i, j) << \textcolor{stringliteral}{"), but the update vector for "} <<}
\DoxyCodeLine{2268                 (i == j ? iVar : iVar + \textcolor{stringliteral}{" and/or "} + jVar) << \textcolor{stringliteral}{" is set to true. This may produce undesirable results."};}
\DoxyCodeLine{2269 }
\DoxyCodeLine{2270             \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a8266b1436e1907c160d8c73a920e806c}{addDiagnostic}}(diagnostic\_msgs::DiagnosticStatus::WARN,}
\DoxyCodeLine{2271                           topicName + \textcolor{stringliteral}{"\_covariance"},}
\DoxyCodeLine{2272                           stream.str(),}
\DoxyCodeLine{2273                           \textcolor{keyword}{false});}
\DoxyCodeLine{2274           \}}
\DoxyCodeLine{2275           \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (updateVector[i] \&\& i == j \&\& covariance(i, j) == 0)}
\DoxyCodeLine{2276           \{}
\DoxyCodeLine{2277             std::stringstream stream;}
\DoxyCodeLine{2278             stream << \textcolor{stringliteral}{"The covariance at position ("} << dimension * i + j << \textcolor{stringliteral}{"), which corresponds to "} <<}
\DoxyCodeLine{2279                        iVar << \textcolor{stringliteral}{" variance, was zero. This will be replaced with a small value to maintain filter "}}
\DoxyCodeLine{2280                        \textcolor{stringliteral}{"stability, but should be corrected at the message origin node."};}
\DoxyCodeLine{2281 }
\DoxyCodeLine{2282             \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a8266b1436e1907c160d8c73a920e806c}{addDiagnostic}}(diagnostic\_msgs::DiagnosticStatus::WARN,}
\DoxyCodeLine{2283                           topicName + \textcolor{stringliteral}{"\_covariance"},}
\DoxyCodeLine{2284                           stream.str(),}
\DoxyCodeLine{2285                           \textcolor{keyword}{false});}
\DoxyCodeLine{2286           \}}
\DoxyCodeLine{2287           \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (updateVector[i] \&\& i == j \&\& covariance(i, j) < 0)}
\DoxyCodeLine{2288           \{}
\DoxyCodeLine{2289             std::stringstream stream;}
\DoxyCodeLine{2290             stream << \textcolor{stringliteral}{"The covariance at position ("} << dimension * i + j <<}
\DoxyCodeLine{2291                       \textcolor{stringliteral}{"), which corresponds to "} << iVar << \textcolor{stringliteral}{" variance, was negative. This will be replaced with a "}}
\DoxyCodeLine{2292                       \textcolor{stringliteral}{"small positive value to maintain filter stability, but should be corrected at the message "}}
\DoxyCodeLine{2293                       \textcolor{stringliteral}{"origin node."};}
\DoxyCodeLine{2294 }
\DoxyCodeLine{2295             \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a8266b1436e1907c160d8c73a920e806c}{addDiagnostic}}(diagnostic\_msgs::DiagnosticStatus::WARN,}
\DoxyCodeLine{2296                           topicName + \textcolor{stringliteral}{"\_covariance"},}
\DoxyCodeLine{2297                           stream.str(),}
\DoxyCodeLine{2298                           \textcolor{keyword}{false});}
\DoxyCodeLine{2299           \}}
\DoxyCodeLine{2300         \}}
\DoxyCodeLine{2301       \}}
\DoxyCodeLine{2302     \}}
\DoxyCodeLine{2303   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a54eb6cf70f939ed188fa051c0dc50c97}\label{classRobotLocalization_1_1RosFilter_a54eb6cf70f939ed188fa051c0dc50c97}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!copyCovariance@{copyCovariance}}
\index{copyCovariance@{copyCovariance}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{copyCovariance()}{copyCovariance()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::copy\+Covariance (\begin{DoxyParamCaption}\item[{const Eigen\+::\+Matrix\+Xd \&}]{covariance,  }\item[{double $\ast$}]{arr,  }\item[{const size\+\_\+t}]{dimension }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}



Utility method for copying covariances from Eigen matrices to R\+OS covariance arrays. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em covariance} & -\/ The source matrix for the covariance data \\
\hline
\mbox{\texttt{ in}}  & {\em arr} & -\/ The destination array \\
\hline
\mbox{\texttt{ in}}  & {\em dimension} & -\/ The number of values to copy \\
\hline
\end{DoxyParams}


Definition at line 2306 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{2309   \{}
\DoxyCodeLine{2310     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < dimension; i++)}
\DoxyCodeLine{2311     \{}
\DoxyCodeLine{2312       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = 0; j < dimension; j++)}
\DoxyCodeLine{2313       \{}
\DoxyCodeLine{2314         arr[dimension * i + j] = covariance(i, j);}
\DoxyCodeLine{2315       \}}
\DoxyCodeLine{2316     \}}
\DoxyCodeLine{2317   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a83c63cecbddfda272d9905c337b4ef4d}\label{classRobotLocalization_1_1RosFilter_a83c63cecbddfda272d9905c337b4ef4d}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!enableFilterSrvCallback@{enableFilterSrvCallback}}
\index{enableFilterSrvCallback@{enableFilterSrvCallback}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{enableFilterSrvCallback()}{enableFilterSrvCallback()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::enable\+Filter\+Srv\+Callback (\begin{DoxyParamCaption}\item[{std\+\_\+srvs\+::\+Empty\+::\+Request \&}]{,  }\item[{std\+\_\+srvs\+::\+Empty\+::\+Response \&}]{ }\end{DoxyParamCaption})}



Service callback for manually enable the filter. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em request} & -\/ N/A \\
\hline
\mbox{\texttt{ out}}  & {\em response} & -\/ N/A \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
boolean true if successful, false if not 
\end{DoxyReturn}


Definition at line 2064 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{2066   \{}
\DoxyCodeLine{2067     RF\_DEBUG(\textcolor{stringliteral}{"\(\backslash\)n["} << ros::this\_node::getName() << \textcolor{stringliteral}{":]"} << \textcolor{stringliteral}{" -\/-\/-\/-\/-\/-\/ /RosFilter::enableFilterSrvCallback -\/-\/-\/-\/-\/-\/\(\backslash\)n"});}
\DoxyCodeLine{2068     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a5da2ab5cea26ee0545447a7643523d1b}{enabled\_}})}
\DoxyCodeLine{2069     \{}
\DoxyCodeLine{2070       ROS\_WARN\_STREAM(\textcolor{stringliteral}{"["} << ros::this\_node::getName() << \textcolor{stringliteral}{":] Asking for enabling filter service, but the filter was "}}
\DoxyCodeLine{2071         \textcolor{stringliteral}{"already enabled! Use param disabled\_at\_startup."});}
\DoxyCodeLine{2072     \}}
\DoxyCodeLine{2073     \textcolor{keywordflow}{else}}
\DoxyCodeLine{2074     \{}
\DoxyCodeLine{2075       ROS\_INFO\_STREAM(\textcolor{stringliteral}{"["} << ros::this\_node::getName() << \textcolor{stringliteral}{":] Enabling filter..."});}
\DoxyCodeLine{2076       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a5da2ab5cea26ee0545447a7643523d1b}{enabled\_}} = \textcolor{keyword}{true};}
\DoxyCodeLine{2077     \}}
\DoxyCodeLine{2078     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{2079   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a6f69cfe0fd2fea54446e4895b14c4c88}\label{classRobotLocalization_1_1RosFilter_a6f69cfe0fd2fea54446e4895b14c4c88}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!enqueueMeasurement@{enqueueMeasurement}}
\index{enqueueMeasurement@{enqueueMeasurement}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{enqueueMeasurement()}{enqueueMeasurement()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::enqueue\+Measurement (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{topic\+Name,  }\item[{const Eigen\+::\+Vector\+Xd \&}]{measurement,  }\item[{const Eigen\+::\+Matrix\+Xd \&}]{measurement\+Covariance,  }\item[{const std\+::vector$<$ int $>$ \&}]{update\+Vector,  }\item[{const double}]{mahalanobis\+Thresh,  }\item[{const ros\+::\+Time \&}]{time }\end{DoxyParamCaption})}



Adds a measurement to the queue of measurements to be processed. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em topic\+Name} & -\/ The name of the measurement source (only used for debugging) \\
\hline
\mbox{\texttt{ in}}  & {\em measurement} & -\/ The measurement to enqueue \\
\hline
\mbox{\texttt{ in}}  & {\em measurement\+Covariance} & -\/ The covariance of the measurement \\
\hline
\mbox{\texttt{ in}}  & {\em update\+Vector} & -\/ The boolean vector that specifies which variables to update from this measurement \\
\hline
\mbox{\texttt{ in}}  & {\em mahalanobis\+Thresh} & -\/ Threshold, expressed as a Mahalanobis distance, for outlier rejection \\
\hline
\mbox{\texttt{ in}}  & {\em time} & -\/ The time of arrival (in seconds) \\
\hline
\end{DoxyParams}


Definition at line 318 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{324   \{}
\DoxyCodeLine{325     MeasurementPtr meas = MeasurementPtr(\textcolor{keyword}{new} Measurement());}
\DoxyCodeLine{326 }
\DoxyCodeLine{327     meas-\/>topicName\_ = topicName;}
\DoxyCodeLine{328     meas-\/>measurement\_ = measurement;}
\DoxyCodeLine{329     meas-\/>covariance\_ = measurementCovariance;}
\DoxyCodeLine{330     meas-\/>updateVector\_ = updateVector;}
\DoxyCodeLine{331     meas-\/>time\_ = time.toSec();}
\DoxyCodeLine{332     meas-\/>mahalanobisThresh\_ = mahalanobisThresh;}
\DoxyCodeLine{333     meas-\/>latestControl\_ = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a1dc8ec7162549a3f935159fc4df143d6}{latestControl\_}};}
\DoxyCodeLine{334     meas-\/>latestControlTime\_ = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a94ccac9ce6b71ee1a36b19a8ba33b0ac}{latestControlTime\_}}.toSec();}
\DoxyCodeLine{335     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a233bcdab40b3b0d7db316ffd0c09f2ce}{measurementQueue\_}}.push(meas);}
\DoxyCodeLine{336   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a4585957fbc3239e559eb509921f28a8f}\label{classRobotLocalization_1_1RosFilter_a4585957fbc3239e559eb509921f28a8f}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!forceTwoD@{forceTwoD}}
\index{forceTwoD@{forceTwoD}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{forceTwoD()}{forceTwoD()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::force\+TwoD (\begin{DoxyParamCaption}\item[{Eigen\+::\+Vector\+Xd \&}]{measurement,  }\item[{Eigen\+::\+Matrix\+Xd \&}]{measurement\+Covariance,  }\item[{std\+::vector$<$ int $>$ \&}]{update\+Vector }\end{DoxyParamCaption})}



Method for zeroing out 3D variables within measurements. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ out}}  & {\em measurement} & -\/ The measurement whose 3D variables will be zeroed out \\
\hline
\mbox{\texttt{ out}}  & {\em measurement\+Covariance} & -\/ The covariance of the measurement \\
\hline
\mbox{\texttt{ out}}  & {\em update\+Vector} & -\/ The boolean update vector of the measurement\\
\hline
\end{DoxyParams}
If we\textquotesingle{}re in 2D mode, then for every measurement from every sensor, we call this. It sets the 3D variables to 0, gives those variables tiny variances, and sets their update\+Vector values to 1. 

Definition at line 339 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{342   \{}
\DoxyCodeLine{343     measurement(StateMemberZ) = 0.0;}
\DoxyCodeLine{344     measurement(StateMemberRoll) = 0.0;}
\DoxyCodeLine{345     measurement(StateMemberPitch) = 0.0;}
\DoxyCodeLine{346     measurement(StateMemberVz) = 0.0;}
\DoxyCodeLine{347     measurement(StateMemberVroll) = 0.0;}
\DoxyCodeLine{348     measurement(StateMemberVpitch) = 0.0;}
\DoxyCodeLine{349     measurement(StateMemberAz) = 0.0;}
\DoxyCodeLine{350 }
\DoxyCodeLine{351     measurementCovariance(StateMemberZ, StateMemberZ) = 1e-\/6;}
\DoxyCodeLine{352     measurementCovariance(StateMemberRoll, StateMemberRoll) = 1e-\/6;}
\DoxyCodeLine{353     measurementCovariance(StateMemberPitch, StateMemberPitch) = 1e-\/6;}
\DoxyCodeLine{354     measurementCovariance(StateMemberVz, StateMemberVz) = 1e-\/6;}
\DoxyCodeLine{355     measurementCovariance(StateMemberVroll, StateMemberVroll) = 1e-\/6;}
\DoxyCodeLine{356     measurementCovariance(StateMemberVpitch, StateMemberVpitch) = 1e-\/6;}
\DoxyCodeLine{357     measurementCovariance(StateMemberAz, StateMemberAz) = 1e-\/6;}
\DoxyCodeLine{358 }
\DoxyCodeLine{359     updateVector[StateMemberZ] = 1;}
\DoxyCodeLine{360     updateVector[StateMemberRoll] = 1;}
\DoxyCodeLine{361     updateVector[StateMemberPitch] = 1;}
\DoxyCodeLine{362     updateVector[StateMemberVz] = 1;}
\DoxyCodeLine{363     updateVector[StateMemberVroll] = 1;}
\DoxyCodeLine{364     updateVector[StateMemberVpitch] = 1;}
\DoxyCodeLine{365     updateVector[StateMemberAz] = 1;}
\DoxyCodeLine{366   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a62f8eabae93ec1ca823b1b4ce65faa68}\label{classRobotLocalization_1_1RosFilter_a62f8eabae93ec1ca823b1b4ce65faa68}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!getFilteredAccelMessage@{getFilteredAccelMessage}}
\index{getFilteredAccelMessage@{getFilteredAccelMessage}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{getFilteredAccelMessage()}{getFilteredAccelMessage()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::get\+Filtered\+Accel\+Message (\begin{DoxyParamCaption}\item[{geometry\+\_\+msgs\+::\+Accel\+With\+Covariance\+Stamped \&}]{message }\end{DoxyParamCaption})}



Retrieves the E\+KF\textquotesingle{}s acceleration output for broadcasting. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ out}}  & {\em message} & -\/ The standard R\+OS acceleration message to be filled \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true if the filter is initialized, false otherwise 
\end{DoxyReturn}
Fill out the accel\+\_\+msg

Definition at line 428 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{429   \{}
\DoxyCodeLine{430     \textcolor{comment}{// If the filter has received a measurement at some point...}}
\DoxyCodeLine{431     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.getInitializedStatus())}
\DoxyCodeLine{432     \{}
\DoxyCodeLine{433       \textcolor{comment}{// Grab our current state and covariance estimates}}
\DoxyCodeLine{434       \textcolor{keyword}{const} Eigen::VectorXd \&state = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.getState();}
\DoxyCodeLine{435       \textcolor{keyword}{const} Eigen::MatrixXd \&estimateErrorCovariance = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.getEstimateErrorCovariance();}
\DoxyCodeLine{436 }
\DoxyCodeLine{438       message.accel.accel.linear.x = state(StateMemberAx);}
\DoxyCodeLine{439       message.accel.accel.linear.y = state(StateMemberAy);}
\DoxyCodeLine{440       message.accel.accel.linear.z = state(StateMemberAz);}
\DoxyCodeLine{441 }
\DoxyCodeLine{442       \textcolor{comment}{// Fill the covariance (only the left-\/upper matrix since we are not estimating}}
\DoxyCodeLine{443       \textcolor{comment}{// the rotational accelerations arround the axes}}
\DoxyCodeLine{444       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < ACCELERATION\_SIZE; i++)}
\DoxyCodeLine{445       \{}
\DoxyCodeLine{446         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = 0; j < ACCELERATION\_SIZE; j++)}
\DoxyCodeLine{447         \{}
\DoxyCodeLine{448           \textcolor{comment}{// We use the POSE\_SIZE since the accel cov matrix of ROS is 6x6}}
\DoxyCodeLine{449           message.accel.covariance[POSE\_SIZE * i + j] =}
\DoxyCodeLine{450               estimateErrorCovariance(i + POSITION\_A\_OFFSET, j + POSITION\_A\_OFFSET);}
\DoxyCodeLine{451         \}}
\DoxyCodeLine{452       \}}
\DoxyCodeLine{453 }
\DoxyCodeLine{454       \textcolor{comment}{// Fill header information}}
\DoxyCodeLine{455       message.header.stamp = ros::Time(\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.getLastMeasurementTime());}
\DoxyCodeLine{456       message.header.frame\_id = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a4b00cc26b36b9039f120eecf7a7d4ab1}{baseLinkOutputFrameId\_}};}
\DoxyCodeLine{457     \}}
\DoxyCodeLine{458 }
\DoxyCodeLine{459     \textcolor{keywordflow}{return} \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.getInitializedStatus();}
\DoxyCodeLine{460   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a2bfbf2f272e49f7727adbf180ba00356}\label{classRobotLocalization_1_1RosFilter_a2bfbf2f272e49f7727adbf180ba00356}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!getFilteredOdometryMessage@{getFilteredOdometryMessage}}
\index{getFilteredOdometryMessage@{getFilteredOdometryMessage}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{getFilteredOdometryMessage()}{getFilteredOdometryMessage()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::get\+Filtered\+Odometry\+Message (\begin{DoxyParamCaption}\item[{nav\+\_\+msgs\+::\+Odometry \&}]{message }\end{DoxyParamCaption})}



Retrieves the E\+KF\textquotesingle{}s output for broadcasting. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ out}}  & {\em message} & -\/ The standard R\+OS odometry message to be filled \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true if the filter is initialized, false otherwise 
\end{DoxyReturn}


Definition at line 369 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{370   \{}
\DoxyCodeLine{371     \textcolor{comment}{// If the filter has received a measurement at some point...}}
\DoxyCodeLine{372     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.getInitializedStatus())}
\DoxyCodeLine{373     \{}
\DoxyCodeLine{374       \textcolor{comment}{// Grab our current state and covariance estimates}}
\DoxyCodeLine{375       \textcolor{keyword}{const} Eigen::VectorXd \&state = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.getState();}
\DoxyCodeLine{376       \textcolor{keyword}{const} Eigen::MatrixXd \&estimateErrorCovariance = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.getEstimateErrorCovariance();}
\DoxyCodeLine{377 }
\DoxyCodeLine{378       \textcolor{comment}{// Convert from roll, pitch, and yaw back to quaternion for}}
\DoxyCodeLine{379       \textcolor{comment}{// orientation values}}
\DoxyCodeLine{380       tf2::Quaternion quat;}
\DoxyCodeLine{381       quat.setRPY(state(StateMemberRoll), state(StateMemberPitch), state(StateMemberYaw));}
\DoxyCodeLine{382 }
\DoxyCodeLine{383       \textcolor{comment}{// Fill out the message}}
\DoxyCodeLine{384       message.pose.pose.position.x = state(StateMemberX);}
\DoxyCodeLine{385       message.pose.pose.position.y = state(StateMemberY);}
\DoxyCodeLine{386       message.pose.pose.position.z = state(StateMemberZ);}
\DoxyCodeLine{387       message.pose.pose.orientation.x = quat.x();}
\DoxyCodeLine{388       message.pose.pose.orientation.y = quat.y();}
\DoxyCodeLine{389       message.pose.pose.orientation.z = quat.z();}
\DoxyCodeLine{390       message.pose.pose.orientation.w = quat.w();}
\DoxyCodeLine{391       message.twist.twist.linear.x = state(StateMemberVx);}
\DoxyCodeLine{392       message.twist.twist.linear.y = state(StateMemberVy);}
\DoxyCodeLine{393       message.twist.twist.linear.z = state(StateMemberVz);}
\DoxyCodeLine{394       message.twist.twist.angular.x = state(StateMemberVroll);}
\DoxyCodeLine{395       message.twist.twist.angular.y = state(StateMemberVpitch);}
\DoxyCodeLine{396       message.twist.twist.angular.z = state(StateMemberVyaw);}
\DoxyCodeLine{397 }
\DoxyCodeLine{398       \textcolor{comment}{// Our covariance matrix layout doesn't quite match}}
\DoxyCodeLine{399       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < POSE\_SIZE; i++)}
\DoxyCodeLine{400       \{}
\DoxyCodeLine{401         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = 0; j < POSE\_SIZE; j++)}
\DoxyCodeLine{402         \{}
\DoxyCodeLine{403           message.pose.covariance[POSE\_SIZE * i + j] = estimateErrorCovariance(i, j);}
\DoxyCodeLine{404         \}}
\DoxyCodeLine{405       \}}
\DoxyCodeLine{406 }
\DoxyCodeLine{407       \textcolor{comment}{// POSE\_SIZE and TWIST\_SIZE are currently the same size, but we can spare a few}}
\DoxyCodeLine{408       \textcolor{comment}{// cycles to be meticulous and not index a twist covariance array on the size of}}
\DoxyCodeLine{409       \textcolor{comment}{// a pose covariance array}}
\DoxyCodeLine{410       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < TWIST\_SIZE; i++)}
\DoxyCodeLine{411       \{}
\DoxyCodeLine{412         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = 0; j < TWIST\_SIZE; j++)}
\DoxyCodeLine{413         \{}
\DoxyCodeLine{414           message.twist.covariance[TWIST\_SIZE * i + j] =}
\DoxyCodeLine{415               estimateErrorCovariance(i + POSITION\_V\_OFFSET, j + POSITION\_V\_OFFSET);}
\DoxyCodeLine{416         \}}
\DoxyCodeLine{417       \}}
\DoxyCodeLine{418 }
\DoxyCodeLine{419       message.header.stamp = ros::Time(\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.getLastMeasurementTime());}
\DoxyCodeLine{420       message.header.frame\_id = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a37c23d6c10a630fe33e74376898fc5c8}{worldFrameId\_}};}
\DoxyCodeLine{421       message.child\_frame\_id = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a4b00cc26b36b9039f120eecf7a7d4ab1}{baseLinkOutputFrameId\_}};}
\DoxyCodeLine{422     \}}
\DoxyCodeLine{423 }
\DoxyCodeLine{424     \textcolor{keywordflow}{return} \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.getInitializedStatus();}
\DoxyCodeLine{425   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_aa3a763add884bc19e741a69d0720b27e}\label{classRobotLocalization_1_1RosFilter_aa3a763add884bc19e741a69d0720b27e}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!imuCallback@{imuCallback}}
\index{imuCallback@{imuCallback}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{imuCallback()}{imuCallback()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::imu\+Callback (\begin{DoxyParamCaption}\item[{const sensor\+\_\+msgs\+::\+Imu\+::\+Const\+Ptr \&}]{msg,  }\item[{const std\+::string \&}]{topic\+Name,  }\item[{const \mbox{\hyperlink{structRobotLocalization_1_1CallbackData}{Callback\+Data}} \&}]{pose\+Callback\+Data,  }\item[{const \mbox{\hyperlink{structRobotLocalization_1_1CallbackData}{Callback\+Data}} \&}]{twist\+Callback\+Data,  }\item[{const \mbox{\hyperlink{structRobotLocalization_1_1CallbackData}{Callback\+Data}} \&}]{accel\+Callback\+Data }\end{DoxyParamCaption})}



Callback method for receiving all I\+MU messages. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em msg} & -\/ The R\+OS I\+MU message to take in. \\
\hline
\mbox{\texttt{ in}}  & {\em topic\+Name} & -\/ The topic name for the I\+MU message (only used for debug output) \\
\hline
\mbox{\texttt{ in}}  & {\em pose\+Callback\+Data} & -\/ Relevant static callback data for orientation variables \\
\hline
\mbox{\texttt{ in}}  & {\em twist\+Callback\+Data} & -\/ Relevant static callback data for angular velocity variables \\
\hline
\mbox{\texttt{ in}}  & {\em accel\+Callback\+Data} & -\/ Relevant static callback data for linear acceleration variables\\
\hline
\end{DoxyParams}
This method separates out the orientation, angular velocity, and linear acceleration data and passed each on to its respective callback. 

Definition at line 463 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{468   \{}
\DoxyCodeLine{469     RF\_DEBUG(\textcolor{stringliteral}{"-\/-\/-\/-\/-\/-\/ RosFilter::imuCallback ("} << topicName << \textcolor{stringliteral}{") -\/-\/-\/-\/-\/-\/\(\backslash\)n"} << \textcolor{stringliteral}{"IMU message:\(\backslash\)n"} << *msg);}
\DoxyCodeLine{470 }
\DoxyCodeLine{471     \textcolor{comment}{// If we've just reset the filter, then we want to ignore any messages}}
\DoxyCodeLine{472     \textcolor{comment}{// that arrive with an older timestamp}}
\DoxyCodeLine{473     \textcolor{keywordflow}{if} (msg-\/>header.stamp <= \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aa9df5f56cfb6d02a4bc22c8b68ad115f}{lastSetPoseTime\_}})}
\DoxyCodeLine{474     \{}
\DoxyCodeLine{475       std::stringstream stream;}
\DoxyCodeLine{476       stream << \textcolor{stringliteral}{"The "} << topicName << \textcolor{stringliteral}{" message has a timestamp equal to or before the last filter reset, "} <<}
\DoxyCodeLine{477                 \textcolor{stringliteral}{"this message will be ignored. This may indicate an empty or bad timestamp. (message time: "} <<}
\DoxyCodeLine{478                 msg-\/>header.stamp.toSec() << \textcolor{stringliteral}{")"};}
\DoxyCodeLine{479       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a8266b1436e1907c160d8c73a920e806c}{addDiagnostic}}(diagnostic\_msgs::DiagnosticStatus::WARN,}
\DoxyCodeLine{480                     topicName + \textcolor{stringliteral}{"\_timestamp"},}
\DoxyCodeLine{481                     stream.str(),}
\DoxyCodeLine{482                     \textcolor{keyword}{false});}
\DoxyCodeLine{483       RF\_DEBUG(\textcolor{stringliteral}{"Received message that preceded the most recent pose reset. Ignoring..."});}
\DoxyCodeLine{484 }
\DoxyCodeLine{485       \textcolor{keywordflow}{return};}
\DoxyCodeLine{486     \}}
\DoxyCodeLine{487 }
\DoxyCodeLine{488     \textcolor{comment}{// As with the odometry message, we can separate out the pose-\/ and twist-\/related variables}}
\DoxyCodeLine{489     \textcolor{comment}{// in the IMU message and pass them to the pose and twist callbacks (filters)}}
\DoxyCodeLine{490     \textcolor{keywordflow}{if} (poseCallbackData.updateSum\_ > 0)}
\DoxyCodeLine{491     \{}
\DoxyCodeLine{492       \textcolor{comment}{// Per the IMU message specification, if the IMU does not provide orientation,}}
\DoxyCodeLine{493       \textcolor{comment}{// then its first covariance value should be set to -\/1, and we should ignore}}
\DoxyCodeLine{494       \textcolor{comment}{// that portion of the message. robot\_localization allows users to explicitly}}
\DoxyCodeLine{495       \textcolor{comment}{// ignore data using its parameters, but we should also be compliant with}}
\DoxyCodeLine{496       \textcolor{comment}{// message specs.}}
\DoxyCodeLine{497       \textcolor{keywordflow}{if} (::fabs(msg-\/>orientation\_covariance[0] + 1) < 1e-\/9)}
\DoxyCodeLine{498       \{}
\DoxyCodeLine{499         RF\_DEBUG(\textcolor{stringliteral}{"Received IMU message with -\/1 as its first covariance value for orientation. "}}
\DoxyCodeLine{500                  \textcolor{stringliteral}{"Ignoring orientation..."});}
\DoxyCodeLine{501       \}}
\DoxyCodeLine{502       \textcolor{keywordflow}{else}}
\DoxyCodeLine{503       \{}
\DoxyCodeLine{504         \textcolor{comment}{// Extract the pose (orientation) data, pass it to its filter}}
\DoxyCodeLine{505         geometry\_msgs::PoseWithCovarianceStamped *posPtr = \textcolor{keyword}{new} geometry\_msgs::PoseWithCovarianceStamped();}
\DoxyCodeLine{506         posPtr-\/>header = msg-\/>header;}
\DoxyCodeLine{507         posPtr-\/>pose.pose.orientation = msg-\/>orientation;}
\DoxyCodeLine{508 }
\DoxyCodeLine{509         \textcolor{comment}{// Copy the covariance for roll, pitch, and yaw}}
\DoxyCodeLine{510         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < ORIENTATION\_SIZE; i++)}
\DoxyCodeLine{511         \{}
\DoxyCodeLine{512           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = 0; j < ORIENTATION\_SIZE; j++)}
\DoxyCodeLine{513           \{}
\DoxyCodeLine{514             posPtr-\/>pose.covariance[POSE\_SIZE * (i + ORIENTATION\_SIZE) + (j + ORIENTATION\_SIZE)] =}
\DoxyCodeLine{515                 msg-\/>orientation\_covariance[ORIENTATION\_SIZE * i + j];}
\DoxyCodeLine{516           \}}
\DoxyCodeLine{517         \}}
\DoxyCodeLine{518 }
\DoxyCodeLine{519         \textcolor{comment}{// IMU data gets handled a bit differently, since the message is ambiguous and has only a single frame\_id,}}
\DoxyCodeLine{520         \textcolor{comment}{// even though the data in it is reported in two different frames. As we assume users will specify a base\_link}}
\DoxyCodeLine{521         \textcolor{comment}{// to imu transform, we make the target frame baseLinkFrameId\_ and tell the poseCallback that it is working}}
\DoxyCodeLine{522         \textcolor{comment}{// with IMU data. This will cause it to apply different logic to the data.}}
\DoxyCodeLine{523         geometry\_msgs::PoseWithCovarianceStampedConstPtr pptr(posPtr);}
\DoxyCodeLine{524         \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a54e73dcf610e672435582a72dfae57eb}{poseCallback}}(pptr, poseCallbackData, \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6c0cfc2c5d47061bf2ae272b7532b51b}{baseLinkFrameId\_}}, \textcolor{keyword}{true});}
\DoxyCodeLine{525       \}}
\DoxyCodeLine{526     \}}
\DoxyCodeLine{527 }
\DoxyCodeLine{528     \textcolor{keywordflow}{if} (twistCallbackData.updateSum\_ > 0)}
\DoxyCodeLine{529     \{}
\DoxyCodeLine{530       \textcolor{comment}{// Ignore rotational velocity if the first covariance value is -\/1}}
\DoxyCodeLine{531       \textcolor{keywordflow}{if} (::fabs(msg-\/>angular\_velocity\_covariance[0] + 1) < 1e-\/9)}
\DoxyCodeLine{532       \{}
\DoxyCodeLine{533         RF\_DEBUG(\textcolor{stringliteral}{"Received IMU message with -\/1 as its first covariance value for angular "}}
\DoxyCodeLine{534                  \textcolor{stringliteral}{"velocity. Ignoring angular velocity..."});}
\DoxyCodeLine{535       \}}
\DoxyCodeLine{536       \textcolor{keywordflow}{else}}
\DoxyCodeLine{537       \{}
\DoxyCodeLine{538         \textcolor{comment}{// Repeat for velocity}}
\DoxyCodeLine{539         geometry\_msgs::TwistWithCovarianceStamped *twistPtr = \textcolor{keyword}{new} geometry\_msgs::TwistWithCovarianceStamped();}
\DoxyCodeLine{540         twistPtr-\/>header = msg-\/>header;}
\DoxyCodeLine{541         twistPtr-\/>twist.twist.angular = msg-\/>angular\_velocity;}
\DoxyCodeLine{542 }
\DoxyCodeLine{543         \textcolor{comment}{// Copy the covariance}}
\DoxyCodeLine{544         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < ORIENTATION\_SIZE; i++)}
\DoxyCodeLine{545         \{}
\DoxyCodeLine{546           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = 0; j < ORIENTATION\_SIZE; j++)}
\DoxyCodeLine{547           \{}
\DoxyCodeLine{548             twistPtr-\/>twist.covariance[TWIST\_SIZE * (i + ORIENTATION\_SIZE) + (j + ORIENTATION\_SIZE)] =}
\DoxyCodeLine{549               msg-\/>angular\_velocity\_covariance[ORIENTATION\_SIZE * i + j];}
\DoxyCodeLine{550           \}}
\DoxyCodeLine{551         \}}
\DoxyCodeLine{552 }
\DoxyCodeLine{553         geometry\_msgs::TwistWithCovarianceStampedConstPtr tptr(twistPtr);}
\DoxyCodeLine{554         \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aeec53ee745d41ed8e342c9688a4a3165}{twistCallback}}(tptr, twistCallbackData, \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6c0cfc2c5d47061bf2ae272b7532b51b}{baseLinkFrameId\_}});}
\DoxyCodeLine{555       \}}
\DoxyCodeLine{556     \}}
\DoxyCodeLine{557 }
\DoxyCodeLine{558     \textcolor{keywordflow}{if} (accelCallbackData.updateSum\_ > 0)}
\DoxyCodeLine{559     \{}
\DoxyCodeLine{560       \textcolor{comment}{// Ignore linear acceleration if the first covariance value is -\/1}}
\DoxyCodeLine{561       \textcolor{keywordflow}{if} (::fabs(msg-\/>linear\_acceleration\_covariance[0] + 1) < 1e-\/9)}
\DoxyCodeLine{562       \{}
\DoxyCodeLine{563         RF\_DEBUG(\textcolor{stringliteral}{"Received IMU message with -\/1 as its first covariance value for linear "}}
\DoxyCodeLine{564                  \textcolor{stringliteral}{"acceleration. Ignoring linear acceleration..."});}
\DoxyCodeLine{565       \}}
\DoxyCodeLine{566       \textcolor{keywordflow}{else}}
\DoxyCodeLine{567       \{}
\DoxyCodeLine{568         \textcolor{comment}{// Pass the message on}}
\DoxyCodeLine{569         \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ae5643fce575cd46f5cd77becf29d04ad}{accelerationCallback}}(msg, accelCallbackData, \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6c0cfc2c5d47061bf2ae272b7532b51b}{baseLinkFrameId\_}});}
\DoxyCodeLine{570       \}}
\DoxyCodeLine{571     \}}
\DoxyCodeLine{572 }
\DoxyCodeLine{573     RF\_DEBUG(\textcolor{stringliteral}{"\(\backslash\)n-\/-\/-\/-\/-\/ /RosFilter::imuCallback ("} << topicName << \textcolor{stringliteral}{") -\/-\/-\/-\/-\/-\/\(\backslash\)n"});}
\DoxyCodeLine{574   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a0408a310dcd78472013e174c4f26061b}\label{classRobotLocalization_1_1RosFilter_a0408a310dcd78472013e174c4f26061b}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!integrateMeasurements@{integrateMeasurements}}
\index{integrateMeasurements@{integrateMeasurements}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{integrateMeasurements()}{integrateMeasurements()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::integrate\+Measurements (\begin{DoxyParamCaption}\item[{const ros\+::\+Time \&}]{current\+Time }\end{DoxyParamCaption})}



Processes all measurements in the measurement queue, in temporal order. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em current\+Time} & -\/ The time at which to carry out integration (the current time) \\
\hline
\end{DoxyParams}


Definition at line 577 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{578   \{}
\DoxyCodeLine{579     \textcolor{keyword}{const} \textcolor{keywordtype}{double} currentTimeSec = currentTime.toSec();}
\DoxyCodeLine{580 }
\DoxyCodeLine{581     RF\_DEBUG(\textcolor{stringliteral}{"-\/-\/-\/-\/-\/-\/ RosFilter::integrateMeasurements -\/-\/-\/-\/-\/-\/\(\backslash\)n\(\backslash\)n"}}
\DoxyCodeLine{582              \textcolor{stringliteral}{"Integration time is "} << std::setprecision(20) << currentTimeSec << \textcolor{stringliteral}{"\(\backslash\)n"}}
\DoxyCodeLine{583              << \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a233bcdab40b3b0d7db316ffd0c09f2ce}{measurementQueue\_}}.size() << \textcolor{stringliteral}{" measurements in queue.\(\backslash\)n"});}
\DoxyCodeLine{584 }
\DoxyCodeLine{585     \textcolor{keywordtype}{bool} predictToCurrentTime = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_add0c677e8eb87145755b5cd18718a45a}{predictToCurrentTime\_}};}
\DoxyCodeLine{586 }
\DoxyCodeLine{587     \textcolor{comment}{// If we have any measurements in the queue, process them}}
\DoxyCodeLine{588     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a233bcdab40b3b0d7db316ffd0c09f2ce}{measurementQueue\_}}.empty())}
\DoxyCodeLine{589     \{}
\DoxyCodeLine{590       \textcolor{comment}{// Check if the first measurement we're going to process is older than the filter's last measurement.}}
\DoxyCodeLine{591       \textcolor{comment}{// This means we have received an out-\/of-\/sequence message (one with an old timestamp), and we need to}}
\DoxyCodeLine{592       \textcolor{comment}{// revert both the filter state and measurement queue to the first state that preceded the time stamp}}
\DoxyCodeLine{593       \textcolor{comment}{// of our first measurement.}}
\DoxyCodeLine{594       \textcolor{keyword}{const} MeasurementPtr\& firstMeasurement = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a233bcdab40b3b0d7db316ffd0c09f2ce}{measurementQueue\_}}.top();}
\DoxyCodeLine{595       \textcolor{keywordtype}{int} restoredMeasurementCount = 0;}
\DoxyCodeLine{596       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ab8779e25f3390bd1ddeba10401164a2c}{smoothLaggedData\_}} \&\& firstMeasurement-\/>time\_ < \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.getLastMeasurementTime())}
\DoxyCodeLine{597       \{}
\DoxyCodeLine{598         RF\_DEBUG(\textcolor{stringliteral}{"Received a measurement that was "} << \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.getLastMeasurementTime() -\/ firstMeasurement-\/>time\_ <<}
\DoxyCodeLine{599                  \textcolor{stringliteral}{" seconds in the past. Reverting filter state and measurement queue..."});}
\DoxyCodeLine{600 }
\DoxyCodeLine{601         \textcolor{keywordtype}{int} originalCount = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a233bcdab40b3b0d7db316ffd0c09f2ce}{measurementQueue\_}}.size());}
\DoxyCodeLine{602         \textcolor{keyword}{const} \textcolor{keywordtype}{double} firstMeasurementTime =  firstMeasurement-\/>time\_;}
\DoxyCodeLine{603         \textcolor{keyword}{const} std::string firstMeasurementTopic =  firstMeasurement-\/>topicName\_;}
\DoxyCodeLine{604         \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a8ea96b4c2cca39358e3c6e90cfe315bd}{revertTo}}(firstMeasurementTime -\/ 1e-\/9))  \textcolor{comment}{// revertTo may invalidate firstMeasurement}}
\DoxyCodeLine{605         \{}
\DoxyCodeLine{606           RF\_DEBUG(\textcolor{stringliteral}{"ERROR: history interval is too small to revert to time "} << firstMeasurementTime << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{607           ROS\_WARN\_STREAM\_DELAYED\_THROTTLE(\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a84b03bc70e9979c28deb044c545ba287}{historyLength\_}}, \textcolor{stringliteral}{"Received old measurement for topic "} <<}
\DoxyCodeLine{608             firstMeasurementTopic << \textcolor{stringliteral}{", but history interval is insufficiently sized. Measurement time is "} <<}
\DoxyCodeLine{609             std::setprecision(20) << firstMeasurementTime << \textcolor{stringliteral}{", current time is "} << currentTime.toSec() <<}
\DoxyCodeLine{610             \textcolor{stringliteral}{", history length is "} << \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a84b03bc70e9979c28deb044c545ba287}{historyLength\_}} << \textcolor{stringliteral}{"."});}
\DoxyCodeLine{611           restoredMeasurementCount = 0;}
\DoxyCodeLine{612         \}}
\DoxyCodeLine{613 }
\DoxyCodeLine{614         restoredMeasurementCount = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a233bcdab40b3b0d7db316ffd0c09f2ce}{measurementQueue\_}}.size()) -\/ originalCount;}
\DoxyCodeLine{615       \}}
\DoxyCodeLine{616 }
\DoxyCodeLine{617       \textcolor{keywordflow}{while} (!\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a233bcdab40b3b0d7db316ffd0c09f2ce}{measurementQueue\_}}.empty() \&\& ros::ok())}
\DoxyCodeLine{618       \{}
\DoxyCodeLine{619         MeasurementPtr measurement = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a233bcdab40b3b0d7db316ffd0c09f2ce}{measurementQueue\_}}.top();}
\DoxyCodeLine{620 }
\DoxyCodeLine{621         \textcolor{comment}{// If we've reached a measurement that has a time later than now, it should wait until a future iteration.}}
\DoxyCodeLine{622         \textcolor{comment}{// Since measurements are stored in a priority queue, all remaining measurements will be in the future.}}
\DoxyCodeLine{623         \textcolor{keywordflow}{if} (measurement-\/>time\_ > currentTime.toSec())}
\DoxyCodeLine{624         \{}
\DoxyCodeLine{625           \textcolor{keywordflow}{break};}
\DoxyCodeLine{626         \}}
\DoxyCodeLine{627 }
\DoxyCodeLine{628         \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a233bcdab40b3b0d7db316ffd0c09f2ce}{measurementQueue\_}}.pop();}
\DoxyCodeLine{629 }
\DoxyCodeLine{630         \textcolor{comment}{// When we receive control messages, we call this directly in the control callback. However, we also associate}}
\DoxyCodeLine{631         \textcolor{comment}{// a control with each sensor message so that we can support lagged smoothing. As we cannot guarantee that the}}
\DoxyCodeLine{632         \textcolor{comment}{// new control callback will fire before a new measurement, we should only perform this operation if we are}}
\DoxyCodeLine{633         \textcolor{comment}{// processing messages from the history. Otherwise, we may get a new measurement, store the "old" latest}}
\DoxyCodeLine{634         \textcolor{comment}{// control, then receive a control, call setControl, and then overwrite that value with this one (i.e., with}}
\DoxyCodeLine{635         \textcolor{comment}{// the "old" control we associated with the measurement).}}
\DoxyCodeLine{636         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a714e2c0386cfa1ec147c52f897852532}{useControl\_}} \&\& restoredMeasurementCount > 0)}
\DoxyCodeLine{637         \{}
\DoxyCodeLine{638           \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.setControl(measurement-\/>latestControl\_, measurement-\/>latestControlTime\_);}
\DoxyCodeLine{639           restoredMeasurementCount-\/-\/;}
\DoxyCodeLine{640         \}}
\DoxyCodeLine{641 }
\DoxyCodeLine{642         \textcolor{comment}{// This will call predict and, if necessary, correct}}
\DoxyCodeLine{643         \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.processMeasurement(*(measurement.get()));}
\DoxyCodeLine{644 }
\DoxyCodeLine{645         \textcolor{comment}{// Store old states and measurements if we're smoothing}}
\DoxyCodeLine{646         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ab8779e25f3390bd1ddeba10401164a2c}{smoothLaggedData\_}})}
\DoxyCodeLine{647         \{}
\DoxyCodeLine{648           \textcolor{comment}{// Invariant still holds: measurementHistoryDeque\_.back().time\_ < measurementQueue\_.top().time\_}}
\DoxyCodeLine{649           \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aeb7a3b61549bad2cc4e84d803c038c5f}{measurementHistory\_}}.push\_back(measurement);}
\DoxyCodeLine{650 }
\DoxyCodeLine{651           \textcolor{comment}{// We should only save the filter state once per unique timstamp}}
\DoxyCodeLine{652           \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a233bcdab40b3b0d7db316ffd0c09f2ce}{measurementQueue\_}}.empty() ||}
\DoxyCodeLine{653               ::fabs(\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a233bcdab40b3b0d7db316ffd0c09f2ce}{measurementQueue\_}}.top()-\/>time\_ -\/ \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.getLastMeasurementTime()) > 1e-\/9)}
\DoxyCodeLine{654           \{}
\DoxyCodeLine{655             \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a0247b864a7b44e5310e7d05e69e41695}{saveFilterState}}(\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}});}
\DoxyCodeLine{656           \}}
\DoxyCodeLine{657         \}}
\DoxyCodeLine{658       \}}
\DoxyCodeLine{659     \}}
\DoxyCodeLine{660     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.getInitializedStatus())}
\DoxyCodeLine{661     \{}
\DoxyCodeLine{662       \textcolor{comment}{// In the event that we don't get any measurements for a long time,}}
\DoxyCodeLine{663       \textcolor{comment}{// we still need to continue to estimate our state. Therefore, we}}
\DoxyCodeLine{664       \textcolor{comment}{// should project the state forward here.}}
\DoxyCodeLine{665       \textcolor{keywordtype}{double} lastUpdateDelta = currentTimeSec -\/ \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.getLastMeasurementTime();}
\DoxyCodeLine{666 }
\DoxyCodeLine{667       \textcolor{comment}{// If we get a large delta, then continuously predict until}}
\DoxyCodeLine{668       \textcolor{keywordflow}{if} (lastUpdateDelta >= \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.getSensorTimeout())}
\DoxyCodeLine{669       \{}
\DoxyCodeLine{670         predictToCurrentTime = \textcolor{keyword}{true};}
\DoxyCodeLine{671 }
\DoxyCodeLine{672         RF\_DEBUG(\textcolor{stringliteral}{"Sensor timeout! Last measurement time was "} << \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.getLastMeasurementTime() <<}
\DoxyCodeLine{673                  \textcolor{stringliteral}{", current time is "} << currentTimeSec <<}
\DoxyCodeLine{674                  \textcolor{stringliteral}{", delta is "} << lastUpdateDelta << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{675       \}}
\DoxyCodeLine{676     \}}
\DoxyCodeLine{677     \textcolor{keywordflow}{else}}
\DoxyCodeLine{678     \{}
\DoxyCodeLine{679       RF\_DEBUG(\textcolor{stringliteral}{"Filter not yet initialized.\(\backslash\)n"});}
\DoxyCodeLine{680     \}}
\DoxyCodeLine{681 }
\DoxyCodeLine{682     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.getInitializedStatus() \&\& predictToCurrentTime)}
\DoxyCodeLine{683     \{}
\DoxyCodeLine{684       \textcolor{keywordtype}{double} lastUpdateDelta = currentTimeSec -\/ \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.getLastMeasurementTime();}
\DoxyCodeLine{685 }
\DoxyCodeLine{686       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.validateDelta(lastUpdateDelta);}
\DoxyCodeLine{687       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.predict(currentTimeSec, lastUpdateDelta);}
\DoxyCodeLine{688 }
\DoxyCodeLine{689       \textcolor{comment}{// Update the last measurement time and last update time}}
\DoxyCodeLine{690       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.setLastMeasurementTime(\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.getLastMeasurementTime() + lastUpdateDelta);}
\DoxyCodeLine{691     \}}
\DoxyCodeLine{692 }
\DoxyCodeLine{693     RF\_DEBUG(\textcolor{stringliteral}{"\(\backslash\)n-\/-\/-\/-\/-\/ /RosFilter::integrateMeasurements -\/-\/-\/-\/-\/-\/\(\backslash\)n"});}
\DoxyCodeLine{694   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a2b54251a0ae492ddf7bbb4112a915968}\label{classRobotLocalization_1_1RosFilter_a2b54251a0ae492ddf7bbb4112a915968}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!loadUpdateConfig@{loadUpdateConfig}}
\index{loadUpdateConfig@{loadUpdateConfig}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{loadUpdateConfig()}{loadUpdateConfig()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
std\+::vector$<$ int $>$ \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::load\+Update\+Config (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{topic\+Name }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}



Loads fusion settings from the config file. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em topic\+Name} & -\/ The name of the topic for which to load settings \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The boolean vector of update settings for each variable for this topic 
\end{DoxyReturn}


Definition at line 2320 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{2321   \{}
\DoxyCodeLine{2322     XmlRpc::XmlRpcValue topicConfig;}
\DoxyCodeLine{2323     std::vector<int> updateVector(STATE\_SIZE, 0);}
\DoxyCodeLine{2324     std::string topicConfigName = topicName + \textcolor{stringliteral}{"\_config"};}
\DoxyCodeLine{2325 }
\DoxyCodeLine{2326     \textcolor{keywordflow}{try}}
\DoxyCodeLine{2327     \{}
\DoxyCodeLine{2328       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_abe50aea17d383427f39c3b3c57617f12}{nhLocal\_}}.getParam(topicConfigName, topicConfig);}
\DoxyCodeLine{2329 }
\DoxyCodeLine{2330       ROS\_ASSERT(topicConfig.getType() == XmlRpc::XmlRpcValue::TypeArray);}
\DoxyCodeLine{2331 }
\DoxyCodeLine{2332       \textcolor{keywordflow}{if} (topicConfig.size() != STATE\_SIZE)}
\DoxyCodeLine{2333       \{}
\DoxyCodeLine{2334         ROS\_WARN\_STREAM(\textcolor{stringliteral}{"Configuration vector for "} << topicConfigName << \textcolor{stringliteral}{" should have 15 entries."});}
\DoxyCodeLine{2335       \}}
\DoxyCodeLine{2336 }
\DoxyCodeLine{2337       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < topicConfig.size(); i++)}
\DoxyCodeLine{2338       \{}
\DoxyCodeLine{2339         \textcolor{comment}{// The double cast looks strange, but we'll get exceptions if we}}
\DoxyCodeLine{2340         \textcolor{comment}{// remove the cast to bool. vector<bool> is discouraged, so updateVector}}
\DoxyCodeLine{2341         \textcolor{comment}{// uses integers.}}
\DoxyCodeLine{2342         updateVector[i] = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{bool}\textcolor{keyword}{>}(topicConfig[i]));}
\DoxyCodeLine{2343       \}}
\DoxyCodeLine{2344     \}}
\DoxyCodeLine{2345     \textcolor{keywordflow}{catch} (XmlRpc::XmlRpcException \&e)}
\DoxyCodeLine{2346     \{}
\DoxyCodeLine{2347       ROS\_FATAL\_STREAM(\textcolor{stringliteral}{"Could not read sensor update configuration for topic "} << topicName <<}
\DoxyCodeLine{2348                        \textcolor{stringliteral}{" (type: "} << topicConfig.getType() << \textcolor{stringliteral}{", expected: "} << XmlRpc::XmlRpcValue::TypeArray}
\DoxyCodeLine{2349                        << \textcolor{stringliteral}{"). Error was "} << e.getMessage() << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{2350     \}}
\DoxyCodeLine{2351 }
\DoxyCodeLine{2352     \textcolor{keywordflow}{return} updateVector;}
\DoxyCodeLine{2353   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_aa64036d927adebecab93437b5a086748}\label{classRobotLocalization_1_1RosFilter_aa64036d927adebecab93437b5a086748}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!odometryCallback@{odometryCallback}}
\index{odometryCallback@{odometryCallback}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{odometryCallback()}{odometryCallback()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::odometry\+Callback (\begin{DoxyParamCaption}\item[{const nav\+\_\+msgs\+::\+Odometry\+::\+Const\+Ptr \&}]{msg,  }\item[{const std\+::string \&}]{topic\+Name,  }\item[{const \mbox{\hyperlink{structRobotLocalization_1_1CallbackData}{Callback\+Data}} \&}]{pose\+Callback\+Data,  }\item[{const \mbox{\hyperlink{structRobotLocalization_1_1CallbackData}{Callback\+Data}} \&}]{twist\+Callback\+Data }\end{DoxyParamCaption})}



Callback method for receiving all odometry messages. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em msg} & -\/ The R\+OS odometry message to take in. \\
\hline
\mbox{\texttt{ in}}  & {\em topic\+Name} & -\/ The topic name for the odometry message (only used for debug output) \\
\hline
\mbox{\texttt{ in}}  & {\em pose\+Callback\+Data} & -\/ Relevant static callback data for pose variables \\
\hline
\mbox{\texttt{ in}}  & {\em twist\+Callback\+Data} & -\/ Relevant static callback data for twist variables\\
\hline
\end{DoxyParams}
This method simply separates out the pose and twist data into two new messages, and passes them into their respective callbacks 

Definition at line 1700 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{1702   \{}
\DoxyCodeLine{1703     \textcolor{comment}{// If we've just reset the filter, then we want to ignore any messages}}
\DoxyCodeLine{1704     \textcolor{comment}{// that arrive with an older timestamp}}
\DoxyCodeLine{1705     \textcolor{keywordflow}{if} (msg-\/>header.stamp <= \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aa9df5f56cfb6d02a4bc22c8b68ad115f}{lastSetPoseTime\_}})}
\DoxyCodeLine{1706     \{}
\DoxyCodeLine{1707       std::stringstream stream;}
\DoxyCodeLine{1708       stream << \textcolor{stringliteral}{"The "} << topicName << \textcolor{stringliteral}{" message has a timestamp equal to or before the last filter reset, "} <<}
\DoxyCodeLine{1709                 \textcolor{stringliteral}{"this message will be ignored. This may indicate an empty or bad timestamp. (message time: "} <<}
\DoxyCodeLine{1710                 msg-\/>header.stamp.toSec() << \textcolor{stringliteral}{")"};}
\DoxyCodeLine{1711       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a8266b1436e1907c160d8c73a920e806c}{addDiagnostic}}(diagnostic\_msgs::DiagnosticStatus::WARN,}
\DoxyCodeLine{1712                     topicName + \textcolor{stringliteral}{"\_timestamp"},}
\DoxyCodeLine{1713                     stream.str(),}
\DoxyCodeLine{1714                     \textcolor{keyword}{false});}
\DoxyCodeLine{1715       RF\_DEBUG(\textcolor{stringliteral}{"Received message that preceded the most recent pose reset. Ignoring..."});}
\DoxyCodeLine{1716 }
\DoxyCodeLine{1717       \textcolor{keywordflow}{return};}
\DoxyCodeLine{1718     \}}
\DoxyCodeLine{1719 }
\DoxyCodeLine{1720     RF\_DEBUG(\textcolor{stringliteral}{"-\/-\/-\/-\/-\/-\/ RosFilter::odometryCallback ("} << topicName << \textcolor{stringliteral}{") -\/-\/-\/-\/-\/-\/\(\backslash\)n"} << \textcolor{stringliteral}{"Odometry message:\(\backslash\)n"} << *msg);}
\DoxyCodeLine{1721 }
\DoxyCodeLine{1722     \textcolor{keywordflow}{if} (poseCallbackData.updateSum\_ > 0)}
\DoxyCodeLine{1723     \{}
\DoxyCodeLine{1724       \textcolor{comment}{// Grab the pose portion of the message and pass it to the poseCallback}}
\DoxyCodeLine{1725       geometry\_msgs::PoseWithCovarianceStamped *posPtr = \textcolor{keyword}{new} geometry\_msgs::PoseWithCovarianceStamped();}
\DoxyCodeLine{1726       posPtr-\/>header = msg-\/>header;}
\DoxyCodeLine{1727       posPtr-\/>pose = msg-\/>pose;  \textcolor{comment}{// Entire pose object, also copies covariance}}
\DoxyCodeLine{1728 }
\DoxyCodeLine{1729       geometry\_msgs::PoseWithCovarianceStampedConstPtr pptr(posPtr);}
\DoxyCodeLine{1730       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a54e73dcf610e672435582a72dfae57eb}{poseCallback}}(pptr, poseCallbackData, \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a37c23d6c10a630fe33e74376898fc5c8}{worldFrameId\_}}, \textcolor{keyword}{false});}
\DoxyCodeLine{1731     \}}
\DoxyCodeLine{1732 }
\DoxyCodeLine{1733     \textcolor{keywordflow}{if} (twistCallbackData.updateSum\_ > 0)}
\DoxyCodeLine{1734     \{}
\DoxyCodeLine{1735       \textcolor{comment}{// Grab the twist portion of the message and pass it to the twistCallback}}
\DoxyCodeLine{1736       geometry\_msgs::TwistWithCovarianceStamped *twistPtr = \textcolor{keyword}{new} geometry\_msgs::TwistWithCovarianceStamped();}
\DoxyCodeLine{1737       twistPtr-\/>header = msg-\/>header;}
\DoxyCodeLine{1738       twistPtr-\/>header.frame\_id = msg-\/>child\_frame\_id;}
\DoxyCodeLine{1739       twistPtr-\/>twist = msg-\/>twist;  \textcolor{comment}{// Entire twist object, also copies covariance}}
\DoxyCodeLine{1740 }
\DoxyCodeLine{1741       geometry\_msgs::TwistWithCovarianceStampedConstPtr tptr(twistPtr);}
\DoxyCodeLine{1742       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aeec53ee745d41ed8e342c9688a4a3165}{twistCallback}}(tptr, twistCallbackData, \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6c0cfc2c5d47061bf2ae272b7532b51b}{baseLinkFrameId\_}});}
\DoxyCodeLine{1743     \}}
\DoxyCodeLine{1744 }
\DoxyCodeLine{1745     RF\_DEBUG(\textcolor{stringliteral}{"\(\backslash\)n-\/-\/-\/-\/-\/ /RosFilter::odometryCallback ("} << topicName << \textcolor{stringliteral}{") -\/-\/-\/-\/-\/-\/\(\backslash\)n"});}
\DoxyCodeLine{1746   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a54e73dcf610e672435582a72dfae57eb}\label{classRobotLocalization_1_1RosFilter_a54e73dcf610e672435582a72dfae57eb}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!poseCallback@{poseCallback}}
\index{poseCallback@{poseCallback}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{poseCallback()}{poseCallback()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::pose\+Callback (\begin{DoxyParamCaption}\item[{const geometry\+\_\+msgs\+::\+Pose\+With\+Covariance\+Stamped\+::\+Const\+Ptr \&}]{msg,  }\item[{const \mbox{\hyperlink{structRobotLocalization_1_1CallbackData}{Callback\+Data}} \&}]{callback\+Data,  }\item[{const std\+::string \&}]{target\+Frame,  }\item[{const bool}]{imu\+Data }\end{DoxyParamCaption})}



Callback method for receiving all pose messages. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em msg} & -\/ The R\+OS stamped pose with covariance message to take in \\
\hline
\mbox{\texttt{ in}}  & {\em callback\+Data} & -\/ Relevant static callback data \\
\hline
\mbox{\texttt{ in}}  & {\em target\+Frame} & -\/ The target frame\+\_\+id into which to transform the data \\
\hline
\mbox{\texttt{ in}}  & {\em imu\+Data} & -\/ Whether this data comes from an I\+MU \\
\hline
\end{DoxyParams}


Definition at line 1749 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{1753   \{}
\DoxyCodeLine{1754     \textcolor{keyword}{const} std::string \&topicName = callbackData.topicName\_;}
\DoxyCodeLine{1755 }
\DoxyCodeLine{1756     \textcolor{comment}{// If we've just reset the filter, then we want to ignore any messages}}
\DoxyCodeLine{1757     \textcolor{comment}{// that arrive with an older timestamp}}
\DoxyCodeLine{1758     \textcolor{keywordflow}{if} (msg-\/>header.stamp <= \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aa9df5f56cfb6d02a4bc22c8b68ad115f}{lastSetPoseTime\_}})}
\DoxyCodeLine{1759     \{}
\DoxyCodeLine{1760       std::stringstream stream;}
\DoxyCodeLine{1761       stream << \textcolor{stringliteral}{"The "} << topicName << \textcolor{stringliteral}{" message has a timestamp equal to or before the last filter reset, "} <<}
\DoxyCodeLine{1762                 \textcolor{stringliteral}{"this message will be ignored. This may indicate an empty or bad timestamp. (message time: "} <<}
\DoxyCodeLine{1763                 msg-\/>header.stamp.toSec() << \textcolor{stringliteral}{")"};}
\DoxyCodeLine{1764       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a8266b1436e1907c160d8c73a920e806c}{addDiagnostic}}(diagnostic\_msgs::DiagnosticStatus::WARN,}
\DoxyCodeLine{1765                     topicName + \textcolor{stringliteral}{"\_timestamp"},}
\DoxyCodeLine{1766                     stream.str(),}
\DoxyCodeLine{1767                     \textcolor{keyword}{false});}
\DoxyCodeLine{1768       \textcolor{keywordflow}{return};}
\DoxyCodeLine{1769     \}}
\DoxyCodeLine{1770 }
\DoxyCodeLine{1771     RF\_DEBUG(\textcolor{stringliteral}{"-\/-\/-\/-\/-\/-\/ RosFilter::poseCallback ("} << topicName << \textcolor{stringliteral}{") -\/-\/-\/-\/-\/-\/\(\backslash\)n"} <<}
\DoxyCodeLine{1772              \textcolor{stringliteral}{"Pose message:\(\backslash\)n"} << *msg);}
\DoxyCodeLine{1773 }
\DoxyCodeLine{1774     \textcolor{comment}{// Put the initial value in the lastMessagTimes\_ for this variable if it's empty}}
\DoxyCodeLine{1775     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a473c0f797fcd9677b1005637ee159ae4}{lastMessageTimes\_}}.count(topicName) == 0)}
\DoxyCodeLine{1776     \{}
\DoxyCodeLine{1777       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a473c0f797fcd9677b1005637ee159ae4}{lastMessageTimes\_}}.insert(std::pair<std::string, ros::Time>(topicName, msg-\/>header.stamp));}
\DoxyCodeLine{1778     \}}
\DoxyCodeLine{1779 }
\DoxyCodeLine{1780     \textcolor{comment}{// Make sure this message is newer than the last one}}
\DoxyCodeLine{1781     \textcolor{keywordflow}{if} (msg-\/>header.stamp >= \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a473c0f797fcd9677b1005637ee159ae4}{lastMessageTimes\_}}[topicName])}
\DoxyCodeLine{1782     \{}
\DoxyCodeLine{1783       RF\_DEBUG(\textcolor{stringliteral}{"Update vector for "} << topicName << \textcolor{stringliteral}{" is:\(\backslash\)n"} << callbackData.updateVector\_);}
\DoxyCodeLine{1784 }
\DoxyCodeLine{1785       Eigen::VectorXd measurement(STATE\_SIZE);}
\DoxyCodeLine{1786       Eigen::MatrixXd measurementCovariance(STATE\_SIZE, STATE\_SIZE);}
\DoxyCodeLine{1787 }
\DoxyCodeLine{1788       measurement.setZero();}
\DoxyCodeLine{1789       measurementCovariance.setZero();}
\DoxyCodeLine{1790 }
\DoxyCodeLine{1791       \textcolor{comment}{// Make sure we're actually updating at least one of these variables}}
\DoxyCodeLine{1792       std::vector<int> updateVectorCorrected = callbackData.updateVector\_;}
\DoxyCodeLine{1793 }
\DoxyCodeLine{1794       \textcolor{comment}{// Prepare the pose data for inclusion in the filter}}
\DoxyCodeLine{1795       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a2538569c164be4b396576252e69732bb}{preparePose}}(msg,}
\DoxyCodeLine{1796                       topicName,}
\DoxyCodeLine{1797                       targetFrame,}
\DoxyCodeLine{1798                       callbackData.differential\_,}
\DoxyCodeLine{1799                       callbackData.relative\_,}
\DoxyCodeLine{1800                       imuData,}
\DoxyCodeLine{1801                       updateVectorCorrected,}
\DoxyCodeLine{1802                       measurement,}
\DoxyCodeLine{1803                       measurementCovariance))}
\DoxyCodeLine{1804       \{}
\DoxyCodeLine{1805         \textcolor{comment}{// Store the measurement. Add a "pose" suffix so we know what kind of measurement}}
\DoxyCodeLine{1806         \textcolor{comment}{// we're dealing with when we debug the core filter logic.}}
\DoxyCodeLine{1807         \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6f69cfe0fd2fea54446e4895b14c4c88}{enqueueMeasurement}}(topicName,}
\DoxyCodeLine{1808                            measurement,}
\DoxyCodeLine{1809                            measurementCovariance,}
\DoxyCodeLine{1810                            updateVectorCorrected,}
\DoxyCodeLine{1811                            callbackData.rejectionThreshold\_,}
\DoxyCodeLine{1812                            msg-\/>header.stamp);}
\DoxyCodeLine{1813 }
\DoxyCodeLine{1814         RF\_DEBUG(\textcolor{stringliteral}{"Enqueued new measurement for "} << topicName << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{1815       \}}
\DoxyCodeLine{1816       \textcolor{keywordflow}{else}}
\DoxyCodeLine{1817       \{}
\DoxyCodeLine{1818         RF\_DEBUG(\textcolor{stringliteral}{"Did *not* enqueue measurement for "} << topicName << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{1819       \}}
\DoxyCodeLine{1820 }
\DoxyCodeLine{1821       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a473c0f797fcd9677b1005637ee159ae4}{lastMessageTimes\_}}[topicName] = msg-\/>header.stamp;}
\DoxyCodeLine{1822 }
\DoxyCodeLine{1823       RF\_DEBUG(\textcolor{stringliteral}{"Last message time for "} << topicName << \textcolor{stringliteral}{" is now "} <<}
\DoxyCodeLine{1824         \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a473c0f797fcd9677b1005637ee159ae4}{lastMessageTimes\_}}[topicName] << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{1825     \}}
\DoxyCodeLine{1826     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a16ad0452b5b52e64a93736d25cfeba95}{resetOnTimeJump\_}} \&\& ros::Time::isSimTime())}
\DoxyCodeLine{1827     \{}
\DoxyCodeLine{1828       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a011b39dad94b84b7856f993518e4ae00}{reset}}();}
\DoxyCodeLine{1829     \}}
\DoxyCodeLine{1830     \textcolor{keywordflow}{else}}
\DoxyCodeLine{1831     \{}
\DoxyCodeLine{1832       std::stringstream stream;}
\DoxyCodeLine{1833       stream << \textcolor{stringliteral}{"The "} << topicName << \textcolor{stringliteral}{" message has a timestamp before that of the previous message received,"} <<}
\DoxyCodeLine{1834                 \textcolor{stringliteral}{" this message will be ignored. This may indicate a bad timestamp. (message time: "} <<}
\DoxyCodeLine{1835                 msg-\/>header.stamp.toSec() << \textcolor{stringliteral}{")"};}
\DoxyCodeLine{1836       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a8266b1436e1907c160d8c73a920e806c}{addDiagnostic}}(diagnostic\_msgs::DiagnosticStatus::WARN,}
\DoxyCodeLine{1837                     topicName + \textcolor{stringliteral}{"\_timestamp"},}
\DoxyCodeLine{1838                     stream.str(),}
\DoxyCodeLine{1839                     \textcolor{keyword}{false});}
\DoxyCodeLine{1840 }
\DoxyCodeLine{1841       RF\_DEBUG(\textcolor{stringliteral}{"Message is too old. Last message time for "} << topicName << \textcolor{stringliteral}{" is "}}
\DoxyCodeLine{1842                << \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a473c0f797fcd9677b1005637ee159ae4}{lastMessageTimes\_}}[topicName] << \textcolor{stringliteral}{", current message time is "}}
\DoxyCodeLine{1843                << msg-\/>header.stamp << \textcolor{stringliteral}{".\(\backslash\)n"});}
\DoxyCodeLine{1844     \}}
\DoxyCodeLine{1845 }
\DoxyCodeLine{1846     RF\_DEBUG(\textcolor{stringliteral}{"\(\backslash\)n-\/-\/-\/-\/-\/ /RosFilter::poseCallback ("} << topicName << \textcolor{stringliteral}{") -\/-\/-\/-\/-\/-\/\(\backslash\)n"});}
\DoxyCodeLine{1847   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a34b0ea97d422eaf92c36ed8085dea5c3}\label{classRobotLocalization_1_1RosFilter_a34b0ea97d422eaf92c36ed8085dea5c3}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!prepareAcceleration@{prepareAcceleration}}
\index{prepareAcceleration@{prepareAcceleration}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{prepareAcceleration()}{prepareAcceleration()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::prepare\+Acceleration (\begin{DoxyParamCaption}\item[{const sensor\+\_\+msgs\+::\+Imu\+::\+Const\+Ptr \&}]{msg,  }\item[{const std\+::string \&}]{topic\+Name,  }\item[{const std\+::string \&}]{target\+Frame,  }\item[{std\+::vector$<$ int $>$ \&}]{update\+Vector,  }\item[{Eigen\+::\+Vector\+Xd \&}]{measurement,  }\item[{Eigen\+::\+Matrix\+Xd \&}]{measurement\+Covariance }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}



Prepares an I\+MU message\textquotesingle{}s linear acceleration for integration into the filter. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em msg} & -\/ The I\+MU message to prepare \\
\hline
\mbox{\texttt{ in}}  & {\em topic\+Name} & -\/ The name of the topic over which this message was received \\
\hline
\mbox{\texttt{ in}}  & {\em target\+Frame} & -\/ The target tf frame \\
\hline
\mbox{\texttt{ in}}  & {\em update\+Vector} & -\/ The update vector for the data source \\
\hline
\mbox{\texttt{ in}}  & {\em measurement} & -\/ The twist data converted to a measurement \\
\hline
\mbox{\texttt{ in}}  & {\em measurement\+Covariance} & -\/ The covariance of the converted measurement \\
\hline
\end{DoxyParams}


Definition at line 2356 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{2362   \{}
\DoxyCodeLine{2363     RF\_DEBUG(\textcolor{stringliteral}{"-\/-\/-\/-\/-\/-\/ RosFilter::prepareAcceleration ("} << topicName << \textcolor{stringliteral}{") -\/-\/-\/-\/-\/-\/\(\backslash\)n"});}
\DoxyCodeLine{2364 }
\DoxyCodeLine{2365     \textcolor{comment}{// 1. Get the measurement into a vector}}
\DoxyCodeLine{2366     tf2::Vector3 accTmp(msg-\/>linear\_acceleration.x,}
\DoxyCodeLine{2367                         msg-\/>linear\_acceleration.y,}
\DoxyCodeLine{2368                         msg-\/>linear\_acceleration.z);}
\DoxyCodeLine{2369 }
\DoxyCodeLine{2370     \textcolor{comment}{// Set relevant header info}}
\DoxyCodeLine{2371     std::string msgFrame = (msg-\/>header.frame\_id == \textcolor{stringliteral}{""} ? \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6c0cfc2c5d47061bf2ae272b7532b51b}{baseLinkFrameId\_}} : msg-\/>header.frame\_id);}
\DoxyCodeLine{2372 }
\DoxyCodeLine{2373     \textcolor{comment}{// 2. robot\_localization lets users configure which variables from the sensor should be}}
\DoxyCodeLine{2374     \textcolor{comment}{//    fused with the filter. This is specified at the sensor level. However, the data}}
\DoxyCodeLine{2375     \textcolor{comment}{//    may go through transforms before being fused with the state estimate. In that case,}}
\DoxyCodeLine{2376     \textcolor{comment}{//    we need to know which of the transformed variables came from the pre-\/transformed}}
\DoxyCodeLine{2377     \textcolor{comment}{//    "approved" variables (i.e., the ones that had "true" in their xxx\_config parameter).}}
\DoxyCodeLine{2378     \textcolor{comment}{//    To do this, we create a pose from the original upate vector, which contains only}}
\DoxyCodeLine{2379     \textcolor{comment}{//    zeros and ones. This pose goes through the same transforms as the measurement. The}}
\DoxyCodeLine{2380     \textcolor{comment}{//    non-\/zero values that result will be used to modify the updateVector.}}
\DoxyCodeLine{2381     tf2::Matrix3x3 maskAcc(updateVector[StateMemberAx], 0, 0,}
\DoxyCodeLine{2382                            0, updateVector[StateMemberAy], 0,}
\DoxyCodeLine{2383                            0, 0, updateVector[StateMemberAz]);}
\DoxyCodeLine{2384 }
\DoxyCodeLine{2385     \textcolor{comment}{// 3. We'll need to rotate the covariance as well}}
\DoxyCodeLine{2386     Eigen::MatrixXd covarianceRotated(ACCELERATION\_SIZE, ACCELERATION\_SIZE);}
\DoxyCodeLine{2387     covarianceRotated.setZero();}
\DoxyCodeLine{2388 }
\DoxyCodeLine{2389     this-\/>\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a8b299c262fd69e029c8fc05ff19f150e}{copyCovariance}}(\&(msg-\/>linear\_acceleration\_covariance[0]),}
\DoxyCodeLine{2390                          covarianceRotated,}
\DoxyCodeLine{2391                          topicName,}
\DoxyCodeLine{2392                          updateVector,}
\DoxyCodeLine{2393                          POSITION\_A\_OFFSET,}
\DoxyCodeLine{2394                          ACCELERATION\_SIZE);}
\DoxyCodeLine{2395 }
\DoxyCodeLine{2396     RF\_DEBUG(\textcolor{stringliteral}{"Original measurement as tf object: "} << accTmp <<}
\DoxyCodeLine{2397              \textcolor{stringliteral}{"\(\backslash\)nOriginal update vector:\(\backslash\)n"} << updateVector <<}
\DoxyCodeLine{2398              \textcolor{stringliteral}{"\(\backslash\)nOriginal covariance matrix:\(\backslash\)n"} << covarianceRotated << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{2399 }
\DoxyCodeLine{2400     \textcolor{comment}{// 4. We need to transform this into the target frame (probably base\_link)}}
\DoxyCodeLine{2401     \textcolor{comment}{// It's unlikely that we'll get a velocity measurement in another frame, but}}
\DoxyCodeLine{2402     \textcolor{comment}{// we have to handle the situation.}}
\DoxyCodeLine{2403     tf2::Transform targetFrameTrans;}
\DoxyCodeLine{2404     \textcolor{keywordtype}{bool} canTransform = RosFilterUtilities::lookupTransformSafe(\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aacaed6dea7d7bd1dc1d03eeddf002c29}{tfBuffer\_}},}
\DoxyCodeLine{2405                                                                 targetFrame,}
\DoxyCodeLine{2406                                                                 msgFrame,}
\DoxyCodeLine{2407                                                                 msg-\/>header.stamp,}
\DoxyCodeLine{2408                                                                 \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a5c57fe5f94f02e033ac78939966ad366}{tfTimeout\_}},}
\DoxyCodeLine{2409                                                                 targetFrameTrans);}
\DoxyCodeLine{2410 }
\DoxyCodeLine{2411     \textcolor{keywordflow}{if} (canTransform)}
\DoxyCodeLine{2412     \{}
\DoxyCodeLine{2413       \textcolor{comment}{// We don't know if the user has already handled the removal}}
\DoxyCodeLine{2414       \textcolor{comment}{// of normal forces, so we use a parameter}}
\DoxyCodeLine{2415       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a27854c71e92da52d6a7c7a004efa1736}{removeGravitationalAcc\_}}[topicName])}
\DoxyCodeLine{2416       \{}
\DoxyCodeLine{2417         tf2::Vector3 normAcc(0, 0, \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a26a3d07bd073104fd3a2ee004ba88581}{gravitationalAcc\_}});}
\DoxyCodeLine{2418         tf2::Quaternion curAttitude;}
\DoxyCodeLine{2419         tf2::Transform trans;}
\DoxyCodeLine{2420 }
\DoxyCodeLine{2421         \textcolor{keywordflow}{if} (::fabs(msg-\/>orientation\_covariance[0] + 1) < 1e-\/9)}
\DoxyCodeLine{2422         \{}
\DoxyCodeLine{2423           \textcolor{comment}{// Imu message contains no orientation, so we should use orientation}}
\DoxyCodeLine{2424           \textcolor{comment}{// from filter state to transform and remove acceleration}}
\DoxyCodeLine{2425           \textcolor{keyword}{const} Eigen::VectorXd \&state = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.getState();}
\DoxyCodeLine{2426           tf2::Vector3 stateTmp(state(StateMemberRoll),}
\DoxyCodeLine{2427                                 state(StateMemberPitch),}
\DoxyCodeLine{2428                                 state(StateMemberYaw));}
\DoxyCodeLine{2429           \textcolor{comment}{// transform state orientation to IMU frame}}
\DoxyCodeLine{2430           tf2::Transform imuFrameTrans;}
\DoxyCodeLine{2431           RosFilterUtilities::lookupTransformSafe(\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aacaed6dea7d7bd1dc1d03eeddf002c29}{tfBuffer\_}},}
\DoxyCodeLine{2432                                                   msgFrame,}
\DoxyCodeLine{2433                                                   targetFrame,}
\DoxyCodeLine{2434                                                   msg-\/>header.stamp,}
\DoxyCodeLine{2435                                                   \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a5c57fe5f94f02e033ac78939966ad366}{tfTimeout\_}},}
\DoxyCodeLine{2436                                                   imuFrameTrans);}
\DoxyCodeLine{2437           stateTmp = imuFrameTrans.getBasis() * stateTmp;}
\DoxyCodeLine{2438           curAttitude.setRPY(stateTmp.getX(), stateTmp.getY(), stateTmp.getZ());}
\DoxyCodeLine{2439         \}}
\DoxyCodeLine{2440         \textcolor{keywordflow}{else}}
\DoxyCodeLine{2441         \{}
\DoxyCodeLine{2442           tf2::fromMsg(msg-\/>orientation, curAttitude);}
\DoxyCodeLine{2443           \textcolor{keywordflow}{if} (fabs(curAttitude.length() -\/ 1.0) > 0.01)}
\DoxyCodeLine{2444           \{}
\DoxyCodeLine{2445             ROS\_WARN\_ONCE(\textcolor{stringliteral}{"An input was not normalized, this should NOT happen, but will normalize."});}
\DoxyCodeLine{2446             curAttitude.normalize();}
\DoxyCodeLine{2447           \}}
\DoxyCodeLine{2448         \}}
\DoxyCodeLine{2449         trans.setRotation(curAttitude);}
\DoxyCodeLine{2450         tf2::Vector3 rotNorm = trans.getBasis().inverse() * normAcc;}
\DoxyCodeLine{2451         accTmp.setX(accTmp.getX() -\/ rotNorm.getX());}
\DoxyCodeLine{2452         accTmp.setY(accTmp.getY() -\/ rotNorm.getY());}
\DoxyCodeLine{2453         accTmp.setZ(accTmp.getZ() -\/ rotNorm.getZ());}
\DoxyCodeLine{2454 }
\DoxyCodeLine{2455         RF\_DEBUG(\textcolor{stringliteral}{"Orientation is "} << curAttitude <<}
\DoxyCodeLine{2456                  \textcolor{stringliteral}{"Acceleration due to gravity is "} << rotNorm <<}
\DoxyCodeLine{2457                  \textcolor{stringliteral}{"After removing acceleration due to gravity, acceleration is "} << accTmp << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{2458       \}}
\DoxyCodeLine{2459 }
\DoxyCodeLine{2460       \textcolor{comment}{// Transform to correct frame}}
\DoxyCodeLine{2461       \textcolor{comment}{// @todo: This needs to take into account offsets from the origin. Right now,}}
\DoxyCodeLine{2462       \textcolor{comment}{// it assumes that if the sensor is placed at some non-\/zero offset from the}}
\DoxyCodeLine{2463       \textcolor{comment}{// vehicle's center, that the vehicle turns with constant velocity. This needs}}
\DoxyCodeLine{2464       \textcolor{comment}{// to be something like}}
\DoxyCodeLine{2465       \textcolor{comment}{// accTmp = targetFrameTrans.getBasis() * accTmp -\/ targetFrameTrans.getOrigin().cross(rotation\_acceleration);}}
\DoxyCodeLine{2466       \textcolor{comment}{// We can get rotational acceleration by differentiating the rotational velocity}}
\DoxyCodeLine{2467       \textcolor{comment}{// (if it's available)}}
\DoxyCodeLine{2468       accTmp = targetFrameTrans.getBasis() * accTmp;}
\DoxyCodeLine{2469       maskAcc = targetFrameTrans.getBasis() * maskAcc;}
\DoxyCodeLine{2470 }
\DoxyCodeLine{2471       \textcolor{comment}{// Now use the mask values to determine which update vector values should be true}}
\DoxyCodeLine{2472       updateVector[StateMemberAx] = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(}
\DoxyCodeLine{2473         maskAcc.getRow(StateMemberAx -\/ POSITION\_A\_OFFSET).length() >= 1e-\/6);}
\DoxyCodeLine{2474       updateVector[StateMemberAy] = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(}
\DoxyCodeLine{2475         maskAcc.getRow(StateMemberAy -\/ POSITION\_A\_OFFSET).length() >= 1e-\/6);}
\DoxyCodeLine{2476       updateVector[StateMemberAz] = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(}
\DoxyCodeLine{2477         maskAcc.getRow(StateMemberAz -\/ POSITION\_A\_OFFSET).length() >= 1e-\/6);}
\DoxyCodeLine{2478 }
\DoxyCodeLine{2479       RF\_DEBUG(msg-\/>header.frame\_id << \textcolor{stringliteral}{"-\/>"} << targetFrame << \textcolor{stringliteral}{" transform:\(\backslash\)n"} << targetFrameTrans <<}
\DoxyCodeLine{2480                \textcolor{stringliteral}{"\(\backslash\)nAfter applying transform to "} << targetFrame << \textcolor{stringliteral}{", update vector is:\(\backslash\)n"} << updateVector <<}
\DoxyCodeLine{2481                \textcolor{stringliteral}{"\(\backslash\)nAfter applying transform to "} << targetFrame << \textcolor{stringliteral}{", measurement is:\(\backslash\)n"} << accTmp << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{2482 }
\DoxyCodeLine{2483       \textcolor{comment}{// 5. Now rotate the covariance: create an augmented}}
\DoxyCodeLine{2484       \textcolor{comment}{// matrix that contains a 3D rotation matrix in the}}
\DoxyCodeLine{2485       \textcolor{comment}{// upper-\/left and lower-\/right quadrants, and zeros}}
\DoxyCodeLine{2486       \textcolor{comment}{// elsewhere}}
\DoxyCodeLine{2487       tf2::Matrix3x3 rot(targetFrameTrans.getRotation());}
\DoxyCodeLine{2488       Eigen::MatrixXd rot3d(ACCELERATION\_SIZE, ACCELERATION\_SIZE);}
\DoxyCodeLine{2489       rot3d.setIdentity();}
\DoxyCodeLine{2490 }
\DoxyCodeLine{2491       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} rInd = 0; rInd < ACCELERATION\_SIZE; ++rInd)}
\DoxyCodeLine{2492       \{}
\DoxyCodeLine{2493         rot3d(rInd, 0) = rot.getRow(rInd).getX();}
\DoxyCodeLine{2494         rot3d(rInd, 1) = rot.getRow(rInd).getY();}
\DoxyCodeLine{2495         rot3d(rInd, 2) = rot.getRow(rInd).getZ();}
\DoxyCodeLine{2496       \}}
\DoxyCodeLine{2497 }
\DoxyCodeLine{2498       \textcolor{comment}{// Carry out the rotation}}
\DoxyCodeLine{2499       covarianceRotated = rot3d * covarianceRotated.eval() * rot3d.transpose();}
\DoxyCodeLine{2500 }
\DoxyCodeLine{2501       RF\_DEBUG(\textcolor{stringliteral}{"Transformed covariance is \(\backslash\)n"} << covarianceRotated << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{2502 }
\DoxyCodeLine{2503       \textcolor{comment}{// 6. Store our corrected measurement and covariance}}
\DoxyCodeLine{2504       measurement(StateMemberAx) = accTmp.getX();}
\DoxyCodeLine{2505       measurement(StateMemberAy) = accTmp.getY();}
\DoxyCodeLine{2506       measurement(StateMemberAz) = accTmp.getZ();}
\DoxyCodeLine{2507 }
\DoxyCodeLine{2508       \textcolor{comment}{// Copy the covariances}}
\DoxyCodeLine{2509       measurementCovariance.block(POSITION\_A\_OFFSET, POSITION\_A\_OFFSET, ACCELERATION\_SIZE, ACCELERATION\_SIZE) =}
\DoxyCodeLine{2510         covarianceRotated.block(0, 0, ACCELERATION\_SIZE, ACCELERATION\_SIZE);}
\DoxyCodeLine{2511 }
\DoxyCodeLine{2512       \textcolor{comment}{// 7. Handle 2D mode}}
\DoxyCodeLine{2513       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ad06dbf8f35a49fc76daf1c16fdecd34d}{twoDMode\_}})}
\DoxyCodeLine{2514       \{}
\DoxyCodeLine{2515         \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a4585957fbc3239e559eb509921f28a8f}{forceTwoD}}(measurement, measurementCovariance, updateVector);}
\DoxyCodeLine{2516       \}}
\DoxyCodeLine{2517     \}}
\DoxyCodeLine{2518     \textcolor{keywordflow}{else}}
\DoxyCodeLine{2519     \{}
\DoxyCodeLine{2520       RF\_DEBUG(\textcolor{stringliteral}{"Could not transform measurement into "} << targetFrame << \textcolor{stringliteral}{". Ignoring...\(\backslash\)n"});}
\DoxyCodeLine{2521     \}}
\DoxyCodeLine{2522 }
\DoxyCodeLine{2523     RF\_DEBUG(\textcolor{stringliteral}{"\(\backslash\)n-\/-\/-\/-\/-\/ /RosFilter::prepareAcceleration("} << topicName << \textcolor{stringliteral}{") -\/-\/-\/-\/-\/-\/\(\backslash\)n"});}
\DoxyCodeLine{2524 }
\DoxyCodeLine{2525     \textcolor{keywordflow}{return} canTransform;}
\DoxyCodeLine{2526   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a2538569c164be4b396576252e69732bb}\label{classRobotLocalization_1_1RosFilter_a2538569c164be4b396576252e69732bb}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!preparePose@{preparePose}}
\index{preparePose@{preparePose}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{preparePose()}{preparePose()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::prepare\+Pose (\begin{DoxyParamCaption}\item[{const geometry\+\_\+msgs\+::\+Pose\+With\+Covariance\+Stamped\+::\+Const\+Ptr \&}]{msg,  }\item[{const std\+::string \&}]{topic\+Name,  }\item[{const std\+::string \&}]{target\+Frame,  }\item[{const bool}]{differential,  }\item[{const bool}]{relative,  }\item[{const bool}]{imu\+Data,  }\item[{std\+::vector$<$ int $>$ \&}]{update\+Vector,  }\item[{Eigen\+::\+Vector\+Xd \&}]{measurement,  }\item[{Eigen\+::\+Matrix\+Xd \&}]{measurement\+Covariance }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}



Prepares a pose message for integration into the filter. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em msg} & -\/ The pose message to prepare \\
\hline
\mbox{\texttt{ in}}  & {\em topic\+Name} & -\/ The name of the topic over which this message was received \\
\hline
\mbox{\texttt{ in}}  & {\em target\+Frame} & -\/ The target tf frame \\
\hline
\mbox{\texttt{ in}}  & {\em differential} & -\/ Whether we\textquotesingle{}re carrying out differential integration \\
\hline
\mbox{\texttt{ in}}  & {\em relative} & -\/ Whether this measurement is processed relative to the first \\
\hline
\mbox{\texttt{ in}}  & {\em imu\+Data} & -\/ Whether this measurement is from an I\+MU \\
\hline
\mbox{\texttt{ in,out}}  & {\em update\+Vector} & -\/ The update vector for the data source \\
\hline
\mbox{\texttt{ out}}  & {\em measurement} & -\/ The pose data converted to a measurement \\
\hline
\mbox{\texttt{ out}}  & {\em measurement\+Covariance} & -\/ The covariance of the converted measurement \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true indicates that the measurement was successfully prepared, false otherwise 
\end{DoxyReturn}


Definition at line 2529 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{2538   \{}
\DoxyCodeLine{2539     \textcolor{keywordtype}{bool} retVal = \textcolor{keyword}{false};}
\DoxyCodeLine{2540 }
\DoxyCodeLine{2541     RF\_DEBUG(\textcolor{stringliteral}{"-\/-\/-\/-\/-\/-\/ RosFilter::preparePose ("} << topicName << \textcolor{stringliteral}{") -\/-\/-\/-\/-\/-\/\(\backslash\)n"});}
\DoxyCodeLine{2542 }
\DoxyCodeLine{2543     \textcolor{comment}{// 1. Get the measurement into a tf-\/friendly transform (pose) object}}
\DoxyCodeLine{2544     tf2::Stamped<tf2::Transform> poseTmp;}
\DoxyCodeLine{2545 }
\DoxyCodeLine{2546     \textcolor{comment}{// We'll need this later for storing this measurement for differential integration}}
\DoxyCodeLine{2547     tf2::Transform curMeasurement;}
\DoxyCodeLine{2548 }
\DoxyCodeLine{2549     \textcolor{comment}{// Handle issues where frame\_id data is not filled out properly}}
\DoxyCodeLine{2550     \textcolor{comment}{// @todo: verify that this is necessary still. New IMU handling may}}
\DoxyCodeLine{2551     \textcolor{comment}{// have rendered this obsolete.}}
\DoxyCodeLine{2552     std::string finalTargetFrame;}
\DoxyCodeLine{2553     \textcolor{keywordflow}{if} (targetFrame == \textcolor{stringliteral}{""} \&\& msg-\/>header.frame\_id == \textcolor{stringliteral}{""})}
\DoxyCodeLine{2554     \{}
\DoxyCodeLine{2555       \textcolor{comment}{// Blank target and message frames mean we can just}}
\DoxyCodeLine{2556       \textcolor{comment}{// use our world\_frame}}
\DoxyCodeLine{2557       finalTargetFrame = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a37c23d6c10a630fe33e74376898fc5c8}{worldFrameId\_}};}
\DoxyCodeLine{2558       poseTmp.frame\_id\_ = finalTargetFrame;}
\DoxyCodeLine{2559     \}}
\DoxyCodeLine{2560     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (targetFrame == \textcolor{stringliteral}{""})}
\DoxyCodeLine{2561     \{}
\DoxyCodeLine{2562       \textcolor{comment}{// A blank target frame means we shouldn't bother}}
\DoxyCodeLine{2563       \textcolor{comment}{// transforming the data}}
\DoxyCodeLine{2564       finalTargetFrame = msg-\/>header.frame\_id;}
\DoxyCodeLine{2565       poseTmp.frame\_id\_ = finalTargetFrame;}
\DoxyCodeLine{2566     \}}
\DoxyCodeLine{2567     \textcolor{keywordflow}{else}}
\DoxyCodeLine{2568     \{}
\DoxyCodeLine{2569       \textcolor{comment}{// Otherwise, we should use our target frame}}
\DoxyCodeLine{2570       finalTargetFrame = targetFrame;}
\DoxyCodeLine{2571       poseTmp.frame\_id\_ = (differential ? finalTargetFrame : msg-\/>header.frame\_id);}
\DoxyCodeLine{2572     \}}
\DoxyCodeLine{2573 }
\DoxyCodeLine{2574     RF\_DEBUG(\textcolor{stringliteral}{"Final target frame for "} << topicName << \textcolor{stringliteral}{" is "} << finalTargetFrame << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{2575 }
\DoxyCodeLine{2576     poseTmp.stamp\_ = msg-\/>header.stamp;}
\DoxyCodeLine{2577 }
\DoxyCodeLine{2578     \textcolor{comment}{// Fill out the position data}}
\DoxyCodeLine{2579     poseTmp.setOrigin(tf2::Vector3(msg-\/>pose.pose.position.x,}
\DoxyCodeLine{2580                                    msg-\/>pose.pose.position.y,}
\DoxyCodeLine{2581                                    msg-\/>pose.pose.position.z));}
\DoxyCodeLine{2582 }
\DoxyCodeLine{2583     tf2::Quaternion orientation;}
\DoxyCodeLine{2584 }
\DoxyCodeLine{2585     \textcolor{comment}{// Handle bad (empty) quaternions}}
\DoxyCodeLine{2586     \textcolor{keywordflow}{if} (msg-\/>pose.pose.orientation.x == 0 \&\& msg-\/>pose.pose.orientation.y == 0 \&\&}
\DoxyCodeLine{2587        msg-\/>pose.pose.orientation.z == 0 \&\& msg-\/>pose.pose.orientation.w == 0)}
\DoxyCodeLine{2588     \{}
\DoxyCodeLine{2589       orientation.setValue(0.0, 0.0, 0.0, 1.0);}
\DoxyCodeLine{2590 }
\DoxyCodeLine{2591       \textcolor{keywordflow}{if} (updateVector[StateMemberRoll] || updateVector[StateMemberPitch] || updateVector[StateMemberYaw])}
\DoxyCodeLine{2592       \{}
\DoxyCodeLine{2593         std::stringstream stream;}
\DoxyCodeLine{2594         stream << \textcolor{stringliteral}{"The "} << topicName << \textcolor{stringliteral}{" message contains an invalid orientation quaternion, "} <<}
\DoxyCodeLine{2595                   \textcolor{stringliteral}{"but its configuration is such that orientation data is being used. Correcting..."};}
\DoxyCodeLine{2596 }
\DoxyCodeLine{2597         \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a8266b1436e1907c160d8c73a920e806c}{addDiagnostic}}(diagnostic\_msgs::DiagnosticStatus::WARN,}
\DoxyCodeLine{2598                       topicName + \textcolor{stringliteral}{"\_orientation"},}
\DoxyCodeLine{2599                       stream.str(),}
\DoxyCodeLine{2600                       \textcolor{keyword}{false});}
\DoxyCodeLine{2601       \}}
\DoxyCodeLine{2602     \}}
\DoxyCodeLine{2603     \textcolor{keywordflow}{else}}
\DoxyCodeLine{2604     \{}
\DoxyCodeLine{2605       tf2::fromMsg(msg-\/>pose.pose.orientation, orientation);}
\DoxyCodeLine{2606       \textcolor{keywordflow}{if} (fabs(orientation.length() -\/ 1.0) > 0.01)}
\DoxyCodeLine{2607       \{}
\DoxyCodeLine{2608         ROS\_WARN\_ONCE(\textcolor{stringliteral}{"An input was not normalized, this should NOT happen, but will normalize."});}
\DoxyCodeLine{2609         orientation.normalize();}
\DoxyCodeLine{2610       \}}
\DoxyCodeLine{2611     \}}
\DoxyCodeLine{2612 }
\DoxyCodeLine{2613     \textcolor{comment}{// Fill out the orientation data}}
\DoxyCodeLine{2614     poseTmp.setRotation(orientation);}
\DoxyCodeLine{2615 }
\DoxyCodeLine{2616     \textcolor{comment}{// 2. Get the target frame transformation}}
\DoxyCodeLine{2617     tf2::Transform targetFrameTrans;}
\DoxyCodeLine{2618     \textcolor{keywordtype}{bool} canTransform = RosFilterUtilities::lookupTransformSafe(\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aacaed6dea7d7bd1dc1d03eeddf002c29}{tfBuffer\_}},}
\DoxyCodeLine{2619                                                                 finalTargetFrame,}
\DoxyCodeLine{2620                                                                 poseTmp.frame\_id\_,}
\DoxyCodeLine{2621                                                                 poseTmp.stamp\_,}
\DoxyCodeLine{2622                                                                 \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a5c57fe5f94f02e033ac78939966ad366}{tfTimeout\_}},}
\DoxyCodeLine{2623                                                                 targetFrameTrans);}
\DoxyCodeLine{2624 }
\DoxyCodeLine{2625     \textcolor{comment}{// 3. Make sure we can work with this data before carrying on}}
\DoxyCodeLine{2626     \textcolor{keywordflow}{if} (canTransform)}
\DoxyCodeLine{2627     \{}
\DoxyCodeLine{2628       \textcolor{comment}{/* 4. robot\_localization lets users configure which variables from the sensor should be}}
\DoxyCodeLine{2629 \textcolor{comment}{       *    fused with the filter. This is specified at the sensor level. However, the data}}
\DoxyCodeLine{2630 \textcolor{comment}{       *    may go through transforms before being fused with the state estimate. In that case,}}
\DoxyCodeLine{2631 \textcolor{comment}{       *    we need to know which of the transformed variables came from the pre-\/transformed}}
\DoxyCodeLine{2632 \textcolor{comment}{       *    "approved" variables (i.e., the ones that had "true" in their xxx\_config parameter).}}
\DoxyCodeLine{2633 \textcolor{comment}{       *    To do this, we construct matrices using the update vector values on the diagonals,}}
\DoxyCodeLine{2634 \textcolor{comment}{       *    pass this matrix through the rotation, and use the length of each row to determine}}
\DoxyCodeLine{2635 \textcolor{comment}{       *    the transformed update vector. The process is slightly different for IMUs, as the}}
\DoxyCodeLine{2636 \textcolor{comment}{       *    coordinate frame transform is really the base\_link-\/>imu\_frame transform, and not}}
\DoxyCodeLine{2637 \textcolor{comment}{       *    a transform from some other world-\/fixed frame (even though the IMU data itself *is*}}
\DoxyCodeLine{2638 \textcolor{comment}{       *    reported in a world fixed frame). */}}
\DoxyCodeLine{2639       tf2::Matrix3x3 maskPosition(updateVector[StateMemberX], 0, 0,}
\DoxyCodeLine{2640                                   0, updateVector[StateMemberY], 0,}
\DoxyCodeLine{2641                                   0, 0, updateVector[StateMemberZ]);}
\DoxyCodeLine{2642 }
\DoxyCodeLine{2643       tf2::Matrix3x3 maskOrientation(updateVector[StateMemberRoll], 0, 0,}
\DoxyCodeLine{2644                                      0, updateVector[StateMemberPitch], 0,}
\DoxyCodeLine{2645                                      0, 0, updateVector[StateMemberYaw]);}
\DoxyCodeLine{2646 }
\DoxyCodeLine{2647       \textcolor{keywordflow}{if} (imuData)}
\DoxyCodeLine{2648       \{}
\DoxyCodeLine{2649         \textcolor{comment}{/* We have to treat IMU orientation data differently. Even though we are dealing with pose}}
\DoxyCodeLine{2650 \textcolor{comment}{         * data when we work with orientations, for IMUs, the frame\_id is the frame in which the}}
\DoxyCodeLine{2651 \textcolor{comment}{         * sensor is mounted, and not the coordinate frame of the IMU. Imagine an IMU that is mounted}}
\DoxyCodeLine{2652 \textcolor{comment}{         * facing sideways. The pitch in the IMU frame becomes roll for the vehicle. This means that}}
\DoxyCodeLine{2653 \textcolor{comment}{         * we need to rotate roll and pitch angles by the IMU's mounting yaw offset, and we must apply}}
\DoxyCodeLine{2654 \textcolor{comment}{         * similar treatment to its update mask and covariance. */}}
\DoxyCodeLine{2655 }
\DoxyCodeLine{2656         \textcolor{keywordtype}{double} dummy, yaw;}
\DoxyCodeLine{2657         targetFrameTrans.getBasis().getRPY(dummy, dummy, yaw);}
\DoxyCodeLine{2658         tf2::Matrix3x3 transTmp;}
\DoxyCodeLine{2659         transTmp.setRPY(0.0, 0.0, yaw);}
\DoxyCodeLine{2660 }
\DoxyCodeLine{2661         maskPosition = transTmp * maskPosition;}
\DoxyCodeLine{2662         maskOrientation = transTmp * maskOrientation;}
\DoxyCodeLine{2663       \}}
\DoxyCodeLine{2664       \textcolor{keywordflow}{else}}
\DoxyCodeLine{2665       \{}
\DoxyCodeLine{2666         maskPosition = targetFrameTrans.getBasis() * maskPosition;}
\DoxyCodeLine{2667         maskOrientation = targetFrameTrans.getBasis() * maskOrientation;}
\DoxyCodeLine{2668       \}}
\DoxyCodeLine{2669 }
\DoxyCodeLine{2670       \textcolor{comment}{// Now copy the mask values back into the update vector: any row with a significant vector length}}
\DoxyCodeLine{2671       \textcolor{comment}{// indicates that we want to set that variable to true in the update vector.}}
\DoxyCodeLine{2672       updateVector[StateMemberX] = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(}
\DoxyCodeLine{2673         maskPosition.getRow(StateMemberX -\/ POSITION\_OFFSET).length() >= 1e-\/6);}
\DoxyCodeLine{2674       updateVector[StateMemberY] = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(}
\DoxyCodeLine{2675         maskPosition.getRow(StateMemberY -\/ POSITION\_OFFSET).length() >= 1e-\/6);}
\DoxyCodeLine{2676       updateVector[StateMemberZ] = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(}
\DoxyCodeLine{2677         maskPosition.getRow(StateMemberZ -\/ POSITION\_OFFSET).length() >= 1e-\/6);}
\DoxyCodeLine{2678       updateVector[StateMemberRoll] = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(}
\DoxyCodeLine{2679         maskOrientation.getRow(StateMemberRoll -\/ ORIENTATION\_OFFSET).length() >= 1e-\/6);}
\DoxyCodeLine{2680       updateVector[StateMemberPitch] = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(}
\DoxyCodeLine{2681         maskOrientation.getRow(StateMemberPitch -\/ ORIENTATION\_OFFSET).length() >= 1e-\/6);}
\DoxyCodeLine{2682       updateVector[StateMemberYaw] = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(}
\DoxyCodeLine{2683         maskOrientation.getRow(StateMemberYaw -\/ ORIENTATION\_OFFSET).length() >= 1e-\/6);}
\DoxyCodeLine{2684 }
\DoxyCodeLine{2685       \textcolor{comment}{// 5a. We'll need to rotate the covariance as well. Create a container and copy over the}}
\DoxyCodeLine{2686       \textcolor{comment}{// covariance data}}
\DoxyCodeLine{2687       Eigen::MatrixXd covariance(POSE\_SIZE, POSE\_SIZE);}
\DoxyCodeLine{2688       covariance.setZero();}
\DoxyCodeLine{2689       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a8b299c262fd69e029c8fc05ff19f150e}{copyCovariance}}(\&(msg-\/>pose.covariance[0]), covariance, topicName, updateVector, POSITION\_OFFSET, POSE\_SIZE);}
\DoxyCodeLine{2690 }
\DoxyCodeLine{2691       \textcolor{comment}{// 5b. Now rotate the covariance: create an augmented matrix that}}
\DoxyCodeLine{2692       \textcolor{comment}{// contains a 3D rotation matrix in the upper-\/left and lower-\/right}}
\DoxyCodeLine{2693       \textcolor{comment}{// quadrants, with zeros elsewhere.}}
\DoxyCodeLine{2694       tf2::Matrix3x3 rot;}
\DoxyCodeLine{2695       Eigen::MatrixXd rot6d(POSE\_SIZE, POSE\_SIZE);}
\DoxyCodeLine{2696       rot6d.setIdentity();}
\DoxyCodeLine{2697       Eigen::MatrixXd covarianceRotated;}
\DoxyCodeLine{2698 }
\DoxyCodeLine{2699       \textcolor{keywordflow}{if} (imuData)}
\DoxyCodeLine{2700       \{}
\DoxyCodeLine{2701         \textcolor{comment}{// Apply the same special logic to the IMU covariance rotation}}
\DoxyCodeLine{2702         \textcolor{keywordtype}{double} dummy, yaw;}
\DoxyCodeLine{2703         targetFrameTrans.getBasis().getRPY(dummy, dummy, yaw);}
\DoxyCodeLine{2704         rot.setRPY(0.0, 0.0, yaw);}
\DoxyCodeLine{2705       \}}
\DoxyCodeLine{2706       \textcolor{keywordflow}{else}}
\DoxyCodeLine{2707       \{}
\DoxyCodeLine{2708         rot.setRotation(targetFrameTrans.getRotation());}
\DoxyCodeLine{2709       \}}
\DoxyCodeLine{2710 }
\DoxyCodeLine{2711       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} rInd = 0; rInd < POSITION\_SIZE; ++rInd)}
\DoxyCodeLine{2712       \{}
\DoxyCodeLine{2713         rot6d(rInd, 0) = rot.getRow(rInd).getX();}
\DoxyCodeLine{2714         rot6d(rInd, 1) = rot.getRow(rInd).getY();}
\DoxyCodeLine{2715         rot6d(rInd, 2) = rot.getRow(rInd).getZ();}
\DoxyCodeLine{2716         rot6d(rInd+POSITION\_SIZE, 3) = rot.getRow(rInd).getX();}
\DoxyCodeLine{2717         rot6d(rInd+POSITION\_SIZE, 4) = rot.getRow(rInd).getY();}
\DoxyCodeLine{2718         rot6d(rInd+POSITION\_SIZE, 5) = rot.getRow(rInd).getZ();}
\DoxyCodeLine{2719       \}}
\DoxyCodeLine{2720 }
\DoxyCodeLine{2721       \textcolor{comment}{// Now carry out the rotation}}
\DoxyCodeLine{2722       covarianceRotated = rot6d * covariance * rot6d.transpose();}
\DoxyCodeLine{2723 }
\DoxyCodeLine{2724       RF\_DEBUG(\textcolor{stringliteral}{"After rotating into the "} << finalTargetFrame <<}
\DoxyCodeLine{2725                \textcolor{stringliteral}{" frame, covariance is \(\backslash\)n"} << covarianceRotated <<  \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{2726 }
\DoxyCodeLine{2727       \textcolor{comment}{/* 6a. For IMU data, the transform that we get is the transform from the body}}
\DoxyCodeLine{2728 \textcolor{comment}{       * frame of the robot (e.g., base\_link) to the mounting frame of the robot. It}}
\DoxyCodeLine{2729 \textcolor{comment}{       * is *not* the coordinate frame in which the IMU orientation data is reported.}}
\DoxyCodeLine{2730 \textcolor{comment}{       * If the IMU is mounted in a non-\/neutral orientation, we need to remove those}}
\DoxyCodeLine{2731 \textcolor{comment}{       * offsets, and then we need to potentially "swap" roll and pitch.}}
\DoxyCodeLine{2732 \textcolor{comment}{       * Note that this transform does NOT handle NED-\/>ENU conversions. Data is assumed}}
\DoxyCodeLine{2733 \textcolor{comment}{       * to be in the ENU frame when it is received.}}
\DoxyCodeLine{2734 \textcolor{comment}{       * */}}
\DoxyCodeLine{2735       \textcolor{keywordflow}{if} (imuData)}
\DoxyCodeLine{2736       \{}
\DoxyCodeLine{2737         \textcolor{comment}{// First, convert the transform and measurement rotation to RPY}}
\DoxyCodeLine{2738         \textcolor{comment}{// @todo: There must be a way to handle this with quaternions. Need to look into it.}}
\DoxyCodeLine{2739         \textcolor{keywordtype}{double} rollOffset = 0;}
\DoxyCodeLine{2740         \textcolor{keywordtype}{double} pitchOffset = 0;}
\DoxyCodeLine{2741         \textcolor{keywordtype}{double} yawOffset = 0;}
\DoxyCodeLine{2742         \textcolor{keywordtype}{double} roll = 0;}
\DoxyCodeLine{2743         \textcolor{keywordtype}{double} pitch = 0;}
\DoxyCodeLine{2744         \textcolor{keywordtype}{double} yaw = 0;}
\DoxyCodeLine{2745         RosFilterUtilities::quatToRPY(targetFrameTrans.getRotation(), rollOffset, pitchOffset, yawOffset);}
\DoxyCodeLine{2746         RosFilterUtilities::quatToRPY(poseTmp.getRotation(), roll, pitch, yaw);}
\DoxyCodeLine{2747 }
\DoxyCodeLine{2748         \textcolor{comment}{// 6b. Apply the offset (making sure to bound them), and throw them in a vector}}
\DoxyCodeLine{2749         tf2::Vector3 rpyAngles(FilterUtilities::clampRotation(roll -\/ rollOffset),}
\DoxyCodeLine{2750                                FilterUtilities::clampRotation(pitch -\/ pitchOffset),}
\DoxyCodeLine{2751                                FilterUtilities::clampRotation(yaw -\/ yawOffset));}
\DoxyCodeLine{2752 }
\DoxyCodeLine{2753         \textcolor{comment}{// 6c. Now we need to rotate the roll and pitch by the yaw offset value.}}
\DoxyCodeLine{2754         \textcolor{comment}{// Imagine a case where an IMU is mounted facing sideways. In that case}}
\DoxyCodeLine{2755         \textcolor{comment}{// pitch for the IMU's world frame is roll for the robot.}}
\DoxyCodeLine{2756         tf2::Matrix3x3 mat;}
\DoxyCodeLine{2757         mat.setRPY(0.0, 0.0, yawOffset);}
\DoxyCodeLine{2758         rpyAngles = mat * rpyAngles;}
\DoxyCodeLine{2759         poseTmp.getBasis().setRPY(rpyAngles.getX(), rpyAngles.getY(), rpyAngles.getZ());}
\DoxyCodeLine{2760 }
\DoxyCodeLine{2761         \textcolor{comment}{// We will use this target transformation later on, but}}
\DoxyCodeLine{2762         \textcolor{comment}{// we've already transformed this data as if the IMU}}
\DoxyCodeLine{2763         \textcolor{comment}{// were mounted neutrall on the robot, so we can just}}
\DoxyCodeLine{2764         \textcolor{comment}{// make the transform the identity.}}
\DoxyCodeLine{2765         targetFrameTrans.setIdentity();}
\DoxyCodeLine{2766       \}}
\DoxyCodeLine{2767 }
\DoxyCodeLine{2768       \textcolor{comment}{// 7. Two cases: if we're in differential mode, we need to generate a twist}}
\DoxyCodeLine{2769       \textcolor{comment}{// message. Otherwise, we just transform it to the target frame.}}
\DoxyCodeLine{2770       \textcolor{keywordflow}{if} (differential)}
\DoxyCodeLine{2771       \{}
\DoxyCodeLine{2772         \textcolor{keywordtype}{bool} success = \textcolor{keyword}{false};}
\DoxyCodeLine{2773 }
\DoxyCodeLine{2774         \textcolor{comment}{// We're going to be playing with poseTmp, so store it,}}
\DoxyCodeLine{2775         \textcolor{comment}{// as we'll need to save its current value for the next}}
\DoxyCodeLine{2776         \textcolor{comment}{// measurement.}}
\DoxyCodeLine{2777         curMeasurement = poseTmp;}
\DoxyCodeLine{2778 }
\DoxyCodeLine{2779         \textcolor{comment}{// Make sure we have previous measurements to work with}}
\DoxyCodeLine{2780         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a368ffffbd5a044c29342add42d1971a9}{previousMeasurements\_}}.count(topicName) > 0 \&\& \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a38800f148299b693366730b3488812b0}{previousMeasurementCovariances\_}}.count(topicName) > 0)}
\DoxyCodeLine{2781         \{}
\DoxyCodeLine{2782           \textcolor{comment}{// 7a. If we are carrying out differential integration and}}
\DoxyCodeLine{2783           \textcolor{comment}{// we have a previous measurement for this sensor,then we}}
\DoxyCodeLine{2784           \textcolor{comment}{// need to apply the inverse of that measurement to this new}}
\DoxyCodeLine{2785           \textcolor{comment}{// measurement to produce a "delta" measurement between the two.}}
\DoxyCodeLine{2786           \textcolor{comment}{// Even if we're not using all of the variables from this sensor,}}
\DoxyCodeLine{2787           \textcolor{comment}{// we need to use the whole measurement to determine the delta}}
\DoxyCodeLine{2788           \textcolor{comment}{// to the new measurement}}
\DoxyCodeLine{2789           tf2::Transform prevMeasurement = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a368ffffbd5a044c29342add42d1971a9}{previousMeasurements\_}}[topicName];}
\DoxyCodeLine{2790           poseTmp.setData(prevMeasurement.inverseTimes(poseTmp));}
\DoxyCodeLine{2791 }
\DoxyCodeLine{2792           RF\_DEBUG(\textcolor{stringliteral}{"Previous measurement:\(\backslash\)n"} << \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a368ffffbd5a044c29342add42d1971a9}{previousMeasurements\_}}[topicName] <<}
\DoxyCodeLine{2793                    \textcolor{stringliteral}{"\(\backslash\)nAfter removing previous measurement, measurement delta is:\(\backslash\)n"} << poseTmp << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{2794 }
\DoxyCodeLine{2795           \textcolor{comment}{// 7b. Now we we have a measurement delta in the frame\_id of the}}
\DoxyCodeLine{2796           \textcolor{comment}{// message, but we want that delta to be in the target frame, so}}
\DoxyCodeLine{2797           \textcolor{comment}{// we need to apply the rotation of the target frame transform.}}
\DoxyCodeLine{2798           targetFrameTrans.setOrigin(tf2::Vector3(0.0, 0.0, 0.0));}
\DoxyCodeLine{2799           poseTmp.mult(targetFrameTrans, poseTmp);}
\DoxyCodeLine{2800 }
\DoxyCodeLine{2801           RF\_DEBUG(\textcolor{stringliteral}{"After rotating to the target frame, measurement delta is:\(\backslash\)n"} << poseTmp << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{2802 }
\DoxyCodeLine{2803           \textcolor{comment}{// 7c. Now use the time difference from the last message to compute}}
\DoxyCodeLine{2804           \textcolor{comment}{// translational and rotational velocities}}
\DoxyCodeLine{2805           \textcolor{keywordtype}{double} dt = msg-\/>header.stamp.toSec() -\/ \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a473c0f797fcd9677b1005637ee159ae4}{lastMessageTimes\_}}[topicName].toSec();}
\DoxyCodeLine{2806           \textcolor{keywordtype}{double} xVel = poseTmp.getOrigin().getX() / dt;}
\DoxyCodeLine{2807           \textcolor{keywordtype}{double} yVel = poseTmp.getOrigin().getY() / dt;}
\DoxyCodeLine{2808           \textcolor{keywordtype}{double} zVel = poseTmp.getOrigin().getZ() / dt;}
\DoxyCodeLine{2809 }
\DoxyCodeLine{2810           \textcolor{keywordtype}{double} rollVel = 0;}
\DoxyCodeLine{2811           \textcolor{keywordtype}{double} pitchVel = 0;}
\DoxyCodeLine{2812           \textcolor{keywordtype}{double} yawVel = 0;}
\DoxyCodeLine{2813 }
\DoxyCodeLine{2814           RosFilterUtilities::quatToRPY(poseTmp.getRotation(), rollVel, pitchVel, yawVel);}
\DoxyCodeLine{2815           rollVel /= dt;}
\DoxyCodeLine{2816           pitchVel /= dt;}
\DoxyCodeLine{2817           yawVel /= dt;}
\DoxyCodeLine{2818 }
\DoxyCodeLine{2819           RF\_DEBUG(\textcolor{stringliteral}{"Previous message time was "} << \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a473c0f797fcd9677b1005637ee159ae4}{lastMessageTimes\_}}[topicName].toSec() <<}
\DoxyCodeLine{2820                    \textcolor{stringliteral}{", current message time is "} << msg-\/>header.stamp.toSec() << \textcolor{stringliteral}{", delta is "} <<}
\DoxyCodeLine{2821                    dt << \textcolor{stringliteral}{", velocity is (vX, vY, vZ): ("} << xVel << \textcolor{stringliteral}{", "} << yVel << \textcolor{stringliteral}{", "} << zVel <<}
\DoxyCodeLine{2822                    \textcolor{stringliteral}{")\(\backslash\)n"} << \textcolor{stringliteral}{"(vRoll, vPitch, vYaw): ("} << rollVel << \textcolor{stringliteral}{", "} << pitchVel << \textcolor{stringliteral}{", "} <<}
\DoxyCodeLine{2823                    yawVel << \textcolor{stringliteral}{")\(\backslash\)n"});}
\DoxyCodeLine{2824 }
\DoxyCodeLine{2825           \textcolor{comment}{// 7d. Fill out the velocity data in the message}}
\DoxyCodeLine{2826           geometry\_msgs::TwistWithCovarianceStamped *twistPtr = \textcolor{keyword}{new} geometry\_msgs::TwistWithCovarianceStamped();}
\DoxyCodeLine{2827           twistPtr-\/>header = msg-\/>header;}
\DoxyCodeLine{2828           twistPtr-\/>header.frame\_id = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6c0cfc2c5d47061bf2ae272b7532b51b}{baseLinkFrameId\_}};}
\DoxyCodeLine{2829           twistPtr-\/>twist.twist.linear.x = xVel;}
\DoxyCodeLine{2830           twistPtr-\/>twist.twist.linear.y = yVel;}
\DoxyCodeLine{2831           twistPtr-\/>twist.twist.linear.z = zVel;}
\DoxyCodeLine{2832           twistPtr-\/>twist.twist.angular.x = rollVel;}
\DoxyCodeLine{2833           twistPtr-\/>twist.twist.angular.y = pitchVel;}
\DoxyCodeLine{2834           twistPtr-\/>twist.twist.angular.z = yawVel;}
\DoxyCodeLine{2835           std::vector<int> twistUpdateVec(STATE\_SIZE, \textcolor{keyword}{false});}
\DoxyCodeLine{2836           std::copy(updateVector.begin() + POSITION\_OFFSET,}
\DoxyCodeLine{2837                     updateVector.begin() + POSE\_SIZE,}
\DoxyCodeLine{2838                     twistUpdateVec.begin() + POSITION\_V\_OFFSET);}
\DoxyCodeLine{2839           std::copy(twistUpdateVec.begin(), twistUpdateVec.end(), updateVector.begin());}
\DoxyCodeLine{2840           geometry\_msgs::TwistWithCovarianceStampedConstPtr ptr(twistPtr);}
\DoxyCodeLine{2841 }
\DoxyCodeLine{2842           \textcolor{comment}{// 7e. Now rotate the previous covariance for this measurement to get it}}
\DoxyCodeLine{2843           \textcolor{comment}{// into the target frame, and add the current measurement's rotated covariance}}
\DoxyCodeLine{2844           \textcolor{comment}{// to the previous measurement's rotated covariance, and multiply by the time delta.}}
\DoxyCodeLine{2845           Eigen::MatrixXd prevCovarRotated = rot6d * \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a38800f148299b693366730b3488812b0}{previousMeasurementCovariances\_}}[topicName] * rot6d.transpose();}
\DoxyCodeLine{2846           covarianceRotated = (covarianceRotated.eval() + prevCovarRotated) * dt;}
\DoxyCodeLine{2847           \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a8b299c262fd69e029c8fc05ff19f150e}{copyCovariance}}(covarianceRotated, \&(twistPtr-\/>twist.covariance[0]), POSE\_SIZE);}
\DoxyCodeLine{2848 }
\DoxyCodeLine{2849           RF\_DEBUG(\textcolor{stringliteral}{"Previous measurement covariance:\(\backslash\)n"} << \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a38800f148299b693366730b3488812b0}{previousMeasurementCovariances\_}}[topicName] <<}
\DoxyCodeLine{2850                    \textcolor{stringliteral}{"\(\backslash\)nPrevious measurement covariance rotated:\(\backslash\)n"} << prevCovarRotated <<}
\DoxyCodeLine{2851                    \textcolor{stringliteral}{"\(\backslash\)nFinal twist covariance:\(\backslash\)n"} << covarianceRotated << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{2852 }
\DoxyCodeLine{2853           \textcolor{comment}{// Now pass this on to prepareTwist, which will convert it to the required frame}}
\DoxyCodeLine{2854           success = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a01c500083730b2030e947e21d630e43b}{prepareTwist}}(ptr,}
\DoxyCodeLine{2855                                  topicName + \textcolor{stringliteral}{"\_twist"},}
\DoxyCodeLine{2856                                  twistPtr-\/>header.frame\_id,}
\DoxyCodeLine{2857                                  updateVector,}
\DoxyCodeLine{2858                                  measurement,}
\DoxyCodeLine{2859                                  measurementCovariance);}
\DoxyCodeLine{2860         \}}
\DoxyCodeLine{2861 }
\DoxyCodeLine{2862         \textcolor{comment}{// 7f. Update the previous measurement and measurement covariance}}
\DoxyCodeLine{2863         \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a368ffffbd5a044c29342add42d1971a9}{previousMeasurements\_}}[topicName] = curMeasurement;}
\DoxyCodeLine{2864         \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a38800f148299b693366730b3488812b0}{previousMeasurementCovariances\_}}[topicName] = covariance;}
\DoxyCodeLine{2865 }
\DoxyCodeLine{2866         retVal = success;}
\DoxyCodeLine{2867       \}}
\DoxyCodeLine{2868       \textcolor{keywordflow}{else}}
\DoxyCodeLine{2869       \{}
\DoxyCodeLine{2870         \textcolor{comment}{// 7g. If we're in relative mode, remove the initial measurement}}
\DoxyCodeLine{2871         \textcolor{keywordflow}{if} (relative)}
\DoxyCodeLine{2872         \{}
\DoxyCodeLine{2873           \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a706c4ea2aad03711195e856dbd2e6796}{initialMeasurements\_}}.count(topicName) == 0)}
\DoxyCodeLine{2874           \{}
\DoxyCodeLine{2875             \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a706c4ea2aad03711195e856dbd2e6796}{initialMeasurements\_}}.insert(std::pair<std::string, tf2::Transform>(topicName, poseTmp));}
\DoxyCodeLine{2876           \}}
\DoxyCodeLine{2877 }
\DoxyCodeLine{2878           tf2::Transform initialMeasurement = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a706c4ea2aad03711195e856dbd2e6796}{initialMeasurements\_}}[topicName];}
\DoxyCodeLine{2879           poseTmp.setData(initialMeasurement.inverseTimes(poseTmp));}
\DoxyCodeLine{2880         \}}
\DoxyCodeLine{2881 }
\DoxyCodeLine{2882         \textcolor{comment}{// 7h. Apply the target frame transformation to the pose object.}}
\DoxyCodeLine{2883         poseTmp.mult(targetFrameTrans, poseTmp);}
\DoxyCodeLine{2884         poseTmp.frame\_id\_ = finalTargetFrame;}
\DoxyCodeLine{2885 }
\DoxyCodeLine{2886         \textcolor{comment}{// 7i. Finally, copy everything into our measurement and covariance objects}}
\DoxyCodeLine{2887         measurement(StateMemberX) = poseTmp.getOrigin().x();}
\DoxyCodeLine{2888         measurement(StateMemberY) = poseTmp.getOrigin().y();}
\DoxyCodeLine{2889         measurement(StateMemberZ) = poseTmp.getOrigin().z();}
\DoxyCodeLine{2890 }
\DoxyCodeLine{2891         \textcolor{comment}{// The filter needs roll, pitch, and yaw values instead of quaternions}}
\DoxyCodeLine{2892         \textcolor{keywordtype}{double} roll, pitch, yaw;}
\DoxyCodeLine{2893         RosFilterUtilities::quatToRPY(poseTmp.getRotation(), roll, pitch, yaw);}
\DoxyCodeLine{2894         measurement(StateMemberRoll) = roll;}
\DoxyCodeLine{2895         measurement(StateMemberPitch) = pitch;}
\DoxyCodeLine{2896         measurement(StateMemberYaw) = yaw;}
\DoxyCodeLine{2897 }
\DoxyCodeLine{2898         measurementCovariance.block(0, 0, POSE\_SIZE, POSE\_SIZE) = covarianceRotated.block(0, 0, POSE\_SIZE, POSE\_SIZE);}
\DoxyCodeLine{2899 }
\DoxyCodeLine{2900         \textcolor{comment}{// 8. Handle 2D mode}}
\DoxyCodeLine{2901         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ad06dbf8f35a49fc76daf1c16fdecd34d}{twoDMode\_}})}
\DoxyCodeLine{2902         \{}
\DoxyCodeLine{2903           \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a4585957fbc3239e559eb509921f28a8f}{forceTwoD}}(measurement, measurementCovariance, updateVector);}
\DoxyCodeLine{2904         \}}
\DoxyCodeLine{2905 }
\DoxyCodeLine{2906         retVal = \textcolor{keyword}{true};}
\DoxyCodeLine{2907       \}}
\DoxyCodeLine{2908     \}}
\DoxyCodeLine{2909     \textcolor{keywordflow}{else}}
\DoxyCodeLine{2910     \{}
\DoxyCodeLine{2911       retVal = \textcolor{keyword}{false};}
\DoxyCodeLine{2912 }
\DoxyCodeLine{2913       RF\_DEBUG(\textcolor{stringliteral}{"Could not transform measurement into "} << finalTargetFrame << \textcolor{stringliteral}{". Ignoring..."});}
\DoxyCodeLine{2914     \}}
\DoxyCodeLine{2915 }
\DoxyCodeLine{2916     RF\_DEBUG(\textcolor{stringliteral}{"\(\backslash\)n-\/-\/-\/-\/-\/ /RosFilter::preparePose ("} << topicName << \textcolor{stringliteral}{") -\/-\/-\/-\/-\/-\/\(\backslash\)n"});}
\DoxyCodeLine{2917 }
\DoxyCodeLine{2918     \textcolor{keywordflow}{return} retVal;}
\DoxyCodeLine{2919   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a01c500083730b2030e947e21d630e43b}\label{classRobotLocalization_1_1RosFilter_a01c500083730b2030e947e21d630e43b}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!prepareTwist@{prepareTwist}}
\index{prepareTwist@{prepareTwist}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{prepareTwist()}{prepareTwist()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::prepare\+Twist (\begin{DoxyParamCaption}\item[{const geometry\+\_\+msgs\+::\+Twist\+With\+Covariance\+Stamped\+::\+Const\+Ptr \&}]{msg,  }\item[{const std\+::string \&}]{topic\+Name,  }\item[{const std\+::string \&}]{target\+Frame,  }\item[{std\+::vector$<$ int $>$ \&}]{update\+Vector,  }\item[{Eigen\+::\+Vector\+Xd \&}]{measurement,  }\item[{Eigen\+::\+Matrix\+Xd \&}]{measurement\+Covariance }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}



Prepares a twist message for integration into the filter. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em msg} & -\/ The twist message to prepare \\
\hline
\mbox{\texttt{ in}}  & {\em topic\+Name} & -\/ The name of the topic over which this message was received \\
\hline
\mbox{\texttt{ in}}  & {\em target\+Frame} & -\/ The target tf frame \\
\hline
\mbox{\texttt{ in,out}}  & {\em update\+Vector} & -\/ The update vector for the data source \\
\hline
\mbox{\texttt{ out}}  & {\em measurement} & -\/ The twist data converted to a measurement \\
\hline
\mbox{\texttt{ out}}  & {\em measurement\+Covariance} & -\/ The covariance of the converted measurement \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true indicates that the measurement was successfully prepared, false otherwise 
\end{DoxyReturn}


Definition at line 2922 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{2928   \{}
\DoxyCodeLine{2929     RF\_DEBUG(\textcolor{stringliteral}{"-\/-\/-\/-\/-\/-\/ RosFilter::prepareTwist ("} << topicName << \textcolor{stringliteral}{") -\/-\/-\/-\/-\/-\/\(\backslash\)n"});}
\DoxyCodeLine{2930 }
\DoxyCodeLine{2931     \textcolor{comment}{// 1. Get the measurement into two separate vector objects.}}
\DoxyCodeLine{2932     tf2::Vector3 twistLin(msg-\/>twist.twist.linear.x,}
\DoxyCodeLine{2933                           msg-\/>twist.twist.linear.y,}
\DoxyCodeLine{2934                           msg-\/>twist.twist.linear.z);}
\DoxyCodeLine{2935     tf2::Vector3 measTwistRot(msg-\/>twist.twist.angular.x,}
\DoxyCodeLine{2936                               msg-\/>twist.twist.angular.y,}
\DoxyCodeLine{2937                               msg-\/>twist.twist.angular.z);}
\DoxyCodeLine{2938 }
\DoxyCodeLine{2939     \textcolor{comment}{// 1a. This sensor may or may not measure rotational velocity. Regardless,}}
\DoxyCodeLine{2940     \textcolor{comment}{// if it measures linear velocity, then later on, we'll need to remove "false"}}
\DoxyCodeLine{2941     \textcolor{comment}{// linear velocity resulting from angular velocity and the translational offset}}
\DoxyCodeLine{2942     \textcolor{comment}{// of the sensor from the vehicle origin.}}
\DoxyCodeLine{2943     \textcolor{keyword}{const} Eigen::VectorXd \&state = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.getState();}
\DoxyCodeLine{2944     tf2::Vector3 stateTwistRot(state(StateMemberVroll),}
\DoxyCodeLine{2945                                state(StateMemberVpitch),}
\DoxyCodeLine{2946                                state(StateMemberVyaw));}
\DoxyCodeLine{2947 }
\DoxyCodeLine{2948     \textcolor{comment}{// Determine the frame\_id of the data}}
\DoxyCodeLine{2949     std::string msgFrame = (msg-\/>header.frame\_id == \textcolor{stringliteral}{""} ? targetFrame : msg-\/>header.frame\_id);}
\DoxyCodeLine{2950 }
\DoxyCodeLine{2951     \textcolor{comment}{// 2. robot\_localization lets users configure which variables from the sensor should be}}
\DoxyCodeLine{2952     \textcolor{comment}{//    fused with the filter. This is specified at the sensor level. However, the data}}
\DoxyCodeLine{2953     \textcolor{comment}{//    may go through transforms before being fused with the state estimate. In that case,}}
\DoxyCodeLine{2954     \textcolor{comment}{//    we need to know which of the transformed variables came from the pre-\/transformed}}
\DoxyCodeLine{2955     \textcolor{comment}{//    "approved" variables (i.e., the ones that had "true" in their xxx\_config parameter).}}
\DoxyCodeLine{2956     \textcolor{comment}{//    To do this, we construct matrices using the update vector values on the diagonals,}}
\DoxyCodeLine{2957     \textcolor{comment}{//    pass this matrix through the rotation, and use the length of each row to determine}}
\DoxyCodeLine{2958     \textcolor{comment}{//    the transformed update vector.}}
\DoxyCodeLine{2959     tf2::Matrix3x3 maskLin(updateVector[StateMemberVx], 0, 0,}
\DoxyCodeLine{2960                            0, updateVector[StateMemberVy], 0,}
\DoxyCodeLine{2961                            0, 0, updateVector[StateMemberVz]);}
\DoxyCodeLine{2962 }
\DoxyCodeLine{2963     tf2::Matrix3x3 maskRot(updateVector[StateMemberVroll], 0, 0,}
\DoxyCodeLine{2964                            0, updateVector[StateMemberVpitch], 0,}
\DoxyCodeLine{2965                            0, 0, updateVector[StateMemberVyaw]);}
\DoxyCodeLine{2966 }
\DoxyCodeLine{2967     \textcolor{comment}{// 3. We'll need to rotate the covariance as well}}
\DoxyCodeLine{2968     Eigen::MatrixXd covarianceRotated(TWIST\_SIZE, TWIST\_SIZE);}
\DoxyCodeLine{2969     covarianceRotated.setZero();}
\DoxyCodeLine{2970 }
\DoxyCodeLine{2971     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a8b299c262fd69e029c8fc05ff19f150e}{copyCovariance}}(\&(msg-\/>twist.covariance[0]),}
\DoxyCodeLine{2972                    covarianceRotated,}
\DoxyCodeLine{2973                    topicName,}
\DoxyCodeLine{2974                    updateVector,}
\DoxyCodeLine{2975                    POSITION\_V\_OFFSET,}
\DoxyCodeLine{2976                    TWIST\_SIZE);}
\DoxyCodeLine{2977 }
\DoxyCodeLine{2978     RF\_DEBUG(\textcolor{stringliteral}{"Original measurement as tf object:\(\backslash\)nLinear: "} << twistLin <<}
\DoxyCodeLine{2979              \textcolor{stringliteral}{"Rotational: "} << measTwistRot <<}
\DoxyCodeLine{2980              \textcolor{stringliteral}{"\(\backslash\)nOriginal update vector:\(\backslash\)n"} << updateVector <<}
\DoxyCodeLine{2981              \textcolor{stringliteral}{"\(\backslash\)nOriginal covariance matrix:\(\backslash\)n"} << covarianceRotated << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{2982 }
\DoxyCodeLine{2983     \textcolor{comment}{// 4. We need to transform this into the target frame (probably base\_link)}}
\DoxyCodeLine{2984     tf2::Transform targetFrameTrans;}
\DoxyCodeLine{2985     \textcolor{keywordtype}{bool} canTransform = RosFilterUtilities::lookupTransformSafe(\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aacaed6dea7d7bd1dc1d03eeddf002c29}{tfBuffer\_}},}
\DoxyCodeLine{2986                                                                 targetFrame,}
\DoxyCodeLine{2987                                                                 msgFrame,}
\DoxyCodeLine{2988                                                                 msg-\/>header.stamp,}
\DoxyCodeLine{2989                                                                 \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a5c57fe5f94f02e033ac78939966ad366}{tfTimeout\_}},}
\DoxyCodeLine{2990                                                                 targetFrameTrans);}
\DoxyCodeLine{2991 }
\DoxyCodeLine{2992     \textcolor{keywordflow}{if} (canTransform)}
\DoxyCodeLine{2993     \{}
\DoxyCodeLine{2994       \textcolor{comment}{// Transform to correct frame. Note that we can get linear velocity}}
\DoxyCodeLine{2995       \textcolor{comment}{// as a result of the sensor offset and rotational velocity}}
\DoxyCodeLine{2996       measTwistRot = targetFrameTrans.getBasis() * measTwistRot;}
\DoxyCodeLine{2997       twistLin = targetFrameTrans.getBasis() * twistLin + targetFrameTrans.getOrigin().cross(stateTwistRot);}
\DoxyCodeLine{2998       maskLin = targetFrameTrans.getBasis() * maskLin;}
\DoxyCodeLine{2999       maskRot = targetFrameTrans.getBasis() * maskRot;}
\DoxyCodeLine{3000 }
\DoxyCodeLine{3001       \textcolor{comment}{// Now copy the mask values back into the update vector}}
\DoxyCodeLine{3002       updateVector[StateMemberVx] = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(}
\DoxyCodeLine{3003         maskLin.getRow(StateMemberVx -\/ POSITION\_V\_OFFSET).length() >= 1e-\/6);}
\DoxyCodeLine{3004       updateVector[StateMemberVy] = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(}
\DoxyCodeLine{3005         maskLin.getRow(StateMemberVy -\/ POSITION\_V\_OFFSET).length() >= 1e-\/6);}
\DoxyCodeLine{3006       updateVector[StateMemberVz] = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(}
\DoxyCodeLine{3007         maskLin.getRow(StateMemberVz -\/ POSITION\_V\_OFFSET).length() >= 1e-\/6);}
\DoxyCodeLine{3008       updateVector[StateMemberVroll] = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(}
\DoxyCodeLine{3009         maskRot.getRow(StateMemberVroll -\/ ORIENTATION\_V\_OFFSET).length() >= 1e-\/6);}
\DoxyCodeLine{3010       updateVector[StateMemberVpitch] = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(}
\DoxyCodeLine{3011         maskRot.getRow(StateMemberVpitch -\/ ORIENTATION\_V\_OFFSET).length() >= 1e-\/6);}
\DoxyCodeLine{3012       updateVector[StateMemberVyaw] = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(}
\DoxyCodeLine{3013         maskRot.getRow(StateMemberVyaw -\/ ORIENTATION\_V\_OFFSET).length() >= 1e-\/6);}
\DoxyCodeLine{3014 }
\DoxyCodeLine{3015       RF\_DEBUG(msg-\/>header.frame\_id << \textcolor{stringliteral}{"-\/>"} << targetFrame << \textcolor{stringliteral}{" transform:\(\backslash\)n"} << targetFrameTrans <<}
\DoxyCodeLine{3016                \textcolor{stringliteral}{"\(\backslash\)nAfter applying transform to "} << targetFrame << \textcolor{stringliteral}{", update vector is:\(\backslash\)n"} << updateVector <<}
\DoxyCodeLine{3017                \textcolor{stringliteral}{"\(\backslash\)nAfter applying transform to "} << targetFrame << \textcolor{stringliteral}{", measurement is:\(\backslash\)n"} <<}
\DoxyCodeLine{3018                \textcolor{stringliteral}{"Linear: "} << twistLin << \textcolor{stringliteral}{"Rotational: "} << measTwistRot << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{3019 }
\DoxyCodeLine{3020       \textcolor{comment}{// 5. Now rotate the covariance: create an augmented}}
\DoxyCodeLine{3021       \textcolor{comment}{// matrix that contains a 3D rotation matrix in the}}
\DoxyCodeLine{3022       \textcolor{comment}{// upper-\/left and lower-\/right quadrants, and zeros}}
\DoxyCodeLine{3023       \textcolor{comment}{// elsewhere}}
\DoxyCodeLine{3024       tf2::Matrix3x3 rot(targetFrameTrans.getRotation());}
\DoxyCodeLine{3025       Eigen::MatrixXd rot6d(TWIST\_SIZE, TWIST\_SIZE);}
\DoxyCodeLine{3026       rot6d.setIdentity();}
\DoxyCodeLine{3027 }
\DoxyCodeLine{3028       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} rInd = 0; rInd < POSITION\_SIZE; ++rInd)}
\DoxyCodeLine{3029       \{}
\DoxyCodeLine{3030         rot6d(rInd, 0) = rot.getRow(rInd).getX();}
\DoxyCodeLine{3031         rot6d(rInd, 1) = rot.getRow(rInd).getY();}
\DoxyCodeLine{3032         rot6d(rInd, 2) = rot.getRow(rInd).getZ();}
\DoxyCodeLine{3033         rot6d(rInd+POSITION\_SIZE, 3) = rot.getRow(rInd).getX();}
\DoxyCodeLine{3034         rot6d(rInd+POSITION\_SIZE, 4) = rot.getRow(rInd).getY();}
\DoxyCodeLine{3035         rot6d(rInd+POSITION\_SIZE, 5) = rot.getRow(rInd).getZ();}
\DoxyCodeLine{3036       \}}
\DoxyCodeLine{3037 }
\DoxyCodeLine{3038       \textcolor{comment}{// Carry out the rotation}}
\DoxyCodeLine{3039       covarianceRotated = rot6d * covarianceRotated.eval() * rot6d.transpose();}
\DoxyCodeLine{3040 }
\DoxyCodeLine{3041       RF\_DEBUG(\textcolor{stringliteral}{"Transformed covariance is \(\backslash\)n"} << covarianceRotated << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{3042 }
\DoxyCodeLine{3043       \textcolor{comment}{// 6. Store our corrected measurement and covariance}}
\DoxyCodeLine{3044       measurement(StateMemberVx) = twistLin.getX();}
\DoxyCodeLine{3045       measurement(StateMemberVy) = twistLin.getY();}
\DoxyCodeLine{3046       measurement(StateMemberVz) = twistLin.getZ();}
\DoxyCodeLine{3047       measurement(StateMemberVroll) = measTwistRot.getX();}
\DoxyCodeLine{3048       measurement(StateMemberVpitch) = measTwistRot.getY();}
\DoxyCodeLine{3049       measurement(StateMemberVyaw) = measTwistRot.getZ();}
\DoxyCodeLine{3050 }
\DoxyCodeLine{3051       \textcolor{comment}{// Copy the covariances}}
\DoxyCodeLine{3052       measurementCovariance.block(POSITION\_V\_OFFSET, POSITION\_V\_OFFSET, TWIST\_SIZE, TWIST\_SIZE) =}
\DoxyCodeLine{3053         covarianceRotated.block(0, 0, TWIST\_SIZE, TWIST\_SIZE);}
\DoxyCodeLine{3054 }
\DoxyCodeLine{3055       \textcolor{comment}{// 7. Handle 2D mode}}
\DoxyCodeLine{3056       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ad06dbf8f35a49fc76daf1c16fdecd34d}{twoDMode\_}})}
\DoxyCodeLine{3057       \{}
\DoxyCodeLine{3058         \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a4585957fbc3239e559eb509921f28a8f}{forceTwoD}}(measurement, measurementCovariance, updateVector);}
\DoxyCodeLine{3059       \}}
\DoxyCodeLine{3060     \}}
\DoxyCodeLine{3061     \textcolor{keywordflow}{else}}
\DoxyCodeLine{3062     \{}
\DoxyCodeLine{3063       RF\_DEBUG(\textcolor{stringliteral}{"Could not transform measurement into "} << targetFrame << \textcolor{stringliteral}{". Ignoring..."});}
\DoxyCodeLine{3064     \}}
\DoxyCodeLine{3065 }
\DoxyCodeLine{3066     RF\_DEBUG(\textcolor{stringliteral}{"\(\backslash\)n-\/-\/-\/-\/-\/ /RosFilter::prepareTwist ("} << topicName << \textcolor{stringliteral}{") -\/-\/-\/-\/-\/-\/\(\backslash\)n"});}
\DoxyCodeLine{3067 }
\DoxyCodeLine{3068     \textcolor{keywordflow}{return} canTransform;}
\DoxyCodeLine{3069   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a8ea96b4c2cca39358e3c6e90cfe315bd}\label{classRobotLocalization_1_1RosFilter_a8ea96b4c2cca39358e3c6e90cfe315bd}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!revertTo@{revertTo}}
\index{revertTo@{revertTo}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{revertTo()}{revertTo()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::revert\+To (\begin{DoxyParamCaption}\item[{const double}]{time }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}



Finds the latest filter state before the given timestamp and makes it the current state again. 

This method also inserts all measurements between the older filter timestamp and now into the measurements queue.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em time} & -\/ The time to which the filter state should revert \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True if restoring the filter succeeded. False if not. 
\end{DoxyReturn}


Definition at line 3086 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{3087   \{}
\DoxyCodeLine{3088     RF\_DEBUG(\textcolor{stringliteral}{"\(\backslash\)n-\/-\/-\/-\/-\/ RosFilter::revertTo -\/-\/-\/-\/-\/\(\backslash\)n"});}
\DoxyCodeLine{3089     RF\_DEBUG(\textcolor{stringliteral}{"\(\backslash\)nRequested time was "} << std::setprecision(20) << time << \textcolor{stringliteral}{"\(\backslash\)n"})}
\DoxyCodeLine{3090 }
\DoxyCodeLine{3091     size\_t history\_size = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a37a9eb3abb974e2079e34843dbd69af3}{filterStateHistory\_}}.size();}
\DoxyCodeLine{3092 }
\DoxyCodeLine{3093     \textcolor{comment}{// Walk back through the queue until we reach a filter state whose time stamp is less than or equal to the}}
\DoxyCodeLine{3094     \textcolor{comment}{// requested time. Since every saved state after that time will be overwritten/corrected, we can pop from}}
\DoxyCodeLine{3095     \textcolor{comment}{// the queue. If the history is insufficiently short, we just take the oldest state we have.}}
\DoxyCodeLine{3096     FilterStatePtr lastHistoryState;}
\DoxyCodeLine{3097     while (!\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a37a9eb3abb974e2079e34843dbd69af3}{filterStateHistory\_}}.empty() \&\& \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a37a9eb3abb974e2079e34843dbd69af3}{filterStateHistory\_}}.back()-\/>lastMeasurementTime\_ > time)}
\DoxyCodeLine{3098     \{}
\DoxyCodeLine{3099       lastHistoryState = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a37a9eb3abb974e2079e34843dbd69af3}{filterStateHistory\_}}.back();}
\DoxyCodeLine{3100       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a37a9eb3abb974e2079e34843dbd69af3}{filterStateHistory\_}}.pop\_back();}
\DoxyCodeLine{3101     \}}
\DoxyCodeLine{3102 }
\DoxyCodeLine{3103     \textcolor{comment}{// If the state history is not empty at this point, it means that our history was large enough, and we}}
\DoxyCodeLine{3104     \textcolor{comment}{// should revert to the state at the back of the history deque.}}
\DoxyCodeLine{3105     \textcolor{keywordtype}{bool} retVal = \textcolor{keyword}{false};}
\DoxyCodeLine{3106     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a37a9eb3abb974e2079e34843dbd69af3}{filterStateHistory\_}}.empty())}
\DoxyCodeLine{3107     \{}
\DoxyCodeLine{3108       retVal = \textcolor{keyword}{true};}
\DoxyCodeLine{3109       lastHistoryState = \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a37a9eb3abb974e2079e34843dbd69af3}{filterStateHistory\_}}.back();}
\DoxyCodeLine{3110     \}}
\DoxyCodeLine{3111     \textcolor{keywordflow}{else}}
\DoxyCodeLine{3112     \{}
\DoxyCodeLine{3113       RF\_DEBUG(\textcolor{stringliteral}{"Insufficient history to revert to time "} << time << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{3114 }
\DoxyCodeLine{3115       \textcolor{keywordflow}{if} (lastHistoryState)}
\DoxyCodeLine{3116       \{}
\DoxyCodeLine{3117         RF\_DEBUG(\textcolor{stringliteral}{"Will revert to oldest state at "} << lastHistoryState-\/>latestControlTime\_ << \textcolor{stringliteral}{".\(\backslash\)n"});}
\DoxyCodeLine{3118         ROS\_WARN\_STREAM\_DELAYED\_THROTTLE(\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a84b03bc70e9979c28deb044c545ba287}{historyLength\_}}, \textcolor{stringliteral}{"Could not revert to state with time "} <<}
\DoxyCodeLine{3119           std::setprecision(20) << time << \textcolor{stringliteral}{". Instead reverted to state with time "} <<}
\DoxyCodeLine{3120           lastHistoryState-\/>lastMeasurementTime\_ << \textcolor{stringliteral}{". History size was "} << history\_size);}
\DoxyCodeLine{3121       \}}
\DoxyCodeLine{3122     \}}
\DoxyCodeLine{3123 }
\DoxyCodeLine{3124     \textcolor{comment}{// If we have a valid reversion state, revert}}
\DoxyCodeLine{3125     \textcolor{keywordflow}{if} (lastHistoryState)}
\DoxyCodeLine{3126     \{}
\DoxyCodeLine{3127       \textcolor{comment}{// Reset filter to the latest state from the queue.}}
\DoxyCodeLine{3128       \textcolor{keyword}{const} FilterStatePtr \&state = lastHistoryState;}
\DoxyCodeLine{3129       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.setState(state-\/>state\_);}
\DoxyCodeLine{3130       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.setEstimateErrorCovariance(state-\/>estimateErrorCovariance\_);}
\DoxyCodeLine{3131       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.setLastMeasurementTime(state-\/>lastMeasurementTime\_);}
\DoxyCodeLine{3132 }
\DoxyCodeLine{3133       RF\_DEBUG(\textcolor{stringliteral}{"Reverted to state with time "} << std::setprecision(20) << state-\/>lastMeasurementTime\_ << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{3134 }
\DoxyCodeLine{3135       \textcolor{comment}{// Repeat for measurements, but push every measurement onto the measurement queue as we go}}
\DoxyCodeLine{3136       \textcolor{keywordtype}{int} restored\_measurements = 0;}
\DoxyCodeLine{3137       \textcolor{keywordflow}{while} (!\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aeb7a3b61549bad2cc4e84d803c038c5f}{measurementHistory\_}}.empty() \&\& \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aeb7a3b61549bad2cc4e84d803c038c5f}{measurementHistory\_}}.back()-\/>time\_ > time)}
\DoxyCodeLine{3138       \{}
\DoxyCodeLine{3139         \textcolor{comment}{// Don't need to restore measurements that predate our earliest state time}}
\DoxyCodeLine{3140         \textcolor{keywordflow}{if} (state-\/>lastMeasurementTime\_ <= \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aeb7a3b61549bad2cc4e84d803c038c5f}{measurementHistory\_}}.back()-\/>time\_)}
\DoxyCodeLine{3141         \{}
\DoxyCodeLine{3142           \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a233bcdab40b3b0d7db316ffd0c09f2ce}{measurementQueue\_}}.push(\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aeb7a3b61549bad2cc4e84d803c038c5f}{measurementHistory\_}}.back());}
\DoxyCodeLine{3143           restored\_measurements++;}
\DoxyCodeLine{3144         \}}
\DoxyCodeLine{3145 }
\DoxyCodeLine{3146         \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aeb7a3b61549bad2cc4e84d803c038c5f}{measurementHistory\_}}.pop\_back();}
\DoxyCodeLine{3147       \}}
\DoxyCodeLine{3148 }
\DoxyCodeLine{3149       RF\_DEBUG(\textcolor{stringliteral}{"Restored "} << restored\_measurements << \textcolor{stringliteral}{" to measurement queue.\(\backslash\)n"});}
\DoxyCodeLine{3150     \}}
\DoxyCodeLine{3151 }
\DoxyCodeLine{3152     RF\_DEBUG(\textcolor{stringliteral}{"\(\backslash\)n-\/-\/-\/-\/-\/ /RosFilter::revertTo\(\backslash\)n"});}
\DoxyCodeLine{3153 }
\DoxyCodeLine{3154     \textcolor{keywordflow}{return} retVal;}
\DoxyCodeLine{3155   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a0247b864a7b44e5310e7d05e69e41695}\label{classRobotLocalization_1_1RosFilter_a0247b864a7b44e5310e7d05e69e41695}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!saveFilterState@{saveFilterState}}
\index{saveFilterState@{saveFilterState}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{saveFilterState()}{saveFilterState()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::save\+Filter\+State (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classRobotLocalization_1_1FilterBase}{Filter\+Base}} \&}]{filter }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}



Saves the current filter state in the queue of previous filter states. 

These measurements will be used in backwards smoothing in the event that older measurements come in. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em filter} & -\/ The filter base object whose state we want to save \\
\hline
\end{DoxyParams}


Definition at line 3072 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{3073   \{}
\DoxyCodeLine{3074     FilterStatePtr state = FilterStatePtr(\textcolor{keyword}{new} FilterState());}
\DoxyCodeLine{3075     state-\/>state\_ = Eigen::VectorXd(filter.getState());}
\DoxyCodeLine{3076     state-\/>estimateErrorCovariance\_ = Eigen::MatrixXd(filter.getEstimateErrorCovariance());}
\DoxyCodeLine{3077     state-\/>lastMeasurementTime\_ = filter.getLastMeasurementTime();}
\DoxyCodeLine{3078     state-\/>latestControl\_ = Eigen::VectorXd(filter.getControl());}
\DoxyCodeLine{3079     state-\/>latestControlTime\_ = filter.getControlTime();}
\DoxyCodeLine{3080     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a37a9eb3abb974e2079e34843dbd69af3}{filterStateHistory\_}}.push\_back(state);}
\DoxyCodeLine{3081     RF\_DEBUG(\textcolor{stringliteral}{"Saved state with timestamp "} << std::setprecision(20) << state-\/>lastMeasurementTime\_ <<}
\DoxyCodeLine{3082              \textcolor{stringliteral}{" to history. "} << \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a37a9eb3abb974e2079e34843dbd69af3}{filterStateHistory\_}}.size() << \textcolor{stringliteral}{" measurements are in the queue.\(\backslash\)n"});}
\DoxyCodeLine{3083   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_ae4a8a9f6bc2aa5358c04de11ed72a821}\label{classRobotLocalization_1_1RosFilter_ae4a8a9f6bc2aa5358c04de11ed72a821}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!setPoseCallback@{setPoseCallback}}
\index{setPoseCallback@{setPoseCallback}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{setPoseCallback()}{setPoseCallback()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::set\+Pose\+Callback (\begin{DoxyParamCaption}\item[{const geometry\+\_\+msgs\+::\+Pose\+With\+Covariance\+Stamped\+::\+Const\+Ptr \&}]{msg }\end{DoxyParamCaption})}



Callback method for manually setting/resetting the internal pose estimate. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em msg} & -\/ The R\+OS stamped pose with covariance message to take in \\
\hline
\end{DoxyParams}


Definition at line 2005 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{2006   \{}
\DoxyCodeLine{2007     RF\_DEBUG(\textcolor{stringliteral}{"-\/-\/-\/-\/-\/-\/ RosFilter::setPoseCallback -\/-\/-\/-\/-\/-\/\(\backslash\)nPose message:\(\backslash\)n"} << *msg);}
\DoxyCodeLine{2008 }
\DoxyCodeLine{2009     ROS\_INFO\_STREAM(\textcolor{stringliteral}{"Received set\_pose request with value\(\backslash\)n"} << *msg);}
\DoxyCodeLine{2010 }
\DoxyCodeLine{2011     std::string topicName(\textcolor{stringliteral}{"setPose"});}
\DoxyCodeLine{2012 }
\DoxyCodeLine{2013     \textcolor{comment}{// Get rid of any initial poses (pretend we've never had a measurement)}}
\DoxyCodeLine{2014     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a706c4ea2aad03711195e856dbd2e6796}{initialMeasurements\_}}.clear();}
\DoxyCodeLine{2015     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a368ffffbd5a044c29342add42d1971a9}{previousMeasurements\_}}.clear();}
\DoxyCodeLine{2016     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a38800f148299b693366730b3488812b0}{previousMeasurementCovariances\_}}.clear();}
\DoxyCodeLine{2017 }
\DoxyCodeLine{2018     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a1ff13740c9af1413442122197e565caf}{clearMeasurementQueue}}();}
\DoxyCodeLine{2019 }
\DoxyCodeLine{2020     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a37a9eb3abb974e2079e34843dbd69af3}{filterStateHistory\_}}.clear();}
\DoxyCodeLine{2021     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aeb7a3b61549bad2cc4e84d803c038c5f}{measurementHistory\_}}.clear();}
\DoxyCodeLine{2022 }
\DoxyCodeLine{2023     \textcolor{comment}{// Also set the last set pose time, so we ignore all messages}}
\DoxyCodeLine{2024     \textcolor{comment}{// that occur before it}}
\DoxyCodeLine{2025     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aa9df5f56cfb6d02a4bc22c8b68ad115f}{lastSetPoseTime\_}} = msg-\/>header.stamp;}
\DoxyCodeLine{2026 }
\DoxyCodeLine{2027     \textcolor{comment}{// Set the state vector to the reported pose}}
\DoxyCodeLine{2028     Eigen::VectorXd measurement(STATE\_SIZE);}
\DoxyCodeLine{2029     Eigen::MatrixXd measurementCovariance(STATE\_SIZE, STATE\_SIZE);}
\DoxyCodeLine{2030     std::vector<int> updateVector(STATE\_SIZE, \textcolor{keyword}{true});}
\DoxyCodeLine{2031 }
\DoxyCodeLine{2032     \textcolor{comment}{// We only measure pose variables, so initialize the vector to 0}}
\DoxyCodeLine{2033     measurement.setZero();}
\DoxyCodeLine{2034 }
\DoxyCodeLine{2035     \textcolor{comment}{// Set this to the identity and let the message reset it}}
\DoxyCodeLine{2036     measurementCovariance.setIdentity();}
\DoxyCodeLine{2037     measurementCovariance *= 1e-\/6;}
\DoxyCodeLine{2038 }
\DoxyCodeLine{2039     \textcolor{comment}{// Prepare the pose data (really just using this to transform it into the target frame).}}
\DoxyCodeLine{2040     \textcolor{comment}{// Twist data is going to get zeroed out.}}
\DoxyCodeLine{2041     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a2538569c164be4b396576252e69732bb}{preparePose}}(msg, topicName, \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a37c23d6c10a630fe33e74376898fc5c8}{worldFrameId\_}}, \textcolor{keyword}{false}, \textcolor{keyword}{false}, \textcolor{keyword}{false}, updateVector, measurement, measurementCovariance);}
\DoxyCodeLine{2042 }
\DoxyCodeLine{2043     \textcolor{comment}{// For the state}}
\DoxyCodeLine{2044     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.setState(measurement);}
\DoxyCodeLine{2045     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.setEstimateErrorCovariance(measurementCovariance);}
\DoxyCodeLine{2046 }
\DoxyCodeLine{2047     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6061a5284caef5912ec015e6caaf00a0}{filter\_}}.setLastMeasurementTime(ros::Time::now().toSec());}
\DoxyCodeLine{2048 }
\DoxyCodeLine{2049     RF\_DEBUG(\textcolor{stringliteral}{"\(\backslash\)n-\/-\/-\/-\/-\/-\/ /RosFilter::setPoseCallback -\/-\/-\/-\/-\/-\/\(\backslash\)n"});}
\DoxyCodeLine{2050   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_ae7e52d78645c3c68279d81d0b0feda25}\label{classRobotLocalization_1_1RosFilter_ae7e52d78645c3c68279d81d0b0feda25}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!setPoseSrvCallback@{setPoseSrvCallback}}
\index{setPoseSrvCallback@{setPoseSrvCallback}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{setPoseSrvCallback()}{setPoseSrvCallback()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::set\+Pose\+Srv\+Callback (\begin{DoxyParamCaption}\item[{robot\+\_\+localization\+::\+Set\+Pose\+::\+Request \&}]{request,  }\item[{robot\+\_\+localization\+::\+Set\+Pose\+::\+Response \&}]{ }\end{DoxyParamCaption})}



Service callback for manually setting/resetting the internal pose estimate. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em request} & -\/ Custom service request with pose information \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true if successful, false if not 
\end{DoxyReturn}


Definition at line 2053 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{2055   \{}
\DoxyCodeLine{2056     geometry\_msgs::PoseWithCovarianceStamped::Ptr msg;}
\DoxyCodeLine{2057     msg = boost::make\_shared<geometry\_msgs::PoseWithCovarianceStamped>(request.pose);}
\DoxyCodeLine{2058     \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ae4a8a9f6bc2aa5358c04de11ed72a821}{setPoseCallback}}(msg);}
\DoxyCodeLine{2059 }
\DoxyCodeLine{2060     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{2061   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_afb177072d3c8ff1f4b9442ad41c2d754}\label{classRobotLocalization_1_1RosFilter_afb177072d3c8ff1f4b9442ad41c2d754}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!toggleFilterProcessingCallback@{toggleFilterProcessingCallback}}
\index{toggleFilterProcessingCallback@{toggleFilterProcessingCallback}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{toggleFilterProcessingCallback()}{toggleFilterProcessingCallback()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::toggle\+Filter\+Processing\+Callback (\begin{DoxyParamCaption}\item[{robot\+\_\+localization\+::\+Toggle\+Filter\+Processing\+::\+Request \&}]{req,  }\item[{robot\+\_\+localization\+::\+Toggle\+Filter\+Processing\+::\+Response \&}]{resp }\end{DoxyParamCaption})}



Service callback to toggle processing measurements for a standby mode but continuing to publish. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em request} & -\/ The state requested, on (True) or off (False) \\
\hline
\mbox{\texttt{ out}}  & {\em response} & -\/ status if upon success \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
boolean true if successful, false if not 
\end{DoxyReturn}


Definition at line 183 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{185   \{}
\DoxyCodeLine{186     \textcolor{keywordflow}{if} (req.on == \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ac22190accdeee0fc2dcfb692e5d97038}{toggledOn\_}})}
\DoxyCodeLine{187     \{}
\DoxyCodeLine{188       ROS\_WARN\_STREAM(\textcolor{stringliteral}{"Service was called to toggle filter processing but state was already as requested."});}
\DoxyCodeLine{189       resp.status = \textcolor{keyword}{false};}
\DoxyCodeLine{190     \}}
\DoxyCodeLine{191     \textcolor{keywordflow}{else}}
\DoxyCodeLine{192     \{}
\DoxyCodeLine{193       ROS\_INFO(\textcolor{stringliteral}{"Toggling filter measurement filtering to \%s."}, req.on ? \textcolor{stringliteral}{"On"} : \textcolor{stringliteral}{"Off"});}
\DoxyCodeLine{194       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_ac22190accdeee0fc2dcfb692e5d97038}{toggledOn\_}} = req.on;}
\DoxyCodeLine{195       resp.status = \textcolor{keyword}{true};}
\DoxyCodeLine{196     \}}
\DoxyCodeLine{197     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{198   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_aeec53ee745d41ed8e342c9688a4a3165}\label{classRobotLocalization_1_1RosFilter_aeec53ee745d41ed8e342c9688a4a3165}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!twistCallback@{twistCallback}}
\index{twistCallback@{twistCallback}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{twistCallback()}{twistCallback()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
void \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::twist\+Callback (\begin{DoxyParamCaption}\item[{const geometry\+\_\+msgs\+::\+Twist\+With\+Covariance\+Stamped\+::\+Const\+Ptr \&}]{msg,  }\item[{const \mbox{\hyperlink{structRobotLocalization_1_1CallbackData}{Callback\+Data}} \&}]{callback\+Data,  }\item[{const std\+::string \&}]{target\+Frame }\end{DoxyParamCaption})}



Callback method for receiving all twist messages. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em msg} & -\/ The R\+OS stamped twist with covariance message to take in. \\
\hline
\mbox{\texttt{ in}}  & {\em callback\+Data} & -\/ Relevant static callback data \\
\hline
\mbox{\texttt{ in}}  & {\em target\+Frame} & -\/ The target frame\+\_\+id into which to transform the data \\
\hline
\end{DoxyParams}


Definition at line 2082 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{2085   \{}
\DoxyCodeLine{2086     \textcolor{keyword}{const} std::string \&topicName = callbackData.topicName\_;}
\DoxyCodeLine{2087 }
\DoxyCodeLine{2088     \textcolor{comment}{// If we've just reset the filter, then we want to ignore any messages}}
\DoxyCodeLine{2089     \textcolor{comment}{// that arrive with an older timestamp}}
\DoxyCodeLine{2090     \textcolor{keywordflow}{if} (msg-\/>header.stamp <= \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_aa9df5f56cfb6d02a4bc22c8b68ad115f}{lastSetPoseTime\_}})}
\DoxyCodeLine{2091     \{}
\DoxyCodeLine{2092       std::stringstream stream;}
\DoxyCodeLine{2093       stream << \textcolor{stringliteral}{"The "} << topicName << \textcolor{stringliteral}{" message has a timestamp equal to or before the last filter reset, "} <<}
\DoxyCodeLine{2094                 \textcolor{stringliteral}{"this message will be ignored. This may indicate an empty or bad timestamp. (message time: "} <<}
\DoxyCodeLine{2095                 msg-\/>header.stamp.toSec() << \textcolor{stringliteral}{")"};}
\DoxyCodeLine{2096       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a8266b1436e1907c160d8c73a920e806c}{addDiagnostic}}(diagnostic\_msgs::DiagnosticStatus::WARN,}
\DoxyCodeLine{2097                     topicName + \textcolor{stringliteral}{"\_timestamp"},}
\DoxyCodeLine{2098                     stream.str(),}
\DoxyCodeLine{2099                     \textcolor{keyword}{false});}
\DoxyCodeLine{2100       \textcolor{keywordflow}{return};}
\DoxyCodeLine{2101     \}}
\DoxyCodeLine{2102 }
\DoxyCodeLine{2103     RF\_DEBUG(\textcolor{stringliteral}{"-\/-\/-\/-\/-\/-\/ RosFilter::twistCallback ("} << topicName << \textcolor{stringliteral}{") -\/-\/-\/-\/-\/-\/\(\backslash\)n"}}
\DoxyCodeLine{2104              \textcolor{stringliteral}{"Twist message:\(\backslash\)n"} << *msg);}
\DoxyCodeLine{2105 }
\DoxyCodeLine{2106     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a473c0f797fcd9677b1005637ee159ae4}{lastMessageTimes\_}}.count(topicName) == 0)}
\DoxyCodeLine{2107     \{}
\DoxyCodeLine{2108       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a473c0f797fcd9677b1005637ee159ae4}{lastMessageTimes\_}}.insert(std::pair<std::string, ros::Time>(topicName, msg-\/>header.stamp));}
\DoxyCodeLine{2109     \}}
\DoxyCodeLine{2110 }
\DoxyCodeLine{2111     \textcolor{comment}{// Make sure this message is newer than the last one}}
\DoxyCodeLine{2112     \textcolor{keywordflow}{if} (msg-\/>header.stamp >= \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a473c0f797fcd9677b1005637ee159ae4}{lastMessageTimes\_}}[topicName])}
\DoxyCodeLine{2113     \{}
\DoxyCodeLine{2114       RF\_DEBUG(\textcolor{stringliteral}{"Update vector for "} << topicName << \textcolor{stringliteral}{" is:\(\backslash\)n"} << callbackData.updateVector\_);}
\DoxyCodeLine{2115 }
\DoxyCodeLine{2116       Eigen::VectorXd measurement(STATE\_SIZE);}
\DoxyCodeLine{2117       Eigen::MatrixXd measurementCovariance(STATE\_SIZE, STATE\_SIZE);}
\DoxyCodeLine{2118 }
\DoxyCodeLine{2119       measurement.setZero();}
\DoxyCodeLine{2120       measurementCovariance.setZero();}
\DoxyCodeLine{2121 }
\DoxyCodeLine{2122       \textcolor{comment}{// Make sure we're actually updating at least one of these variables}}
\DoxyCodeLine{2123       std::vector<int> updateVectorCorrected = callbackData.updateVector\_;}
\DoxyCodeLine{2124 }
\DoxyCodeLine{2125       \textcolor{comment}{// Prepare the twist data for inclusion in the filter}}
\DoxyCodeLine{2126       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a01c500083730b2030e947e21d630e43b}{prepareTwist}}(msg, topicName, targetFrame, updateVectorCorrected, measurement, measurementCovariance))}
\DoxyCodeLine{2127       \{}
\DoxyCodeLine{2128         \textcolor{comment}{// Store the measurement. Add a "twist" suffix so we know what kind of measurement}}
\DoxyCodeLine{2129         \textcolor{comment}{// we're dealing with when we debug the core filter logic.}}
\DoxyCodeLine{2130         \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a6f69cfe0fd2fea54446e4895b14c4c88}{enqueueMeasurement}}(topicName,}
\DoxyCodeLine{2131                            measurement,}
\DoxyCodeLine{2132                            measurementCovariance,}
\DoxyCodeLine{2133                            updateVectorCorrected,}
\DoxyCodeLine{2134                            callbackData.rejectionThreshold\_,}
\DoxyCodeLine{2135                            msg-\/>header.stamp);}
\DoxyCodeLine{2136 }
\DoxyCodeLine{2137         RF\_DEBUG(\textcolor{stringliteral}{"Enqueued new measurement for "} << topicName << \textcolor{stringliteral}{"\_twist\(\backslash\)n"});}
\DoxyCodeLine{2138       \}}
\DoxyCodeLine{2139       \textcolor{keywordflow}{else}}
\DoxyCodeLine{2140       \{}
\DoxyCodeLine{2141         RF\_DEBUG(\textcolor{stringliteral}{"Did *not* enqueue measurement for "} << topicName << \textcolor{stringliteral}{"\_twist\(\backslash\)n"});}
\DoxyCodeLine{2142       \}}
\DoxyCodeLine{2143 }
\DoxyCodeLine{2144       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a473c0f797fcd9677b1005637ee159ae4}{lastMessageTimes\_}}[topicName] = msg-\/>header.stamp;}
\DoxyCodeLine{2145 }
\DoxyCodeLine{2146       RF\_DEBUG(\textcolor{stringliteral}{"Last message time for "} << topicName << \textcolor{stringliteral}{" is now "} <<}
\DoxyCodeLine{2147         \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a473c0f797fcd9677b1005637ee159ae4}{lastMessageTimes\_}}[topicName] << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{2148     \}}
\DoxyCodeLine{2149     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a16ad0452b5b52e64a93736d25cfeba95}{resetOnTimeJump\_}} \&\& ros::Time::isSimTime())}
\DoxyCodeLine{2150     \{}
\DoxyCodeLine{2151       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a011b39dad94b84b7856f993518e4ae00}{reset}}();}
\DoxyCodeLine{2152     \}}
\DoxyCodeLine{2153     \textcolor{keywordflow}{else}}
\DoxyCodeLine{2154     \{}
\DoxyCodeLine{2155       std::stringstream stream;}
\DoxyCodeLine{2156       stream << \textcolor{stringliteral}{"The "} << topicName << \textcolor{stringliteral}{" message has a timestamp before that of the previous message received,"} <<}
\DoxyCodeLine{2157                 \textcolor{stringliteral}{" this message will be ignored. This may indicate a bad timestamp. (message time: "} <<}
\DoxyCodeLine{2158                 msg-\/>header.stamp.toSec() << \textcolor{stringliteral}{")"};}
\DoxyCodeLine{2159       \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a8266b1436e1907c160d8c73a920e806c}{addDiagnostic}}(diagnostic\_msgs::DiagnosticStatus::WARN,}
\DoxyCodeLine{2160                     topicName + \textcolor{stringliteral}{"\_timestamp"},}
\DoxyCodeLine{2161                     stream.str(),}
\DoxyCodeLine{2162                     \textcolor{keyword}{false});}
\DoxyCodeLine{2163 }
\DoxyCodeLine{2164       RF\_DEBUG(\textcolor{stringliteral}{"Message is too old. Last message time for "} << topicName << \textcolor{stringliteral}{" is "} << \mbox{\hyperlink{classRobotLocalization_1_1RosFilter_a473c0f797fcd9677b1005637ee159ae4}{lastMessageTimes\_}}[topicName] <<}
\DoxyCodeLine{2165         \textcolor{stringliteral}{", current message time is "} << msg-\/>header.stamp << \textcolor{stringliteral}{".\(\backslash\)n"});}
\DoxyCodeLine{2166     \}}
\DoxyCodeLine{2167 }
\DoxyCodeLine{2168     RF\_DEBUG(\textcolor{stringliteral}{"\(\backslash\)n-\/-\/-\/-\/-\/ /RosFilter::twistCallback ("} << topicName << \textcolor{stringliteral}{") -\/-\/-\/-\/-\/-\/\(\backslash\)n"});}
\DoxyCodeLine{2169   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a3de307ae35c1f4d6df8d3e19ec06d3e8}\label{classRobotLocalization_1_1RosFilter_a3de307ae35c1f4d6df8d3e19ec06d3e8}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!validateFilterOutput@{validateFilterOutput}}
\index{validateFilterOutput@{validateFilterOutput}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{validateFilterOutput()}{validateFilterOutput()}}
{\footnotesize\ttfamily template$<$typename T $>$ \\
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::validate\+Filter\+Output (\begin{DoxyParamCaption}\item[{const nav\+\_\+msgs\+::\+Odometry \&}]{message }\end{DoxyParamCaption})}



Validates filter outputs for Na\+Ns and Infinite values. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ out}}  & {\em message} & -\/ The standard R\+OS odometry message to be validated \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true if the filter output is valid, false otherwise 
\end{DoxyReturn}


Definition at line 3158 of file ros\+\_\+filter.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{3159   \{}
\DoxyCodeLine{3160     \textcolor{keywordflow}{return} !std::isnan(message.pose.pose.position.x) \&\& !std::isinf(message.pose.pose.position.x) \&\&}
\DoxyCodeLine{3161            !std::isnan(message.pose.pose.position.y) \&\& !std::isinf(message.pose.pose.position.y) \&\&}
\DoxyCodeLine{3162            !std::isnan(message.pose.pose.position.z) \&\& !std::isinf(message.pose.pose.position.z) \&\&}
\DoxyCodeLine{3163            !std::isnan(message.pose.pose.orientation.x) \&\& !std::isinf(message.pose.pose.orientation.x) \&\&}
\DoxyCodeLine{3164            !std::isnan(message.pose.pose.orientation.y) \&\& !std::isinf(message.pose.pose.orientation.y) \&\&}
\DoxyCodeLine{3165            !std::isnan(message.pose.pose.orientation.z) \&\& !std::isinf(message.pose.pose.orientation.z) \&\&}
\DoxyCodeLine{3166            !std::isnan(message.pose.pose.orientation.w) \&\& !std::isinf(message.pose.pose.orientation.w) \&\&}
\DoxyCodeLine{3167            !std::isnan(message.twist.twist.linear.x) \&\& !std::isinf(message.twist.twist.linear.x) \&\&}
\DoxyCodeLine{3168            !std::isnan(message.twist.twist.linear.y) \&\& !std::isinf(message.twist.twist.linear.y) \&\&}
\DoxyCodeLine{3169            !std::isnan(message.twist.twist.linear.z) \&\& !std::isinf(message.twist.twist.linear.z) \&\&}
\DoxyCodeLine{3170            !std::isnan(message.twist.twist.angular.x) \&\& !std::isinf(message.twist.twist.angular.x) \&\&}
\DoxyCodeLine{3171            !std::isnan(message.twist.twist.angular.y) \&\& !std::isinf(message.twist.twist.angular.y) \&\&}
\DoxyCodeLine{3172            !std::isnan(message.twist.twist.angular.z) \&\& !std::isinf(message.twist.twist.angular.z);}
\DoxyCodeLine{3173   \}}

\end{DoxyCode}


\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a4b00cc26b36b9039f120eecf7a7d4ab1}\label{classRobotLocalization_1_1RosFilter_a4b00cc26b36b9039f120eecf7a7d4ab1}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!baseLinkOutputFrameId\_@{baseLinkOutputFrameId\_}}
\index{baseLinkOutputFrameId\_@{baseLinkOutputFrameId\_}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{baseLinkOutputFrameId\_}{baseLinkOutputFrameId\_}}
{\footnotesize\ttfamily template$<$class T $>$ \\
std\+::string \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::base\+Link\+Output\+Frame\+Id\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}



tf frame name for the robot\textquotesingle{}s body frame 

When the final state is computed, we \char`\"{}override\char`\"{} the output transform and message to have this frame for its child\+\_\+frame\+\_\+id. This helps to enable disconnected TF trees when multiple E\+KF instances are being run. 

Definition at line 516 of file ros\+\_\+filter.\+h.

\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_adb32c6e37c800af6a02158c071f85d92}\label{classRobotLocalization_1_1RosFilter_adb32c6e37c800af6a02158c071f85d92}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!disabledAtStartup\_@{disabledAtStartup\_}}
\index{disabledAtStartup\_@{disabledAtStartup\_}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{disabledAtStartup\_}{disabledAtStartup\_}}
{\footnotesize\ttfamily template$<$class T $>$ \\
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::disabled\+At\+Startup\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}



Start the Filter disabled at startup. 

If this is true, the filter reads parameters and prepares publishers and subscribes but does not integrate new messages into the state vector. The filter can be enabled later using a service. 

Definition at line 430 of file ros\+\_\+filter.\+h.

\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a7b48b5bb099cf8c0bd283b6fd5661424}\label{classRobotLocalization_1_1RosFilter_a7b48b5bb099cf8c0bd283b6fd5661424}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!dynamicDiagnostics\_@{dynamicDiagnostics\_}}
\index{dynamicDiagnostics\_@{dynamicDiagnostics\_}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{dynamicDiagnostics\_}{dynamicDiagnostics\_}}
{\footnotesize\ttfamily template$<$class T $>$ \\
std\+::map$<$std\+::string, std\+::string$>$ \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::dynamic\+Diagnostics\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}



This object accumulates dynamic diagnostics, e.\+g., diagnostics relating to sensor data. 

The values are considered transient and are cleared at every iteration. 

Definition at line 547 of file ros\+\_\+filter.\+h.

\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a84b03bc70e9979c28deb044c545ba287}\label{classRobotLocalization_1_1RosFilter_a84b03bc70e9979c28deb044c545ba287}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!historyLength\_@{historyLength\_}}
\index{historyLength\_@{historyLength\_}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{historyLength\_}{historyLength\_}}
{\footnotesize\ttfamily template$<$class T $>$ \\
double \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::history\+Length\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}



The depth of the history we track for smoothing/delayed measurement processing. 

This is the guaranteed minimum buffer size for which previous states and measurements are kept. 

Definition at line 498 of file ros\+\_\+filter.\+h.

\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a706c4ea2aad03711195e856dbd2e6796}\label{classRobotLocalization_1_1RosFilter_a706c4ea2aad03711195e856dbd2e6796}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!initialMeasurements\_@{initialMeasurements\_}}
\index{initialMeasurements\_@{initialMeasurements\_}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{initialMeasurements\_}{initialMeasurements\_}}
{\footnotesize\ttfamily template$<$class T $>$ \\
std\+::map$<$std\+::string, tf2\+::\+Transform$>$ \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::initial\+Measurements\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}



Stores the first measurement from each topic for relative measurements. 

When a given sensor is being integrated in relative mode, its first measurement is effectively treated as an offset, and future measurements have this first measurement removed before they are fused. This variable stores the initial measurements. Note that this is different from using differential mode, as in differential mode, pose data is converted to twist data, resulting in boundless error growth for the variables being fused. With relative measurements, the vehicle will start with a 0 heading and position, but the measurements are still fused absolutely. 

Definition at line 559 of file ros\+\_\+filter.\+h.

\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a473c0f797fcd9677b1005637ee159ae4}\label{classRobotLocalization_1_1RosFilter_a473c0f797fcd9677b1005637ee159ae4}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!lastMessageTimes\_@{lastMessageTimes\_}}
\index{lastMessageTimes\_@{lastMessageTimes\_}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{lastMessageTimes\_}{lastMessageTimes\_}}
{\footnotesize\ttfamily template$<$class T $>$ \\
std\+::map$<$std\+::string, ros\+::\+Time$>$ \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::last\+Message\+Times\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}



Store the last time a message from each topic was received. 

If we\textquotesingle{}re getting messages rapidly, we may accidentally get an older message arriving after a newer one. This variable keeps track of the most recent message time for each subscribed message topic. We also use it when listening to odometry messages to determine if we should be using messages from that topic. 

Definition at line 569 of file ros\+\_\+filter.\+h.

\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_aa9df5f56cfb6d02a4bc22c8b68ad115f}\label{classRobotLocalization_1_1RosFilter_aa9df5f56cfb6d02a4bc22c8b68ad115f}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!lastSetPoseTime\_@{lastSetPoseTime\_}}
\index{lastSetPoseTime\_@{lastSetPoseTime\_}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{lastSetPoseTime\_}{lastSetPoseTime\_}}
{\footnotesize\ttfamily template$<$class T $>$ \\
ros\+::\+Time \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::last\+Set\+Pose\+Time\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}



Store the last time set pose message was received. 

If we receive a set\+Pose message to reset the filter, we can get in strange situations wherein we process the pose reset, but then even after another spin cycle or two, we can get a new message with a time stamp that is {\itshape older} than the set\+Pose message\textquotesingle{}s time stamp. This means we have to check the message\textquotesingle{}s time stamp against the last\+Set\+Pose\+Time\+\_\+. 

Definition at line 619 of file ros\+\_\+filter.\+h.

\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a368ffffbd5a044c29342add42d1971a9}\label{classRobotLocalization_1_1RosFilter_a368ffffbd5a044c29342add42d1971a9}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!previousMeasurements\_@{previousMeasurements\_}}
\index{previousMeasurements\_@{previousMeasurements\_}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{previousMeasurements\_}{previousMeasurements\_}}
{\footnotesize\ttfamily template$<$class T $>$ \\
std\+::map$<$std\+::string, tf2\+::\+Transform$>$ \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::previous\+Measurements\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}



Stores the last measurement from a given topic for differential integration. 

To carry out differential integration, we have to (1) transform that into the target frame (probably the frame specified by {\ttfamily odom\+Frame\+Id\+\_\+}), (2) \char`\"{}subtract\char`\"{} the previous measurement from the current measurement, and then (3) transform it again by the previous state estimate. This holds the measurements used for step (2). 

Definition at line 583 of file ros\+\_\+filter.\+h.

\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a16ad0452b5b52e64a93736d25cfeba95}\label{classRobotLocalization_1_1RosFilter_a16ad0452b5b52e64a93736d25cfeba95}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!resetOnTimeJump\_@{resetOnTimeJump\_}}
\index{resetOnTimeJump\_@{resetOnTimeJump\_}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{resetOnTimeJump\_}{resetOnTimeJump\_}}
{\footnotesize\ttfamily template$<$class T $>$ \\
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::reset\+On\+Time\+Jump\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}



Whether to reset the filters when backwards jump in time is detected. 

This is usually the case when logs are being used and a jump in the logi is done or if a log files restarts from the beginning. 

Definition at line 457 of file ros\+\_\+filter.\+h.

\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_a5df01bed8ccaf9deaadd869518c60310}\label{classRobotLocalization_1_1RosFilter_a5df01bed8ccaf9deaadd869518c60310}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!staticDiagnostics\_@{staticDiagnostics\_}}
\index{staticDiagnostics\_@{staticDiagnostics\_}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{staticDiagnostics\_}{staticDiagnostics\_}}
{\footnotesize\ttfamily template$<$class T $>$ \\
std\+::map$<$std\+::string, std\+::string$>$ \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::static\+Diagnostics\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}



This object accumulates static diagnostics, e.\+g., diagnostics relating to the configuration parameters. 

The values are treated as static and always reported (i.\+e., this object is never cleared) 

Definition at line 594 of file ros\+\_\+filter.\+h.

\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_ad06dbf8f35a49fc76daf1c16fdecd34d}\label{classRobotLocalization_1_1RosFilter_ad06dbf8f35a49fc76daf1c16fdecd34d}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!twoDMode\_@{twoDMode\_}}
\index{twoDMode\_@{twoDMode\_}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{twoDMode\_}{twoDMode\_}}
{\footnotesize\ttfamily template$<$class T $>$ \\
bool \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::two\+D\+Mode\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}



Whether or not we\textquotesingle{}re in 2D mode. 

If this is true, the filter binds all 3D variables (Z, roll, pitch, and their respective velocities) to 0 for every measurement. 

Definition at line 472 of file ros\+\_\+filter.\+h.

\mbox{\Hypertarget{classRobotLocalization_1_1RosFilter_aefbc737fbacf16090e2f17d87de9b186}\label{classRobotLocalization_1_1RosFilter_aefbc737fbacf16090e2f17d87de9b186}} 
\index{RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}!worldBaseLinkTransMsg\_@{worldBaseLinkTransMsg\_}}
\index{worldBaseLinkTransMsg\_@{worldBaseLinkTransMsg\_}!RobotLocalization::RosFilter$<$ T $>$@{RobotLocalization::RosFilter$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{worldBaseLinkTransMsg\_}{worldBaseLinkTransMsg\_}}
{\footnotesize\ttfamily template$<$class T $>$ \\
geometry\+\_\+msgs\+::\+Transform\+Stamped \mbox{\hyperlink{classRobotLocalization_1_1RosFilter}{Robot\+Localization\+::\+Ros\+Filter}}$<$ T $>$\+::world\+Base\+Link\+Trans\+Msg\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}



Message that contains our latest transform (i.\+e., state) 

We use the vehicle\textquotesingle{}s latest state in a number of places, and often use it as a transform, so this is the most convenient variable to use as our global \char`\"{}current state\char`\"{} object 

Definition at line 606 of file ros\+\_\+filter.\+h.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
mapping/robot\+\_\+localization/include/robot\+\_\+localization/ros\+\_\+filter.\+h\item 
mapping/robot\+\_\+localization/src/ros\+\_\+filter.\+cpp\end{DoxyCompactItemize}
