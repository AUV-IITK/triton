\hypertarget{classRobotLocalization_1_1RobotLocalizationEstimator}{}\doxysection{Robot\+Localization\+::Robot\+Localization\+Estimator Class Reference}
\label{classRobotLocalization_1_1RobotLocalizationEstimator}\index{RobotLocalization::RobotLocalizationEstimator@{RobotLocalization::RobotLocalizationEstimator}}


Robot Localization Listener class.  




{\ttfamily \#include $<$robot\+\_\+localization\+\_\+estimator.\+h$>$}

\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classRobotLocalization_1_1RobotLocalizationEstimator_a885830587b69baaa036b00e21446cdcd}{Robot\+Localization\+Estimator}} (unsigned int buffer\+\_\+capacity, Filter\+Type filter\+\_\+type, const Eigen\+::\+Matrix\+Xd \&process\+\_\+noise\+\_\+covariance, const std\+::vector$<$ double $>$ \&filter\+\_\+args=std\+::vector$<$ double $>$())
\begin{DoxyCompactList}\small\item\em Constructor for the Robot\+Localization\+Listener class. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RobotLocalizationEstimator_a82faca7fc95f7e913966c19b4b17814b}\label{classRobotLocalization_1_1RobotLocalizationEstimator_a82faca7fc95f7e913966c19b4b17814b}} 
virtual \mbox{\hyperlink{classRobotLocalization_1_1RobotLocalizationEstimator_a82faca7fc95f7e913966c19b4b17814b}{$\sim$\+Robot\+Localization\+Estimator}} ()
\begin{DoxyCompactList}\small\item\em Destructor for the Robot\+Localization\+Listener class. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classRobotLocalization_1_1RobotLocalizationEstimator_af44f2bffd59b1be40a2643b36aaaf583}{set\+State}} (const \mbox{\hyperlink{structRobotLocalization_1_1EstimatorState}{Estimator\+State}} \&state)
\begin{DoxyCompactList}\small\item\em Sets the current internal state of the listener. \end{DoxyCompactList}\item 
Estimator\+Result \mbox{\hyperlink{classRobotLocalization_1_1RobotLocalizationEstimator_ac34301dfd4a7cbaee5e9cad8d3fae4d5}{get\+State}} (const double time, \mbox{\hyperlink{structRobotLocalization_1_1EstimatorState}{Estimator\+State}} \&state) const
\begin{DoxyCompactList}\small\item\em Returns the state at a given time. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RobotLocalizationEstimator_a40d41e258aedab8cab22b157fcccb3e3}\label{classRobotLocalization_1_1RobotLocalizationEstimator_a40d41e258aedab8cab22b157fcccb3e3}} 
void \mbox{\hyperlink{classRobotLocalization_1_1RobotLocalizationEstimator_a40d41e258aedab8cab22b157fcccb3e3}{clear\+Buffer}} ()
\begin{DoxyCompactList}\small\item\em Clears the internal state buffer. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classRobotLocalization_1_1RobotLocalizationEstimator_a93acd7631f9ee2ef8c8ce552a082ecc1}{set\+Buffer\+Capacity}} (const int capacity)
\begin{DoxyCompactList}\small\item\em Sets the buffer capacity. \end{DoxyCompactList}\item 
unsigned int \mbox{\hyperlink{classRobotLocalization_1_1RobotLocalizationEstimator_aba7d1e5fd8e7fe48e71e73a57e27ebc4}{get\+Buffer\+Capacity}} () const
\begin{DoxyCompactList}\small\item\em Returns the buffer capacity. \end{DoxyCompactList}\item 
unsigned int \mbox{\hyperlink{classRobotLocalization_1_1RobotLocalizationEstimator_a4ca33df66f59bd617dce836718863655}{get\+Size}} () const
\begin{DoxyCompactList}\small\item\em Returns the current buffer size. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Friends}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classRobotLocalization_1_1RobotLocalizationEstimator_a5c32180c9bcbe71dbaad585376d3f200}\label{classRobotLocalization_1_1RobotLocalizationEstimator_a5c32180c9bcbe71dbaad585376d3f200}} 
std\+::ostream \& {\bfseries operator$<$$<$} (std\+::ostream \&os, const \mbox{\hyperlink{classRobotLocalization_1_1RobotLocalizationEstimator}{Robot\+Localization\+Estimator}} \&rle)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Robot Localization Listener class. 

The Robot Localization Estimator class buffers states of and inputs to a system and can interpolate and extrapolate based on a given system model. 

Definition at line 116 of file robot\+\_\+localization\+\_\+estimator.\+h.



\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classRobotLocalization_1_1RobotLocalizationEstimator_a885830587b69baaa036b00e21446cdcd}\label{classRobotLocalization_1_1RobotLocalizationEstimator_a885830587b69baaa036b00e21446cdcd}} 
\index{RobotLocalization::RobotLocalizationEstimator@{RobotLocalization::RobotLocalizationEstimator}!RobotLocalizationEstimator@{RobotLocalizationEstimator}}
\index{RobotLocalizationEstimator@{RobotLocalizationEstimator}!RobotLocalization::RobotLocalizationEstimator@{RobotLocalization::RobotLocalizationEstimator}}
\doxysubsubsection{\texorpdfstring{RobotLocalizationEstimator()}{RobotLocalizationEstimator()}}
{\footnotesize\ttfamily Robot\+Localization\+::\+Robot\+Localization\+Estimator\+::\+Robot\+Localization\+Estimator (\begin{DoxyParamCaption}\item[{unsigned int}]{buffer\+\_\+capacity,  }\item[{Filter\+Type}]{filter\+\_\+type,  }\item[{const Eigen\+::\+Matrix\+Xd \&}]{process\+\_\+noise\+\_\+covariance,  }\item[{const std\+::vector$<$ double $>$ \&}]{filter\+\_\+args = {\ttfamily std\+:\+:vector$<$double$>$()} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [explicit]}}



Constructor for the Robot\+Localization\+Listener class. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em args} & -\/ Generic argument container (not used here, but needed so that the R\+OS filters can pass arbitrary arguments to templated filter types). \\
\hline
\end{DoxyParams}


Definition at line 41 of file robot\+\_\+localization\+\_\+estimator.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{45 \{}
\DoxyCodeLine{46   state\_buffer\_.set\_capacity(buffer\_capacity);}
\DoxyCodeLine{47 }
\DoxyCodeLine{48   \textcolor{comment}{// Set up the filter that is used for predictions}}
\DoxyCodeLine{49   \textcolor{keywordflow}{if} ( filter\_type == FilterTypes::EKF )}
\DoxyCodeLine{50   \{}
\DoxyCodeLine{51     filter\_ = \textcolor{keyword}{new} Ekf;}
\DoxyCodeLine{52   \}}
\DoxyCodeLine{53   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( filter\_type == FilterTypes::UKF )}
\DoxyCodeLine{54   \{}
\DoxyCodeLine{55     filter\_ = \textcolor{keyword}{new} Ukf(filter\_args);}
\DoxyCodeLine{56   \}}
\DoxyCodeLine{57 }
\DoxyCodeLine{58   filter\_-\/>\mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a0a8c02b5e93b21f2bb5124344e3bac73}{setProcessNoiseCovariance}}(process\_noise\_covariance);}
\DoxyCodeLine{59 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classRobotLocalization_1_1RobotLocalizationEstimator_aba7d1e5fd8e7fe48e71e73a57e27ebc4}\label{classRobotLocalization_1_1RobotLocalizationEstimator_aba7d1e5fd8e7fe48e71e73a57e27ebc4}} 
\index{RobotLocalization::RobotLocalizationEstimator@{RobotLocalization::RobotLocalizationEstimator}!getBufferCapacity@{getBufferCapacity}}
\index{getBufferCapacity@{getBufferCapacity}!RobotLocalization::RobotLocalizationEstimator@{RobotLocalization::RobotLocalizationEstimator}}
\doxysubsubsection{\texorpdfstring{getBufferCapacity()}{getBufferCapacity()}}
{\footnotesize\ttfamily unsigned int Robot\+Localization\+::\+Robot\+Localization\+Estimator\+::get\+Buffer\+Capacity (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}



Returns the buffer capacity. 

Returns the number of \mbox{\hyperlink{structRobotLocalization_1_1EstimatorState}{Estimator\+State}} objects that can be pushed to the buffer before old ones are dropped. (The capacity of the buffer).

\begin{DoxyReturn}{Returns}
buffer capacity 
\end{DoxyReturn}


Definition at line 168 of file robot\+\_\+localization\+\_\+estimator.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{169 \{}
\DoxyCodeLine{170   \textcolor{keywordflow}{return} state\_buffer\_.capacity();}
\DoxyCodeLine{171 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RobotLocalizationEstimator_a4ca33df66f59bd617dce836718863655}\label{classRobotLocalization_1_1RobotLocalizationEstimator_a4ca33df66f59bd617dce836718863655}} 
\index{RobotLocalization::RobotLocalizationEstimator@{RobotLocalization::RobotLocalizationEstimator}!getSize@{getSize}}
\index{getSize@{getSize}!RobotLocalization::RobotLocalizationEstimator@{RobotLocalization::RobotLocalizationEstimator}}
\doxysubsubsection{\texorpdfstring{getSize()}{getSize()}}
{\footnotesize\ttfamily unsigned int Robot\+Localization\+::\+Robot\+Localization\+Estimator\+::get\+Size (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}



Returns the current buffer size. 

Returns the number of \mbox{\hyperlink{structRobotLocalization_1_1EstimatorState}{Estimator\+State}} objects currently in the buffer.

\begin{DoxyReturn}{Returns}
current buffer size 
\end{DoxyReturn}


Definition at line 173 of file robot\+\_\+localization\+\_\+estimator.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{174 \{}
\DoxyCodeLine{175   \textcolor{keywordflow}{return} state\_buffer\_.size();}
\DoxyCodeLine{176 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RobotLocalizationEstimator_ac34301dfd4a7cbaee5e9cad8d3fae4d5}\label{classRobotLocalization_1_1RobotLocalizationEstimator_ac34301dfd4a7cbaee5e9cad8d3fae4d5}} 
\index{RobotLocalization::RobotLocalizationEstimator@{RobotLocalization::RobotLocalizationEstimator}!getState@{getState}}
\index{getState@{getState}!RobotLocalization::RobotLocalizationEstimator@{RobotLocalization::RobotLocalizationEstimator}}
\doxysubsubsection{\texorpdfstring{getState()}{getState()}}
{\footnotesize\ttfamily Estimator\+Result Robot\+Localization\+::\+Robot\+Localization\+Estimator\+::get\+State (\begin{DoxyParamCaption}\item[{const double}]{time,  }\item[{\mbox{\hyperlink{structRobotLocalization_1_1EstimatorState}{Estimator\+State}} \&}]{state }\end{DoxyParamCaption}) const}



Returns the state at a given time. 

Projects the current state and error matrices forward using a model of the robot\textquotesingle{}s motion.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em time} & -\/ The time to which the prediction is being made \\
\hline
\mbox{\texttt{ out}}  & {\em state} & -\/ The returned state at the given time\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Get\+State\+Result enum 
\end{DoxyReturn}


Definition at line 87 of file robot\+\_\+localization\+\_\+estimator.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{89 \{}
\DoxyCodeLine{90   \textcolor{comment}{// If there's nothing in the buffer, there's nothing to give.}}
\DoxyCodeLine{91   \textcolor{keywordflow}{if} ( state\_buffer\_.size() == 0 )}
\DoxyCodeLine{92   \{}
\DoxyCodeLine{93     \textcolor{keywordflow}{return} EstimatorResults::EmptyBuffer;}
\DoxyCodeLine{94   \}}
\DoxyCodeLine{95 }
\DoxyCodeLine{96   \textcolor{comment}{// Set state to the most recent one for now}}
\DoxyCodeLine{97   state = state\_buffer\_.back();}
\DoxyCodeLine{98 }
\DoxyCodeLine{99   \textcolor{comment}{// Go through buffer from new to old}}
\DoxyCodeLine{100   EstimatorState last\_state\_before\_time = state\_buffer\_.front();}
\DoxyCodeLine{101   EstimatorState next\_state\_after\_time = state\_buffer\_.back();}
\DoxyCodeLine{102   \textcolor{keywordtype}{bool} previous\_state\_found = \textcolor{keyword}{false};}
\DoxyCodeLine{103   \textcolor{keywordtype}{bool} next\_state\_found = \textcolor{keyword}{false};}
\DoxyCodeLine{104 }
\DoxyCodeLine{105   \textcolor{keywordflow}{for} (boost::circular\_buffer<EstimatorState>::const\_reverse\_iterator it = state\_buffer\_.rbegin();}
\DoxyCodeLine{106        it != state\_buffer\_.rend(); ++it)}
\DoxyCodeLine{107   \{}
\DoxyCodeLine{108     \textcolor{comment}{/* If the time stamp of the current state from the buffer is}}
\DoxyCodeLine{109 \textcolor{comment}{     * older than the requested time, store it as the last state}}
\DoxyCodeLine{110 \textcolor{comment}{     * before the requested time. If it is younger, save it as the}}
\DoxyCodeLine{111 \textcolor{comment}{     * next one after, and go on to find the last one before.}}
\DoxyCodeLine{112 \textcolor{comment}{     */}}
\DoxyCodeLine{113     \textcolor{keywordflow}{if} ( it-\/>time\_stamp == time )}
\DoxyCodeLine{114     \{}
\DoxyCodeLine{115       state = *it;}
\DoxyCodeLine{116       \textcolor{keywordflow}{return} EstimatorResults::Exact;}
\DoxyCodeLine{117     \}}
\DoxyCodeLine{118     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( it-\/>time\_stamp <= time )}
\DoxyCodeLine{119     \{}
\DoxyCodeLine{120       last\_state\_before\_time = *it;}
\DoxyCodeLine{121       previous\_state\_found = \textcolor{keyword}{true};}
\DoxyCodeLine{122       \textcolor{keywordflow}{break};}
\DoxyCodeLine{123     \}}
\DoxyCodeLine{124     \textcolor{keywordflow}{else}}
\DoxyCodeLine{125     \{}
\DoxyCodeLine{126       next\_state\_after\_time = *it;}
\DoxyCodeLine{127       next\_state\_found = \textcolor{keyword}{true};}
\DoxyCodeLine{128     \}}
\DoxyCodeLine{129   \}}
\DoxyCodeLine{130 }
\DoxyCodeLine{131   \textcolor{comment}{// If we found a previous state and a next state, we can do interpolation}}
\DoxyCodeLine{132   \textcolor{keywordflow}{if} ( previous\_state\_found \&\& next\_state\_found )}
\DoxyCodeLine{133   \{}
\DoxyCodeLine{134     interpolate(last\_state\_before\_time, next\_state\_after\_time, time, state);}
\DoxyCodeLine{135     \textcolor{keywordflow}{return} EstimatorResults::Interpolation;}
\DoxyCodeLine{136   \}}
\DoxyCodeLine{137 }
\DoxyCodeLine{138   \textcolor{comment}{// If only a previous state is found, we can do extrapolation into the future}}
\DoxyCodeLine{139   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( previous\_state\_found )}
\DoxyCodeLine{140   \{}
\DoxyCodeLine{141     extrapolate(last\_state\_before\_time, time, state);}
\DoxyCodeLine{142     \textcolor{keywordflow}{return} EstimatorResults::ExtrapolationIntoFuture;}
\DoxyCodeLine{143   \}}
\DoxyCodeLine{144 }
\DoxyCodeLine{145   \textcolor{comment}{// If only a next state is found, we'll have to extrapolate into the past.}}
\DoxyCodeLine{146   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( next\_state\_found )}
\DoxyCodeLine{147   \{}
\DoxyCodeLine{148     extrapolate(next\_state\_after\_time, time, state);}
\DoxyCodeLine{149     \textcolor{keywordflow}{return} EstimatorResults::ExtrapolationIntoPast;}
\DoxyCodeLine{150   \}}
\DoxyCodeLine{151 }
\DoxyCodeLine{152   \textcolor{keywordflow}{else}}
\DoxyCodeLine{153   \{}
\DoxyCodeLine{154     \textcolor{keywordflow}{return} EstimatorResults::Failed;}
\DoxyCodeLine{155   \}}
\DoxyCodeLine{156 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RobotLocalizationEstimator_a93acd7631f9ee2ef8c8ce552a082ecc1}\label{classRobotLocalization_1_1RobotLocalizationEstimator_a93acd7631f9ee2ef8c8ce552a082ecc1}} 
\index{RobotLocalization::RobotLocalizationEstimator@{RobotLocalization::RobotLocalizationEstimator}!setBufferCapacity@{setBufferCapacity}}
\index{setBufferCapacity@{setBufferCapacity}!RobotLocalization::RobotLocalizationEstimator@{RobotLocalization::RobotLocalizationEstimator}}
\doxysubsubsection{\texorpdfstring{setBufferCapacity()}{setBufferCapacity()}}
{\footnotesize\ttfamily void Robot\+Localization\+::\+Robot\+Localization\+Estimator\+::set\+Buffer\+Capacity (\begin{DoxyParamCaption}\item[{const int}]{capacity }\end{DoxyParamCaption})}



Sets the buffer capacity. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em capacity} & -\/ The new buffer capacity \\
\hline
\end{DoxyParams}


Definition at line 158 of file robot\+\_\+localization\+\_\+estimator.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{159 \{}
\DoxyCodeLine{160   state\_buffer\_.set\_capacity(capacity);}
\DoxyCodeLine{161 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1RobotLocalizationEstimator_af44f2bffd59b1be40a2643b36aaaf583}\label{classRobotLocalization_1_1RobotLocalizationEstimator_af44f2bffd59b1be40a2643b36aaaf583}} 
\index{RobotLocalization::RobotLocalizationEstimator@{RobotLocalization::RobotLocalizationEstimator}!setState@{setState}}
\index{setState@{setState}!RobotLocalization::RobotLocalizationEstimator@{RobotLocalization::RobotLocalizationEstimator}}
\doxysubsubsection{\texorpdfstring{setState()}{setState()}}
{\footnotesize\ttfamily void Robot\+Localization\+::\+Robot\+Localization\+Estimator\+::set\+State (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structRobotLocalization_1_1EstimatorState}{Estimator\+State}} \&}]{state }\end{DoxyParamCaption})}



Sets the current internal state of the listener. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em state} & -\/ The new state vector to set the internal state to \\
\hline
\end{DoxyParams}


Definition at line 66 of file robot\+\_\+localization\+\_\+estimator.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{67 \{}
\DoxyCodeLine{68   \textcolor{comment}{// If newly received state is newer than any in the buffer, push back}}
\DoxyCodeLine{69   \textcolor{keywordflow}{if} ( state\_buffer\_.empty() || state.time\_stamp > state\_buffer\_.back().time\_stamp )}
\DoxyCodeLine{70   \{}
\DoxyCodeLine{71     state\_buffer\_.push\_back(state);}
\DoxyCodeLine{72   \}}
\DoxyCodeLine{73   \textcolor{comment}{// If it is older, put it in the right position}}
\DoxyCodeLine{74   \textcolor{keywordflow}{else}}
\DoxyCodeLine{75   \{}
\DoxyCodeLine{76     \textcolor{keywordflow}{for} ( boost::circular\_buffer<EstimatorState>::iterator it = state\_buffer\_.begin(); it != state\_buffer\_.end(); ++it )}
\DoxyCodeLine{77     \{}
\DoxyCodeLine{78       \textcolor{keywordflow}{if} ( state.time\_stamp < it-\/>time\_stamp )}
\DoxyCodeLine{79       \{}
\DoxyCodeLine{80         state\_buffer\_.insert(it, state);}
\DoxyCodeLine{81         \textcolor{keywordflow}{return};}
\DoxyCodeLine{82       \}}
\DoxyCodeLine{83     \}}
\DoxyCodeLine{84   \}}
\DoxyCodeLine{85 \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
mapping/robot\+\_\+localization/include/robot\+\_\+localization/robot\+\_\+localization\+\_\+estimator.\+h\item 
mapping/robot\+\_\+localization/src/robot\+\_\+localization\+\_\+estimator.\+cpp\end{DoxyCompactItemize}
