\hypertarget{classRobotLocalization_1_1Ekf}{}\doxysection{Robot\+Localization\+::Ekf Class Reference}
\label{classRobotLocalization_1_1Ekf}\index{RobotLocalization::Ekf@{RobotLocalization::Ekf}}


Extended Kalman filter class.  




{\ttfamily \#include $<$ekf.\+h$>$}

Inheritance diagram for Robot\+Localization\+::Ekf\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{d9/d0a/classRobotLocalization_1_1Ekf}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classRobotLocalization_1_1Ekf_ab09ec229f33a982425cd8e3a2011887c}{Ekf}} (std\+::vector$<$ double $>$ args=std\+::vector$<$ double $>$())
\begin{DoxyCompactList}\small\item\em Constructor for the \mbox{\hyperlink{classRobotLocalization_1_1Ekf}{Ekf}} class. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classRobotLocalization_1_1Ekf_a9fedcbdb61cdcc3bd9a286980d9832b6}\label{classRobotLocalization_1_1Ekf_a9fedcbdb61cdcc3bd9a286980d9832b6}} 
\mbox{\hyperlink{classRobotLocalization_1_1Ekf_a9fedcbdb61cdcc3bd9a286980d9832b6}{$\sim$\+Ekf}} ()
\begin{DoxyCompactList}\small\item\em Destructor for the \mbox{\hyperlink{classRobotLocalization_1_1Ekf}{Ekf}} class. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classRobotLocalization_1_1Ekf_a99c978378ac9e3e96f7a940de3501d06}{correct}} (const \mbox{\hyperlink{structRobotLocalization_1_1Measurement}{Measurement}} \&measurement)
\begin{DoxyCompactList}\small\item\em Carries out the correct step in the predict/update cycle. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classRobotLocalization_1_1Ekf_adecf63c473cd51da4f7346cd4bfd6a13}{predict}} (const double reference\+Time, const double delta)
\begin{DoxyCompactList}\small\item\em Carries out the predict step in the predict/update cycle. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}
Extended Kalman filter class. 

Implementation of an extended Kalman filter (E\+KF). This class derives from \mbox{\hyperlink{classRobotLocalization_1_1FilterBase}{Filter\+Base}} and overrides the \mbox{\hyperlink{classRobotLocalization_1_1Ekf_adecf63c473cd51da4f7346cd4bfd6a13}{predict()}} and \mbox{\hyperlink{classRobotLocalization_1_1Ekf_a99c978378ac9e3e96f7a940de3501d06}{correct()}} methods in keeping with the discrete time E\+KF algorithm. 

Definition at line 53 of file ekf.\+h.



\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classRobotLocalization_1_1Ekf_ab09ec229f33a982425cd8e3a2011887c}\label{classRobotLocalization_1_1Ekf_ab09ec229f33a982425cd8e3a2011887c}} 
\index{RobotLocalization::Ekf@{RobotLocalization::Ekf}!Ekf@{Ekf}}
\index{Ekf@{Ekf}!RobotLocalization::Ekf@{RobotLocalization::Ekf}}
\doxysubsubsection{\texorpdfstring{Ekf()}{Ekf()}}
{\footnotesize\ttfamily Robot\+Localization\+::\+Ekf\+::\+Ekf (\begin{DoxyParamCaption}\item[{std\+::vector$<$ double $>$}]{args = {\ttfamily std\+:\+:vector$<$double$>$()} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [explicit]}}



Constructor for the \mbox{\hyperlink{classRobotLocalization_1_1Ekf}{Ekf}} class. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em args} & -\/ Generic argument container (not used here, but needed so that the R\+OS filters can pass arbitrary arguments to templated filter types). \\
\hline
\end{DoxyParams}


Definition at line 45 of file ekf.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{45                             :}
\DoxyCodeLine{46     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a61b2196799bf6c765b4694adcf215250}{FilterBase}}()  \textcolor{comment}{// Must initialize filter base!}}
\DoxyCodeLine{47   \{}
\DoxyCodeLine{48   \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classRobotLocalization_1_1Ekf_a99c978378ac9e3e96f7a940de3501d06}\label{classRobotLocalization_1_1Ekf_a99c978378ac9e3e96f7a940de3501d06}} 
\index{RobotLocalization::Ekf@{RobotLocalization::Ekf}!correct@{correct}}
\index{correct@{correct}!RobotLocalization::Ekf@{RobotLocalization::Ekf}}
\doxysubsubsection{\texorpdfstring{correct()}{correct()}}
{\footnotesize\ttfamily void Robot\+Localization\+::\+Ekf\+::correct (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structRobotLocalization_1_1Measurement}{Measurement}} \&}]{measurement }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



Carries out the correct step in the predict/update cycle. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em measurement} & -\/ The measurement to fuse with our estimate \\
\hline
\end{DoxyParams}


Implements \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a7c53dd83aa72e9a46f2d406c6431215e}{Robot\+Localization\+::\+Filter\+Base}}.



Definition at line 54 of file ekf.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{55   \{}
\DoxyCodeLine{56     FB\_DEBUG(\textcolor{stringliteral}{"-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ Ekf::correct -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\(\backslash\)n"} <<}
\DoxyCodeLine{57              \textcolor{stringliteral}{"State is:\(\backslash\)n"} << \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}} << \textcolor{stringliteral}{"\(\backslash\)n"}}
\DoxyCodeLine{58              \textcolor{stringliteral}{"Topic is:\(\backslash\)n"} << measurement.topicName\_ << \textcolor{stringliteral}{"\(\backslash\)n"}}
\DoxyCodeLine{59              \textcolor{stringliteral}{"Measurement is:\(\backslash\)n"} << measurement.measurement\_ << \textcolor{stringliteral}{"\(\backslash\)n"}}
\DoxyCodeLine{60              \textcolor{stringliteral}{"Measurement topic name is:\(\backslash\)n"} << measurement.topicName\_ << \textcolor{stringliteral}{"\(\backslash\)n\(\backslash\)n"}}
\DoxyCodeLine{61              \textcolor{stringliteral}{"Measurement covariance is:\(\backslash\)n"} << measurement.covariance\_ << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{62 }
\DoxyCodeLine{63     \textcolor{comment}{// We don't want to update everything, so we need to build matrices that only update}}
\DoxyCodeLine{64     \textcolor{comment}{// the measured parts of our state vector. Throughout prediction and correction, we}}
\DoxyCodeLine{65     \textcolor{comment}{// attempt to maximize efficiency in Eigen.}}
\DoxyCodeLine{66 }
\DoxyCodeLine{67     \textcolor{comment}{// First, determine how many state vector values we're updating}}
\DoxyCodeLine{68     std::vector<size\_t> updateIndices;}
\DoxyCodeLine{69     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < measurement.updateVector\_.size(); ++i)}
\DoxyCodeLine{70     \{}
\DoxyCodeLine{71       \textcolor{keywordflow}{if} (measurement.updateVector\_[i])}
\DoxyCodeLine{72       \{}
\DoxyCodeLine{73         \textcolor{comment}{// Handle nan and inf values in measurements}}
\DoxyCodeLine{74         \textcolor{keywordflow}{if} (std::isnan(measurement.measurement\_(i)))}
\DoxyCodeLine{75         \{}
\DoxyCodeLine{76           FB\_DEBUG(\textcolor{stringliteral}{"Value at index "} << i << \textcolor{stringliteral}{" was nan. Excluding from update.\(\backslash\)n"});}
\DoxyCodeLine{77         \}}
\DoxyCodeLine{78         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (std::isinf(measurement.measurement\_(i)))}
\DoxyCodeLine{79         \{}
\DoxyCodeLine{80           FB\_DEBUG(\textcolor{stringliteral}{"Value at index "} << i << \textcolor{stringliteral}{" was inf. Excluding from update.\(\backslash\)n"});}
\DoxyCodeLine{81         \}}
\DoxyCodeLine{82         \textcolor{keywordflow}{else}}
\DoxyCodeLine{83         \{}
\DoxyCodeLine{84           updateIndices.push\_back(i);}
\DoxyCodeLine{85         \}}
\DoxyCodeLine{86       \}}
\DoxyCodeLine{87     \}}
\DoxyCodeLine{88 }
\DoxyCodeLine{89     FB\_DEBUG(\textcolor{stringliteral}{"Update indices are:\(\backslash\)n"} << updateIndices << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{90 }
\DoxyCodeLine{91     \textcolor{keywordtype}{size\_t} updateSize = updateIndices.size();}
\DoxyCodeLine{92 }
\DoxyCodeLine{93     \textcolor{comment}{// Now set up the relevant matrices}}
\DoxyCodeLine{94     Eigen::VectorXd stateSubset(updateSize);                              \textcolor{comment}{// x (in most literature)}}
\DoxyCodeLine{95     Eigen::VectorXd measurementSubset(updateSize);                        \textcolor{comment}{// z}}
\DoxyCodeLine{96     Eigen::MatrixXd measurementCovarianceSubset(updateSize, updateSize);  \textcolor{comment}{// R}}
\DoxyCodeLine{97     Eigen::MatrixXd stateToMeasurementSubset(updateSize, \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}.rows());  \textcolor{comment}{// H}}
\DoxyCodeLine{98     Eigen::MatrixXd kalmanGainSubset(\mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}.rows(), updateSize);          \textcolor{comment}{// K}}
\DoxyCodeLine{99     Eigen::VectorXd innovationSubset(updateSize);                         \textcolor{comment}{// z -\/ Hx}}
\DoxyCodeLine{100 }
\DoxyCodeLine{101     stateSubset.setZero();}
\DoxyCodeLine{102     measurementSubset.setZero();}
\DoxyCodeLine{103     measurementCovarianceSubset.setZero();}
\DoxyCodeLine{104     stateToMeasurementSubset.setZero();}
\DoxyCodeLine{105     kalmanGainSubset.setZero();}
\DoxyCodeLine{106     innovationSubset.setZero();}
\DoxyCodeLine{107 }
\DoxyCodeLine{108     \textcolor{comment}{// Now build the sub-\/matrices from the full-\/sized matrices}}
\DoxyCodeLine{109     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < updateSize; ++i)}
\DoxyCodeLine{110     \{}
\DoxyCodeLine{111       measurementSubset(i) = measurement.measurement\_(updateIndices[i]);}
\DoxyCodeLine{112       stateSubset(i) = \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}(updateIndices[i]);}
\DoxyCodeLine{113 }
\DoxyCodeLine{114       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = 0; j < updateSize; ++j)}
\DoxyCodeLine{115       \{}
\DoxyCodeLine{116         measurementCovarianceSubset(i, j) = measurement.covariance\_(updateIndices[i], updateIndices[j]);}
\DoxyCodeLine{117       \}}
\DoxyCodeLine{118 }
\DoxyCodeLine{119       \textcolor{comment}{// Handle negative (read: bad) covariances in the measurement. Rather}}
\DoxyCodeLine{120       \textcolor{comment}{// than exclude the measurement or make up a covariance, just take}}
\DoxyCodeLine{121       \textcolor{comment}{// the absolute value.}}
\DoxyCodeLine{122       \textcolor{keywordflow}{if} (measurementCovarianceSubset(i, i) < 0)}
\DoxyCodeLine{123       \{}
\DoxyCodeLine{124         FB\_DEBUG(\textcolor{stringliteral}{"WARNING: Negative covariance for index "} << i <<}
\DoxyCodeLine{125                  \textcolor{stringliteral}{" of measurement (value is"} << measurementCovarianceSubset(i, i) <<}
\DoxyCodeLine{126                  \textcolor{stringliteral}{"). Using absolute value...\(\backslash\)n"});}
\DoxyCodeLine{127 }
\DoxyCodeLine{128         measurementCovarianceSubset(i, i) = ::fabs(measurementCovarianceSubset(i, i));}
\DoxyCodeLine{129       \}}
\DoxyCodeLine{130 }
\DoxyCodeLine{131       \textcolor{comment}{// If the measurement variance for a given variable is very}}
\DoxyCodeLine{132       \textcolor{comment}{// near 0 (as in e-\/50 or so) and the variance for that}}
\DoxyCodeLine{133       \textcolor{comment}{// variable in the covariance matrix is also near zero, then}}
\DoxyCodeLine{134       \textcolor{comment}{// the Kalman gain computation will blow up. Really, no}}
\DoxyCodeLine{135       \textcolor{comment}{// measurement can be completely without error, so add a small}}
\DoxyCodeLine{136       \textcolor{comment}{// amount in that case.}}
\DoxyCodeLine{137       \textcolor{keywordflow}{if} (measurementCovarianceSubset(i, i) < 1e-\/9)}
\DoxyCodeLine{138       \{}
\DoxyCodeLine{139         FB\_DEBUG(\textcolor{stringliteral}{"WARNING: measurement had very small error covariance for index "} << updateIndices[i] <<}
\DoxyCodeLine{140                  \textcolor{stringliteral}{". Adding some noise to maintain filter stability.\(\backslash\)n"});}
\DoxyCodeLine{141 }
\DoxyCodeLine{142         measurementCovarianceSubset(i, i) = 1e-\/9;}
\DoxyCodeLine{143       \}}
\DoxyCodeLine{144     \}}
\DoxyCodeLine{145 }
\DoxyCodeLine{146     \textcolor{comment}{// The state-\/to-\/measurement function, h, will now be a measurement\_size x full\_state\_size}}
\DoxyCodeLine{147     \textcolor{comment}{// matrix, with ones in the (i, i) locations of the values to be updated}}
\DoxyCodeLine{148     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < updateSize; ++i)}
\DoxyCodeLine{149     \{}
\DoxyCodeLine{150       stateToMeasurementSubset(i, updateIndices[i]) = 1;}
\DoxyCodeLine{151     \}}
\DoxyCodeLine{152 }
\DoxyCodeLine{153     FB\_DEBUG(\textcolor{stringliteral}{"Current state subset is:\(\backslash\)n"} << stateSubset <<}
\DoxyCodeLine{154              \textcolor{stringliteral}{"\(\backslash\)nMeasurement subset is:\(\backslash\)n"} << measurementSubset <<}
\DoxyCodeLine{155              \textcolor{stringliteral}{"\(\backslash\)nMeasurement covariance subset is:\(\backslash\)n"} << measurementCovarianceSubset <<}
\DoxyCodeLine{156              \textcolor{stringliteral}{"\(\backslash\)nState-\/to-\/measurement subset is:\(\backslash\)n"} << stateToMeasurementSubset << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{157 }
\DoxyCodeLine{158     \textcolor{comment}{// (1) Compute the Kalman gain: K = (PH') / (HPH' + R)}}
\DoxyCodeLine{159     Eigen::MatrixXd pht = \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a6422083129fa8c2bc7a2bafa5a412dc4}{estimateErrorCovariance\_}} * stateToMeasurementSubset.transpose();}
\DoxyCodeLine{160     Eigen::MatrixXd hphrInv  = (stateToMeasurementSubset * pht + measurementCovarianceSubset).inverse();}
\DoxyCodeLine{161     kalmanGainSubset.noalias() = pht * hphrInv;}
\DoxyCodeLine{162 }
\DoxyCodeLine{163     innovationSubset = (measurementSubset -\/ stateSubset);}
\DoxyCodeLine{164 }
\DoxyCodeLine{165     \textcolor{comment}{// Wrap angles in the innovation}}
\DoxyCodeLine{166     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < updateSize; ++i)}
\DoxyCodeLine{167     \{}
\DoxyCodeLine{168       \textcolor{keywordflow}{if} (updateIndices[i] == StateMemberRoll  ||}
\DoxyCodeLine{169           updateIndices[i] == StateMemberPitch ||}
\DoxyCodeLine{170           updateIndices[i] == StateMemberYaw)}
\DoxyCodeLine{171       \{}
\DoxyCodeLine{172         \textcolor{keywordflow}{while} (innovationSubset(i) < -\/PI)}
\DoxyCodeLine{173         \{}
\DoxyCodeLine{174           innovationSubset(i) += TAU;}
\DoxyCodeLine{175         \}}
\DoxyCodeLine{176 }
\DoxyCodeLine{177         \textcolor{keywordflow}{while} (innovationSubset(i) > PI)}
\DoxyCodeLine{178         \{}
\DoxyCodeLine{179           innovationSubset(i) -\/= TAU;}
\DoxyCodeLine{180         \}}
\DoxyCodeLine{181       \}}
\DoxyCodeLine{182     \}}
\DoxyCodeLine{183 }
\DoxyCodeLine{184     \textcolor{comment}{// (2) Check Mahalanobis distance between mapped measurement and state.}}
\DoxyCodeLine{185     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a580584882a77061dab91746fb670a7be}{checkMahalanobisThreshold}}(innovationSubset, hphrInv, measurement.mahalanobisThresh\_))}
\DoxyCodeLine{186     \{}
\DoxyCodeLine{187       \textcolor{comment}{// (3) Apply the gain to the difference between the state and measurement: x = x + K(z -\/ Hx)}}
\DoxyCodeLine{188       \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}.noalias() += kalmanGainSubset * innovationSubset;}
\DoxyCodeLine{189 }
\DoxyCodeLine{190       \textcolor{comment}{// (4) Update the estimate error covariance using the Joseph form: (I -\/ KH)P(I -\/ KH)' + KRK'}}
\DoxyCodeLine{191       Eigen::MatrixXd gainResidual = \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a86346ff3edea596b9381d27e94a4e908}{identity\_}};}
\DoxyCodeLine{192       gainResidual.noalias() -\/= kalmanGainSubset * stateToMeasurementSubset;}
\DoxyCodeLine{193       \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a6422083129fa8c2bc7a2bafa5a412dc4}{estimateErrorCovariance\_}} = gainResidual * \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a6422083129fa8c2bc7a2bafa5a412dc4}{estimateErrorCovariance\_}} * gainResidual.transpose();}
\DoxyCodeLine{194       \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a6422083129fa8c2bc7a2bafa5a412dc4}{estimateErrorCovariance\_}}.noalias() += kalmanGainSubset *}
\DoxyCodeLine{195                                             measurementCovarianceSubset *}
\DoxyCodeLine{196                                             kalmanGainSubset.transpose();}
\DoxyCodeLine{197 }
\DoxyCodeLine{198       \textcolor{comment}{// Handle wrapping of angles}}
\DoxyCodeLine{199       \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a76f3971d5c07e068ea1aa50e934b7c31}{wrapStateAngles}}();}
\DoxyCodeLine{200 }
\DoxyCodeLine{201       FB\_DEBUG(\textcolor{stringliteral}{"Kalman gain subset is:\(\backslash\)n"} << kalmanGainSubset <<}
\DoxyCodeLine{202                \textcolor{stringliteral}{"\(\backslash\)nInnovation is:\(\backslash\)n"} << innovationSubset <<}
\DoxyCodeLine{203                \textcolor{stringliteral}{"\(\backslash\)nCorrected full state is:\(\backslash\)n"} << \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}} <<}
\DoxyCodeLine{204                \textcolor{stringliteral}{"\(\backslash\)nCorrected full estimate error covariance is:\(\backslash\)n"} << \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a6422083129fa8c2bc7a2bafa5a412dc4}{estimateErrorCovariance\_}} <<}
\DoxyCodeLine{205                \textcolor{stringliteral}{"\(\backslash\)n\(\backslash\)n-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ /Ekf::correct -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\(\backslash\)n"});}
\DoxyCodeLine{206     \}}
\DoxyCodeLine{207   \}}

\end{DoxyCode}
\mbox{\Hypertarget{classRobotLocalization_1_1Ekf_adecf63c473cd51da4f7346cd4bfd6a13}\label{classRobotLocalization_1_1Ekf_adecf63c473cd51da4f7346cd4bfd6a13}} 
\index{RobotLocalization::Ekf@{RobotLocalization::Ekf}!predict@{predict}}
\index{predict@{predict}!RobotLocalization::Ekf@{RobotLocalization::Ekf}}
\doxysubsubsection{\texorpdfstring{predict()}{predict()}}
{\footnotesize\ttfamily void Robot\+Localization\+::\+Ekf\+::predict (\begin{DoxyParamCaption}\item[{const double}]{reference\+Time,  }\item[{const double}]{delta }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



Carries out the predict step in the predict/update cycle. 

Projects the state and error matrices forward using a model of the vehicle\textquotesingle{}s motion.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em reference\+Time} & -\/ The time at which the prediction is being made \\
\hline
\mbox{\texttt{ in}}  & {\em delta} & -\/ The time step over which to predict. \\
\hline
\end{DoxyParams}


Implements \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a75c6282d2136ef591d9c4bae58292480}{Robot\+Localization\+::\+Filter\+Base}}.



Definition at line 209 of file ekf.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{210   \{}
\DoxyCodeLine{211     FB\_DEBUG(\textcolor{stringliteral}{"-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ Ekf::predict -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\(\backslash\)n"} <<}
\DoxyCodeLine{212              \textcolor{stringliteral}{"delta is "} << delta << \textcolor{stringliteral}{"\(\backslash\)n"} <<}
\DoxyCodeLine{213              \textcolor{stringliteral}{"state is "} << \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}} << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{214 }
\DoxyCodeLine{215     \textcolor{keywordtype}{double} roll = \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}(StateMemberRoll);}
\DoxyCodeLine{216     \textcolor{keywordtype}{double} pitch = \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}(StateMemberPitch);}
\DoxyCodeLine{217     \textcolor{keywordtype}{double} yaw = \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}(StateMemberYaw);}
\DoxyCodeLine{218     \textcolor{keywordtype}{double} xVel = \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}(StateMemberVx);}
\DoxyCodeLine{219     \textcolor{keywordtype}{double} yVel = \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}(StateMemberVy);}
\DoxyCodeLine{220     \textcolor{keywordtype}{double} zVel = \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}(StateMemberVz);}
\DoxyCodeLine{221     \textcolor{keywordtype}{double} pitchVel = \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}(StateMemberVpitch);}
\DoxyCodeLine{222     \textcolor{keywordtype}{double} yawVel = \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}(StateMemberVyaw);}
\DoxyCodeLine{223     \textcolor{keywordtype}{double} xAcc = \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}(StateMemberAx);}
\DoxyCodeLine{224     \textcolor{keywordtype}{double} yAcc = \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}(StateMemberAy);}
\DoxyCodeLine{225     \textcolor{keywordtype}{double} zAcc = \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}(StateMemberAz);}
\DoxyCodeLine{226 }
\DoxyCodeLine{227     \textcolor{comment}{// We'll need these trig calculations a lot.}}
\DoxyCodeLine{228     \textcolor{keywordtype}{double} sp = ::sin(pitch);}
\DoxyCodeLine{229     \textcolor{keywordtype}{double} cp = ::cos(pitch);}
\DoxyCodeLine{230     \textcolor{keywordtype}{double} cpi = 1.0 / cp;}
\DoxyCodeLine{231     \textcolor{keywordtype}{double} tp = sp * cpi;}
\DoxyCodeLine{232 }
\DoxyCodeLine{233     \textcolor{keywordtype}{double} sr = ::sin(roll);}
\DoxyCodeLine{234     \textcolor{keywordtype}{double} cr = ::cos(roll);}
\DoxyCodeLine{235 }
\DoxyCodeLine{236     \textcolor{keywordtype}{double} sy = ::sin(yaw);}
\DoxyCodeLine{237     \textcolor{keywordtype}{double} cy = ::cos(yaw);}
\DoxyCodeLine{238 }
\DoxyCodeLine{239     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a99c42d2973233e855a67ce4a052aeef4}{prepareControl}}(referenceTime, delta);}
\DoxyCodeLine{240 }
\DoxyCodeLine{241     \textcolor{comment}{// Prepare the transfer function}}
\DoxyCodeLine{242     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberX, StateMemberVx) = cy * cp * delta;}
\DoxyCodeLine{243     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberX, StateMemberVy) = (cy * sp * sr -\/ sy * cr) * delta;}
\DoxyCodeLine{244     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberX, StateMemberVz) = (cy * sp * cr + sy * sr) * delta;}
\DoxyCodeLine{245     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberX, StateMemberAx) = 0.5 * \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberX, StateMemberVx) * delta;}
\DoxyCodeLine{246     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberX, StateMemberAy) = 0.5 * \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberX, StateMemberVy) * delta;}
\DoxyCodeLine{247     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberX, StateMemberAz) = 0.5 * \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberX, StateMemberVz) * delta;}
\DoxyCodeLine{248     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberY, StateMemberVx) = sy * cp * delta;}
\DoxyCodeLine{249     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberY, StateMemberVy) = (sy * sp * sr + cy * cr) * delta;}
\DoxyCodeLine{250     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberY, StateMemberVz) = (sy * sp * cr -\/ cy * sr) * delta;}
\DoxyCodeLine{251     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberY, StateMemberAx) = 0.5 * \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberY, StateMemberVx) * delta;}
\DoxyCodeLine{252     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberY, StateMemberAy) = 0.5 * \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberY, StateMemberVy) * delta;}
\DoxyCodeLine{253     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberY, StateMemberAz) = 0.5 * \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberY, StateMemberVz) * delta;}
\DoxyCodeLine{254     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberZ, StateMemberVx) = -\/sp * delta;}
\DoxyCodeLine{255     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberZ, StateMemberVy) = cp * sr * delta;}
\DoxyCodeLine{256     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberZ, StateMemberVz) = cp * cr * delta;}
\DoxyCodeLine{257     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberZ, StateMemberAx) = 0.5 * \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberZ, StateMemberVx) * delta;}
\DoxyCodeLine{258     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberZ, StateMemberAy) = 0.5 * \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberZ, StateMemberVy) * delta;}
\DoxyCodeLine{259     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberZ, StateMemberAz) = 0.5 * \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberZ, StateMemberVz) * delta;}
\DoxyCodeLine{260     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberRoll, StateMemberVroll) = delta;}
\DoxyCodeLine{261     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberRoll, StateMemberVpitch) = sr * tp * delta;}
\DoxyCodeLine{262     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberRoll, StateMemberVyaw) = cr * tp * delta;}
\DoxyCodeLine{263     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberPitch, StateMemberVpitch) = cr * delta;}
\DoxyCodeLine{264     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberPitch, StateMemberVyaw) = -\/sr * delta;}
\DoxyCodeLine{265     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberYaw, StateMemberVpitch) = sr * cpi * delta;}
\DoxyCodeLine{266     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberYaw, StateMemberVyaw) = cr * cpi * delta;}
\DoxyCodeLine{267     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberVx, StateMemberAx) = delta;}
\DoxyCodeLine{268     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberVy, StateMemberAy) = delta;}
\DoxyCodeLine{269     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}}(StateMemberVz, StateMemberAz) = delta;}
\DoxyCodeLine{270 }
\DoxyCodeLine{271     \textcolor{comment}{// Prepare the transfer function Jacobian. This function is analytically derived from the}}
\DoxyCodeLine{272     \textcolor{comment}{// transfer function.}}
\DoxyCodeLine{273     \textcolor{keywordtype}{double} xCoeff = 0.0;}
\DoxyCodeLine{274     \textcolor{keywordtype}{double} yCoeff = 0.0;}
\DoxyCodeLine{275     \textcolor{keywordtype}{double} zCoeff = 0.0;}
\DoxyCodeLine{276     \textcolor{keywordtype}{double} oneHalfATSquared = 0.5 * delta * delta;}
\DoxyCodeLine{277 }
\DoxyCodeLine{278     yCoeff = cy * sp * cr + sy * sr;}
\DoxyCodeLine{279     zCoeff = -\/cy * sp * sr + sy * cr;}
\DoxyCodeLine{280     \textcolor{keywordtype}{double} dFx\_dR = (yCoeff * yVel + zCoeff * zVel) * delta +}
\DoxyCodeLine{281                     (yCoeff * yAcc + zCoeff * zAcc) * oneHalfATSquared;}
\DoxyCodeLine{282     \textcolor{keywordtype}{double} dFR\_dR = 1.0 + (cr * tp * pitchVel -\/ sr * tp * yawVel) * delta;}
\DoxyCodeLine{283 }
\DoxyCodeLine{284     xCoeff = -\/cy * sp;}
\DoxyCodeLine{285     yCoeff = cy * cp * sr;}
\DoxyCodeLine{286     zCoeff = cy * cp * cr;}
\DoxyCodeLine{287     \textcolor{keywordtype}{double} dFx\_dP = (xCoeff * xVel + yCoeff * yVel + zCoeff * zVel) * delta +}
\DoxyCodeLine{288                     (xCoeff * xAcc + yCoeff * yAcc + zCoeff * zAcc) * oneHalfATSquared;}
\DoxyCodeLine{289     \textcolor{keywordtype}{double} dFR\_dP = (cpi * cpi * sr * pitchVel + cpi * cpi * cr * yawVel) * delta;}
\DoxyCodeLine{290 }
\DoxyCodeLine{291     xCoeff = -\/sy * cp;}
\DoxyCodeLine{292     yCoeff = -\/sy * sp * sr -\/ cy * cr;}
\DoxyCodeLine{293     zCoeff = -\/sy * sp * cr + cy * sr;}
\DoxyCodeLine{294     \textcolor{keywordtype}{double} dFx\_dY = (xCoeff * xVel + yCoeff * yVel + zCoeff * zVel) * delta +}
\DoxyCodeLine{295                     (xCoeff * xAcc + yCoeff * yAcc + zCoeff * zAcc) * oneHalfATSquared;}
\DoxyCodeLine{296 }
\DoxyCodeLine{297     yCoeff = sy * sp * cr -\/ cy * sr;}
\DoxyCodeLine{298     zCoeff = -\/sy * sp * sr -\/ cy * cr;}
\DoxyCodeLine{299     \textcolor{keywordtype}{double} dFy\_dR = (yCoeff * yVel + zCoeff * zVel) * delta +}
\DoxyCodeLine{300                     (yCoeff * yAcc + zCoeff * zAcc) * oneHalfATSquared;}
\DoxyCodeLine{301     \textcolor{keywordtype}{double} dFP\_dR = (-\/sr * pitchVel -\/ cr * yawVel) * delta;}
\DoxyCodeLine{302 }
\DoxyCodeLine{303     xCoeff = -\/sy * sp;}
\DoxyCodeLine{304     yCoeff = sy * cp * sr;}
\DoxyCodeLine{305     zCoeff = sy * cp * cr;}
\DoxyCodeLine{306     \textcolor{keywordtype}{double} dFy\_dP = (xCoeff * xVel + yCoeff * yVel + zCoeff * zVel) * delta +}
\DoxyCodeLine{307                     (xCoeff * xAcc + yCoeff * yAcc + zCoeff * zAcc) * oneHalfATSquared;}
\DoxyCodeLine{308 }
\DoxyCodeLine{309     xCoeff = cy * cp;}
\DoxyCodeLine{310     yCoeff = cy * sp * sr -\/ sy * cr;}
\DoxyCodeLine{311     zCoeff = cy * sp * cr + sy * sr;}
\DoxyCodeLine{312     \textcolor{keywordtype}{double} dFy\_dY = (xCoeff * xVel + yCoeff * yVel + zCoeff * zVel) * delta +}
\DoxyCodeLine{313                     (xCoeff * xAcc + yCoeff * yAcc + zCoeff * zAcc) * oneHalfATSquared;}
\DoxyCodeLine{314 }
\DoxyCodeLine{315     yCoeff = cp * cr;}
\DoxyCodeLine{316     zCoeff = -\/cp * sr;}
\DoxyCodeLine{317     \textcolor{keywordtype}{double} dFz\_dR = (yCoeff * yVel + zCoeff * zVel) * delta +}
\DoxyCodeLine{318                     (yCoeff * yAcc + zCoeff * zAcc) * oneHalfATSquared;}
\DoxyCodeLine{319     \textcolor{keywordtype}{double} dFY\_dR = (cr * cpi * pitchVel -\/ sr * cpi * yawVel) * delta;}
\DoxyCodeLine{320 }
\DoxyCodeLine{321     xCoeff = -\/cp;}
\DoxyCodeLine{322     yCoeff = -\/sp * sr;}
\DoxyCodeLine{323     zCoeff = -\/sp * cr;}
\DoxyCodeLine{324     \textcolor{keywordtype}{double} dFz\_dP = (xCoeff * xVel + yCoeff * yVel + zCoeff * zVel) * delta +}
\DoxyCodeLine{325                     (xCoeff * xAcc + yCoeff * yAcc + zCoeff * zAcc) * oneHalfATSquared;}
\DoxyCodeLine{326     \textcolor{keywordtype}{double} dFY\_dP = (sr * tp * cpi * pitchVel -\/ cr * tp * cpi * yawVel) * delta;}
\DoxyCodeLine{327 }
\DoxyCodeLine{328     \textcolor{comment}{// Much of the transfer function Jacobian is identical to the transfer function}}
\DoxyCodeLine{329     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a9635224445b700f87c56cf1ed42b8b66}{transferFunctionJacobian\_}} = \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}};}
\DoxyCodeLine{330     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a9635224445b700f87c56cf1ed42b8b66}{transferFunctionJacobian\_}}(StateMemberX, StateMemberRoll) = dFx\_dR;}
\DoxyCodeLine{331     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a9635224445b700f87c56cf1ed42b8b66}{transferFunctionJacobian\_}}(StateMemberX, StateMemberPitch) = dFx\_dP;}
\DoxyCodeLine{332     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a9635224445b700f87c56cf1ed42b8b66}{transferFunctionJacobian\_}}(StateMemberX, StateMemberYaw) = dFx\_dY;}
\DoxyCodeLine{333     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a9635224445b700f87c56cf1ed42b8b66}{transferFunctionJacobian\_}}(StateMemberY, StateMemberRoll) = dFy\_dR;}
\DoxyCodeLine{334     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a9635224445b700f87c56cf1ed42b8b66}{transferFunctionJacobian\_}}(StateMemberY, StateMemberPitch) = dFy\_dP;}
\DoxyCodeLine{335     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a9635224445b700f87c56cf1ed42b8b66}{transferFunctionJacobian\_}}(StateMemberY, StateMemberYaw) = dFy\_dY;}
\DoxyCodeLine{336     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a9635224445b700f87c56cf1ed42b8b66}{transferFunctionJacobian\_}}(StateMemberZ, StateMemberRoll) = dFz\_dR;}
\DoxyCodeLine{337     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a9635224445b700f87c56cf1ed42b8b66}{transferFunctionJacobian\_}}(StateMemberZ, StateMemberPitch) = dFz\_dP;}
\DoxyCodeLine{338     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a9635224445b700f87c56cf1ed42b8b66}{transferFunctionJacobian\_}}(StateMemberRoll, StateMemberRoll) = dFR\_dR;}
\DoxyCodeLine{339     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a9635224445b700f87c56cf1ed42b8b66}{transferFunctionJacobian\_}}(StateMemberRoll, StateMemberPitch) = dFR\_dP;}
\DoxyCodeLine{340     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a9635224445b700f87c56cf1ed42b8b66}{transferFunctionJacobian\_}}(StateMemberPitch, StateMemberRoll) = dFP\_dR;}
\DoxyCodeLine{341     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a9635224445b700f87c56cf1ed42b8b66}{transferFunctionJacobian\_}}(StateMemberYaw, StateMemberRoll) = dFY\_dR;}
\DoxyCodeLine{342     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a9635224445b700f87c56cf1ed42b8b66}{transferFunctionJacobian\_}}(StateMemberYaw, StateMemberPitch) = dFY\_dP;}
\DoxyCodeLine{343 }
\DoxyCodeLine{344     FB\_DEBUG(\textcolor{stringliteral}{"Transfer function is:\(\backslash\)n"} << \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}} <<}
\DoxyCodeLine{345              \textcolor{stringliteral}{"\(\backslash\)nTransfer function Jacobian is:\(\backslash\)n"} << \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a9635224445b700f87c56cf1ed42b8b66}{transferFunctionJacobian\_}} <<}
\DoxyCodeLine{346              \textcolor{stringliteral}{"\(\backslash\)nProcess noise covariance is:\(\backslash\)n"} << \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_ae309020ee3466e4e73de7ab711b0f695}{processNoiseCovariance\_}} <<}
\DoxyCodeLine{347              \textcolor{stringliteral}{"\(\backslash\)nCurrent state is:\(\backslash\)n"} << \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}} << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{348 }
\DoxyCodeLine{349     Eigen::MatrixXd *processNoiseCovariance = \&\mbox{\hyperlink{classRobotLocalization_1_1FilterBase_ae309020ee3466e4e73de7ab711b0f695}{processNoiseCovariance\_}};}
\DoxyCodeLine{350 }
\DoxyCodeLine{351     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a93d04e061304bd001d604c9a28db40d8}{useDynamicProcessNoiseCovariance\_}})}
\DoxyCodeLine{352     \{}
\DoxyCodeLine{353       \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a027315e64db2c8d0f6ecc83d5ffd83a5}{computeDynamicProcessNoiseCovariance}}(\mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}, delta);}
\DoxyCodeLine{354       processNoiseCovariance = \&\mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a949fabe1bd9f06eeae1b79b40e19fd92}{dynamicProcessNoiseCovariance\_}};}
\DoxyCodeLine{355     \}}
\DoxyCodeLine{356 }
\DoxyCodeLine{357     \textcolor{comment}{// (1) Apply control terms, which are actually accelerations}}
\DoxyCodeLine{358     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}(StateMemberVroll) += \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a0f0d4a852a6538a86721f3e7c003b1b4}{controlAcceleration\_}}(ControlMemberVroll) * delta;}
\DoxyCodeLine{359     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}(StateMemberVpitch) += \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a0f0d4a852a6538a86721f3e7c003b1b4}{controlAcceleration\_}}(ControlMemberVpitch) * delta;}
\DoxyCodeLine{360     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}(StateMemberVyaw) += \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a0f0d4a852a6538a86721f3e7c003b1b4}{controlAcceleration\_}}(ControlMemberVyaw) * delta;}
\DoxyCodeLine{361 }
\DoxyCodeLine{362     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}(StateMemberAx) = (\mbox{\hyperlink{classRobotLocalization_1_1FilterBase_ac52608c95ed579d0388515ad9941676a}{controlUpdateVector\_}}[ControlMemberVx] ?}
\DoxyCodeLine{363       \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a0f0d4a852a6538a86721f3e7c003b1b4}{controlAcceleration\_}}(ControlMemberVx) : \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}(StateMemberAx));}
\DoxyCodeLine{364     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}(StateMemberAy) = (\mbox{\hyperlink{classRobotLocalization_1_1FilterBase_ac52608c95ed579d0388515ad9941676a}{controlUpdateVector\_}}[ControlMemberVy] ?}
\DoxyCodeLine{365       \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a0f0d4a852a6538a86721f3e7c003b1b4}{controlAcceleration\_}}(ControlMemberVy) : \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}(StateMemberAy));}
\DoxyCodeLine{366     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}(StateMemberAz) = (\mbox{\hyperlink{classRobotLocalization_1_1FilterBase_ac52608c95ed579d0388515ad9941676a}{controlUpdateVector\_}}[ControlMemberVz] ?}
\DoxyCodeLine{367       \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a0f0d4a852a6538a86721f3e7c003b1b4}{controlAcceleration\_}}(ControlMemberVz) : \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}}(StateMemberAz));}
\DoxyCodeLine{368 }
\DoxyCodeLine{369     \textcolor{comment}{// (2) Project the state forward: x = Ax + Bu (really, x = f(x, u))}}
\DoxyCodeLine{370     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}} = \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a5589e126890277eb435a07fd25871989}{transferFunction\_}} * \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}};}
\DoxyCodeLine{371 }
\DoxyCodeLine{372     \textcolor{comment}{// Handle wrapping}}
\DoxyCodeLine{373     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a76f3971d5c07e068ea1aa50e934b7c31}{wrapStateAngles}}();}
\DoxyCodeLine{374 }
\DoxyCodeLine{375     FB\_DEBUG(\textcolor{stringliteral}{"Predicted state is:\(\backslash\)n"} << \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a24e6fba6b9dceb9b581d5ac73ab0613f}{state\_}} <<}
\DoxyCodeLine{376              \textcolor{stringliteral}{"\(\backslash\)nCurrent estimate error covariance is:\(\backslash\)n"} <<  \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a6422083129fa8c2bc7a2bafa5a412dc4}{estimateErrorCovariance\_}} << \textcolor{stringliteral}{"\(\backslash\)n"});}
\DoxyCodeLine{377 }
\DoxyCodeLine{378     \textcolor{comment}{// (3) Project the error forward: P = J * P * J' + Q}}
\DoxyCodeLine{379     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a6422083129fa8c2bc7a2bafa5a412dc4}{estimateErrorCovariance\_}} = (\mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a9635224445b700f87c56cf1ed42b8b66}{transferFunctionJacobian\_}} *}
\DoxyCodeLine{380                                 \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a6422083129fa8c2bc7a2bafa5a412dc4}{estimateErrorCovariance\_}} *}
\DoxyCodeLine{381                                 \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a9635224445b700f87c56cf1ed42b8b66}{transferFunctionJacobian\_}}.transpose());}
\DoxyCodeLine{382     \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a6422083129fa8c2bc7a2bafa5a412dc4}{estimateErrorCovariance\_}}.noalias() += delta * (*processNoiseCovariance);}
\DoxyCodeLine{383 }
\DoxyCodeLine{384     FB\_DEBUG(\textcolor{stringliteral}{"Predicted estimate error covariance is:\(\backslash\)n"} << \mbox{\hyperlink{classRobotLocalization_1_1FilterBase_a6422083129fa8c2bc7a2bafa5a412dc4}{estimateErrorCovariance\_}} <<}
\DoxyCodeLine{385              \textcolor{stringliteral}{"\(\backslash\)n\(\backslash\)n-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ /Ekf::predict -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\(\backslash\)n"});}
\DoxyCodeLine{386   \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
mapping/robot\+\_\+localization/include/robot\+\_\+localization/ekf.\+h\item 
mapping/robot\+\_\+localization/src/ekf.\+cpp\end{DoxyCompactItemize}
